/*
 * DataFlex Web Application Framework 18.0
 * Copyright(c) Data Access Corporation 2014
 */


var df={psVersionId:((df&&df.psVersionId)||""),LT:0,LE:1,EQ:2,GE:3,GT:4,FIRST:6,LAST:7,ciTypeText:0,ciTypeBCD:1,ciTypeDate:2,ciTypeDateTime:3,ciRegionCenter:0,ciRegionLeft:1,ciRegionRight:2,ciRegionTop:3,ciRegionBottom:4,ciLabelLeft:0,ciLabelTop:1,ciLabelRight:2,ciAlignLeft:0,ciAlignCenter:1,ciAlignRight:2,ciDirGT:0,ciDirLT:1,ciOpenSameWindow:0,ciOpenNewTab:1,ciOpenNewWindow:2,cwiActual:0,cwiStretch:1,cwiStretchHoriz:2,cwiCenter:3,tString:0,tInt:1,tNumber:2,tDate:3,tBool:4,gtAutomatic:0,gtAllData:1,gtManual:2,cCallModeDefault:0,cCallModeWait:1,cCallModeProgress:2,smFind:0,smValidationTable:1,smCustom:2,psIncludeLocation:(function(){var aScripts;aScripts=document.getElementsByTagName("script");return aScripts[aScripts.length-1].src;}()),psRootPath:(function(){var aScripts,sPath;aScripts=document.getElementsByTagName("script");sPath=aScripts[aScripts.length-1].src;if(sPath&&sPath.indexOf('DfEngine')>0){return sPath.substr(0,sPath.indexOf('DfEngine'));}
return null;}()),ajax:{},lang:{},gui:{aZReservations:[true],reserveZIndex:function(){return this.aZReservations.push(true)-1;},freeZIndex:function(iIndex){var iRes;this.aZReservations[iIndex]=false;for(iRes=this.aZReservations.length-1;iRes>=0;iRes--){if(!this.aZReservations[iRes]){this.aZReservations.pop();}else{break;}}},dragMask:function(){var eMask;eMask=df.dom.create('<div class="WebApp_DragMask"></div>');document.body.appendChild(eMask);return eMask;}},defineClass:function(constructor,sSuper,oProto){var fConstructor,fSuper,oPrototype,FTemp,sProp,sSuperName;if(typeof(constructor)==="string"){if(df.sys){fConstructor=df.sys.ref.getNestedProp(constructor);}else{fConstructor=eval(constructor);}}else{fConstructor=constructor;}
if(arguments.length>2){oPrototype=arguments[arguments.length-1];if(typeof(arguments[1])==="string"){if(df.sys){fSuper=df.sys.ref.getNestedProp(arguments[1]);}else{fSuper=eval(arguments[1]);}}else{fSuper=arguments[1];}
if(typeof fSuper!=='function'){alert("Super class for '"+constructor+"' must be defined first ('"+arguments[1]+"')");}
oPrototype=arguments[2];FTemp=function(){};FTemp.prototype=fSuper.prototype;fConstructor.prototype=new FTemp();for(sProp in oPrototype){if(oPrototype.hasOwnProperty(sProp)){fConstructor.prototype[sProp]=oPrototype[sProp];}}
fConstructor.base=fSuper.prototype;}if(arguments.length===2){oPrototype=arguments[1];fConstructor.prototype=oPrototype;}
fConstructor.prototype.constructor=fConstructor;},mixin:function(sMixin,sSuper){var fSuper,fMixin,fConstructor,FTemp,sProp,sMixinName=sMixin;fSuper=df.sys.ref.getNestedProp(sSuper);fMixin=df.sys.ref.getNestedProp(sMixin);if(typeof fSuper!=='function'){alert("Super class for new mixed base class must be defined first ('"+sSuper+"')");return;}
if(typeof fMixin!=='function'){alert("Mixin class for new mixed base class must be defined first ('"+sMixin+"')");return;}
fConstructor=function(){fMixin.apply(this,arguments);};FTemp=function(){};FTemp.prototype=fSuper.prototype;fConstructor.prototype=new FTemp();for(sProp in fMixin.prototype){if(fMixin.prototype.hasOwnProperty(sProp)){fConstructor.prototype[sProp]=fMixin.prototype[sProp];}}
fConstructor.prototype.getBase=function(sOptClass){if(!sOptClass||sOptClass===sMixinName){return fSuper.prototype;}
fSuper.prototype.getBase.call(this,sOptClass);};fConstructor.prototype.constructor=fMixin;return fConstructor;},toBool:function(val){return(val==="0"||val==="-1"||val==="false"?false:!!val);},fromBool:function(bVal){return(bVal?"1":"0");},toInt:function(val){return parseInt(val,10);},toNumber:function(val){return parseFloat(val);},lastTime:new Date().getTime(),aLog:[],log:function(sLog){var currentTime,time;currentTime=new Date().getTime();time=(currentTime-this.lastTime)/1000;this.lastTime=currentTime;sLog=time+" : "+sLog;df.aLog.push(sLog);if(typeof(console)==="object"&&console.log){console.log(sLog);}},debug:function(sLog){if((typeof(bDfDebug)==="boolean"&&bDfDebug)||document.location.href.toLowerCase().indexOf('dfdebug=true')>0){df.log(sLog);}},handleError:function(oError,oOptSource){var oWebApp=null;if(oError instanceof df.Error){if(oOptSource&&oOptSource.getWebApp){oWebApp=oOptSource.getWebApp();}
if(oOptSource&&(oOptSource instanceof df.WebApp)){oWebApp=oOptSource;}
if(oWebApp){oWebApp.handleError(oError);}else{alert(oError.iNumber+": "+oError.sText+"\n\r Line: "+oError.iLine+"\n\r Target: "+oError.sTarget+"\n\r User error: "+oError.bUserError);}}else{throw oError;}}};df.Error=function Error(iNumber,sText,oOptSource,aOptReplacements,sOptDetailHtml,bOptSrv,bOptUsr,sOptCaption,oOptTarget,iOptLine){this.iNumber=iNumber;this.sText=sText;this.bUserError=!!bOptUsr;this.sCaption=sOptCaption||null;this.oSource=oOptSource||null;this.oTarget=oOptTarget||null;this.bServer=!!bOptSrv;this.iLine=iOptLine;this.sDetailHtml=sOptDetailHtml||null;if(aOptReplacements){this.sText=df.sys.data.format(this.sText,aOptReplacements);}};

df.settings={formKeys:{findGT:{iKeyCode:119,bCtrl:false,bShift:false,bAlt:false},findLT:{iKeyCode:118,bCtrl:false,bShift:false,bAlt:false},findGE:{iKeyCode:120,bCtrl:false,bShift:false,bAlt:false},findFirst:{iKeyCode:36,bCtrl:true,bShift:false,bAlt:false},findLast:{iKeyCode:35,bCtrl:true,bShift:false,bAlt:false},save:{iKeyCode:113,bCtrl:false,bShift:false,bAlt:false},clear:{iKeyCode:116,bCtrl:false,bShift:false,bAlt:false},clearAll:{iKeyCode:116,bCtrl:true,bShift:false,bAlt:false},remove:{iKeyCode:113,bCtrl:false,bShift:true,bAlt:false},prompt:{iKeyCode:115,bCtrl:false,bShift:false,bAlt:false},tabOut:{iKeyCode:9,bCtrl:false,bShift:false,bAlt:false},submit:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false},escape:{iKeyCode:27,bCtrl:false,bShift:false,bAlt:false}},listKeys:{scrollUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},scrollDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},scrollPageUp:{iKeyCode:33,bCtrl:false,bShift:false,bAlt:false},scrollPageDown:{iKeyCode:34,bCtrl:false,bShift:false,bAlt:false},scrollTop:[{iKeyCode:36,bCtrl:true,bShift:false,bAlt:false},{iKeyCode:38,bCtrl:true,bShift:false,bAlt:false}],scrollBottom:[{iKeyCode:35,bCtrl:true,bShift:false,bAlt:false},{iKeyCode:40,bCtrl:true,bShift:false,bAlt:false}],search:{iKeyCode:70,bCtrl:true,bShift:false,bAlt:false}},gridKeys:{nextCol:{iKeyCode:9,bCtrl:false,bShift:false,bAlt:false},prevCol:{iKeyCode:9,bCtrl:false,bShift:true,bAlt:false},newRow:{iKeyCode:121,bCtrl:false,bShift:true,bAlt:false}},tabKeys:{enter:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false}},calendarKeys:{dayUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},dayDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},dayLeft:{iKeyCode:37,bCtrl:false,bShift:false,bAlt:false},dayRight:{iKeyCode:39,bCtrl:false,bShift:false,bAlt:false},monthUp:{iKeyCode:33,bCtrl:false,bShift:false,bAlt:false},monthDown:{iKeyCode:34,bCtrl:false,bShift:false,bAlt:false},yearUp:{iKeyCode:33,bCtrl:true,bShift:false,bAlt:false},yearDown:{iKeyCode:34,bCtrl:true,bShift:false,bAlt:false},enter:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false},close:{iKeyCode:27,bCtrl:false,bShift:false,bAlt:false}},treeKeys:{moveUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},moveDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},collapse:{iKeyCode:37,bCtrl:false,bShift:false,bAlt:false},extend:{iKeyCode:39,bCtrl:false,bShift:false,bAlt:false},moveFirst:{iKeyCode:36,bCtrl:false,bShift:false,bAlt:false},moveLast:{iKeyCode:35,bCtrl:false,bShift:false,bAlt:false},enter:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false}},sliderKeys:{sliderUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},sliderDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},sliderLeft:{iKeyCode:37,bCtrl:false,bShift:false,bAlt:false},sliderRight:{iKeyCode:39,bCtrl:false,bShift:false,bAlt:false}},spinKeys:{moveUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},moveDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false}},suggestionKeys:{moveUp:{iKeyCode:38,bCtrl:false,bShift:false,bAlt:false},moveDown:{iKeyCode:40,bCtrl:false,bShift:false,bAlt:false},select:{iKeyCode:13,bCtrl:false,bShift:false,bAlt:false},escape:[{iKeyCode:27,bCtrl:false,bShift:false,bAlt:false},{iKeyCode:9,bCtrl:false,bShift:false,bAlt:false}],forceDisplay:{iKeyCode:32,bCtrl:true,bShift:false,bAlt:false}}};

df.events={KEY_CODE_TAB:9,KEY_CODE_NON_EDIT:{37:1,38:1,39:1,40:1,35:1,36:1,9:1},KEY_CODE_SPECIAL:{37:1,38:1,39:1,40:1,35:1,36:1,46:1,8:1,9:1},addDomCaptureListener:function(sEvent,eElement,fListener,oEnvironment){if(window.addEventListener){sEvent="capture_"+sEvent;}
this.addDomListener(sEvent,eElement,fListener,oEnvironment);},removeDomCaptureListener:function(sEvent,eElement,fListener){if(window.addEventListener){sEvent="capture_"+sEvent;}
this.removeDomListener(sEvent,eElement,fListener);},addDomListener:function(sEvent,eElement,fListener,oEnvironment){var oDOMHandler;if(eElement._oDfDomH===undefined||!eElement._oDfDomH[sEvent]){oDOMHandler=new df.events.DOMHandler(sEvent,eElement);}else{oDOMHandler=eElement._oDfDomH[sEvent];}
oDOMHandler.addListener(fListener,oEnvironment);},removeDomListener:function(sEvent,eElement,fListener){if(eElement._oDfDomH!==undefined&&eElement._oDfDomH[sEvent]){eElement._oDfDomH[sEvent].removeListener(fListener);}},addDomKeyListener:function(eElement,fListener,oEnvironment){df.events.addDomListener("keydown",eElement,fListener,oEnvironment);},removeDomKeyListener:function(eElement,fListener){df.events.removeDomListener("keydown",eElement,fListener);},addDomMouseWheelListener:function(eElement,fListener,oEnvironment){if(df.sys.isMoz){df.events.addDomListener("DOMMouseScroll",eElement,fListener,oEnvironment);}else{df.events.addDomListener("mousewheel",eElement,fListener,oEnvironment);}},removeDomMouseWheelListener:function(eElement,fListener){if(df.sys.isMoz){df.events.removeDomListener("DOMMouseScroll",eElement,fListener);}else{df.events.removeDomListener("mousewheel",eElement,fListener);}},stop:function(oEvent){oEvent.stop();},iDOMHandlers:0,oDOMHandlers:{},clearDomHandlers:function(){var iHandlerId;for(iHandlerId in df.events.oDOMHandlers){if(df.events.oDOMHandlers.hasOwnProperty(iHandlerId)){if(df.events.oDOMHandlers[iHandlerId].__DOMHandler){df.events.oDOMHandlers[iHandlerId].clear();}}}},clearDomListeners:function(eElement,bRecursive){var sEvent;if(eElement._oDfDomH){for(sEvent in eElement._oDfDomH){if(eElement._oDfDomH.hasOwnProperty(sEvent)){eElement._oDfDomH[sEvent].clear();}}}
if(bRecursive){df.dom.visit(eElement,function(eChild){df.events.clearDomListeners(eChild,true);});}}};df.events.DOMHandler=function DOMHandler(sEvent,eElement){this.sEvent=sEvent;this.eElement=eElement;this.aListeners=[];this.aRemoveListeners=[];this.bFiring=false;this.fHandler=null;this.__DOMHandler=true;this.iHandlerId=df.events.iDOMHandlers++;this.attach();};df.defineClass("df.events.DOMHandler",{attach:function(){var oDOMHandler,fHandler;oDOMHandler=this;fHandler=function(e){return oDOMHandler.fire(e);};if(window.addEventListener){if(this.sEvent.substr(0,8)==="capture_"){this.eElement.addEventListener(this.sEvent.substr(8),fHandler,true);}else{this.eElement.addEventListener(this.sEvent,fHandler,false);}}else{this.eElement.attachEvent("on"+this.sEvent,fHandler);}
if(!this.eElement._oDfDomH){this.eElement._oDfDomH={};}
this.eElement._oDfDomH[this.sEvent]=this;df.events.oDOMHandlers[this.iHandlerId]=this;this.fHandler=fHandler;},clear:function(){if(window.addEventListener){this.eElement.removeEventListener(this.sEvent,this.fHandler,false);}else{this.eElement.detachEvent("on"+this.sEvent,this.fHandler);}
delete this.eElement._oDfDomH[this.sEvent];delete df.events.oDOMHandlers[this.iHandlerId];},addListener:function(fListener,oEnvironment){if(typeof(fListener)!=="function"){throw new df.Error(5131,"Listener must be a function (event: {{0}})",this,[this.sEvent]);}
this.aListeners.push({"fListener":fListener,"oEnvironment":oEnvironment});},removeListener:function(fListener){var i;for(i=0;i<this.aListeners.length;i++){if(this.aListeners[i].fListener===fListener){if(this.bFiring){this.aListeners[i].fListener=null;this.aRemoveListeners.push(fListener);}else{if(this.aListeners.length>1){this.aListeners.splice(i,1);}else{this.clear();}}
break;}}},fire:function(e){var i,oEvent;oEvent=new df.events.DOMEvent(e,this.eElement,this.sEvent);this.bFiring=true;for(i=0;i<this.aListeners.length&&!oEvent.bCanceled;i++){if(typeof(this.aListeners[i].fListener)==="function"){try{if(this.aListeners[i].fListener.call((this.aListeners[i].oEnvironment!==undefined?this.aListeners[i].oEnvironment:this.eElement),oEvent)===false){oEvent.stop();}}catch(oError){df.handleError(oError);}}}
this.bFiring=false;while(this.aRemoveListeners.length>0){this.removeListener(this.aRemoveListeners.pop());}
if(oEvent.bCanceled){if(e.preventDefault){e.preventDefault();}
e.returnValue=false;return false;}
return true;}});df.events.DOMEvent=function DOMEvent(e,eSource,sName){this.eSource=eSource;if(!e){this.e=window.event;}else{this.e=e;}
this.sName=sName;this.bCanceled=false;};df.defineClass("df.events.DOMEvent",{getTarget:function(){var eTarget;if(this.e.target){eTarget=this.e.target;}else if(this.e.srcElement){eTarget=this.e.srcElement;}
if(eTarget.nodeType===3){eTarget=eTarget.parentNode;}
return eTarget;},getMouseX:function(){return this.e.clientX;},getMouseY:function(){return this.e.clientY;},getKeyCode:function(){return this.e.keyCode;},isSpecialKey:function(){var iKeyCode=this.getKeyCode();if((df.sys.isIE||df.sys.isSafari)&&this.e.type==="keypress"){return false;}
return(this.getAltKey()||this.getCtrlKey()||(df.events.KEY_CODE_SPECIAL[iKeyCode]&&iKeyCode!==0));},getCharCode:function(){if(this.e.charCode){return this.e.charCode;}
return 0;},getCtrlKey:function(){return this.e.ctrlKey;},getShiftKey:function(){return this.e.shiftKey;},getAltKey:function(){return this.e.altKey;},getMouseButton:function(){if(this.e.which){switch(this.e.which){case 0:return 1;case 1:return 4;case 2:return 2;default:return 0;}}else{return this.e.button;}},getMouseWheelDelta:function(){var iDelta=0;if(this.e.detail){iDelta=-this.e.detail/3;}else if(this.e.wheelDelta){iDelta=this.e.wheelDelta/120;}
return iDelta;},stop:function(){this.bCanceled=true;this.e.returnValue=false;this.e.cancelBubble=true;this.e.canceled=true;if(this.e.preventDefault){this.e.preventDefault();}
if(this.e.stopPropagation){this.e.stopPropagation();}
if(df.sys.isIE&&this.sName.indexOf("key")>=0){this.e.keyCode=0;}},matchKey:function(keydef){var i;if(keydef){if(keydef instanceof Array){for(i=0;i<keydef.length;i++){if(keydef[i].iKeyCode===this.getKeyCode()&&keydef[i].bCtrl===this.getCtrlKey()&&keydef[i].bShift===this.getShiftKey()&&keydef[i].bAlt===this.getAltKey()){return true;}}}else{return(keydef.iKeyCode===this.getKeyCode()&&keydef.bCtrl===this.getCtrlKey()&&keydef.bShift===this.getShiftKey()&&keydef.bAlt===this.getAltKey());}}
return false;}});df.events.addDomListener("unload",window,df.events.clearDomHandlers);df.events.JSHandler=function JSHandler(){this.aListeners=[];this.aRemoveListeners=[];this.bFiring=false;};df.defineClass("df.events.JSHandler",{addListener:function(fListener,oEnvironment){if(typeof(fListener)!=="function"){throw new df.Error(5131,"Listener must be a function",this,[this.sEvent]);}
this.aListeners.push({"fListener":fListener,"oEnvironment":oEnvironment});},removeListener:function(fListener){var iListener;for(iListener=0;iListener<this.aListeners.length;iListener++){if(this.aListeners[iListener].fListener===fListener){if(this.bFiring){this.aListeners[iListener].fListener=null;this.aRemoveListeners.push(fListener);}else{this.aListeners.splice(iListener,1);}}}},fire:function(oSource,oOptions){if(this.aListeners.length>0){var iListener,oEvent;oEvent=(oOptions instanceof df.events.JSEvent?oOptions:new df.events.JSEvent(oSource,oOptions));this.bFiring=true;for(iListener=0;iListener<this.aListeners.length&&!oEvent.bCanceled;iListener++){if(typeof(this.aListeners[iListener].fListener)==="function"){try{if(this.aListeners[iListener].fListener.call((this.aListeners[iListener].oEnvironment!==undefined?this.aListeners[iListener].oEnvironment:this.eElement),oEvent)===false){oEvent.stop();}}catch(oError){df.handleError(oError,oSource);}}}
this.bFiring=false;while(this.aRemoveListeners.length>0){this.removeListener(this.aRemoveListeners.pop());}
return!oEvent.bCanceled;}
return true;}});df.events.JSEvent=function JSEvent(oSource,oOptions){var sProp;this.oSource=oSource;this.bCanceled=false;if(typeof(oOptions)==="object"){for(sProp in oOptions){if(oOptions.hasOwnProperty(sProp)){this[sProp]=oOptions[sProp];}}}};df.defineClass("df.events.JSEvent",{getTarget:function(){return this.oSource;},stop:function(){this.bCanceled=true;}});

df.dom={cFocusSelector:'a, button, textarea, input, iframe, select, *[tabindex]',piDomCounter:0,genDomId:function(){return"df:"+this.piDomCounter++;},addClass:function(eElem,sClass){var aClasses,sClassName,i;if(eElem.className){aClasses=(sClass||"").split(/\s+/);sClassName=" "+eElem.className+" ";for(i=0;i<aClasses.length;i++){if(sClassName.indexOf(" "+aClasses[i]+" ")<0){sClassName+=" "+aClasses[i];}}
eElem.className=df.sys.string.trim(sClassName);}else{eElem.className=sClass;}},removeClass:function(eElem,sClass){var aClasses,sClassName,i;if(eElem.className){sClass=" "+sClass+" ";aClasses=eElem.className.split(/\s+/);sClassName="";for(i=0;i<aClasses.length;i++){if(sClass.indexOf(" "+aClasses[i]+" ")<0){sClassName+=" "+aClasses[i];}}
eElem.className=df.sys.string.trim(sClassName);}},toggleClass:function(eElem,sClass,bVal){if(bVal){this.addClass(eElem,sClass);}else{this.removeClass(eElem,sClass);}},createCSSElem:function(sFile){var eStyle=document.createElement('link');eStyle.rel='stylesheet';eStyle.type='text/css';eStyle.href=sFile;return eStyle;},setText:function(eElem,sValue){if(sValue===" "){eElem.innerHTML="&nbsp;";}else{sValue=sValue.toString().replace(/\\n\\r/gi,'\n');if(eElem.innerText!==undefined){eElem.innerText=sValue;}else{eElem.textContent=sValue;}}},getText:function(eElem){if(eElem.innerText!==undefined){return eElem.innerText;}
return eElem.textContent;},getOuterHTML:function(eElem){var eParent,eFake,sHTML;if(eElem.outerHTML){return eElem.outerHTML;}
if(eElem.parentNode){eParent=eElem.parentNode;eFake=document.createElement(eParent.tagName);eFake.appendChild(eElem);sHTML=eFake.innerHTML;eParent.appendChild(eElem);return sHTML;}
return null;},deepClone:function(eOrig){var eClone,fChecker;eClone=eOrig.cloneNode(true);fChecker=function(eClone,eOrig){var iChild;if(eClone.tagName==="SELECT"||eClone.tagName==="TEXTAREA"){eClone.value=eOrig.value;}
for(iChild=0;iChild<eClone.childNodes.length;iChild++){if(eClone.childNodes[iChild].nodeType!==3&&eClone.childNodes[iChild].nodeType!==8){fChecker(eClone.childNodes[iChild],eOrig.childNodes[iChild]);}}};fChecker(eClone,eOrig);return eClone;},swapNodes:function(eOrig,eNew){if(eOrig){if(eNew){if(eOrig.replaceNode!==undefined){eOrig.replaceNode(eNew);}else{eOrig.parentNode.replaceChild(eNew,eOrig);}}}},insertAfter:function(eNewElement,eElem){if(eElem.nextSibling!==null){eElem.parentNode.insertBefore(eNewElement,eElem.nextSibling);}else{eElem.parentNode.appendChild(eNewElement);}},isParent:function(eStart,eSearch){if(eStart===null){return false;}
if(eStart===eSearch){return true;}
if(eStart.parentNode!==undefined){return this.isParent(eStart.parentNode,eSearch);}
return false;},searchParent:function(eElem,sTagName){sTagName=sTagName.toUpperCase();if(eElem.tagName===sTagName){return eElem;}
if(eElem.parentNode!==undefined&&eElem!==document){return this.searchParent(eElem.parentNode,sTagName);}
return null;},focus:function(eElem,bSelect){try{eElem.focus();if(bSelect&&eElem.select){eElem.select();}
if(typeof(eElem.setActive)==="function"){eElem.setActive();}}catch(err){}},getCaretPosition:function(eField){var oSelection,oSelection2,iSelection;try{if(document.selection){if(eField.tagName.toLowerCase()==="textarea"){oSelection=document.selection.createRange();oSelection2=oSelection.duplicate();oSelection2.moveToElementText(eField);oSelection2.setEndPoint('StartToEnd',oSelection);return eField.value.length-oSelection2.text.length;}
eField.focus();oSelection=document.selection.createRange();iSelection=oSelection.text.length;oSelection.moveStart('character',-eField.value.length);return oSelection.text.length-iSelection;}
if(eField.selectionStart||eField.selectionStart===0){return eField.selectionStart;}}catch(e){}
return 0;},getSelectionLength:function(eField){var oBookmark,oSelection;try{if(eField.selectionStart||eField.selectionStart===0){return eField.selectionEnd-eField.selectionStart;}
if(document.selection){oBookmark=document.selection.createRange().getBookmark();oSelection=eField.createTextRange();oSelection.moveToBookmark(oBookmark);return oSelection.text.length;}}catch(e){}
return 0;},setCaretPosition:function(eField,iCaretPos){try{if(document.selection){eField.focus();var oSel=document.selection.createRange();oSel.moveStart('character',-eField.value.length);oSel.moveEnd('character',-eField.value.length);oSel.moveStart('character',iCaretPos);oSel.select();}else if(eField.selectionStart||eField.selectionStart===0){eField.selectionStart=iCaretPos;eField.selectionEnd=iCaretPos;eField.focus();}}catch(e){}},getFirstFocusChild:function(eElem){var aElems,i;aElems=df.dom.query(eElem,df.dom.cFocusSelector,true);for(i=0;i<aElems.length;i++){if(aElems[i].tabIndex>=0&&aElems[i].type!=="hidden"){return aElems[i];}}
return null;},visit:function(eElem,fWorker,oEnv){var iChild;if(eElem.childNodes){for(iChild=0;iChild<eElem.childNodes.length;iChild++){if(eElem.childNodes[iChild].nodeType!==3&&eElem.childNodes[iChild].nodeType!==8){if(fWorker.call(oEnv||this,eElem.childNodes[iChild])===false){return false;}}}}
return true;},disableTextSelection:function(eElem){eElem.unselectable="on";eElem.style.MozUserSelect="none";eElem.style.webkitUserSelect="none";},enableTextSelection:function(eElem){eElem.unselectable="off";eElem.style.MozUserSelect="text";eElem.style.webkitUserSelect="text";},ready:function(fWorker,oEnv){function call(){fWorker.call(oEnv||null);if(window.addEventListener){window.removeEventListener("load",call,false);}else{window.detachEvent("onload",call);}}
if(document.readyState==="complete"){call();}else{if(window.addEventListener){window.addEventListener("load",call,false);}else{window.attachEvent("onload",call);}}},create:function(sHtml){var eWrapper=document.createElement("div");eWrapper.innerHTML=sHtml;return eWrapper.firstChild;},query:function(eElem,sSelect,bOptMulti){if(!bOptMulti&&eElem.querySelector){return eElem.querySelector(sSelect);}
if(eElem.querySelectorAll){var aRes=eElem.querySelectorAll(sSelect);if(bOptMulti){return aRes;}
return(aRes.length>0?aRes[0]:null);}
throw new df.Error(999,"This browser doesn't support querySelectorAll");}};

df.sys={isSafari:false,isChrome:false,isOpera:false,isMoz:false,isIE:false,isWebkit:false,iVersion:0,ref:{getType:function(oObject){var sType=typeof(oObject);if(sType==="object"){if(oObject===null||oObject===undefined){sType="null";}else if(oObject.constructor===Array){sType="array";}else if(oObject.constructor===Date){sType="date";}else{sType=this.getConstructorName(oObject);}}
return sType;},getConstructorName:function(oObject){var sName=this.getMethodName(oObject.constructor);if(sName===""){sName="object";}
return sName;},getMethodName:function(fFunction){var sString;try{sString=fFunction.toString();return sString.substring(sString.indexOf("function")+8,sString.indexOf('(')).replace(/ /g,'');}catch(e){return"";}},getGlobalObj:function(){return(function(){return this;}).call(null);},getNestedProp:function(sPath){var aParts,oProp,iPart;aParts=sPath.split(".");oProp=df.sys.ref.getGlobalObj();for(iPart=0;iPart<aParts.length;iPart++){if(typeof oProp==="object"&&oProp!==null){oProp=oProp[aParts[iPart]];}else{return null;}}
return oProp;}},math:{padZero:function(iNum,iDigits)
{var sResult=iNum.toString();while(sResult.length<iDigits){sResult="0"+sResult;}
return sResult;}},data:{stringToNum:function(sVal,sDecSep,sOptThousSepp){return sVal&&parseFloat(sVal.replace(sOptThousSepp||"","").replace(sDecSep,"."));},numToString:function(nVal,sDecSep,iPrecision){var aVal,sVal;nVal=nVal||0.0;sVal=nVal.toString().replace(".",sDecSep);if(iPrecision>0){aVal=sVal.split(sDecSep);if(aVal.length<2){aVal[1]="";}
aVal[1]=(aVal[1]+"0000000000000000000").substr(0,iPrecision);sVal=aVal[0]+sDecSep+aVal[1];}
return sVal;},applyDateMask:function(dValue,sMask,sDateSeparator){return sMask.replace(/(m{1,4}|d{1,4}|yyyy|yy|\/)/gi,function(sValue,iPos){switch(sValue.toLowerCase()){case"m":return dValue.getMonth()+1;case"mm":return df.sys.math.padZero(dValue.getMonth()+1,2);case"mmm":return df.sys.string.copyCase(df.lang.monthsShort[dValue.getMonth()],sValue);case"mmmm":return df.sys.string.copyCase(df.lang.monthsLong[dValue.getMonth()],sValue);case"d":return dValue.getDate();case"dd":return df.sys.math.padZero(dValue.getDate(),2);case"ddd":return df.sys.string.copyCase(df.lang.daysShort[dValue.getDay()],sValue);case"dddd":return df.sys.string.copyCase(df.lang.daysLong[dValue.getDay()],sValue);case"yy":return df.sys.math.padZero(dValue.getFullYear()%100,2);case"yyyy":return df.sys.math.padZero(dValue.getFullYear(),4);case"/":return sDateSeparator;}
return sValue;});},applyNumMask:function(nValue,sMask,sDecSep,sThousSep,sCurSym){var aParts,aResult=[],sChar,bEscape,iChar,iNumChar,iCount,sBefore,sDecimals,sMaskBefore,sMaskDecimals=null,sValue,iMaskBefore=0,iMaskDecimals=0,bThousands=false,bBefore=true;sMask=sMask.replace(/&curren;/g,sCurSym).replace(/&euro;/g,String.fromCharCode(0x20ac));if(sMask.charAt(0)==="Z"){if(nValue===0.0){return"";}
sMask=sMask.substr(1);}
aParts=sMask.split(";");if(nValue<0.0){if(aParts.length>1){sMask=aParts[1];}else{sMask="-"+aParts[0];}}else{sMask=aParts[0];}
aParts=sMask.split(".");sMaskBefore=aParts[0];if(aParts.length>1){sMaskDecimals=aParts[1];}
for(iChar=0;iChar<sMask.length;iChar++){switch(sMask.charAt(iChar)){case"\\":iChar++;break;case"#":case"0":if(bBefore){if(iMaskBefore>=0){iMaskBefore++;}}else{if(iMaskDecimals>=0){iMaskDecimals++;}}
break;case"*":if(bBefore){iMaskBefore=-1;}else{iMaskDecimals=-1;}
break;case",":bThousands=true;break;case".":bBefore=false;break;}}
if(iMaskDecimals>=0){nValue=nValue.toFixed(iMaskDecimals);}
sValue=(nValue===0.0?"":String(nValue));aParts=sValue.split(".");sBefore=aParts[0];if(aParts.length>1){sDecimals=aParts[1];}else{sDecimals="";}
if(sBefore.charAt(0)==="-"){sBefore=sBefore.substr(1);}
iChar=sMaskBefore.length-1;iNumChar=sBefore.length-1;iCount=0;while(iChar>=0){sChar=sMaskBefore.charAt(iChar);bEscape=(iChar>0&&sMaskBefore.charAt(iChar-1)==="\\");if(!bEscape&&(sChar==="#"||sChar==="*"||sChar==="0")){while(iNumChar>=0||sChar==="0"){if(iCount>=3){iCount=0;if(bThousands){aResult.unshift(sThousSep);}}
aResult.unshift((iNumChar>=0?sBefore.charAt(iNumChar):"0"));iNumChar--;iCount++;if(sChar==="#"||sChar==="0"){break;}}}else{if((sChar!==","&&sChar!=="\\")||bEscape){aResult.unshift(sChar);}}
iChar--;}
if(sMaskDecimals!==null){aResult.push(sDecSep);iNumChar=0;for(iChar=0;iChar<sMaskDecimals.length;iChar++){sChar=sMaskDecimals.charAt(iChar);bEscape=(iChar>0&&sMaskBefore.charAt(iChar-1)==="\\");if(!bEscape&&(sChar==="#"||sChar==="*"||sChar==="0")){while(iNumChar<sDecimals.length||sChar==="0"){aResult.push((iNumChar>=0?sDecimals.charAt(iNumChar):"0"));iNumChar++;if(sChar==="#"||sChar==="0"){break;}}}else{if(sChar!=="\\"||bEscape){aResult.push(sChar);}}}}
return aResult.join("");},applyWinMask:function(sValue,sMask){var iChar=0,iValChar=0,aResult=[],bFound,sChar;if(sValue===""){return"";}
if(sMask===""){return sValue;}
while(iChar<sMask.length){sChar=sMask.charAt(iChar);if(sChar==="\\"&&sMask.length>(iChar+1)){aResult.push(sMask.charAt(iChar+1));}else{if(sChar==="#"||sChar==="@"||sChar==="!"||sChar==="*"){bFound=false;while(iValChar<sValue.length&&!bFound){if(this.acceptWinMaskChar(sValue.charAt(iValChar),sChar)){aResult.push(sValue.charAt(iValChar));bFound=true;}
iValChar++;}
if(!bFound){break;}}else{aResult.push(sChar);}}
iChar++;}
return aResult.join("");},acceptWinMaskChar:function(sValChar,sChar){return((sChar==="#"&&sValChar.match(/[0-9]/))||(sChar==="@"&&sValChar.match(/[a-zA-Z]/))||(sChar==="!"&&sValChar.match(/[^a-zA-Z0-9]/))||sChar==="*");},stringToDate:function(sValue,sFormat,sDateSeparator){var dResult,dToday=new Date(),iChar,aMask,aData,sChar,iPart,sPart,iDate,iMonth,iYear;sFormat=sFormat.toLowerCase();if(df.sys.string.trim(sValue)===""){return null;}
if(typeof sDateSeparator!=="string"){for(iChar=0;iChar<sFormat.length;iChar++){sChar=sFormat.charAt(iChar).toLowerCase();if(sChar!=="m"&&sChar!=="d"&&sChar!=="y"){sDateSeparator=sChar;break;}}}
aMask=sFormat.toLowerCase().split("/");if(aMask.length===0){aMask=sFormat.toLowerCase.split(sDateSeparator);}
aData=sValue.toLowerCase().split(sDateSeparator);for(iPart=0;iPart<aData.length&&iPart<aMask.length;iPart++){sPart=aData[iPart];switch(aMask[iPart]){case"d":case"dd":iDate=parseInt(sPart,10);break;case"m":case"mm":iMonth=parseInt(sPart,10);break;case"yy":case"yyyy":iYear=parseInt(sPart,10);if(sPart.length===2){iYear=(iYear>50?iYear+1900:iYear+2000);}else if(sPart.length===0){iYear=dToday.getFullYear();}
break;}}
dResult=new Date(1,1,1,1,1,1);if(iYear){if(iYear>9999){iYear=9999;}
if(iYear<-9999){iYear=0;}
dResult.setFullYear((iYear>9999?9999:(iYear<0?0:iYear)));}else{dResult.setFullYear(dToday.getFullYear());}
if(iMonth){dResult.setMonth((iMonth<0?0:(iMonth>12?11:iMonth-1)));}else{dResult.setMonth(dToday.getMonth());}
if(iDate){iDate=(iDate<1?1:(iDate>31?31:iDate));}else{iDate=dToday.getDate();}
iMonth=dResult.getMonth();iYear=dResult.getFullYear();dResult.setDate(iDate);while(dResult.getMonth()!==iMonth){dResult.setFullYear(iYear);dResult.setMonth(iMonth);iDate--;dResult.setDate(iDate);}
return dResult;},dateToString:function(dValue,sFormat,sDateSeparator){return this.applyDateMask(dValue,sFormat,sDateSeparator||"/");},dateToWeek:function(dDate){var iYear,iMonth,iDate,dNow,dFirstDay,dThen,iCompensation,iNumberOfWeek;iYear=dDate.getFullYear();iMonth=dDate.getMonth();iDate=dDate.getDate();dNow=Date.UTC(iYear,iMonth,iDate+1,0,0,0);dFirstDay=new Date();dFirstDay.setFullYear(iYear);dFirstDay.setMonth(0);dFirstDay.setDate(1);dThen=Date.UTC(iYear,0,1,0,0,0);iCompensation=dFirstDay.getDay();if(iCompensation>3){iCompensation-=4;}else{iCompensation+=3;}
iNumberOfWeek=Math.round((((dNow-dThen)/86400000)+iCompensation)/7);return iNumberOfWeek;},removeFromArray:function(aArray,oObj){var i;for(i=0;i<aArray.length;i++){if(aArray[i]===oObj){aArray.splice(i,1);}}},formatRegExp:/\{\{([0-1a-zA-Z]+)\}\}/gi,format:function(sStr,oReps){var reps=oReps||{};return sStr.replace(this.formatRegExp,function(str,p1,offset,s){if(reps.hasOwnProperty(p1)){return reps[p1];}
return str;});},markupDataSize:function(iBytes){var nVal;if(iBytes<1024){return iBytes+" B";}
nVal=iBytes/1024;if(nVal<2048){return Math.round(nVal)+" kB";}
nVal=nVal/1024;if(nVal<2048){if(nVal<100){return((Math.round(nVal)*10)/10)+" MB";}
return Math.round(nVal)+" MB";}
nVal=nVal/1024;if(nVal<2048){if(nVal<100){return((Math.round(nVal)*10)/10)+" GB";}
return Math.round(nVal)+" GB";}
nVal=nVal/1024;if(nVal<2048){if(nVal<100){return((Math.round(nVal)*10)/10)+" TB";}
return Math.round(nVal)+" TB";}
nVal=nVal/1024;if(nVal<100){return((Math.round(nVal)*10)/10)+" PB";}
return Math.round(nVal)+" PB";},escapeRegExp:function(sStr){return sStr.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");}},cookie:{set:function(sVar,sValue,iExpires){var date=new Date();if(iExpires){date.setHours(date.getHours()+iExpires);document.cookie=sVar+"="+sValue+"; expires="+date.toGMTString();}else{document.cookie=sVar+"="+sValue;}},del:function(sVar){var date=new Date();date.setTime(date.getTime()-1);document.cookie=sVar+"=; expires="+date.toGMTString();},get:function(sVar,sDefault){var sResult=null,aVars,aVar,iVar;if(document.cookie){aVars=document.cookie.split(';');for(iVar=0;iVar<aVars.length&&sResult===null;iVar++){aVar=aVars[iVar].split('=');if(aVar.length>1){if(df.sys.string.trim(aVar[0])===df.sys.string.trim(sVar)){sResult=aVar[1];}}}}
if(sResult!==null){return sResult;}
return sDefault;}},gui:{findParentRef:function(oControl){var eContent=oControl._eElem;eContent=eContent.parentNode||eContent;while(oControl){if(oControl instanceof df.WebBaseContainer){if(oControl._eSizer){eContent=oControl._eSizer;if(oControl._eContainer.scrollHeight>oControl._eContainer.clientHeight){return eContent;}}else{eContent=oControl._eSizer;}}
if(oControl instanceof df.WebCard){return eContent;}
if(oControl instanceof df.WebView){if(oControl._eContainer.scrollHeight>oControl._eContainer.clientHeight){return eContent;}
return oControl._eElem;}
oControl=oControl._oParent;}
return eContent;},disableTabIndexes:function(eParent){var iElem,aElems,eElem;aElems=df.dom.query(eParent,df.dom.cFocusSelector,true);for(iElem=0;iElem<aElems.length;iElem++){eElem=aElems[iElem];if(eElem.getAttribute("data-dfOrigTabIndex")===null){eElem.setAttribute("data-dfTabIndexCount",1);eElem.setAttribute("data-dfOrigTabIndex",eElem.tabIndex);eElem.tabIndex="-1";}else{eElem.setAttribute("data-dfTabIndexCount",parseInt(eElem.getAttribute("data-dfTabIndexCount"),10)+1);}}},restoreTabIndexes:function(eParent){var iElem,aElems,eElem;aElems=df.dom.query(eParent,df.dom.cFocusSelector,true);for(iElem=0;iElem<aElems.length;iElem++){eElem=aElems[iElem];if(parseInt(eElem.getAttribute("data-dfTabIndexCount"),10)!==null){if(eElem.getAttribute("data-dfTabIndexCount")<=1){eElem.tabIndex=eElem.getAttribute("data-dfOrigTabIndex");eElem.removeAttribute("data-dfOrigTabIndex");eElem.removeAttribute("data-dfTabIndexCount");}else{eElem.setAttribute("data-dfTabIndexCount",parseInt(eElem.getAttribute("data-dfTabIndexCount"),10)-1);}}}},hidePlugins:function(eElem){var aElems,i,aHidden=[];if(df.sys.isIE){aElems=df.dom.query(eElem,"iframe, object, embed",true);for(i=0;i<aElems.length;i++){eElem=aElems[i];if(eElem.getAttribute("data-df-hiddenplugin")!=="yes"){aHidden.push(eElem);eElem.style.display="none";eElem.setAttribute("data-df-hiddenplugin","yes");}}}
return aHidden;},restorePlugins:function(aHidden){var i;for(i=0;i<aHidden.length;i++){aHidden[i].style.display="";aHidden[i].removeAttribute("data-df-hiddenplugin");}},getAbsoluteOffset:function(eElement){var oReturn={left:0,top:0},bFirst=true;if(eElement.offsetParent){while(eElement&&(bFirst||df.sys.gui.getCurrentStyle(eElement).position!=="absolute")&&df.sys.gui.getCurrentStyle(eElement).position!=="fixed"&&df.sys.gui.getCurrentStyle(eElement).position!=="relative"){bFirst=false;oReturn.top+=eElement.offsetTop;oReturn.left+=eElement.offsetLeft;eElement=eElement.offsetParent;}}else if(eElement.y){oReturn.left+=eElement.x;oReturn.top+=eElement.y;}
return oReturn;},getViewportHeight:function(){if(window.innerHeight!==undefined){return window.innerHeight;}
if(document.compatMode==="CSS1Compat"){return document.documentElement.clientHeight;}
if(document.body){return document.body.clientHeight;}
return null;},getViewportWidth:function(){if(document.compatMode==='CSS1Compat'){return document.documentElement.clientWidth;}
if(document.body){return document.body.clientWidth;}
if(window.innerWidth!==undefined){return window.innerWidth;}
return null;},getSize:function(eElem){if(df.sys.isIE||df.sys.isWebkit){return{width:eElem.offsetWidth,height:eElem.offsetHeight};}
var oStyle=df.sys.gui.getCurrentStyle(eElem);return{width:parseInt(oStyle.getPropertyValue("width"),10),height:parseInt(oStyle.getPropertyValue("height"),10)};},getCurrentStyle:function(eElem){return(typeof(window.getComputedStyle)==="function"?window.getComputedStyle(eElem,null):eElem.currentStyle);},getContentHeight:function(eElem){var iHeight=0,oStyle=df.sys.gui.getCurrentStyle(eElem);iHeight=eElem.clientHeight;iHeight-=parseInt(oStyle.paddingTop,10)||0;iHeight-=parseInt(oStyle.paddingBottom,10)||0;return iHeight;},getVertBoxDiff:function(eElem,iOptType){var iDiff=0,oStyle=df.sys.gui.getCurrentStyle(eElem);iOptType=iOptType||0;if(iOptType===0||iOptType===1){iDiff+=parseFloat(oStyle.marginTop)||0;iDiff+=parseFloat(oStyle.borderTopWidth)||0;}
if(iOptType===0||iOptType===2){iDiff+=parseFloat(oStyle.paddingTop)||0;}
if(iOptType===0||iOptType===1){iDiff+=parseFloat(oStyle.marginBottom)||0;iDiff+=parseFloat(oStyle.borderBottomWidth)||0;}
if(iOptType===0||iOptType===2){iDiff+=parseFloat(oStyle.paddingBottom)||0;}
return iDiff;},getHorizBoxDiff:function(eElem,iOptType){var iDiff=0,oStyle=df.sys.gui.getCurrentStyle(eElem);iOptType=iOptType||0;if(iOptType===0||iOptType===1){iDiff+=parseFloat(oStyle.marginLeft)||0;iDiff+=parseFloat(oStyle.borderLeftWidth)||0;}
if(iOptType===0||iOptType===2){iDiff+=parseFloat(oStyle.paddingLeft)||0;}
if(iOptType===0||iOptType===1){iDiff+=parseFloat(oStyle.marginRight)||0;iDiff+=parseFloat(oStyle.borderRightWidth)||0;}
if(iOptType===0||iOptType===2){iDiff+=parseFloat(oStyle.paddingRight)||0;}
return iDiff;},getBoundRect:function(eElem){var oR=eElem.getBoundingClientRect();if(typeof oR.width!=='number'){return{top:oR.top,right:oR.right,bottom:oR.bottom,left:oR.left,width:oR.right-oR.left,height:oR.bottom-oR.top}}
return oR;},initCSS:function(){var sClass;if(df.sys.isIE){sClass="df-ie";sClass="df-ie"+(df.sys.iVersion<=6?" df-ie6":(df.sys.iVersion<=7?" df-ie7":(df.sys.iVersion<=8?" df-ie8":" df-ie9")));}else if(df.sys.isSafari){sClass="df-safari";}else if(df.sys.isChrome){sClass="df-chrome";}else if(df.sys.isOpera){sClass="df-opera";}else if(df.sys.isMoz){sClass="df-mozilla";}
if(df.sys.isWebkit){sClass+=" df-webkit";}
document.body.className=document.body.className+" "+sClass;},isOnScreen:function(eElem){var iTop,iBottom,iLeft,iRight,iHeight;iTop=eElem.offsetTop;iLeft=eElem.offsetLeft;iHeight=eElem.offsetHeight;while(eElem=eElem.offsetParent){if(eElem.scrollTop>iTop+iHeight||eElem.scrollTop+eElem.clientHeight<iTop){return false;}
iTop=iTop-eElem.scrollTop+eElem.offsetTop;iLeft=iLeft-eElem.scrollLeft+eElem.offsetLeft;}
return true;}},string:{trim:function(sString){return sString.replace(/^\s+|\s+$/g,"");},ltrim:function(sString){return sString.replace(/^\s+/,"");},rtrim:function(sString){return sString.replace(/\s+$/,"");},copyCase:function(sValue,sSample){var bUpper,iChar,sResult="";for(iChar=0;iChar<sValue.length;iChar++){bUpper=(iChar<sSample.length?sSample.charAt(iChar)===sSample.charAt(iChar).toUpperCase():bUpper);sResult+=(bUpper?sValue.charAt(iChar).toUpperCase():sValue.charAt(iChar).toLowerCase());}
return sResult;},encodeHtml:function(sValue){return(sValue||"").replace(/</g,"&lt;").replace(/>/g,"&gt;");}},nothing:function(){}};if(navigator.userAgent.indexOf("Trident")>=0){df.sys.isIE=true;if(document.documentMode){df.sys.iVersion=document.documentMode;}else if(navigator.appVersion.indexOf("MSIE")>=0){df.sys.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("MSIE")+4),10);}else{df.sys.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("rv:")+3),10);}}else if(navigator.userAgent.indexOf("Chrome")>=0){df.sys.isChrome=true;df.sys.iVersion=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("Chrome/")+7));}else if(navigator.userAgent.indexOf("Safari")>=0){df.sys.isSafari=true;df.sys.iVersion=parseFloat(navigator.appVersion.substr(navigator.appVersion.indexOf("Version/")+8));}else if(navigator.product==="Gecko"){df.sys.isMoz=true;df.sys.iVersion=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Firefox/")+8));}else if(navigator.userAgent.indexOf("Opera")>=0){df.sys.isOpera=true;df.sys.iVersion=parseFloat(navigator.appVersion);}else{df.sys.isIE=true;df.sys.iVersion=parseInt(navigator.appVersion.substr(navigator.appVersion.indexOf("MSIE")+4),10);if(document.documentMode){df.sys.iVersion=document.documentMode;}}
if(navigator.userAgent.indexOf("AppleWebKit")>=0){df.sys.isWebkit=true;}
df.dom.ready(df.sys.gui.initCSS);

df.sys.json={parse:function(sString){if(typeof JSON==="object"&&typeof JSON.parse==="function"){return JSON.parse(sString);}
this.oDecodeRegex.lastIndex=0;if(this.oDecodeRegex.test(sString)){sString=sString.replace(this.oDecodeRegex,function(sVal,iPos){return'\\u'+
('0000'+sVal.charCodeAt(0).toString(16)).slice(-4);});}
if(this.validate(sString)){return eval("("+sString+")");}
throw new SyntaxError('JSON.parse');},validate:function(sJSON){return(/^[\],:{}\s]*$/.test(sJSON.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,'')));},stringify:function(oObject){if(typeof JSON==="object"&&typeof JSON.stringify==="function"&&(!df.sys.isIE||(df.sys.iVersion>8))){return JSON.stringify(oObject,function(sKey,sValue){return(typeof sKey==="string"&&sKey.substr(0,2)==="__"?undefined:sValue);});}
var aResult=[];this.switchToJson(oObject,aResult);return aResult.join("");},switchToJson:function(object,aResult){switch(df.sys.ref.getType(object)){case"array":this.arrayToJson(object,aResult);break;case"string":this.stringToJson(object,aResult);break;case"number":this.numberToJson(object,aResult);break;case"boolean":this.booleanToJson(object,aResult);break;case"date":this.dateToJson(object,aResult);break;case"null":aResult.push("null");break;default:this.objectToJson(object,aResult);break;}},objectToJson:function(oObj,aResult){var sProp,bFirst=true;if(oObj!==null&&oObj!==undefined){aResult.push("{");for(sProp in oObj){if(typeof(oObj[sProp])!=="function"&&sProp.substr(0,2)!=="__"){if(!bFirst){aResult.push(",");}
aResult.push('"');aResult.push(sProp);aResult.push('":');this.switchToJson(oObj[sProp],aResult);bFirst=false;}}
aResult.push("}");}},arrayToJson:function(aArray,aResult){var iItem,bFirst=true;aResult.push("[");for(iItem=0;iItem<aArray.length;iItem++){if(!bFirst){aResult.push(",");}
this.switchToJson(aArray[iItem],aResult);bFirst=false;}
aResult.push("]");},oEncodeChars:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},stringToJson:function(sString,aResult){aResult.push('"');this.oEncodeRegex.lastIndex=0;if(this.oEncodeRegex.test(sString)){sString=sString.replace(this.oEncodeRegex,function(sValue,iPos){var sRep=df.sys.json.oEncodeChars[sValue];return(typeof sRep==="string"?sRep:'\\u'+('0000'+sValue.charCodeAt(0).toString(16)).slice(-4));});}
aResult.push(sString);aResult.push('"');},booleanToJson:function(bBool,aResult){aResult.push(String(bBool));},numberToJson:function(nNumber,aResult){aResult.push((isFinite(nNumber)?String(nNumber):nNumber));},dateToJson:function(dDate,aResult){aResult.push('"');aResult.push(dDate.getUTCFullYear());aResult.push("-");aResult.push(df.sys.math.padZero(dDate.getUTCMonth()+1,2));aResult.push('-');aResult.push(df.sys.math.padZero(dDate.getUTCDate(),2));aResult.push('T');aResult.push(df.sys.math.padZero(dDate.getUTCHours(),2));aResult.push(':');aResult.push(df.sys.math.padZero(dDate.getUTCMinutes(),2));aResult.push(':');aResult.push(df.sys.math.padZero(dDate.getUTCSeconds(),2));aResult.push('Z');aResult.push('"');}};df.sys.json.oEncodeRegex=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;df.sys.json.oDecodeRegex=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;

df.sys.vt={generateDeserializer:function(tDef){var aCode=[],iFC=0;function parseObj(sC,tDef){var sM,i=0,iFunc=iFC++,aFunc=[];aFunc.push('function p',iFunc,'(tVT){','return {');for(sM in tDef){if(tDef.hasOwnProperty(sM)){if(i>0){aFunc.push(',');}
aFunc.push(sM,':',switchType('tVT.c['+i+']',tDef[sM]));i++;}}
aFunc.push('};','}');aCode.push(aFunc.join(''));return'p'+iFunc+'('+sC+')';}
function parseArray(sC,tDef){var iFunc=iFC++,aFunc=[];aFunc.push('function p',iFunc,'(tVT){','var a = [], i; ','for(i = 0; i < tVT.c.length; i++){');aFunc.push('a.push(',switchType('tVT.c[i]',tDef[0]),');');aFunc.push('}','return a;','}');aCode.push(aFunc.join(''));return'p'+iFunc+'('+sC+')';}
function parseEndNode(sC,tDef){switch(tDef){case df.tBool:return'df.toBool('+sC+'.v)';case df.tInt:return'df.toInt('+sC+'.v)';default:return sC+'.v';}}
function switchType(sC,tDef){if(typeof(tDef)==="number"){return parseEndNode(sC,tDef);}
if(tDef instanceof Array){return parseArray(sC,tDef);}
return parseObj(sC,tDef);}
aCode.push('try{','return ',switchType("tVT",tDef),';','}catch(oErr){','throw new df.Error(999, "Unable to deserialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}", this, [ oErr.message ]);','}');return new Function("tVT",aCode.join(''));},generateSerializer:function(tDef){var aCode=[],iFC=0;function parseObj(sC,tDef){var sM,i=0,iFunc=iFC++,aFunc=[];aFunc.push('function p',iFunc,'(oObj){','return {','v : "",','c : [');for(sM in tDef){if(tDef.hasOwnProperty(sM)){if(i>0){aFunc.push(',');}
aFunc.push(switchType('oObj["'+sM+'"]',tDef[sM]));i++;}}
aFunc.push(']','};','}');aCode.push(aFunc.join(''));return'p'+iFunc+'('+sC+')';}
function parseArray(sC,tDef){var iFunc=iFC++,aFunc=[];aFunc.push('function p',iFunc,'(aArray){','var tVT = { v : "", c : [] }, i;','for(i = 0; i < aArray.length; i++){');aFunc.push('tVT.c.push(',switchType('aArray[i]',tDef[0]),');');aFunc.push('}','return tVT;','}');aCode.push(aFunc.join(''));return'p'+iFunc+'('+sC+')';}
function parseEndNode(sC,tDef){switch(tDef){case df.tBool:return'{ v : df.fromBool('+sC+'), c : [] }';default:return'{ v : '+sC+'.toString(), c : [] }';}}
function switchType(sC,tDef){if(typeof(tDef)==="number"){return parseEndNode(sC,tDef);}
if(tDef instanceof Array){return parseArray(sC,tDef);}
return parseObj(sC,tDef);}
aCode.push('try{','return ',switchType("tStruct",tDef),';','}catch(oErr){','throw new df.Error(999, "Unable to serialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}", this, [ oErr.message ]);','}');return new Function("tStruct",aCode.join(''));},deserialize:function(tVT,tDef){function parseObj(tVT,tDef){var sM,i=0,oRes={};for(sM in tDef){if(tDef.hasOwnProperty(sM)){oRes[sM]=switchType(tVT.c[i],tDef[sM]);i++;}}
return oRes;}
function parseArray(tVT,tDef){var i,aRes=[];for(i=0;i<tVT.c.length;i++){aRes.push(switchType(tVT.c[i],tDef[0]));}
return aRes;}
function parseEndNode(tVT,tDef){switch(tDef){case df.tBool:return df.toBool(tVT.v);case df.tInt:return df.toInt(tVT.v);default:return tVT.v;}}
function switchType(tVT,tDef){if(typeof(tDef)==="number"){return parseEndNode(tVT,tDef);}
if(tDef instanceof Array){return parseArray(tVT,tDef);}
return parseObj(tVT,tDef);}
try{return switchType(tVT,tDef);}catch(oErr){throw new df.Error(999,"Unable to deserialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}",this,[oErr.message]);}},serialize:function(tStruct){function parseObj(oObj){var sM,oRes={v:"",c:[]};for(sM in oObj){if(oObj.hasOwnProperty(sM)){oRes.c.push(switchType(oObj[sM]));}}
return oRes;}
function parseArray(aArray){var i,oRes={v:"",c:[]};for(i=0;i<aArray.length;i++){oRes.c.push(switchType(aArray[i]));}
return oRes;}
function parseEndNode(oObj){switch(typeof oObj){case"boolean":return{v:df.toBool(oObj),c:[]};default:return{v:oObj.toString(),c:[]};}}
function switchType(tStruct){if(typeof(tStruct)==="object"){if(tStruct instanceof Array){return parseArray(tStruct);}
return parseObj(tStruct);}
return parseEndNode(tStruct);}
try{return switchType(tStruct);}catch(oErr){throw new df.Error(999,"Unable to serialize valuetree, invalid data format!\\n\\r\\n\\rMSG: {{0}}",this,[oErr.message]);}}};

df.ajax.REQUEST_STATE_UNITIALIZED=0;df.ajax.REQUEST_STATE_LOADING=1;df.ajax.REQUEST_STATE_LOADED=2;df.ajax.REQUEST_STATE_INTERACTIVE=3;df.ajax.REQUEST_STATE_COMPLETE=4;df.ajax.HttpRequest=function HttpRequest(sUrl,sData,oSource){if(sData===undefined){sData=null;}
this.sUrl=sUrl;this.sData=sData;this.bAsynchronous=true;this.onFinished=new df.events.JSHandler();this.onError=new df.events.JSHandler();this.onClose=new df.events.JSHandler();this.oLoader=null;this.oSource=oSource||null;this.bSilent=false;};df.defineClass("df.ajax.HttpRequest",{send:function(bAsynchronous){var that=this,sData;if(typeof bAsynchronous==="boolean"){this.bAsynchronous=bAsynchronous;}
this.oLoader=new XMLHttpRequest();sData=this.getData();if(this.bAsynchronous){this.oLoader.onreadystatechange=function(){that.onReadyStateChange();};this.oLoader.onloadend=function(){};this.oLoader.onabort=function(){};this.oLoader.onerror=function(){};}
try{this.oLoader.open((sData)?"POST":"GET",this.getRequestUrl(),this.bAsynchronous);this.setHeaders(this.oLoader);this.oLoader.send(sData);}catch(oErr){throw new df.Error(999,"The application was unable to communicate with the server.",this);}
if(!this.bAsynchronous){this.onReadyStateChange();}},onReadyStateChange:function(){try{if(this.oLoader.readyState===df.ajax.REQUEST_STATE_COMPLETE){if(this.oLoader.status>0){this.onClose.fire(this);this.checkErrors();this.onFinished.fire(this,this.getFinishedDetails());}}}catch(e){if(!this.bSilent){df.handleError(e,this);}
this.onError.fire(this,{oError:e});}},getFinishedDetails:function(){return{oResponseXml:this.getResponseXml(),sResponseText:this.getResponseText()};},checkErrors:function(bSkip500){if(this.oLoader.status>=300&&(!bSkip500||this.oLoader.status!==500)){var aDetails,sDetailHtml=this.oLoader.responseText;sDetailHtml=sDetailHtml.replace(/(^(.|\n|\r)*<body.*?>)|(<\/body>(.|\n|\r)*$)/gi,"");sDetailHtml=sDetailHtml.replace(/<style(.|\n|\r)*\/style>/gi,"");sDetailHtml=sDetailHtml.replace(/<script(.|\n|\r)*\/script>/gi,"");aDetails=["<b>Target:</b> ",this.sUrl,"<br/>","<b>Full URL:</b> ",this.getRequestUrl(),"<br/>","<b>Status code:</b> ",this.oLoader.status,"<br/>","<b>Status text:</b> ",this.oLoader.statusText,"<br/>","<br />","<hr />",sDetailHtml];throw new df.Error(5120,"Received HTTP error",this,[this.oLoader.status,this.oLoader.statusText,this.sUrl],aDetails.join(""));}},setHeaders:function(oLoader){},getRequestUrl:function(){var sPath,iPos;if(this.sUrl.substr(0,7).toLowerCase()!=="http://"){sPath=window.location.pathname;if(sPath.substr(0,1)!=="/"){sPath="/"+sPath;}
iPos=sPath.lastIndexOf("/");if(iPos>=0){sPath=sPath.substring(0,iPos);}
if(this.sUrl.substr(0,1)!=="/"){return sPath+"/"+this.sUrl;}
return sPath+this.sUrl;}
return this.sUrl;},getResponseXml:function(){return this.oLoader.responseXML;},getResponseText:function(){return this.oLoader.responseText;},getData:function(){return this.sData;},cancel:function(){if(this.oLoader!==null){this.onClose.fire(this);this.oLoader.onreadystatechange=function(){};this.oLoader.abort();this.oLoader=null;}else if(df.ajax.oDefaultQueue&&this.bAsynchronous){df.ajax.oDefaultQueue.removeCall(this);}
this.onFinished.aListener=[];},destroy:function(){try{if(this.bAsynchronous&&this.oLoader&&this.oLoader.onreadystatechange){this.oLoader.onreadstatechange=null;}}catch(oErr){}
this.oLoader=null;},getWebApp:function(){if(this.oSource&&this.oSource.getWebApp){return this.oSource.getWebApp();}
return null;}});

df.ajax.JSONCall=function JSONCall(sFunction,oParams,sUrl,oSource){if(sUrl===undefined||sUrl===null){sUrl="WebService.wso";}
df.ajax.JSONCall.base.constructor.call(this,sUrl,null,oSource);this.sFunction=sFunction;this.oParams=oParams||{};this.bUsePOST=true;this.bExtendURL=true;this._oJSON=null;};df.defineClass("df.ajax.JSONCall","df.ajax.HttpRequest",{addParam:function(sName,sValue){this.oParams[sName]=sValue;},setHeaders:function(oLoader){df.ajax.JSONCall.base.setHeaders.call(this,oLoader);if(this.bUsePOST){oLoader.setRequestHeader("Content-Type","application/json");}},getData:function(){if(this.bUsePOST){return df.sys.json.stringify(this.oParams);}
return null;},getRequestUrl:function(){var sUrl,sParam,aParams=[];sUrl=df.ajax.JSONCall.base.getRequestUrl.call(this);if(sUrl.indexOf("/JSON")>=0){sUrl=sUrl.replace("/JSON","/"+this.sFunction+"/JSON");}else{if(sUrl.indexOf("?")>=0){sUrl=sUrl.replace("?","/"+this.sFunction+"/JSON");}else{sUrl=sUrl+(sUrl.charAt(sUrl.length-1)!=="/"?"/":"")+this.sFunction+"/JSON";}}
if(!this.bUsePOST){for(sParam in this.oParams){if(this.oParams.hasOwnProperty(sParam)){aParams.push((aParams.length<=0&&sUrl.indexOf("?")<0?"?":"&"));aParams.push(encodeURIComponent(sParam));aParams.push("=");aParams.push(encodeURIComponent(String(this.oParams[sParam])));}}
return sUrl+aParams.join("");}
return sUrl;},getResponseXml:function(){return null;},checkErrors:function(){var tError;if(this.oLoader.status===500){try{tError=df.sys.json.parse(this.getResponseText());}catch(oErr){}
if(tError&&tError.errorCode){throw new df.Error(999,tError.errorDescription,this,[],null,false,false,"Server returned HTTP error 500");}}
df.ajax.JSONCall.base.checkErrors.call(this);},getResponseValue:function(){var sJSON=this.getResponseText();return df.sys.json.parse(sJSON);}});

df.ServerAction=function ServerAction(){this.oWO=null;this.sAction="";this.aParams=[];this.tData={v:"",c:[]};this.aViews=[];this.eCallMode=df.cCallModeDefault;this.sProcessMessage="";this.fHandler=null;this.oHandlerEnv=null;this.sReturnValue=null;};df.ServerCall=function(){this.aActions=[];this.eCallMode=df.cCallModeDefault;this.sProcessMessage="";this.sFocus="";this.aWaiters=[];this.bSending=false;};

df.DatePicker=function DatePicker(){this.pbShowWeekNr=true;this.pbShowToday=true;this.piStartWeekAt=1;this.psMask="mm/dd/yyyy";this.onChange=new df.events.JSHandler();this.onEnter=new df.events.JSHandler();this.onDateClick=new df.events.JSHandler();this._eElem=null;this._eFocus=null;this._eBody=null;this._eDispMonth=null;this._eDispYear=null;this._dSelected=new Date();this._iWeekSelected=df.sys.data.dateToWeek(this._dSelected);this._iDisplayYear=this._dSelected.getFullYear();this._iDisplayMonth=this._dSelected.getMonth();this._iLastDisplayYear=this._iDisplayYear;this._iLastDisplayMonth=this._iDisplayMonth;this._oParent=null;this._aMonthNames=df.lang.monthsLong;this._aMonthNamesShort=df.lang.monthsShort;this._aDaysShort=df.lang.daysShort;this._aDaysLong=df.lang.daysLong;};df.defineClass("df.DatePicker",{openHtml:function(aHtml){aHtml.push('<div class="WebDP">','<div class="WebDP_Wrp">','<div class="WebDP_Head">','<div class="WebDP_BtnPrev"><span></span></div>','<div class="WebDP_BtnNext"><span></span></div>','<div class="WebDP_BtnYear"><span></span><div class="WebDP_YearMnu"></div></div>','<div class="WebDP_BtnMonth"><span></span><div class="WebDP_MonthMnu"></div></div>','<div style="clear: both;"></div>','</div>','<div class="WebDP_Body">');},closeHtml:function(aHtml){aHtml.push('</div>');if(this.pbShowToday){aHtml.push('<div class="WebDP_Footer">','<div class="WebDP_BtnToday">',this.getWebApp().getTrans("todayIs"),' <span></span></div>','</div>');}
aHtml.push('</div>','</div>');},render:function(){var aHtml=[];this.openHtml(aHtml);this.closeHtml(aHtml);this._eElem=df.dom.create(aHtml.join(''));return this._eElem;},afterRender:function(){this._eBody=df.dom.query(this._eElem,"div.WebDP_Body");this._eDispMonth=df.dom.query(this._eElem,"div.WebDP_BtnMonth > span");this._eDispYear=df.dom.query(this._eElem,"div.WebDP_BtnYear > span");if(this.pbShowToday){this._eDispToday=df.dom.query(this._eElem,"div.WebDP_BtnToday > span");}
df.events.addDomListener("click",this._eBody,this.onBodyClick,this);df.events.addDomListener("click",df.dom.query(this._eElem,"div.WebDP_BtnNext"),this.onNextClick,this);df.events.addDomListener("click",df.dom.query(this._eElem,"div.WebDP_BtnPrev"),this.onPrevClick,this);df.events.addDomListener("click",df.dom.query(this._eElem,"div.WebDP_BtnMonth"),this.onMonthClick,this);df.events.addDomListener("click",df.dom.query(this._eElem,"div.WebDP_BtnYear"),this.onYearClick,this);if(this.pbShowToday){df.events.addDomListener("click",df.dom.query(this._eElem,"div.WebDP_BtnToday"),this.onTodayClick,this);}
df.events.addDomKeyListener(this._eFocus,this.onKey,this);this.update();},update:function(){if(this._eElem){df.dom.setText(this._eDispMonth,this._aMonthNames[this._iDisplayMonth]);df.dom.setText(this._eDispYear,this._iDisplayYear);if(this.pbShowToday){df.dom.setText(this._eDispToday,df.sys.data.applyDateMask((new Date()),this.psMask,this.getWebApp().psDateSeparator));}
this.displayCalendar();}},displayCalendar:function(){var iDay,iDayPointer,aHtml=[],sCSS,dToday,dEnd,dDate,iRows,iYear,iMonth,eNew,eOld;aHtml.push('<div><table>');iYear=this._iDisplayYear;iMonth=this._iDisplayMonth;dToday=new Date();dDate=new Date(iYear,iMonth,1,1,1,1);dEnd=new Date(iYear,(iMonth+1),1,1,1,1);aHtml.push('<tr class="WebDP_BodyHead">');if(this.pbShowWeekNr){aHtml.push('<th class="WebDP_WeekNr">',this.getWebApp().getTrans("wk"),'</th>');}
for(iDay=0;iDay<7;iDay++){sCSS="";iDayPointer=(iDay+this.piStartWeekAt>6?iDay+this.piStartWeekAt-7:iDay+this.piStartWeekAt);if(iDayPointer===0||iDayPointer===6){sCSS="WebDP_Weekend";}
aHtml.push('<th class="',sCSS,'">',this.getDay(iDay,true),'</th>');}
aHtml.push('</tr>');iDayPointer=dDate.getDay()-this.piStartWeekAt;if(iDayPointer<0){iDayPointer=7+iDayPointer;}
dDate.setDate(dDate.getDate()-iDayPointer);iDayPointer=0;iRows=0;aHtml.push('<tr>');while(dDate<dEnd||(iDayPointer<7&&iDayPointer!==0)||iRows<6){if(iDayPointer===0||iDayPointer>6){if(iRows>0){aHtml.push('</tr><tr>');}
iRows++;if(this.pbShowWeekNr){aHtml.push('<td class="WebDP_WeekNr">',df.sys.data.dateToWeek(dDate),'</td>');}
iDayPointer=0;}
sCSS="WebDP_Day";if(dDate.getMonth()!==iMonth){sCSS+=(sCSS!==""?" ":"")+"WebDP_Overflow";}
if(dDate.getDay()===0||dDate.getDay()===6){sCSS+=(sCSS!==""?" ":"")+"WebDP_Weekend";}
if(dDate.getDate()===this._dSelected.getDate()&&dDate.getMonth()===this._dSelected.getMonth()&&dDate.getFullYear()===this._dSelected.getFullYear()){sCSS+=(sCSS!==""?" ":"")+"WebDP_Selected"+(this.bHasFocus?" focussed":"");}
if(dDate.getDate()===dToday.getDate()&&dDate.getMonth()===dToday.getMonth()&&dDate.getFullYear()===dToday.getFullYear()){sCSS+=(sCSS!==""?" ":"")+"WebDP_Today";}
aHtml.push('<td class="',sCSS,'" data-date="',dDate.getDate(),'" data-month="',dDate.getMonth(),'" data-year="',dDate.getFullYear(),'">',dDate.getDate(),'</td>');dDate.setDate(dDate.getDate()+1);iDayPointer++;}
aHtml.push('</table></div>');if(this._iLastDisplayYear===this._iDisplayYear&&this._iLastDisplayMonth===this._iDisplayMonth){this._eBody.innerHTML=aHtml.join('');}else{eOld=df.dom.query(this._eBody,".WebDP_Old");if(eOld){this._eBody.removeChild(eOld);}
eNew=df.dom.create(aHtml.join(''));eOld=this._eBody.firstChild;if(eOld){eOld.firstChild.style.width=eOld.firstChild.clientWidth+"px";eOld.firstChild.style.height=eOld.firstChild.clientHeight+"px";df.dom.addClass(eOld,"WebDP_Old");}
this._eBody.appendChild(eNew);if(eOld){df.dom.addClass(eOld,((this._iLastDisplayYear<this._iDisplayYear||(this._iLastDisplayYear===this._iDisplayYear&&this._iLastDisplayMonth<this._iDisplayMonth))?"WebDP_HideNext":"WebDP_HidePrev"));}}
this._iLastDisplayYear=this._iDisplayYear;this._iLastDisplayMonth=this._iDisplayMonth;},setSelectedDate:function(dSelected,bOptNoAni,bOptNoDisplayNow){if(!dSelected){dSelected=new Date();this.fireChanged();}
this._dSelected=dSelected;this._iWeekSelected=df.sys.data.dateToWeek(this._dSelected);if(!bOptNoDisplayNow){this._iDisplayYear=this._dSelected.getFullYear();this._iDisplayMonth=this._dSelected.getMonth();if(bOptNoAni){this._iLastDisplayYear=this._iDisplayYear;this._iLastDisplayMonth=this._iDisplayMonth;}}
this.update();},getSelectedDate:function(){return new Date(this._dSelected.valueOf());},getDay:function(iDay,bShort){iDay+=this.piStartWeekAt;if(iDay>6){iDay=iDay-7;}
return(bShort?this._aDaysShort[iDay]:this._aDaysLong[iDay]);},onMonthClick:function(oEvent){var eMenu,tMenuTimeout,aHtml=[],i,sCSS,hide,that=this;eMenu=df.dom.query(this._eElem,"div.WebDP_MonthMnu");function onClick(oEvent){var eLI=oEvent.getTarget();if(eLI.getAttribute('data-month')){this._iDisplayMonth=parseInt(eLI.getAttribute('data-month'),10);hide();this.update();this.focus();oEvent.stop();}}
function onOver(oEvent){clearTimeout(tMenuTimeout);}
function onOut(oEvent){clearTimeout(tMenuTimeout);tMenuTimeout=setTimeout(hide,1200);}
hide=function hide(){df.events.removeDomListener("click",eMenu,onClick);df.events.removeDomListener("mouseover",eMenu,onOver);df.events.removeDomListener("mouseout",eMenu,onOut);eMenu.style.display="none";clearTimeout(tMenuTimeout);that._fMonthHide=null;};if(this._fMonthHide){this._fMonthHide();}else{if(this.isEnabled()){this._fMonthHide=hide;df.events.addDomListener("click",eMenu,onClick,this);df.events.addDomListener("mouseover",eMenu,onOver,this);df.events.addDomListener("mouseout",eMenu,onOut,this);aHtml.push('<ul>');for(i=0;i<12;i++){sCSS=(i===this._iDisplayMonth?"WebDP_Current":"");aHtml.push('<li data-month="',i,'" class="',sCSS,'">',this._aMonthNames[i],'</li>');}
aHtml.push('</ul');eMenu.innerHTML=aHtml.join('');eMenu.style.display="inline";tMenuTimeout=setTimeout(hide,2400);}}
this.focus();},onYearClick:function(oEvent){var eMenu,eUp,eDown,tMenuTimeout,tScrollTimeout,aHtml=[],i,iYear=this._dSelected.getFullYear(),sCSS,hide,that=this;eMenu=df.dom.query(this._eElem,"div.WebDP_YearMnu");function onClick(oEvent){var eLI=oEvent.getTarget();if(eLI.getAttribute('data-year')){this._iDisplayYear=parseInt(eLI.getAttribute('data-year'),10);hide();this.update();this.focus();}
oEvent.stop();}
function onOver(oEvent){clearTimeout(tMenuTimeout);}
function onOut(oEvent){tMenuTimeout=setTimeout(hide,1200);}
function scrollUp(){var iYear,eNew;iYear=eUp.nextSibling.getAttribute("data-year");iYear--;eDown.parentNode.removeChild(eDown.previousSibling);eNew=document.createElement("li");df.dom.setText(eNew,iYear);eNew.setAttribute("data-year",iYear);eUp.parentNode.insertBefore(eNew,eUp.nextSibling);}
function scrollDown(){var iYear,eNew;iYear=eDown.previousSibling.getAttribute("data-year");iYear++;eUp.parentNode.removeChild(eUp.nextSibling);eNew=document.createElement("li");df.dom.setText(eNew,iYear);eNew.setAttribute("data-year",iYear);eDown.parentNode.insertBefore(eNew,eDown);}
function onScroll(oEvent){var fFunc,eScroll;eScroll=oEvent.getTarget();fFunc=(eScroll===eUp?scrollUp:scrollDown);function doScroll(){fFunc();tScrollTimeout=setTimeout(doScroll,35);}
fFunc();tScrollTimeout=setTimeout(doScroll,300);df.dom.addClass(eScroll,(eScroll===eUp?"WebDP_UpDown":"WebDP_DownDown"));oEvent.stop();}
function onScrollStop(oEvent){clearTimeout(tScrollTimeout);df.dom.removeClass(eUp,"WebDP_UpDown");df.dom.removeClass(eDown,"WebDP_DownDown");oEvent.stop();}
hide=function hide(){eMenu.style.display="none";df.events.removeDomListener("click",eMenu,onClick);df.events.removeDomListener("mouseover",eMenu,onOver);df.events.removeDomListener("mouseout",eMenu,onOut);df.events.removeDomListener("mousedown",eUp,onScroll);df.events.removeDomListener("mouseout",eUp,onScrollStop);df.events.removeDomListener("mouseup",eUp,onScrollStop);df.events.removeDomListener("mousedown",eDown,onScroll);df.events.removeDomListener("mouseout",eDown,onScrollStop);df.events.removeDomListener("mouseup",eDown,onScrollStop);clearTimeout(tMenuTimeout);that._fYearHide=null;};if(this._fYearHide){this._fYearHide();}else{if(this.isEnabled()){this._fYearHide=hide;aHtml.push('<ul>');aHtml.push('<li class="WebDP_Up"></li>');for(i=this._iDisplayYear-4;i<this._iDisplayYear+4;i++){sCSS=(i===iYear?"WebDP_Current":"");aHtml.push('<li data-year="',i,'" class="',sCSS,'">',i,'</li>');}
aHtml.push('<li class="WebDP_Down"></li>');aHtml.push('</ul');eMenu.innerHTML=aHtml.join('');eMenu.style.display="inline";eUp=df.dom.query(eMenu,'li.WebDP_Up');eDown=df.dom.query(eMenu,'li.WebDP_Down');df.events.addDomListener("click",eMenu,onClick,this);df.events.addDomListener("mouseover",eMenu,onOver,this);df.events.addDomListener("mouseout",eMenu,onOut,this);df.events.addDomListener("mousedown",eUp,onScroll,this);df.events.addDomListener("mouseout",eUp,onScrollStop,this);df.events.addDomListener("mouseup",eUp,onScrollStop,this);df.events.addDomListener("mousedown",eDown,onScroll,this);df.events.addDomListener("mouseout",eDown,onScrollStop,this);df.events.addDomListener("mouseup",eDown,onScrollStop,this);tMenuTimeout=setTimeout(hide,2400);}}
this.focus();},onNextClick:function(oEvent){if(this.isEnabled()){this._iDisplayMonth++;if(this._iDisplayMonth>=12){this._iDisplayYear++;this._iDisplayMonth=0;}
this.update();this.focus();}},onPrevClick:function(oEvent){if(this.isEnabled()){this._iDisplayMonth--;if(this._iDisplayMonth<0){this._iDisplayYear--;this._iDisplayMonth=11;}
this.update();this.focus();}},onBodyClick:function(oEvent){var eCell=oEvent.getTarget(),dDate;if(this.isEnabled()){if(eCell.getAttribute("data-date")){dDate=new Date(parseInt(eCell.getAttribute("data-year"),10),parseInt(eCell.getAttribute("data-month"),10),parseInt(eCell.getAttribute("data-date"),10),1,1,1);this.setSelectedDate(dDate,false,false);this.fireChanged();this.fireEnter();this.fireDateClick();this.focus();}}},onTodayClick:function(oEvent){if(this.isEnabled()){this._dSelected=new Date();this._iDisplayYear=this._dSelected.getFullYear();this._iDisplayMonth=this._dSelected.getMonth();this.update();this.fireChanged();this.fireEnter();this.fireDateClick();this.focus();}},onKey:function(oEvent){var dDate=this._dSelected;if(this.isEnabled()){if(oEvent.matchKey(df.settings.calendarKeys.dayUp)){dDate.setDate(dDate.getDate()-7);this.setSelectedDate(dDate);this.fireChanged();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.dayDown)){dDate.setDate(dDate.getDate()+7);this.setSelectedDate(dDate);this.fireChanged();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.dayLeft)){dDate.setDate(dDate.getDate()-1);this.setSelectedDate(dDate);this.fireChanged();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.dayRight)){dDate.setDate(dDate.getDate()+1);this.setSelectedDate(dDate);this.fireChanged();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.monthUp)){dDate.setMonth(dDate.getMonth()+1);this.setSelectedDate(dDate);this.fireChanged();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.monthDown)){dDate.setMonth(dDate.getMonth()-1);this.setSelectedDate(dDate);this.fireChanged();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.yearUp)){dDate.setFullYear(dDate.getFullYear()+1);this.setSelectedDate(dDate);this.fireChanged();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.yearDown)){dDate.setFullYear(dDate.getFullYear()-1);this.setSelectedDate(dDate);this.fireChanged();oEvent.stop();}else if(oEvent.matchKey(df.settings.calendarKeys.enter)){this.fireDateClick();if(!this.fireEnter()){oEvent.stop();}}else{this._oParent.onKey(oEvent);}}},focus:function(){this._oParent.focus();},fireChanged:function(){this.onChange.fire(this,{dValue:this.getSelectedDate()});},fireEnter:function(){return this.onEnter.fire(this,{dValue:this.getSelectedDate()});},fireDateClick:function(){this.onDateClick.fire(this,{dValue:this.getSelectedDate()});},isEnabled:function(){return this._oParent.pbEnabled;},getWebApp:function(){return this._oParent.getWebApp();}});

df.InfoBalloon=function(oControl,sCssClass,sMessage){this.psMessage=sMessage;this.piHideDelay=6000;this.pbShowOnHover=true;this.psCSSClass=sCssClass;this.poTarget=oControl;this._eElem=null;this._eEventElem=null;this._eParentRef=null;this._bTopTooltip=false;this._tHideTimeout=null;};df.defineClass("df.InfoBalloon",{update:function(){if(this._eElem){this._eElem.innerHTML=this.psMessage;this._eElem.className="WebInfoBalloon "+this.psCSSClass;this._eElem.style.bottom="";this._eElem.style.top="";this._eElem.style.left="";this._bTopTooltip=false;this.position(true);}},show:function(){var eRef,eTarget=this.getTargetElem();if(!this._eElem){this._eElem=df.dom.create('<div class="WebInfoBalloon '+this.psCSSClass+'"></div>');this._eElem.innerHTML=this.psMessage;this._eParentRef=eRef=df.sys.gui.findParentRef(this.poTarget);if(eRef){eRef.appendChild(this._eElem);this._bTopTooltip=false;this.position(true);if(this.pbShowOnHover){df.events.addDomListener("mouseover",eTarget,this.onMouseOver,this);df.events.addDomListener("mouseout",eTarget,this.onMouseOut,this);this._eEventElem=eTarget;}
this._show();this.setTimeout();}else{throw new df.Error(999,"No element to insert next to!");}}else{this._show();this.setTimeout();}},_show:function(){if(this._eElem){df.dom.addClass(this._eElem,"WebInfoBalloonVisible");}},getTargetElem:function(){var eElem=this.poTarget._eElem;if(this.poTarget.getTooltipElem){eElem=this.poTarget.getTooltipElem()||eElem;}
return eElem;},hide:function(){var eElem=this._eElem;if(this._eElem){this._hide();if(this._eEventElem){df.events.removeDomListener("mouseover",this._eEventElem,this.onMouseOver);df.events.removeDomListener("mouseout",this._eEventElem,this.onMouseOut);this._eEventElem=null;}
if(this._tHideTimeout){clearTimeout(this._tHideTimeout);this._tHideTimeout=null;}
setTimeout(function(){if(eElem.parentNode){eElem.parentNode.removeChild(eElem);}},3000);this._eElem=null;}},_hide:function(){if(this._eElem){df.dom.removeClass(this._eElem,"WebInfoBalloonVisible");}},position:function(bOptFirstPos){var eParent,iTop=0,iLeft=0,iHeight,iBottom,iWidth,eCurrent,eTarget,eTool;eParent=this._eElem&&this._eElem.offsetParent;eTarget=this.getTargetElem();eTool=this._eElem;if(eTool&&eParent){iTop=eTarget.offsetHeight;if(eTarget.offsetWidth>70){iLeft=Math.round((eTarget.offsetWidth-70)/2);}
eCurrent=eTarget;while(eCurrent.offsetParent&&eCurrent!==eParent){iTop+=eCurrent.offsetTop;iLeft+=eCurrent.offsetLeft;eCurrent=eCurrent.offsetParent;}
iHeight=eTool.clientHeight+df.sys.gui.getVertBoxDiff(eTool);iWidth=eTool.clientWidth+df.sys.gui.getHorizBoxDiff(eTool);iBottom=eParent.clientHeight-iTop+eTarget.offsetHeight;if(bOptFirstPos){if(eParent.clientHeight<(iTop+iHeight)&&eParent.clientHeight>(iBottom+iHeight)){this._bTopTooltip=true;df.dom.addClass(this._eElem,"WebInfoBalloon_Top");}}
if(eParent.clientWidth<iLeft+iWidth){iLeft=eParent.clientWidth-iWidth;if(iLeft<0){iLeft=0;}}
if(this._bTopTooltip){eTool.style.bottom=iBottom+"px";}else{eTool.style.top=iTop+"px";}
eTool.style.left=iLeft+"px";}},setTimeout:function(){var that=this;if(this.piHideDelay>0){if(this._tHideTimeout){clearTimeout(this._tHideTimeout);}
this._tHideTimeout=setTimeout(function(){that._hide();},this.piHideDelay);}},onMouseOver:function(oEvent){this._show();if(this._tHideTimeout){clearTimeout(this._tHideTimeout);this._tHideTimeout=null;}},onMouseOut:function(oEvent){this.setTimeout();},resize:function(){this.position();}});

df.WebObject=function WebObject(sName,oParent){this._sName=sName;this._oParent=oParent||null;this._oTypes={};this._oSynced={};this._aChildren=[];this._oServerActionModes={};this._oServerWaitMsg={};this._tActionData=null;this._bStandalone=!sName;this._oWebApp=null;};df.defineClass("df.WebObject",{create:function(tDef){},addChild:function(oChild){this._aChildren.push(oChild);},prop:function(eType,sName,sVal){this[sName]=sVal;this._oTypes[sName]=eType;},toLocalType:function(val,eType){switch(eType){case df.tString:return val;case df.tBool:return df.toBool(val);case df.tInt:return df.toInt(val);case df.tNumber:return df.toNumber(val);}},toServerType:function(val,eType){switch(eType){case df.tString:if(typeof val==="string"){return val;}
if(val){return val.toString();}
return"";case df.tBool:return df.fromBool(val);default:return val.toString();}},get:function(sProp){if(this['get_'+sProp]){return this['get_'+sProp]();}
return this[sProp];},set:function(sProp,val,bOptNoSync){var bRes;if(this['set_'+sProp]){bRes=this['set_'+sProp](val);}
if(this[sProp]!==undefined&&bRes!==false){this[sProp]=val;}
if(bOptNoSync!==true){this.addSync(sProp);}},_set:function(sProp,val,bSetter,bSync){var bRes;if(this._oTypes[sProp]){val=this.toLocalType(val,this._oTypes[sProp]);}
if(bSetter){if(this['set_'+sProp]){bRes=this['set_'+sProp](val,true);}}
this[sProp]=val;if(bSync){this.addSync(sProp);}},addSync:function(sProp){if(!this._oSynced.hasOwnProperty(sProp)){this._oSynced[sProp]=true;}},unSync:function(sProp){if(this._oSynced.hasOwnProperty(sProp)){delete this._oSynced[sProp];}},getSynced:function(aObjs){var i,sProp,aProps=[],val;for(sProp in this._oSynced){if(this._oSynced.hasOwnProperty(sProp)){val=this.get(sProp);if(this._oTypes[sProp]){val=this.toServerType(val,this._oTypes[sProp]);}
aProps.push({sN:sProp,sV:val});}}
if(aProps.length>0){aObjs.push({sO:this.getLongName(),aP:aProps});}
for(i=0;i<this._aChildren.length;i++){this._aChildren[i].getSynced(aObjs);}},getLongName:function(){var sName;if(this instanceof df.WebApp){return"";}
sName=(this._oParent&&this._oParent.getLongName())||"";return(sName?sName+"."+this._sName:this._sName);},getWebApp:function(){if(this._oWebApp){return this._oWebApp;}
return this._oWebApp=(this instanceof df.WebApp&&this)||(this._oParent&&this._oParent.getWebApp&&this._oParent.getWebApp())||null;},getView:function(){return(this instanceof df.WebView&&this)||(this._oParent&&this._oParent.getView&&this._oParent.getView())||null;},serverAction:function(sMethod,aOptParams,tOptData,fOptHandler,oOptEnv){var oView,oAction=new df.ServerAction();oAction.oWO=this;oAction.sAction=sMethod;oAction.aParams=aOptParams||[];oAction.tData=tOptData||null;oView=this.getView();if(oView){oAction.aViews.push(oView);}
oAction.eCallMode=this._oServerActionModes[sMethod.toLowerCase()]||df.cCallModeDefault;if(oAction.eCallMode===df.cCallModeProgress&&this._oServerWaitMsg[sMethod.toLowerCase()]){oAction.sProcessMessage=this._oServerWaitMsg[sMethod.toLowerCase()];}
if(fOptHandler){oAction.fHandler=fOptHandler;oAction.oHandlerEnv=oOptEnv||this;}
this.getWebApp().handleAction(oAction);},cancelServerAction:function(sMethod){this.getWebApp().cancelAction(this,sMethod);},setActionMode:function(sMethod,eMode,sOptWaitMessage){this._oServerActionModes[sMethod.toLowerCase()]=df.toInt(eMode);if(sOptWaitMessage){this._oServerWaitMsg[sMethod.toLowerCase()]=sOptWaitMessage;}},getActionMode:function(sMethod){return this._oServerActionModes[sMethod.toLowerCase()]||df.cCallModeDefault;},event:function(sName,eOptMode){this.setActionMode(sName,eOptMode||df.cCallModeDefault);this[sName]=new df.events.JSHandler();this.prop(df.tBool,"pbServer"+sName,false);this.prop(df.tString,"psClient"+sName,"");},fire:function(sName,aOptParams,fOptHandler,oOptEnv){var oEvent,bResult=false,bASync=false,fFunc;df.debug('Event: '+sName+" "+df.sys.json.stringify(aOptParams||[])+" on "+this.getLongName()+"  (Call mode: "+this._oServerActionModes[sName.toLowerCase()]+" )");if(aOptParams&&!(aOptParams instanceof Array)){throw new df.Error(999,"Parameters should be provided in an array",this);}
aOptParams=aOptParams||[];oEvent=new df.events.JSEvent(this,{aParams:aOptParams,bClient:false,bServer:false,sReturnVal:null});if(this['psClient'+sName]){fFunc=df.sys.ref.getNestedProp(this['psClient'+sName]);if(typeof fFunc==='function'){oEvent.bClient=bResult=true;try{if(fFunc(oEvent)===false){oEvent.stop();}}catch(oError){this.getWebApp().handleError(oError);}}else{this.getWebApp().handleError(new df.Error(999,"Event handler function '{{0}}' set as 'psClient{{1}}' not found.",this,[this['psClient'+sName],sName]));}}
if(!oEvent.bCancelled){if(this[sName]instanceof df.events.JSHandler){oEvent.bClient=bResult=(bResult||this[sName].aListeners.length>0);this[sName].fire(this,oEvent);}}
if(!oEvent.bCancelled){if(this['pbServer'+sName]&&df.toBool(this['pbServer'+sName])){bResult=true;bASync=true;this.serverAction(sName,aOptParams,null,function(oActEvent){oEvent.sReturnValue=oActEvent.sReturnValue;oEvent.bServer=true;if(fOptHandler){fOptHandler.call(oOptEnv||this,oEvent);}},this);}}
if(!bASync){if(fOptHandler){fOptHandler.call(oOptEnv||this,oEvent);}}
return bResult;}});

df.WebBaseUIObject=function WebBaseUIObject(sName,oParent){df.WebBaseUIObject.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCSSClass","");this.prop(df.tString,"psHtmlId","");this.prop(df.tString,"psTextColor","");this.prop(df.tString,"psBackgroundColor","");this.prop(df.tBool,"pbRender",true);this.prop(df.tBool,"pbVisible",true);this.prop(df.tBool,"pbEnabled",true);this._eElem=null;this._bWrapDiv=false;this._bRenderChildren=false;this._bFocusAble=false;this._sControlClass="";this._sBaseClass="WebUIObj";this._aKeyHandlers=[];this._bShown=false;};df.defineClass("df.WebBaseUIObject","df.WebObject",{openHtml:function(aHtml){if(this._bWrapDiv){aHtml.push('<div class="',this.genClass(),'"');if(this.psHtmlId){aHtml.push(' id="',this.psHtmlId,'"');}
aHtml.push(' data-dfobj="',this.getLongName(),'"');aHtml.push(' tabindex="-1" style=" ',(this.pbRender?'':'display: none;'),(this.pbVisible?'':'visibility: hidden;'),'"');aHtml.push('>');}},closeHtml:function(aHtml){if(this._bWrapDiv){aHtml.push('</div>');}},render:function(){var aHtml=[];this.openHtml(aHtml);this.closeHtml(aHtml);this._eElem=df.dom.create(aHtml.join(""));if(this._bRenderChildren){this.renderChildren();}
return this._eElem;},afterRender:function(){if(this._bRenderChildren){this.afterRenderChildren();}
if(this._aKeyHandlers.length>0){df.events.addDomListener("keydown",this._eElem,this.onKeyDownHandler,this);}
this.attachFocusEvents();this.set_psTextColor(this.psTextColor);this.set_psBackgroundColor(this.psBackgroundColor);},afterShow:function(){var i;this._bShown=true;if(this._bRenderChildren){for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject&&this._aChildren[i].pbRender){this._aChildren[i].afterShow();}}}},afterHide:function(){var i;this._bShown=false;if(this._bRenderChildren){for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject&&this._aChildren[i].pbRender){this._aChildren[i].afterHide();}}}},attachFocusEvents:function(){},renderChildren:function(eContainer){var i,eChild,oChild;eContainer=eContainer||this._eElem;for(i=0;i<this._aChildren.length;i++){oChild=this._aChildren[i];if(oChild instanceof df.WebBaseUIObject){eChild=oChild.render();if(eChild){eContainer.appendChild(eChild);}}}},afterRenderChildren:function(){var i;for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject){this._aChildren[i].afterRender();}}},genClass:function(){return this._sBaseClass+" "+this._sControlClass+(this.pbEnabled?" Web_Enabled":" Web_Disabled")+(this.psCSSClass?" "+this.psCSSClass:"");},set_psTextColor:function(sVal){if(this._eElem){this._eElem.style.color=sVal||'';}},set_psBackgroundColor:function(sVal){if(this._eElem){this._eElem.style.backgroundColor=sVal||'';}},set_pbVisible:function(bVal){if(this._eElem){this._eElem.style.visibility=(bVal?'':'hidden');}},set_pbRender:function(bVal){if(this._eElem){this._eElem.style.display=(bVal?'':'none');if(this.pbRender!==bVal){this.pbRender=bVal;if(this.pbRender){this.afterShow();}else{this.afterHide();}
if(this._oParent){if(this._oParent.position){this._oParent.position();}
if(this._oParent.sizeChanged){this._oParent.sizeChanged();}}}}},set_pbEnabled:function(bVal){if(this._eElem&&bVal!==this.pbEnabled){df.dom.toggleClass(this._eElem,"Web_Disabled",!bVal);df.dom.toggleClass(this._eElem,"Web_Enabled",bVal);}},set_psCSSClass:function(sVal){this.psCSSClass=sVal;if(this._eElem){this._eElem.className=this.genClass();}},set_psHtmlId:function(sVal){if(this._eElem){this._eElem.id=sVal;}},addKeyHandler:function(sServerMsg,iKeyCode,bShift,bAlt,bCtrl){var i,oKH;iKeyCode=df.toInt(iKeyCode);bShift=df.toBool(bShift);bAlt=df.toBool(bAlt);bCtrl=df.toBool(bCtrl);oKH=this.findKeyHandler(iKeyCode,bShift,bAlt,bCtrl);if(oKH){for(i=0;i<oKH.aMsg.length;i++){if(oKH.aMsg[i]===sServerMsg){return;}}
oKH.aMsg.push(sServerMsg);}else{if(this._aKeyHandlers.length===0&&this._eElem){df.events.addDomListener("keydown",this._eElem,this.onKeyDownHandler,this);}
this._aKeyHandlers.push({iKey:iKeyCode,aMsg:[sServerMsg],bShift:bShift,bAlt:bAlt,bCtrl:bCtrl});}},removeKeyHandler:function(sServerMsg,iKeyCode,bShift,bAlt,bCtrl){var i,oKH;iKeyCode=df.toInt(iKeyCode);bShift=df.toBool(bShift);bAlt=df.toBool(bAlt);bCtrl=df.toBool(bCtrl);oKH=this.findKeyHandler(iKeyCode,bShift,bAlt,bCtrl);if(oKH){for(i=0;i<oKH.aMsg.length;i++){if(oKH.aMsg[i]===sServerMsg){oKH.aMsg.splice(i,1);i--;}}
if(!oKH.aMsg.length){this._aKeyHandlers.slice(oKH.iIndex,1);}}
if(this._aKeyHandlers.length===0&&this._eElem){df.events.removeDomListener("keydown",this._eElem,this.onKeyDownHandler);}},findKeyHandler:function(iKeyCode,bShift,bAlt,bCtrl,iIndexOut){var i,oH;for(i=0;i<this._aKeyHandlers.length;i++){oH=this._aKeyHandlers[i];if(oH.iKey===iKeyCode&&oH.bShift===bShift&&oH.bAlt===bAlt&&oH.bCtrl===bCtrl){oH.iIndex=i;return oH;}}
return null;},onKeyDownHandler:function(oEvent){var oKH,i;oKH=this.findKeyHandler(oEvent.getKeyCode(),oEvent.getShiftKey(),oEvent.getAltKey(),oEvent.getCtrlKey());if(oKH){for(i=0;i<oKH.aMsg.length;i++){this.serverAction(oKH.aMsg[i],[oKH.iKey,df.fromBool(oKH.bShift),df.fromBool(oKH.bAlt),df.fromBool(oKH.bCtrl)]);}
oEvent.stop();}},svrFocus:function(){this.focus();},onFocus:function(oEvent){this.getWebApp().objFocus(this);},focus:function(){if(this._bFocusAble&&this.pbEnabled&&this._eElem&&this._eElem.focus){this._eElem.focus();return true;}
return false;},onBlur:function(oEvent){this.getWebApp().objBlur(this);},sizeChanged:function(){var oWebApp,oObj=this;while(oObj._oParent&&!(oObj instanceof df.WebView||oObj instanceof df.WebApp)){oObj=oObj._oParent;}
if(oObj&&oObj.resize){oObj.resize();}
if(this.getWebApp()){this.getWebApp().notifyLayoutChange(this);}},fireSubmit:function(){return(this._oParent&&this._oParent.fireSubmit&&this._oParent.fireSubmit());}});

df.WebBaseContainer_mixin=function WebBaseContainer_mixin(sName,oParent){this.getBase("df.WebBaseContainer_mixin").constructor.call(this,sName,oParent);this.prop(df.tInt,"piColumnCount",1);this.prop(df.tInt,"piWidth",0);this.prop(df.tInt,"piMinWidth",0);this.prop(df.tInt,"piHeight",0);this.prop(df.tInt,"piMinHeight",0);this._oRegionTop=null;this._oRegionLeft=null;this._oRegionCenter=null;this._oRegionRight=null;this._oRegionBottom=null;this._eRegionTop=null;this._eMainArea=null;this._eRegionLeft=null;this._eRegionCenter=null;this._eContent=null;this._eRegionRight=null;this._eRegionBottom=null;this._eContainer=null;this._aUIObjects=[];this._bHasFill=false;this._iContentHeight=null;this._bRendered=false;this._bPanels=false;this._bRenderChildren=true;this._sBaseClass="WebContainer";};df.defineClass("df.WebBaseContainer_mixin",{openHtml:function(aHtml){this.getBase("df.WebBaseContainer_mixin").openHtml.call(this,aHtml);this.wrpOpenHtml(aHtml);aHtml.push('<div class="WebCon_Sizer">');if(this._bPanels){aHtml.push('<div class="WebCon_Main">');}else{aHtml.push('<div class="WebCon_Content">');}},closeHtml:function(aHtml){aHtml.push('</div></div>');this.wrpCloseHtml(aHtml);this.getBase("df.WebBaseContainer_mixin").closeHtml.call(this,aHtml);},wrpOpenHtml:function(aHtml){},wrpCloseHtml:function(aHtml){},afterRender:function(){this.getBase("df.WebBaseContainer_mixin").afterRender.call(this);this._bRendered=true;df.events.addDomListener("scroll",this._eElem,this.onScroll,this);},render:function(){var eElem;this._bRenderChildren=false;eElem=this.getBase("df.WebBaseContainer_mixin").render.call(this);this._bRenderChildren=true;this._eSizer=df.dom.query(this._eElem,"div.WebCon_Sizer");if(this._bPanels){this._eMainArea=df.dom.query(this._eElem,"div.WebCon_Main");}else{this._eContent=df.dom.query(this._eElem,"div.WebCon_Content");}
this._eContainer=df.dom.query(this._eElem,"div.WebContainer")||this._eElem;this.renderChildren();this.position();return eElem;},renderChildren:function(){var i,eChild;if(this._bPanels){if(this._aUIObjects.length>0){throw new df.Error(999,"Web controls and panels cannot be siblings within the same container object '{{0}}'. Consider placing them within a panel.",this,[(this.getLongName()||'oWebApp')]);}
if(this._oRegionTop){this._eRegionTop=this._oRegionTop.render();this._eSizer.insertBefore(this._eRegionTop,this._eMainArea);}
if(this._oRegionLeft){this._eRegionLeft=this._oRegionLeft.render();this._eMainArea.appendChild(this._eRegionLeft);this._eRegionLeft.style.styleFloat="left";this._eRegionLeft.style.cssFloat="left";}
if(this._oRegionRight){this._eRegionRight=this._oRegionRight.render();this._eMainArea.appendChild(this._eRegionRight);this._eRegionRight.style.styleFloat="right";this._eRegionRight.style.cssFloat="right";}
if(this._oRegionCenter){this._eRegionCenter=this._oRegionCenter.render();this._eMainArea.appendChild(this._eRegionCenter);}
this._eMainArea.appendChild(df.dom.create('<div style="clear: both;"></div>'));if(this._oRegionBottom){this._eRegionBottom=this._oRegionBottom.render();this._eSizer.appendChild(this._eRegionBottom);}}else{for(i=0;i<this._aUIObjects.length;i++){eChild=this._aUIObjects[i].render();this._eContent.appendChild(eChild);}
this._eContent.appendChild(df.dom.create('<div style="clear: both;"></div>'));}},addChild:function(oChild){if(oChild instanceof df.WebBaseUIObject){if(oChild.peRegion!==undefined){this._bPanels=true;if(oChild.peRegion===df.ciRegionCenter){if(this._oRegionCenter){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oChild._sName,this._oRegionCenter._sName]);}
this._oRegionCenter=oChild;}else if(oChild.peRegion===df.ciRegionTop){if(this._oRegionTop){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oChild._sName,this._oRegionTop._sName]);}
this._oRegionTop=oChild;}else if(oChild.peRegion===df.ciRegionLeft){if(this._oRegionLeft){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oChild._sName,this._oRegionLeft._sName]);}
this._oRegionLeft=oChild;}else if(oChild.peRegion===df.ciRegionRight){if(this._oRegionRight){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oChild._sName,this._oRegionRight._sName]);}
this._oRegionRight=oChild;}else if(oChild.peRegion===df.ciRegionBottom){if(this._oRegionBottom){throw new df.Error(999,"The region setting (peRegion) in panel '{{0}}' is already used by panel '{{1}}'. Sibling panels may not share the same region setting.",this,[oChild._sName,this._oRegionBottom._sName]);}
this._oRegionBottom=oChild;}else{throw new df.Error(999,"Invalid value for peRegion of '{{0}}'",this,[oChild._sName]);}}else{this._aUIObjects.push(oChild);}}
this.getBase("df.WebBaseContainer_mixin").addChild.call(this,oChild);},prepareSize:function(){var iHeight=0,iMiddle=0,iCur;this._bStretch=false;if(this._bPanels){if(this._oRegionTop&&this._oRegionTop.pbRender){iHeight+=this._oRegionTop.prepareSize();}
if(this._oRegionCenter&&this._oRegionCenter.pbRender){iMiddle=this._oRegionCenter.prepareSize();this._bStretch=this._oRegionCenter._bStretch||this._bStretch;}
if(this._oRegionLeft&&this._oRegionLeft.pbRender){iCur=this._oRegionLeft.prepareSize();iMiddle=(iCur>iMiddle?iCur:iMiddle);this._bStretch=this._oRegionLeft._bStretch||this._bStretch;}
if(this._oRegionRight&&this._oRegionRight.pbRender){iCur=this._oRegionRight.prepareSize();iMiddle=(iCur>iMiddle?iCur:iMiddle);this._bStretch=this._oRegionRight._bStretch||this._bStretch;}
iHeight+=iMiddle;if(this._oRegionBottom&&this._oRegionBottom.pbRender){iHeight+=this._oRegionBottom.prepareSize();}
iHeight+=this.getHeightDiff(true,true,true,true);}else{if(this._bHasFill){if(!this._iContentHeight){this.resizeColumnLayout();}
iHeight+=this._iContentHeight+this.getHeightDiff(true,true,true,true);}else{iHeight+=this._eContent.clientHeight+this.getHeightDiff(true,true,true,false);}}
this._iMinHeight=iHeight;if(this.piHeight>0){this._iWantedHeight=this.piHeight;}else{this._iWantedHeight=(iHeight>this.piMinHeight?iHeight:this.piMinHeight);}
if(this.peRegion!==df.ciRegionTop&&this.peRegion!==df.ciRegionBottom){if((this.piHeight<=0&&this._bHasFill)||(this instanceof df.WebView&&this.pbFillHeight)){this._bStretch=true;}}
this._bSizePrep=true;return this._iWantedHeight;},resizeHorizontal:function(){var i,iWidth=0,iDiff;if(this._eElem){if(this._bPanels){if(this._oRegionLeft){this._oRegionLeft.setOuterWidth(this._oRegionLeft.piWidth);if(this._eRegionCenter&&(this instanceof df.WebApp)){this._eRegionCenter.style.marginLeft=(this._oRegionLeft.pbRender?this._oRegionLeft.piWidth+"px":"0px");}}
if(this._oRegionRight){this._oRegionRight.setOuterWidth(this._oRegionRight.piWidth);if(this._eRegionCenter&&(this instanceof df.WebApp)){this._eRegionCenter.style.marginRight=(this._oRegionRight.pbRender?this._oRegionRight.piWidth+"px":"0px");}}}
iDiff=this.getWidthDiff();if(this.piWidth>0){iWidth=this.piWidth;}
if(iWidth<this.piMinWidth){iWidth=this.piMinWidth;}
if(iWidth>(this._eElem.clientWidth+iDiff)){this.setInnerWidth(iWidth);}else{this.setInnerWidth(0);}
for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject&&!(this._aChildren[i]instanceof df.WebView)){if(this._aChildren[i].pbRender&&this._aChildren[i].resizeHorizontal){this._aChildren[i].resizeHorizontal();}}}}},resizeVertical:function(){var iHeight,iMiddleHeight,iVSpace,iPanelHeight,bStretch=false,i;if(this._eElem){if(!this._bSizePrep){this.prepareSize();}
if(this.piHeight>0||this._bStretch){iHeight=this._eContainer.clientHeight+this.getHeightDiff(true,false,false,false);bStretch=true;}else{iHeight=this._iWantedHeight;}
if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;bStretch=true;}
if(this._bPanels){iVSpace=iHeight;if(this._oRegionTop&&this._oRegionTop.pbRender){iPanelHeight=this._oRegionTop._iWantedHeight;if(iPanelHeight>iVSpace){iHeight=iHeight+this._oRegionTop._iWantedHeight-iVSpace;iVSpace=iPanelHeight;}
iVSpace-=iPanelHeight;this._oRegionTop.setOuterHeight(iPanelHeight);}
if(this._oRegionBottom&&this._oRegionBottom.pbRender){iPanelHeight=this._oRegionBottom._iWantedHeight;if(iPanelHeight>iVSpace){iHeight=iHeight+iPanelHeight-iVSpace;iVSpace=iPanelHeight;}
iVSpace-=iPanelHeight;this._oRegionBottom.setOuterHeight(iPanelHeight);}
if(bStretch||(this._oRegionLeft&&this._oRegionLeft._bStretch)||(this._oRegionCenter&&this._oRegionCenter._bStretch)||(this._oRegionRight&&this._oRegionRight._bStretch)){iMiddleHeight=iVSpace-this.getHeightDiff(true,true,true,true);}else{iMiddleHeight=0;if(this._oRegionLeft&&this._oRegionLeft.pbRender){iMiddleHeight=this._oRegionLeft._iWantedHeight;}
if(this._oRegionCenter&&this._oRegionCenter.pbRender&&this._oRegionCenter._iWantedHeight>iMiddleHeight){iMiddleHeight=this._oRegionCenter._iWantedHeight;}
if(this._oRegionRight&&this._oRegionRight.pbRender&&this._oRegionRight._iWantedHeight>iMiddleHeight){iMiddleHeight=this._oRegionRight._iWantedHeight;}}
if(this._oRegionLeft){this._oRegionLeft.setOuterHeight(iMiddleHeight);}
if(this._oRegionCenter){this._oRegionCenter.setOuterHeight(iMiddleHeight);}
if(this._oRegionRight){this._oRegionRight.setOuterHeight(iMiddleHeight);}
this._iMiddleHeight=iMiddleHeight;}else{this.resizeColumnLayout();if(iHeight>this._eElem.clientHeight+this.getHeightDiff(true,false,false)){this.setInnerHeight(iHeight);}else{this.setInnerHeight(0);}}
for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i]instanceof df.WebBaseUIObject&&!(this._aChildren[i]instanceof df.WebView)){if(this._aChildren[i].pbRender){if(this._aChildren[i].resizeVertical){this._aChildren[i].resizeVertical();}else if(this._aChildren[i].resize){this._aChildren[i].resize();}}}}
this._bSizePrep=false;}},setOuterHeight:function(iHeight){iHeight-=this.getHeightDiff(true,false,false,false);this._eElem.style.height=(iHeight>0?iHeight+"px":"");},setInnerHeight:function(iHeight){iHeight-=this.getHeightDiff(true,true,false,false);this._eSizer.style.height=(iHeight>0?iHeight+"px":"");},setOuterWidth:function(iWidth){iWidth-=df.sys.gui.getHorizBoxDiff(this._eElem,1);this._eElem.style.width=(iWidth>0?iWidth+"px":"");},setInnerWidth:function(iWidth){iWidth-=df.sys.gui.getHorizBoxDiff(this._eElem,0);iWidth-=df.sys.gui.getHorizBoxDiff(this._eSizer,1);this._eSizer.style.width=(iWidth>0?iWidth+"px":"");},resizeColumnLayout:function(){var oChild,i,x,iHeight=0,iRow=0,iCol=0,iRowHeight=0,iMinHeight,iSpace,aStretch=[],iSize,oStretch,iCount=this.piColumnCount,iIndex,iSpan;if(df.sys.isIE&&df.sys.iVersion<=8){iHeight=3;}
if(this._bHasFill){for(i=0;i<this._aUIObjects.length;i++){oChild=this._aUIObjects[i];if(oChild.pbRender){iIndex=(oChild.piColumnIndex<iCount?oChild.piColumnIndex:0);if(iIndex+oChild.piColumnSpan>iCount||oChild.piColumnSpan<=0){iSpan=iCount-iIndex;}else{iSpan=oChild.piColumnSpan;}
if(iCol>iIndex||iCol+iSpan>iCount){if(oStretch){oStretch.iHeight=iRowHeight;aStretch.push(oStretch);oStretch=null;}else{iHeight=iHeight+iRowHeight;}
iRowHeight=0;iRow++;iCol=0;}
if(oChild.pbFillHeight){if(oStretch){oStretch.aItems.push(oChild);}else{oStretch={aItems:[oChild],iHeight:0};}
if(oChild.getMinHeight){iMinHeight=oChild.getMinHeight();}else{iMinHeight=oChild.piMinHeight;}
if(iRowHeight<iMinHeight){iRowHeight=iMinHeight;}}else{if(oChild._eElem.offsetHeight>iRowHeight){iRowHeight=oChild._eElem.offsetHeight;}}
iCol=iIndex+(iSpan||1);}}
if(oStretch){oStretch.iHeight=iRowHeight;aStretch.push(oStretch);}else{iHeight+=iRowHeight;}
this._iContentHeight=iHeight;iSpace=this._eContainer.clientHeight+this.getHeightDiff(true,false,false,false);if(iSpace<this.piMinHeight){iSpace=this.piMinHeight;}
iSpace=iSpace-this.getHeightDiff(true,true,true,true);iSpace=iSpace-iHeight;for(i=0;i<aStretch.length;i++){oStretch=aStretch[i];iSize=iSpace/(aStretch.length-i);this._iContentHeight=this._iContentHeight+oStretch.iHeight;if(iSize<oStretch.iHeight){iSize=oStretch.iHeight;}
for(x=0;x<oStretch.aItems.length;x++){oStretch.aItems[x].sizeHeight(iSize);}
iSpace-=iSize;}}},position:function(){var i,oChild,iCol=0,iCount=this.piColumnCount,iIndex,iSpan;if(iCount<=0){throw new df.Error(999,"Invalid column count on '{{0}}'",this,[this.getLongName()||"oWebApp"]);}
this._bHasFill=false;for(i=0;i<this._aUIObjects.length;i++){oChild=this._aUIObjects[i];if(oChild._eElem&&oChild.pbRender){iIndex=(oChild.piColumnIndex<iCount?oChild.piColumnIndex:0);if(iIndex+oChild.piColumnSpan>iCount||oChild.piColumnSpan<=0){iSpan=iCount-iIndex;}else{iSpan=oChild.piColumnSpan;}
oChild._eElem.style.styleFloat="left";oChild._eElem.style.cssFloat="left";if(iCol>iIndex||iCol+iSpan>iCount){oChild._eElem.style.clear="left";iCol=0;}else{oChild._eElem.style.clear="none";}
oChild._eElem.style.marginLeft=((Math.floor((10000/iCount))/100)*(iIndex-iCol))+"%";iCol=iIndex+(iSpan||1);oChild._eElem.style.width=((Math.floor((10000/iCount))/100)*iSpan)+"%";}
this._bHasFill=this._bHasFill||oChild.pbFillHeight;}},getRequiredHeight:function(){if(!this._bSizePrep){this.prepareSize();}
this._bSizePrep=false;return this._iWantedHeight;},getAvailableHeight:function(){return(this._eSizer.clientHeight>this._eElem.clientHeight?this._eSizer.clientHeight:this._eElem.clientHeight);},getHeightDiff:function(bOut,bIn,bContentOut,bContentIn){var iHeight=0;if(bOut){if(this._eElem){iHeight+=df.sys.gui.getVertBoxDiff(this._eElem,1);}}
if(bIn){if(this._eElem){iHeight+=df.sys.gui.getVertBoxDiff(this._eElem,2);}
if(this._eSizer){iHeight+=df.sys.gui.getVertBoxDiff(this._eSizer,1);}}
if(bContentOut){if(this._eSizer){iHeight+=df.sys.gui.getVertBoxDiff(this._eSizer,2);}
if(this._eMainArea){iHeight+=df.sys.gui.getVertBoxDiff(this._eMainArea,2);}
if(this._eContent){iHeight+=df.sys.gui.getVertBoxDiff(this._eContent,1);}}
if(bContentIn){if(this._eContent){iHeight+=df.sys.gui.getVertBoxDiff(this._eContent,2);iHeight+=1;}}
return iHeight;},getWidthDiff:function(){var iWidth=0;if(this._eElem){iWidth+=df.sys.gui.getHorizBoxDiff(this._eElem,1);}
return iWidth;},getContentWidthDiff:function(){var iWidth=0;if(this._eContent){iWidth+=df.sys.gui.getHorizBoxDiff(this._eContent);}
return iWidth;},onScroll:function(oEvent){var oWebApp=this.getWebApp();if(oWebApp){oWebApp.notifyScroll(this);}},focus:function(bOptSelect){var i;for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i].focus){if(this._aChildren[i].focus(bOptSelect)){return true;}}}
return false;},set_piWidth:function(iVal){this.piWidth=iVal;if(this._eElem){this.sizeChanged();}},set_piHeight:function(iVal){this.piHeight=iVal;if(this._eElem){this.sizeChanged();}},set_piMinHeight:function(iVal){this.piMinHeight=iVal;if(this._eElem){this.sizeChanged();}},set_piMinWidth:function(iVal){this.piMinWidth=iVal;if(this._eElem){this.sizeChanged();}},set_piColumnCount:function(iVal){this.piColumnCount=iVal;this.position();},set_psBackgroundColor:function(sVal){if(this._eContainer){this._eContainer.style.backgroundColor=sVal||'';}}});df.WebBaseContainer=df.mixin("df.WebBaseContainer_mixin","df.WebBaseUIObject");

df.WebBaseControl=function WebBaseControl(sName,oParent){df.WebBaseControl.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piColumnIndex",0);this.prop(df.tInt,"piColumnSpan",1);this.prop(df.tBool,"pbShowLabel",true);this.prop(df.tString,"psLabel","");this.prop(df.tInt,"peLabelPosition",0);this.prop(df.tInt,"peLabelAlign",-1);this.prop(df.tInt,"piLabelOffset",-1);this.prop(df.tString,"psLabelColor","");this.prop(df.tString,"psTooltip","");this.prop(df.tBool,"pbFillHeight",false);this.prop(df.tInt,"piHeight",-1);this.event("OnFocus",df.cCallModeDefault);this.event("OnBlur",df.cCallModeDefault);this._eInner=null;this._eLbl=null;this._eControlWrp=null;this._eControl=null;this._oInfoBalloon=null;this._sControlId=df.dom.genDomId();this._bFocusAble=true;this._bHasFocus=false;this._sBaseClass="WebControl";};df.defineClass("df.WebBaseControl","df.WebBaseUIObject",{openHtml:function(aHtml){aHtml.push('<div class="',this.genClass(),'"');if(this.psHtmlId){aHtml.push(' id="',this.psHtmlId,'"');}
aHtml.push(' style=" ',(this.pbRender?'':'display: none;'),(this.pbVisible?'':'visibility: hidden;'),'"');aHtml.push('>');if(this.pbShowLabel){aHtml.push('<div class="WebCon_Inner"><label for="',this._sControlId,'">&nbsp;</label>');}else{aHtml.push('<div class="WebCon_Inner">');}
aHtml.push('<div>');},closeHtml:function(aHtml){aHtml.push('</div></div></div>');},afterRender:function(){this._eInner=df.dom.query(this._eElem,"div.WebCon_Inner");this._eControlWrp=df.dom.query(this._eElem,"div.WebCon_Inner > div");if(this.pbShowLabel){this._eLbl=df.dom.query(this._eElem,"div > label");}
df.WebBaseControl.base.afterRender.call(this);if(this._eLbl){df.events.addDomListener("click",this._eLbl,this.onLblClick,this);}
this.set_psLabel(this.psLabel);this.posLabel();this.set_psLabelColor(this.psLabelColor);this.set_peLabelAlign(this.peLabelAlign);this.set_psTooltip(this.psTooltip);this.sizeHeight(-1);},onLblClick:function(oEvent){this.focus();},set_psLabel:function(sVal){if(this._eLbl){df.dom.setText(this._eLbl,sVal);}},set_pbShowLabel:function(bVal){this.pbShowLabel=bVal;this.posLabel();},set_psLabelColor:function(sVal){if(this._eLbl){this._eLbl.style.color=sVal;}},set_peLabelAlign:function(iVal){if(this._eLbl){this._eLbl.style.textAlign=(iVal===df.ciAlignLeft?"left":(iVal===df.ciAlignCenter?"center":(iVal===df.ciAlignRight?"right":"")));}},set_piLabelOffset:function(iVal){this.piLabelOffset=iVal;this.posLabel();},set_peLabelPosition:function(iVal){this.peLabelPosition=iVal;this.posLabel();},set_psTooltip:function(sVal){if(this._eControl){this._eControl.title=sVal;}},set_piColumnIndex:function(iVal){if(this.piColumnIndex!==iVal){this.piColumnIndex=iVal;if(this._oParent&&this._oParent.position){this._oParent.position();this._oParent.sizeChanged();}}},set_piColumnSpan:function(iVal){if(this.piColumnSpan!==iVal){this.piColumnSpan=iVal;if(this._oParent&&this._oParent.position){this._oParent.position();this._oParent.sizeChanged();}}},set_psTextColor:function(sVal){if(this._eControl){this._eControl.style.color=sVal||'';}},set_psBackgroundColor:function(sVal){if(this._eControl){this._eControl.style.backgroundColor=sVal||'';this._eControl.style.backgroundImage=(sVal?'none':'');}},set_piMinHeight:function(iVal){if(this._eControl){if(this.piMinHeight!==iVal){this.piMinHeight=iVal;if(!this.pbFillHeight){this.sizeHeight(-1);}
this.sizeChanged();}}},set_piHeight:function(iVal){if(this._eControl){if(this.piHeight!==iVal){this.piHeight=iVal;if(!this.pbFillHeight){this.sizeHeight(-1);}
this.sizeChanged();}}},sizeHeight:function(iExtHeight){var iHeight=-1;if(this.pbFillHeight){iHeight=iExtHeight;}else{if(this.piHeight>0){iHeight=this.piHeight;}}
if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;}
this.setHeight(iHeight);if(iHeight>0){return iHeight;}},setHeight:function(iHeight){if(this._eControl){if(iHeight>0){if(this.peLabelPosition===df.ciLabelTop){iHeight-=this._eLbl.offsetHeight;}
iHeight-=df.sys.gui.getVertBoxDiff(this._eInner);iHeight-=df.sys.gui.getVertBoxDiff(this._eControlWrp);iHeight-=df.sys.gui.getVertBoxDiff(this._eControl);this._eControl.style.height=iHeight+"px";}else{this._eControl.style.height="";}}},posLabel:function(){var iPos=this.peLabelPosition,sClass,sOffset,iOffset=this.piLabelOffset,iMargin,sMargin,oStyle;if(this._eElem){df.dom.removeClass(this._eInner,"WebCon_HasLabel WebCon_TopLabel WebCon_RightLabel WebCon_LeftLabel");if(!this.pbShowLabel){if(this._eLbl){df.events.removeDomListener("click",this._eLbl,this.onLblClick);this._eLbl.parentNode.removeChild(this._eLbl);this._eLbl=null;}
this._eControlWrp.style.marginLeft="";this._eControlWrp.style.marginTop="";this._eControlWrp.style.marginRight="";}else{if(!this._eLbl){this._eLbl=df.dom.create('<label for="',this._sControlId,'">&nbsp;</label>');this.set_psLabel(this.psLabel);this.set_psLabelColor(this.psLabelColor);this.set_peLabelAlign(this.peLabelAlign);this._eInner.insertBefore(this._eLbl,this._eInner.firstChild);df.events.addDomListener("click",this._eLbl,this.onLblClick,this);}
df.dom.addClass(this._eInner,"WebCon_HasLabel");if(this.peLabelPosition<0){oStyle=df.sys.gui.getCurrentStyle(this._eLbl);iPos=(oStyle.marginLeft>0?df.ciLabelLeft:(oStyle.marginRight>0?df.ciLabelRight:df.ciLabelLeft));}
switch(iPos){case df.ciLabelLeft:sClass="WebCon_LeftLabel";iMargin=(iOffset>0?iOffset+df.sys.gui.getHorizBoxDiff(this._eLbl):0);break;case df.ciLabelTop:sClass="WebCon_TopLabel";iMargin=(iOffset>0?iOffset+df.sys.gui.getVertBoxDiff(this._eLbl):0);break;case df.ciLabelRight:sClass="WebCon_RightLabel";iMargin=(iOffset>0?iOffset+df.sys.gui.getHorizBoxDiff(this._eLbl):0);break;}
sOffset=(iOffset>0?iOffset+"px":"");sMargin=(iMargin>0?iMargin+"px":"");this._eControlWrp.style.marginLeft=(iPos===df.ciLabelLeft?sMargin:"");this._eControlWrp.style.marginTop=(iPos===df.ciLabelTop?sMargin:"");this._eControlWrp.style.marginRight=(iPos===df.ciLabelRight?sMargin:"");this._eLbl.style.width=(iPos===df.ciLabelLeft||iPos===df.ciLabelRight?sOffset:"");this._eLbl.style.height=(iPos===df.ciLabelTop?sOffset:"");df.dom.addClass(this._eInner,sClass);}}},getBalloonElem:function(){return this._eControlWrp;},showInfoBalloon:function(sCssClass,sText){if(this._oInfoBalloon){this._oInfoBalloon.psCssClass=sCssClass;this._oInfoBalloon.psMessage=sText;this._oInfoBalloon.update();}else{this._oInfoBalloon=new df.InfoBalloon(this,sCssClass,sText);}
this._oInfoBalloon.show();},hideInfoBalloon:function(){if(this._oInfoBalloon){this._oInfoBalloon.hide();}},resize:function(){if(this._oInfoBalloon){this._oInfoBalloon.resize();}},focus:function(){if(this._bFocusAble&&this.pbEnabled&&this._eControl&&this._eControl.focus){this._eControl.focus();return true;}
return false;},attachFocusEvents:function(){if(window.addEventListener){df.events.addDomCaptureListener("focus",this._eElem,this.onFocus,this);df.events.addDomCaptureListener("blur",this._eElem,this.onBlur,this);}else{df.events.addDomListener("focusin",this._eElem,this.onFocus,this);df.events.addDomListener("focusout",this._eElem,this.onBlur,this);}},onFocus:function(oEvent){df.WebBaseControl.base.onFocus.call(this,oEvent);if(this._eElem){df.dom.addClass(this._eElem,"WebCon_Focus");}
this.fire("OnFocus");this._bHasFocus=true;},onBlur:function(oEvent){df.WebBaseControl.base.onBlur.call(this,oEvent);if(this._eElem){df.dom.removeClass(this._eElem,"WebCon_Focus");}
this.fire("OnBlur");this._bHasFocus=false;}});

df.WebBaseDEO=function WebBaseDEO(sName,oParent){df.WebBaseDEO.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psValue","");this.prop(df.tBool,"pbChanged",false);this.prop(df.tInt,"peDataType",df.ciTypeText);this.prop(df.tInt,"piPrecision",0);this.prop(df.tInt,"piMaxLength",0);this.prop(df.tBool,"pbCapslock",false);this.prop(df.tBool,"pbRequired",false);this.prop(df.tInt,"peAlign",-1);this.prop(df.tString,"psMask","");this.event("OnAutoFind");this.event("OnChange");this._tValue=null;this._sOrigValue="";this._bFilters=true;this._bMasks=true;this._bAutoFind=false;this._aMaskChars=null;this._oErrorBalloon=null;this._aErrors=[];this.addSync("psValue");this.addSync("pbChanged");};df.defineClass("df.WebBaseDEO","df.WebBaseControl",{afterRender:function(){df.WebBaseDEO.base.afterRender.call(this);var sVal=this.psValue;this.set_peDataType(this.peDataType);this.set_psValue(sVal);this.set_pbCapslock(this.pbCapslock);this.set_peAlign(this.peAlign);this.set_pbEnabled(this.pbEnabled);df.dom.enableTextSelection(this._eControlWrp);if(this._eControl){df.events.addDomListener("change",this._eControl,this.onChange,this);df.events.addDomKeyListener(this._eControl,this.onKey,this);df.dom.enableTextSelection(this._eControl);}},attachFocusEvents:function(){if(this._eControl){df.events.addDomListener("focus",this._eControl,this.onFocus,this);df.events.addDomListener("blur",this._eControl,this.onBlur,this);}},get_pbChanged:function(){if(!this.pbChanged&&this._eElem){this.updateTypeVal();}
return this.pbChanged||this._sOrigValue!==this.getServerVal();},set_psValue:function(sVal){this._tValue=this.serverToType(sVal);this.psValue=sVal;this._sPrevChangeVal=this._sOrigValue=this.getServerVal();this.refreshDisplay(this._tValue);this.hideAllControlErrors();},get_psValue:function(){if(this._eElem){this.updateTypeVal();}
return this.getServerVal();},set_peDataType:function(iVal,bSvr){var sValue;if(this._eControl){if(this._bFilters){df.events.removeDomListener("keypress",this._eControl,this.filterDate);df.events.removeDomListener("keypress",this._eControl,this.filterNumeric);if(iVal===df.ciTypeBCD){df.events.addDomListener("keypress",this._eControl,this.filterNumeric,this);}else if(iVal===df.ciTypeDate){df.events.addDomListener("keypress",this._eControl,this.filterDate,this);}}
if(bSvr){sValue=this.get_psValue();}
this.peDataType=iVal;this.initMask();if(bSvr){this.set_psValue(sValue);}
df.dom.removeClass(this._eControl,"dfData_BCD dfData_Date dfDate_Text");if(iVal===df.ciTypeBCD){df.dom.addClass(this._eControl,"dfData_BCD");}else if(iVal===df.ciTypeDate){df.dom.addClass(this._eControl,"dfData_Date");}else{df.dom.addClass(this._eControl,"dfData_Text");}}},set_psMask:function(sVal){this.updateTypeVal();this.psMask=sVal;this.initMask();this.refreshDisplay(this._tValue);},set_pbCapslock:function(bVal){if(this._eControl){this._eControl.style.textTransform=(bVal?"uppercase":"");}},set_pbEnabled:function(bVal){df.WebBaseDEO.base.set_pbEnabled.call(this,bVal);if(this._eControl){this._eControl.disabled=!bVal;this._eControl.tabIndex=(bVal?0:-1);}},set_peAlign:function(iVal){if(this._eControl){this._eControl.style.textAlign=(iVal===df.ciAlignLeft?"left":(iVal===df.ciAlignCenter?"center":(iVal===df.ciAlignRight?"right":"")));}},refreshDisplay:function(tVal){var sVal=this.typeToDisplay(tVal);this.setControlValue(sVal);},serverToType:function(sVal){var tVal=sVal;if(this.peDataType===df.ciTypeBCD){tVal=df.sys.data.stringToNum(sVal,".");}else if(this.peDataType===df.ciTypeDate){tVal=df.sys.data.stringToDate(sVal,"yyyy/mm/dd","-");}
return tVal;},typeToDisplay:function(tVal){var sVal=tVal;if(!this._bHasFocus&&this.psMask&&this.peDataType!==df.ciTypeText){if(this.peDataType===df.ciTypeDate){sVal=(tVal&&df.sys.data.applyDateMask(tVal,this.psMask,this.getWebApp().psDateSeparator))||"";}else if(this.peDataType===df.ciTypeBCD){sVal=(tVal!==null&&df.sys.data.applyNumMask(tVal||0.0,this.psMask,this.getWebApp().psDecimalSeparator,this.getWebApp().psThousandsSeparator,this.getWebApp().psCurrencySymbol))||"";}}else if(this.psMask&&this.peDataType===df.ciTypeText){sVal=df.sys.data.applyWinMask(sVal,this.psMask);}else{if(tVal!==""){if(this.peDataType===df.ciTypeBCD){sVal=(tVal!==null&&df.sys.data.numToString(tVal,this.getWebApp().psDecimalSeparator,this.piPrecision));}else if(this.peDataType===df.ciTypeDate){sVal=(tVal&&df.sys.data.dateToString(tVal,this.getWebApp().psDateFormat,this.getWebApp().psDateSeparator))||"";}}}
return sVal;},updateTypeVal:function(){var sVal=this.getControlValue();if(this.pbCapslock){sVal=sVal.toUpperCase();}
if(this.peDataType===df.ciTypeText&&this.psMask){this.psValue=this._tValue=this.clearWinMask(sVal);}else if(this._bHasFocus||!this.psMask){this.psValue=sVal;if(this.peDataType===df.ciTypeBCD){this._tValue=df.sys.data.stringToNum(sVal,this.getWebApp().psDecimalSeparator,this.getWebApp().psThousandsSeparator);}else if(this.peDataType===df.ciTypeDate){this._tValue=df.sys.data.stringToDate(sVal,this.getWebApp().psDateFormat,this.getWebApp().psDateSeparator);}else{this._tValue=sVal;}}},getServerVal:function(){if(this._tValue!==null){if(this.peDataType===df.ciTypeBCD){return this._tValue.toString();}
if(this.peDataType===df.ciTypeDate){return(this._tValue&&df.sys.data.dateToString(this._tValue,"yyyy/mm/dd","-"))||"";}}
return this.psValue;},getControlValue:function(){if(this._eControl){return this._eControl.value;}
return this.psValue;},setControlValue:function(sVal){if(this._eControl&&this._eControl.value!==sVal){this._eControl.value=sVal;}},initMask:function(){var i,sChar,sMask=this.psMask;if(this._bMasks){this._aMaskChars=null;if(this._bFilters){df.events.removeDomListener("keypress",this._eControl,this.filterWinMask,this);df.events.removeDomListener("keyup",this._eControl,this.correctWinMask,this);df.events.removeDomListener("blur",this._eControl,this.correctWinMask,this);df.events.removeDomListener("cut",this._eControl,this.onCutPasteWinMask,this);df.events.removeDomListener("paste",this._eControl,this.onCutPasteWinMask,this);}
if(this.peDataType===df.ciTypeText&&this.psMask){this._aMaskChars=[];for(i=0;i<sMask.length;i++){sChar=sMask.charAt(i);if(sChar==="\\"&&i+1<this.sMask.length&&(sMask.charAt(i+1)==="#"||sMask.charAt(i+1)==="@"||sMask.charAt(i+1)==="!"||sMask.charAt(i+1)==="*")){i++;this._aMaskChars.push({bEnter:false,bNumeric:false,bAlpha:false,bPunct:false,sChar:sMask.charAt(i+1)});}else{this._aMaskChars.push({bEnter:(sChar==="#"||sChar==="@"||sChar==="!"||sChar==="*"),bNumeric:(sChar==="#"||sChar==="*"),bAlpha:(sChar==="@"||sChar==="*"),bPunct:(sChar==="!"||sChar==="*"),sChar:sChar});}}
if(this._bFilters){df.events.addDomListener("keypress",this._eControl,this.filterWinMask,this);df.events.addDomListener("keyup",this._eControl,this.correctWinMask,this);df.events.addDomListener("cut",this._eControl,this.onCutPasteWinMask,this);df.events.addDomListener("paste",this._eControl,this.onCutPasteWinMask,this);}}}},clearWinMask:function(sVal){var i=0,sResult="";while(i<sVal.length&&i<this._aMaskChars.length){if(this._aMaskChars[i].bEnter||sVal.charAt(i)!==this._aMaskChars[i].sChar){sResult+=sVal.charAt(i);}
i++;}
return sResult;},correctWinMask:function(oEvent){var iPos,sNewValue;sNewValue=df.sys.data.applyWinMask(this.clearWinMask(this._eControl.value),this.psMask);if(sNewValue!==this._eControl.value){iPos=df.dom.getCaretPosition(this._eControl);this._eControl.value=sNewValue;df.dom.setCaretPosition(this._eControl,iPos);}},onCutPasteWinMask:function(oEvent){var that=this;setTimeout(function(){that.correctWinMask();},50);},filterWinMask:function(oEvent){var iPos,iNewPos,sChar;if(!oEvent.isSpecialKey()){iPos=df.dom.getCaretPosition(this._eControl);sChar=String.fromCharCode(oEvent.getCharCode());iNewPos=iPos;while(iNewPos<this._aMaskChars.length&&!this._aMaskChars[iNewPos].bEnter){if(this._eControl.value.length<=iNewPos){this._eControl.value+=this._aMaskChars[iNewPos].sChar;}
iNewPos++;}
if(iPos!==iNewPos&&iNewPos<this._aMaskChars.length){df.dom.setCaretPosition(this._eControl,iNewPos);iPos=iNewPos;}
if(iPos>=this._aMaskChars.length||!df.sys.data.acceptWinMaskChar(sChar,this._aMaskChars[iPos].sChar)){oEvent.stop();}}},filterDate:function(oEvent){var iChar,sChar,iCarret,sNumChar,aFormats,aValues,iCur,iStartPos,sCur,sDateFormat=this.getWebApp().psDateFormat,sDateSepp=this.getWebApp().psDateSeparator;iChar=oEvent.getCharCode();if(!oEvent.isSpecialKey()&&iChar>0){sChar=String.fromCharCode(iChar);iCarret=df.dom.getCaretPosition(this._eControl);sNumChar="0123456789";if(sNumChar.indexOf(sChar)!==-1||sChar===sDateSepp){aFormats=sDateFormat.toLowerCase().split('/');aValues=this._eControl.value.split(sDateSepp);iCur=0;iStartPos=0;while(iCur<aValues.length&&iCur<aFormats.length){if(iCarret-iStartPos>=0&&(iCur+1===aValues.length||iCarret-iStartPos<=aValues[iCur].length)){sCur=aValues[iCur];if(sChar===sDateSepp){if(iCarret-iStartPos>(aFormats[iCur]==="yyyy"?4:2)||iCarret-iStartPos<=0){oEvent.stop();return;}
if(aValues.length>=aFormats.length||sCur.length-(iCarret-iStartPos)>(aFormats[iCur+1]==="yyyy"?4:2)){oEvent.stop();return;}}else{if(sCur.length>=(aFormats[iCur]==="yyyy"?4:2)){if(iCur+1===aValues.length&&aFormats.length>iCur+1&&sCur.length-(iCarret-iStartPos)<(aFormats[iCur+1]==="yyyy"?4:2)){this._eControl.value=this._eControl.value.substring(0,iCarret)+sDateSepp+this._eControl.value.substring(iCarret);df.dom.setCaretPosition(this._eControl,iCarret+1);return;}
oEvent.stop();return;}}}
iStartPos+=sDateSepp.length+aValues[iCur].length;iCur++;}}else{oEvent.stop();}}},filterNumeric:function(oEvent){var iChar,sValidChars,sChar,iSeparator,iBefore,iDecimals,iMaxBefore,iPos,sValue,iSel,sDecSepp=this.getWebApp().psDecimalSeparator;iChar=oEvent.getCharCode();if(!oEvent.isSpecialKey()&&iChar>0){sChar=String.fromCharCode(iChar);iPos=df.dom.getCaretPosition(this._eControl);iSel=df.dom.getSelectionLength(this._eControl);sValue=this._eControl.value;sValidChars="0123456789";if(sChar==="-"){if(iPos===0){if(sValue.indexOf("-")!==-1){df.dom.setCaretPosition(this._eControl,1);oEvent.stop();}}else{oEvent.stop();}}else if(sChar===sDecSepp){iSeparator=sValue.indexOf(sDecSepp);if(iPos===iSeparator&&iSel===0){df.dom.setCaretPosition(this._eControl,iPos+1);oEvent.stop();}else if(iSeparator!==-1&&(iSeparator<iPos||iSeparator>(iPos+iSel))){oEvent.stop();}else if(sValue.indexOf("-")>=iPos&&sValue.indexOf("-")>=iPos+iSel){oEvent.stop();}else if(sValue.length-iSel-iPos>this.piPrecision){oEvent.stop();}else if(this.piPrecision<=0){oEvent.stop();}}else if(sValidChars.indexOf(sChar)!==-1){if(iPos===0&&sValue.indexOf("-")!==-1&&iSel===0){iPos++;df.dom.setCaretPosition(this._eControl,iPos);}
iMaxBefore=this.piMaxLength-this.piPrecision;if(iMaxBefore>=0&&this.piPrecision>=0){iSeparator=sValue.indexOf(sDecSepp);iBefore=(iSeparator===-1?sValue.length:iSeparator)-(sValue.indexOf("-")===-1?0:1);iDecimals=(iSeparator===-1?0:sValue.length-iSeparator-1);if(iPos<=iSeparator||iSeparator===-1){if(iBefore>=iMaxBefore){if(iDecimals<this.piPrecision&&iSeparator!==-1&&iPos===iSeparator){iPos++;df.dom.setCaretPosition(this._eControl,iPos);}else if(iDecimals<this.piPrecision&&iSeparator===-1&&iPos===sValue.length){this._eControl.value=sValue+sDecSepp;}else{oEvent.stop();}}}else if(iDecimals>=this.piPrecision){oEvent.stop();}}}else{oEvent.stop();}}},validate:function(){var bResult=true,sVal;if(this.pbRequired){sVal=this.get_psValue();if((this.peDataType===df.ciTypeBCD&&parseFloat(sVal)===0.0)||sVal===""){bResult=false;this.showControlError(13,this.getWebApp().getTrans("err_entry_required"));}else{this.hideControlError(13);}}
if(bResult){this.fireChange();this.fireAutoFind();this.fire("OnValidate",[],function(oEvent){if(oEvent.bServer){if(oEvent.sReturnValue==="0"){this.focus();}else{this.hideAllControlErrors();}}else{if(oEvent.bCancelled){bResult=false;}}});}
return bResult;},onKey:function(oEvent){var oView=this.getView();if(oEvent.matchKey(df.settings.formKeys.tabOut)){if(!this.validate()){oEvent.stop();}}},onFocus:function(oEvent){df.WebBaseDEO.base.onFocus.call(this,oEvent);this.refreshDisplay(this._tValue);},onBlur:function(oEvent){this.updateTypeVal();this.fireAutoFind();df.WebBaseDEO.base.onBlur.call(this,oEvent);this.refreshDisplay(this._tValue);},fireChange:function(){var sNewVal;this.updateTypeVal();sNewVal=this.getServerVal();if(this._sPrevChangeVal!==sNewVal){this.pbChanged=true;this.fire('OnChange',[sNewVal,this._sPrevChangeVal]);this._bAutoFind=true;this._sPrevChangeVal=sNewVal;}},fireAutoFind:function(){if(this._bAutoFind){this.fire('OnAutoFind');this._bAutoFind=false;}},onChange:function(){this.fireChange();},showControlError:function(iErrNum,sErrText){var i;for(i=0;i<this._aErrors.length;i++){if(this._aErrors[i].iNumber===iErrNum){this._aErrors[i].sText=sErrText;this.updateErrorDisp();return;}}
this._aErrors.push({iNumber:iErrNum,sText:sErrText});this.updateErrorDisp();},hideControlError:function(iErrNum){var i;for(i=0;i<this._aErrors.length;i++){if(this._aErrors[i].iNumber===iErrNum){this._aErrors.splice(i,1);this.updateErrorDisp();break;}}},hideAllControlErrors:function(){this._aErrors=[];this.updateErrorDisp();},updateErrorDisp:function(){var i,aHtml=[];if(this._aErrors.length>0){for(i=0;i<this._aErrors.length;i++){if(i>0){aHtml.push('<br>');}
aHtml.push(this._aErrors[i].sText);}
if(!this._oErrorBalloon){this._oErrorBalloon=new df.InfoBalloon(this,"WebErrorTooltip",aHtml.join(''));this._oErrorBalloon.update();}else{this._oErrorBalloon.psMessage=aHtml.join('');}
this._oErrorBalloon.show();df.dom.addClass(this.getErrorElem(),"WebError");this.makeVisible();this.focus();}else{if(this._oErrorBalloon){this._oErrorBalloon.hide();df.dom.removeClass(this.getErrorElem(),"WebError");}}},getErrorElem:function(){return this._eElem;},resize:function(){df.WebBaseDEO.base.resize.call(this);if(this._oErrorBalloon){this._oErrorBalloon.resize();}},makeVisible:function(){var oControl=this;while(oControl){if(oControl instanceof df.WebCard){oControl.show();}
oControl=oControl._oParent;}}});

df.WebBaseForm=function WebBaseForm(sName,oParent){df.WebBaseForm.base.constructor.call(this,sName,oParent);};df.defineClass("df.WebBaseForm","df.WebBaseDEO",{});

df.dragdrop={_aHandlers:[],_bInDrag:false,onDragEnter:function(oEvent){var eMask,eMaskWrp,oDropDetails,i,aZones=[],eZone,tHideTimeout=null;if(this._bInDrag){return;}
this._bInDrag=true;eMaskWrp=df.dom.create('<div class="WebDropMask"><div class="WebDropMask_Mask"></div></div>');document.body.appendChild(eMaskWrp);eMask=eMaskWrp.firstChild;for(i=0;i<this._aHandlers.length;i++){oDropDetails=this._aHandlers[i].getDropDetails();if(oDropDetails){oDropDetails.oObj=this._aHandlers[i];oDropDetails.eZone=eZone=df.dom.create('<div class="WebDropZone '+oDropDetails.sDropClass+'"><div>'+oDropDetails.sDropContent+'</div></div>');eZone.style.width=oDropDetails.oRect.width+"px";eZone.style.height=oDropDetails.oRect.height+"px";eZone.style.left=oDropDetails.oRect.left+"px";eZone.style.top=oDropDetails.oRect.top+"px";aZones.push(oDropDetails);eMaskWrp.appendChild(eZone);}}
function dragStop(){var i;this._bInDrag=false;for(i=0;i<aZones.length;i++){aZones[i].eZone.parentNode.removeChild(aZones[i].eZone);aZones[i].eZone=null;}
aZones=null;df.events.removeDomListener("dragleave",eMaskWrp,onDragLeave);df.events.removeDomListener("dragenter",eMaskWrp,onDragOver);df.events.removeDomListener("dragover",eMaskWrp,onDragOver);df.events.removeDomListener("drop",eMaskWrp,onDragDrop);eMaskWrp.parentNode.removeChild(eMaskWrp);eMask=null;eMaskWrp=null;}
function onDragOver(oEvent){var eElem=oEvent.getTarget();if(eElem!==eMask){oEvent.e.dataTransfer.dropEffect="copy";}else{oEvent.e.dataTransfer.dropEffect="none";}
oEvent.stop();if(tHideTimeout){clearTimeout(tHideTimeout);tHideTimeout=null;}}
function onDragLeave(oEvent){var that=this;oEvent.stop();if(tHideTimeout){clearTimeout(tHideTimeout);tHideTimeout=null;}
tHideTimeout=setTimeout(function(){dragStop.call(that);},200);}
function onDragDrop(oEvent){var i,eElem=oEvent.getTarget();oEvent.stop();while(eElem.className.indexOf("WebDropZone")<0&&eElem&&eElem!==eMaskWrp){eElem=eElem.parentNode;}
if(eElem){for(i=0;i<aZones.length;i++){if(aZones[i].eZone===eElem){aZones[i].oObj.handleDrop(oEvent);break;}}}
dragStop.call(this);}
df.events.addDomListener("dragleave",eMaskWrp,onDragLeave,this);df.events.addDomListener("dragenter",eMaskWrp,onDragOver,this);df.events.addDomListener("dragover",eMaskWrp,onDragOver,this);df.events.addDomListener("drop",eMaskWrp,onDragDrop,this);oEvent.e.dataTransfer.dropEffect="none";},addHandler:function(oObj){this._aHandlers.push(oObj);},remHandler:function(oObj){var i;for(i=0;i<this._aHandlers.length;i++){if(this._aHandlers[i]===oObj){this._aHandlers.splice(i,1);i--;}}}};df.dom.ready(function(){df.events.addDomListener("dragenter",document.body,df.dragdrop.onDragEnter,df.dragdrop);});df.WebBaseFileUpload=function WebBaseFileUpload(sName,oParent){df.WebBaseFileUpload.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbMultiFile",false);this.prop(df.tBool,"pbAutoStart",true);this.prop(df.tBool,"pbAllowCancel",true);this.prop(df.tBool,"pbNotifyIndividualFile",false);this.prop(df.tBool,"pbShowDialog",true);this.prop(df.tString,"psDragAreaObj","");this._bHTML5=(window.File&&window.FileList&&window.FileReader);this._oDragArea=null;this._eDragArea=null;this._oDialog=null;this._oTotalPrg=null;this._oFilePrg=null;this._oRemLbl=null;this._oFileLbl=null;this._bCanceled=false;this.event("OnUploadFinished",df.cCallModeWait);};df.defineClass("df.WebBaseFileUpload","df.WebBaseControl",{fileHtml:function(aHtml){if(this._bHTML5){aHtml.push('<input type="file" name="',this._sName,'" id="',this._sControlId,'"',(this.pbMultiFile?' multiple':''),'>');}else{aHtml.push('<form>');aHtml.push('<input type="file" name="file" id="',this._sControlId,'">');aHtml.push('<input type="hidden" name="hash" value="">');aHtml.push('<input type="hidden" name="v" value="html4">');aHtml.push('</form>');}},afterRender:function(){this._eControl=df.dom.query(this._eElem,"input");this._eForm=df.dom.query(this._eElem,"form");df.WebBaseFileUpload.base.afterRender.call(this);df.events.addDomListener("change",this._eControl,this.onFileChange,this);},afterShow:function(){df.WebBaseFileUpload.base.afterShow.call(this);df.dragdrop.addHandler(this);},afterHide:function(){df.WebBaseFileUpload.base.afterHide.call(this);df.dragdrop.remHandler(this);},getDropDetails:function(){var oDragObj,eDragElem,oWebApp=this.getWebApp();if(this.pbEnabled){oDragObj=oWebApp.findObj(this.psDragAreaObj);if(oDragObj instanceof df.WebBaseUIObject){if(oDragObj===oWebApp){eDragElem=this.getWebApp()._eViewPort||document.body;}else{eDragElem=oDragObj._eElem;}
if(eDragElem){return{sDropContent:"Drop files!",sDropClass:"",oRect:eDragElem.getBoundingClientRect()};}}}
return null;},handleDrop:function(oEvent){var aFiles;aFiles=(oEvent.e.dataTransfer&&oEvent.e.dataTransfer.files)||null;if(aFiles&&aFiles.length>0){oEvent.stop();this.initFiles(aFiles);}},onFileChange:function(oEvent){var sFileName;if(this._bHTML5){if(this._eControl.files.length>0){this.initFiles(this._eControl.files);}}else{sFileName=this._eControl.value;if(sFileName){if(sFileName.lastIndexOf("\\")>0){sFileName=sFileName.substr(sFileName.lastIndexOf("\\")+1);}
this.initFiles([{name:sFileName,size:0,type:""}]);}}
oEvent.stop();},initFiles:function(aFiles){var i;this._aFiles=[];for(i=0;i<(this.pbMultiFile?aFiles.length:1);i++){this._aFiles.push({bFinished:false,sResourceId:null,oFile:aFiles[i]});}
if(this.pbAutoStart){this.startUpload();}},startUpload:function(){var i,aRows=[],oCurrent;if(this._aFiles.length>0){this._iTotal=0;this._iLoaded=0;for(i=0;i<this._aFiles.length;i++){oCurrent=this._aFiles[i];aRows.push([i,oCurrent.oFile.name,oCurrent.oFile.size,oCurrent.oFile.type]);this._iTotal+=oCurrent.oFile.size;}
this.displayStartWorking();this.serverAction("DoStartUpload",[],df.sys.vt.serialize(aRows));}else{alert("Not ready!");}},processUpload:function(){var i,aRows=df.sys.vt.deserialize(this._tActionData,[[df.tString]]);for(i=0;i<aRows.length;i++){if(aRows[i].length>=2&&this._aFiles[aRows[i][0]]){this._aFiles[aRows[i][0]].sResourceId=aRows[i][1];}else{alert("Received invalid data!");}}
this._iTotal=0;this._iLoaded=0;for(i=0;i<this._aFiles.length;i++){if(!this._aFiles[i].sResourceId){this._aFiles.splice(i,1);i--;}else{this._iTotal+=this._aFiles[i].oFile.size;}}
if(this._aFiles.length>0){this._bCanceled=false;if(this._bHTML5){this.uploadFilesHtml5();}else{this.uploadFileHtml4(this._aFiles[0]);}}else{alert("All files are cancelled!");}},displayStartWorking:function(){var oDialog,oMainPnl,oLbl,oFileLbl,oRemLbl,oSpacer,oTotalPrg,oFilePrg,oBtnPnl,oCancelBtn,oLabel;if(this.pbShowDialog){if(this._bHTML5){this._oDialog=oDialog=new df.WebModalDialog(null,this);oDialog.psCaption="Uploading files...";oDialog.pbShowClose=this.pbAllowCancel;oDialog.piMinWidth=500;oDialog.OnEscape.addListener(this.onCancel,this);oMainPnl=new df.WebPanel(null,oDialog);oMainPnl.peRegion=df.ciRegionCenter;oMainPnl.piColumnCount=10;oDialog.addChild(oMainPnl);oLbl=new df.WebLabel(null,oMainPnl);oLbl.psCaption="File:";oLbl.piColumnSpan=2;oLbl.peAlign=df.ciAlignRight;oMainPnl.addChild(oLbl);this._oFileLbl=oFileLbl=new df.WebLabel(null,oMainPnl);oFileLbl.psCaption="...";oFileLbl.piColumnSpan=0;oFileLbl.piColumnIndex=2;oMainPnl.addChild(oFileLbl);oLbl=new df.WebLabel(null,oMainPnl);oLbl.psCaption="Remaining:";oLbl.piColumnSpan=2;oLbl.peAlign=df.ciAlignRight;oMainPnl.addChild(oLbl);this._oRemLbl=oRemLbl=new df.WebLabel(null,oMainPnl);oRemLbl.psCaption=this._aFiles.length+" files ("+df.sys.data.markupDataSize(this._iTotal)+")";oRemLbl.piColumnSpan=0;oRemLbl.piColumnIndex=2;oMainPnl.addChild(oRemLbl);oSpacer=new df.WebSpacer(null,oMainPnl);oMainPnl.addChild(oSpacer);if(this.pbMultiFile){this._oTotalPrg=oTotalPrg=new df.WebProgressBar(null,oMainPnl);oTotalPrg.piMaxValue=(this._iTotal>0?this._iTotal:this._aFiles.length);oMainPnl.addChild(oTotalPrg);}
this._oFilePrg=oFilePrg=new df.WebProgressBar(null,oMainPnl);oMainPnl.addChild(oFilePrg);if(this.pbAllowCancel){oBtnPnl=new df.WebPanel(null,oDialog);oBtnPnl.peRegion=df.ciRegionBottom;oBtnPnl.piColumnCount=6;oDialog.addChild(oBtnPnl);this._oCancelButton=oCancelBtn=new df.WebButton(null,oBtnPnl);oCancelBtn.psCaption="Cancel";oCancelBtn.piColumnIndex=5;oCancelBtn.OnClick.addListener(this.onCancel,this);oBtnPnl.addChild(oCancelBtn);}
oDialog.show();this.getWebApp().ready(function(){oDialog.resize();if(oCancelBtn){oCancelBtn.focus();}});}else{this._oDialog=oDialog=new df.WebModalDialog(null,this);oDialog.psCaption="";oDialog.pbResizable=false;oDialog.pbShowClose=this.pbAllowCancel;oDialog.OnEscape.addListener(this.onCancel,this);oLabel=new df.WebLabel(null,oDialog);oLabel.psCaption="Uploading files...";oLabel.psCSSClass="WebMsgBoxProgress";oDialog.addChild(oLabel);oDialog.show();}}},onCancel:function(oEvent){this.cancel();},displayProgress:function(iFile,iFiles,iFileLoaded,iFileTotal,iTotalLoaded,iTotal){var iRem,iBytesRem;if(this.pbShowDialog){this._oFileLbl.set("psCaption",this._aFiles[iFile].oFile.name);iRem=iFiles-(iFile+1);iBytesRem=iTotal-iTotalLoaded;this._oRemLbl.set("psCaption",(iRem>0?(iRem.toString()+" files ("+df.sys.data.markupDataSize(iBytesRem)+")"):df.sys.data.markupDataSize(iBytesRem)));if(this.pbMultiFile){this._oTotalPrg.set("piMaxValue",iTotal);this._oTotalPrg.set("piValue",iTotalLoaded);}
this._oFilePrg.set("piMaxValue",iFileTotal);this._oFilePrg.set("piValue",iFileLoaded);}},displayFinishWorking:function(){if(this.pbShowDialog){if(this._bHTML5){this._oFilePrg.set("piValue",this._oFilePrg.get("piMaxValue"));if(this.pbMultiFile){this._oTotalPrg.set("piValue",this._oTotalPrg.get("piMaxValue"));}
this._oRemLbl.set("psCaption","0 KB");}}},displayFinished:function(bSuccess){if(this.pbShowDialog&&this._oDialog){this._oDialog.hide();this._oDialog.destroy();this._oDialog.OnEscape.removeListener(this.onCancel);this._oDialog=null;if(this._oCancelButton){this._oCancelButton.OnClick.removeListener(this.onCancelClick);this._oCancelButton=null;}
if(this._bHTML5){this._oTotalPrg=null;this._oFilePrg=null;this._oRemLbl=null;this._oFileLbl=null;}}},cancel:function(){var i;this._bCanceled=true;if(this._bHTML5){this._aFiles=[];if(this._oRequest){this._oRequest.abort();}
this.displayFinished(false);}else{if(this._eIFrame){this._eIFrame.src="";}
this.displayFinished(false);}},uploadFilesHtml5:function(){var i,bLast=true,oFile=null,iIndex;if(this._bCanceled){return;}
for(i=0;i<this._aFiles.length;i++){if(!this._aFiles[i].bFinished){if(!oFile){oFile=this._aFiles[i];iIndex=i;}else{bLast=false;break;}}}
this.uploadFileHtml5(oFile,iIndex,function(bSuccess){var i;if(bSuccess){if(bLast){this.displayFinishWorking();}
if(this.pbNotifyIndividualFile){this.serverAction("DoFileFinished",[oFile.oFile.name,oFile.sResourceId]);}else{if(bLast){for(i=0;i<this._aFiles.length;i++){this.serverAction("DoFileFinished",[this._aFiles[i].oFile.name,this._aFiles[i].sResourceId]);}}}
if(bLast){this.fire("OnUploadFinished",[],function(oEvent){this.displayFinished(true);});}else{this.uploadFilesHtml5();}}else{this.displayFinished(false);}});},uploadFileHtml5:function(oFile,iFile,fFinished){var that=this,oReq,oData;this.displayProgress(iFile,this._aFiles.length,0,oFile.oFile.size,this._iLoaded,this._iTotal);this._oRequest=oReq=new XMLHttpRequest();oReq.upload.addEventListener('progress',function(ev){var iTotal=that._iLoaded+ev.loaded;iTotal=(iTotal<that._iTotal?iTotal:that._iTotal);that.displayProgress(iFile,that._aFiles.length,ev.loaded,ev.total,iTotal,that._iTotal);},false);oReq.onreadystatechange=function(ev){try{if(oReq.readyState===df.ajax.REQUEST_STATE_COMPLETE){if(!that._bCanceled){if(oReq.status===200){if(oReq.responseText.indexOf("!completed!")>=0){oFile.bFinished=true;that._iLoaded+=oFile.oFile.size;fFinished.call(that,true);}else{throw new df.Error(999,"Received error '{{0}}' while uploading file.",this,[oReq.responseText]);}}else{throw new df.Error(999,"Received HTTP error '{{0}} {{1}}' while uploading file.",this,[oReq.status,oReq.statusText],oReq.responseText);}}
this._oRequest=null;}}catch(oErr){fFinished.call(that,false);that.getWebApp().handleError(oErr);this._oRequest=null;}};oReq.open('POST',this.psUploadUrl,true);oData=new FormData();oData.append('file',oFile.oFile);oData.append('hash',oFile.sResourceId);oData.append('v','html5');oReq.send(oData);},uploadFileHtml4:function(oFile){var eForm=this._eForm,eIFrame,eDiv,fHandler,sName;if(this._eControl.value){sName="vdf_webfileuploader_"+df.dom.piDomCounter++;eDiv=df.dom.create('<div style="position: absolute; top: 0px; background-color: #DDDDEE; overflow: hidden; width: 1px; height: 1px;"></div>');this._eElem.appendChild(eDiv);eDiv.innerHTML='<iframe name="'+sName+'" style="width: 0; height: 0; border: none;"></iframe>';this._eIFrame=eIFrame=eDiv.firstChild;fHandler=function(oEvent){var sResultStr="";try{df.events.removeDomListener("load",eIFrame,fHandler);if(!this._bCanceled){try{if(eIFrame.contentWindow){sResultStr=eIFrame.contentWindow.document.body.innerHTML;}else if(eIFrame.document){sResultStr=eIFrame.document.body.innerHTML;}else if(eIFrame.contentDocument){sResultStr=eIFrame.contentDocument.body.innerHTML;}}catch(oErr){}
if(sResultStr.indexOf("!completed!")>=0){eForm.reset();this.serverAction("DoFileFinished",[oFile.oFile.name,oFile.sResourceId]);this.fire("OnUploadFinished",[],function(oEvent){this.displayFinished(true);});}else{if(sResultStr&&sResultStr.indexOf("<")>=0){throw new df.Error(999,"Received error from server while uploading file.",this,[],sResultStr);}else if(sResultStr){throw new df.Error(999,"Received error '{{0}}' while uploading file.",this,[sResultStr]);}else{throw new df.Error(999,"Unable to upload file.",this,[sResultStr]);}}}}catch(oErr){this.displayFinished(false);this.getWebApp().handleError(oErr);}
this._eIFrame=null;setTimeout(function(){eIFrame.parentNode.removeChild(eIFrame);},1500);};df.events.addDomListener("load",eIFrame,fHandler,this);eForm.hash.value=oFile.sResourceId;eForm.setAttribute("target",sName);eForm.setAttribute("action",this.psUploadUrl);eForm.setAttribute("method","post");eForm.setAttribute("enctype","multipart/form-data");eForm.setAttribute("encoding","multipart/form-data");eForm.submit();}}});

df.WebPanel=function WebPanel(sName,oParent){df.WebPanel.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peRegion",0);this.prop(df.tBool,"pbResizable",false);this._eDivider=null;this._bWrapDiv=true;this._sControlClass="WebPanel";};df.defineClass("df.WebPanel","df.WebBaseContainer",{afterRender:function(){df.WebPanel.base.afterRender.call(this);this.set_pbResizable(this.pbResizable);},set_pbResizable:function(bVal){if(this._eElem){if(bVal&&this.peRegion!==df.ciRegionCenter){if(!this._eDivider){this._eDivider=df.dom.create('<div class="'+(this.peRegion===df.ciRegionLeft||this.peRegion===df.ciRegionRight?'WebPanel_DividerVertical':'WebPanel_DividerHorizontal')+'"></div>');this._eElem.appendChild(this._eDivider);df.events.addDomListener("mousedown",this._eDivider,this.onResize,this);if(this.peRegion===df.ciRegionLeft){this._eDivider.style.right="0px";}else if(this.peRegion===df.ciRegionRight){this._eDivider.style.left="0px";}else if(this.peRegion===df.ciRegionBottom){this._eDivider.style.top="0px";}else if(this.peRegion===df.ciRegionTop){this._eDivider.style.bottom="0px";}}}else{if(this._eDivider){df.events.removeDomListener("mousedown",this._eDivider,this.onResize);this._eElem.removeChild(this._eDivider);this._eDivider=null;}}}},onResize:function(oEvent){var eMask,eGhost,iCurLeft,iStartLeft,iMin=0,iMax=0,iCurTop,iStartTop,iStartMouseY,iStartMouseX;eGhost=df.dom.create('<div class="'+(this.peRegion===df.ciRegionLeft||this.peRegion===df.ciRegionRight?'WebPanel_DividerVertical_Ghost':'WebPanel_DividerHorizontal_Ghost')+'"></div>');eMask=eMask=df.gui.dragMask();if(this.peRegion===df.ciRegionTop||this.peRegion===df.ciRegionBottom){eMask.style.cursor="n-resize";if(this.peRegion===df.ciRegionTop){iCurTop=this._eElem.clientHeight;iMin=(this.piMinHeight>2?this.piMinHeight:2);iMax=iCurTop+this._oParent._eMainArea.clientHeight;if(this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinHeight>0){iMax=iMax-this._oParent._oRegionCenter.piMinHeight;}}else{iCurTop=this._oParent._eMainArea.clientHeight;if(this._oParent._eRegionTop){iCurTop+=this._oParent._eRegionTop.clientHeight;iMin=this._oParent._eRegionTop.clientHeight;}
if(this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinHeight>0){iMin+=this._oParent._oRegionCenter.piMinHeight;}
iMax=iCurTop+this._eElem.clientHeight-(this.piMinHeight>0?this.piMinHeight:0)-10;}
eGhost.style.top=iCurTop+"px";this._oParent._eMainArea.parentNode.appendChild(eGhost);}else{eMask.style.cursor="e-resize";if(this.peRegion===df.ciRegionLeft){iCurLeft=this._eElem.clientWidth;iMin=(this.piMinWidth>2?this.piMinWidth:2);iMax=iCurLeft+this._oParent._eRegionCenter.clientWidth;if(this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinWidth>0){iMax=iMax-this._oParent._oRegionCenter.piMinWidth;}else{iMax=iMax-4;}}else{iCurLeft=this._oParent._eMainArea.clientWidth-this._eElem.clientWidth;if(this._oParent._eRegionLeft){iMin=this._oParent._eRegionLeft.clientWidth;}
if(this._oParent._oRegionCenter&&this._oParent._oRegionCenter.piMinWidth>0){iMin+=this._oParent._oRegionCenter.piMinWidth;}
iMax=iCurLeft+this._eElem.clientWidth-(this.piMinWidth>0?this.piMinWidth:0)-10;}
eGhost.style.left=iCurLeft+"px";this._oParent._eMainArea.appendChild(eGhost);}
iStartLeft=iCurLeft;iStartTop=iCurTop;iStartMouseX=oEvent.getMouseX();iStartMouseY=oEvent.getMouseY();function onResize(oEvent){if(this.peRegion===df.ciRegionTop||this.peRegion===df.ciRegionBottom){iCurTop=iStartTop-(iStartMouseY-oEvent.getMouseY());iCurTop=(iCurTop<iMax?(iCurTop>iMin?iCurTop:iMin):iMax);eGhost.style.top=iCurTop+"px";}else{iCurLeft=iStartLeft-(iStartMouseX-oEvent.getMouseX());iCurLeft=(iCurLeft<iMax?(iCurLeft>iMin?iCurLeft:iMin):iMax);eGhost.style.left=iCurLeft+"px";}}
function onStopResize(oEvent){df.events.removeDomListener("mouseup",eMask,onStopResize);df.events.removeDomListener("mouseup",window,onStopResize);df.events.removeDomListener("mousemove",eMask,onResize);eMask.parentNode.removeChild(eMask);if(eGhost){eGhost.parentNode.removeChild(eGhost);}
if(this.peRegion===df.ciRegionTop){this.piHeight=iCurTop;this._eElem.style.height=this.piHeight+"px";}else if(this.peRegion===df.ciRegionBottom){this.piHeight=this._eElem.clientHeight+(iStartTop-iCurTop);this._eElem.style.height=this.piHeight+"px";}else if(this.peRegion===df.ciRegionLeft){this.piWidth=iCurLeft;this._eElem.style.width=this.piWidth+"px";}else if(this.peRegion===df.ciRegionRight){this.piWidth=this._eElem.clientWidth+(iStartLeft-iCurLeft);this._eElem.style.width=this.piWidth+"px";}
this.sizeChanged();}
df.events.addDomListener("mousemove",eMask,onResize,this);df.events.addDomListener("mouseup",window,onStopResize,this);df.events.addDomListener("mouseup",eMask,onStopResize,this);oEvent.stop();}});

df.WebApp=function WebApp(sOptWebService,sOptCookieName,iOptCookieHours){df.WebApp.base.constructor.call(this,"oWebApp",null);this.prop(df.tString,"psWebService",sOptWebService||"WebServiceDispatcher.wso");this.prop(df.tString,"psTheme",(typeof(sDfPreloadTheme)==="string"&&sDfPreloadTheme)||"Df_Web_Creme");this.prop(df.tString,"psDecimalSeparator",",");this.prop(df.tString,"psThousandsSeparator",".");this.prop(df.tString,"psDateFormat","dd/mm/yyyy");this.prop(df.tString,"psDateSeparator","-");this.prop(df.tString,"psCurrencySymbol","&euro;");this.prop(df.tInt,"piScreenWidth",screen.width);this.prop(df.tInt,"piScreenHeight",screen.width);this.prop(df.tInt,"piWindowWidth",0);this.prop(df.tInt,"piWindowHeight",0);this.OnError=new df.events.JSHandler();this.OnShowProgress=new df.events.JSHandler();this.OnShowWindow=new df.events.JSHandler();this.OnHideWindow=new df.events.JSHandler();this.OnHideProgress=new df.events.JSHandler();this.pbMDI=false;this._bInitStarted=false;this._aSyncPropCache=[];this._oCurrentWindow=null;this._oCurrentView=null;this._oCurrentObj=null;this._aViews=[];this._aFocussed=[];this._bReady=false;this._aLoadQueue=[];this._sStartupView=null;this._oLoadViewQueue={};this._bCallTimeout=false;this._oPendingCall=null;this._oSendingCall=null;this._eStyleSystem=null;this._eStyleTheme=null;this._eStyleApplication=null;this._sRootPath=df.psRootPath;this._oTranslations={};this._aModalQueue=[];this._bWrapDiv=true;this._sControlClass="WebApp";this._bPanels=true;this._eViewPort=null;this.addSync("piScreenWidth");this.addSync("piScreenHeight");this.addSync("piWindowWidth");this.addSync("piWindowHeight");this.setActionMode("loadView",df.cCallModeWait);};df.defineClass("df.WebApp","df.WebBaseContainer",{afterRender:function(){this._eRegionCenter=df.dom.create('<div class="WebApp_ViewRegion"></div>');this._eMainArea.insertBefore(this._eRegionCenter,this._eMainArea.lastChild);df.events.addDomListener("resize",window,this.onResize,this);df.events.addDomListener("scroll",window,this.onScroll,this);df.WebApp.base.afterRender.call(this);this.set_pbMDI(this.pbMDI);if(this._eElem){df.dom.addClass(this._eElem,this.psTheme);}},addChild:function(oChild){if(!(oChild instanceof df.WebView)){if(oChild.peRegion===df.ciRegionCenter){throw new df.Error(999,"The 'oWebApp' object should not have panels set to the center region, this space is reserved for the WebView.",this,[oChild.getLongName()]);}
df.WebApp.base.addChild.call(this,oChild);}else{this._aViews.push(oChild);}},renderViewPort:function(eRenderTo){var eViewPort=df.dom.create('<div id="'+this.psHtmlId+'" class="'+this.psTheme+'"></div>');eRenderTo.appendChild(eViewPort);return eViewPort;},initialize:function(){this._bInitStarted=true;try{if(this.checkBrowser()){this.serverAction("LoadWebApp",[],null,function(oEvent){this._sStartupView=oEvent.sReturnValue;this.updateCSS(false);df.dom.ready(function(){this.testCSS(function(){var i;try{this.checkVersion();this._bReady=true;for(i=0;i<this._aLoadQueue.length;i++){this._aLoadQueue[i].fHandler.call(this._aLoadQueue[i].oEnv||this);}}catch(oErr){this.handleError(oErr);}
this._bCallTimeout=true;});},this);});}}catch(oErr){this.handleError(oErr);}},checkBrowser:function(){if(df.sys.isIE&&df.sys.iVersion<8){alert("Unfortunately the browser you are using is not supported by this framework. Please upgrade to a more modern browser.\n\r\n\rThe minimal version required is Internet Explorer 8. We advise to use the latest version of Google Chrome or Mozilla FireFox.");return false;}
return true;},checkVersion:function(){var aPartsServer,aPartsClient,i;if(this.psVersionID!==df.psVersionId){aPartsServer=(this.psVersionID||"").split(".");aPartsClient=(df.psVersionId||"").split(".");if(aPartsServer.length===aPartsClient.length){for(i=0;i<aPartsServer.length;i++){if(parseInt(aPartsServer[i],10)<parseInt(aPartsClient[i],10)){this.handleError(new df.Error(999,"The server application ('{{1}}') is running an older version than the client-engine ('{{0}}'). Consider recompiling the server application.",this,[df.psVersionId,this.psVersionID]));return false;}
if(parseInt(aPartsServer[i],10)>parseInt(aPartsClient[i],10)){this.handleError(new df.Error(999,"The server application ('{{1}}') is running a newer version than the client-engine ('{{0}}'). This might be a caching issue, consider clearing your browser cache.",this,[df.psVersionId,this.psVersionID]));return false;}}}else{throw new df.Error(999,"There is a version number mismatch between the client-engine ('{{0}}') and the server application ('{{1}}') version numbers.",this,[df.psVersionId,this.psVersionID]);}}
return true;},ready:function(sView,fHandler,oOptEnv){if(!this._bInitStarted){this.initialize();}
if(typeof(sView)==="string"){this.ready(function(){if(this[sView]instanceof df.WebView){fHandler.call(oOptEnv||this);}else{if(!this._oLoadViewQueue[sView]){this._oLoadViewQueue[sView]={aWaiters:[],bLoading:false};}
this._oLoadViewQueue[sView].aWaiters.push({fHandler:fHandler,oEnv:oOptEnv});}});}else{oOptEnv=fHandler;fHandler=sView;if(!this._bReady){this._aLoadQueue.push({fHandler:fHandler,oEnv:oOptEnv});}else{fHandler.call(oOptEnv||this);}}},displayApp:function(oRenderTo){this.ready(function(){var eContent,eRenderTo;try{if(typeof(oRenderTo)==="string"){eRenderTo=df.dom.query(document.body,oRenderTo);}else{eRenderTo=oRenderTo;}
if(!eRenderTo){throw new df.Error(999,"No proper element passed",this);}
this._eViewPort=eContent=this.render();this.afterRender();eContent.style.visibility="hidden";eRenderTo.appendChild(eContent);this.afterShow();this.resize();eContent.style.visibility="";if(this._sStartupView){this.showView(this._sStartupView);}}catch(oErr){this.handleError(oErr);}});},displayView:function(sView,oRenderTo){this.ready(function(){var eRenderTo;try{if(typeof(oRenderTo)==="string"){eRenderTo=df.dom.query(document.body,oRenderTo);}else{eRenderTo=oRenderTo;}
if(!eRenderTo){throw new df.Error(999,"No proper element passed",this);}
if(!this._eViewPort){eRenderTo=this._eViewPort=this.renderViewPort(eRenderTo);}
if(this[sView]&&this[sView]instanceof df.WebView){this.renderView(this[sView],eRenderTo,true);}else{this.loadView(sView,null,function(){this.renderView(this[sView],eRenderTo,true);});}}catch(oErr){this.handleError(oErr);}});},renderView:function(oView,eRenderTo){if(!oView._bRendered){if(oView instanceof df.WebModalDialog){oView._oInvokingView=this._oCurrentWindow||null;if(oView._oInvokingView){oView.addSync("psInvokingView");}}else{if(this.pbMDI){oView.pbFloating=true;}}
oView._show(eRenderTo);this._oCurrentWindow=oView;this.resize();}},showView:function(sName){function doShow(oView){if(oView instanceof df.WebModalDialog){this.queueModal(function(){this.renderView(oView,this._eRegionCenter);},this);}else{if(!this.pbMDI&&this._oCurrentView){this.hideView(this._oCurrentView);}
this.renderView(oView,this._eRegionCenter);this._oCurrentView=oView;}}
if(this[sName]&&this[sName]instanceof df.WebView){doShow.call(this,this[sName]);}else{this.loadView(sName,((this._oCurrentWindow&&this._oCurrentWindow._sName)||""),doShow);}},hideView:function(sView){var oView;oView=(typeof sView==="string"?this[sView]:sView);if(oView instanceof df.WebView){oView._hide();if(this._oCurrentWindow===oView){this._oCurrentWindow=null;}
if(this._oCurrentView===oView){this._oCurrentView=null;}
if(oView instanceof df.WebModalDialog){if(oView._oInvokingView){this._oCurrentWindow=oView._oInvokingView;}}else{if(this.pbMDI){while(!oView._bRendered){oView=this._aFocussed.pop();}
if(oView&&oView._bRendered){oView.bringFront();}}}}},loadView:function(sName,sOptInvoker,fHandler,oEnv){this.ready(function(){if(this[sName]&&this[sName]instanceof df.WebView){if(fHandler){fHandler.call(oEnv||this,this[sName]);}}else{if(!this._oLoadViewQueue[sName]){this._oLoadViewQueue[sName]={aWaiters:[],bLoading:false};}
if(this._oLoadViewQueue[sName].bLoading){return;}
this._oLoadViewQueue[sName].bLoading=true;if(fHandler){this._oLoadViewQueue[sName].aWaiters.push({fHandler:fHandler,oEnv:oEnv});}
var oAction=new df.ServerAction();oAction.oWO=this;oAction.sAction="loadView";oAction.aParams=[sName,sOptInvoker||""];oAction.eCallMode=df.cCallModeWait;oAction.fHandler=function(){var aWaiters,i,oView=this[sName];try{if(oView instanceof df.WebView){aWaiters=this._oLoadViewQueue[sName].aWaiters;for(i=0;i<aWaiters.length;i++){aWaiters[i].fHandler.call(aWaiters[i].oEnv||this,oView);}
this._oLoadViewQueue[sName]=null;}else{this._oLoadViewQueue[sName].bLoading=false;throw new df.Error(999,"No view definition received for '{{0}}'",this,[sName]);}}catch(oErr){this.handleError(oErr);}};oAction.oHandlerEnv=this;oAction.aViews.push(sOptInvoker||null);oAction.aViews.push(sName);this.handleAction(oAction);}},this);},unloadView:function(sView){var oView,i;if(this[sView]&&this[sView]instanceof df.WebView){this.hideView(sView);oView=this[sView];if(oView.destroy){oView.destroy();}
for(i=0;i<this._aViews.length;i++){if(this._aViews[i]===oView){this._aViews.splice(i,1);}}
delete this[sView];}},windowFocus:function(oWin){var i;if(oWin instanceof df.WebView){if(oWin!==this._oCurrentWindow){if(this.pbMDI){for(i=0;i<this._aFocussed.length;i++){if(this._aFocussed[i]===oWin){this._aFocussed.splice(i,1);break;}}
this._aFocussed.push(oWin);}
this._oCurrentWindow=oWin;}}},objFocus:function(oObj){this._oCurrentObj=oObj;},objBlur:function(oObj){},returnFocus:function(){if(this._oCurrentObj){this._oCurrentObj.focus();}},getFocusObjName:function(){if(this._oCurrentObj instanceof df.WebBaseUIObject&&!this._oCurrentObj._bStandalone){return this._oCurrentObj.getLongName();}
return"";},set_pbMDI:function(bVal){if(this._eRegionCenter){this._eRegionCenter.style.position=(bVal?"relative":"");}},notifyScroll:function(oWO){df.debug("Scoll: "+oWO.getLongName());this.notifyPosChange(oWO);},notifyLayoutChange:function(oWO){this.notifyPosChange(oWO);},notifyPosChange:function(oWO){},initJSON:function(tDef){function initObj(tDef,oContext){var i,oObj,FConstructor;if(tDef.sType==="df.WebApp"){oObj=this;}else{if(!oContext[tDef.sName]){FConstructor=this.getConstructor(tDef.sType,tDef);if(typeof(FConstructor)==="function"){oContext[tDef.sName]=oObj=new FConstructor(tDef.sName,oContext);}else{throw new df.Error(999,"Could not find class '{{0}}'",this,[tDef.sType]);}}else{throw new df.Error(999,"Naming conflict with child object '{{0}}'",this,[tDef.sName]);}}
for(i=0;i<tDef.aProps.length;i++){if(tDef.aProps[i].sN.charAt(0)!=="_"){if(!oObj[tDef.aProps[i].sN]||(typeof(oObj[tDef.aProps[i].sN])!=="object"&&typeof(oObj[tDef.aProps[i].sN])!=="function")){oObj._set(tDef.aProps[i].sN,tDef.aProps[i].sV,false,false);}else{throw new df.Error(999,"Naming conflict with property '{{0}}' of object '{{1}}'",this,[tDef.aProps[i].sN,tDef.sName]);}}else{throw new df.Error(999,"Published property '{{0}}' of object '{{1}}' properties should not start with an '_'",this,[tDef.aProps[i].sV,tDef.sName]);}}
this.newWebObject(oObj,oContext,tDef);oObj.create(tDef);for(i=0;i<tDef.aObjs.length;i++){initObj.call(this,tDef.aObjs[i],oObj);}
return oObj;}
return initObj.call(this,tDef,this);},newWebObject:function(oObj,oParent,tDef){if(oParent.addChild&&oParent!==oObj){oParent.addChild(oObj);}},getConstructor:function(sType){return df.sys.ref.getNestedProp(sType);},findObj:function(sName){var i,aParts,oObj;if(sName===""){return this;}
aParts=sName.split(".");oObj=this;for(i=0;i<aParts.length&&oObj;i++){oObj=oObj[aParts[i]];}
return(typeof oObj==="object"&&oObj)||null;},lock:function(bWaitDialog,sWaitMessage){var oDialog,oLabel,that=this;this._bLocked=true;if(!this._eLockMask){this._eLockMask=df.gui.dragMask();this._tLockCursor=setTimeout(function(){if(that._eLockMask){that._eLockMask.style.cursor="wait";}
that._tLockCursor=null;},140);}
df.events.addDomCaptureListener("keydown",document.body,this.onBlockKey,this);if(bWaitDialog&&!this._bLockWait){this._bLockWait=true;if(this.OnShowProgress.fire(this,{sMessage:sWaitMessage})){this._aModalQueue.push(this._oLockModalBlock={fFunc:null,bFinished:false,bDisplayed:true});this._oLockDialog=oDialog=new df.WebModalDialog(null,this);oDialog.psCaption="";oDialog.pbResizable=false;oDialog.pbShowClose=false;oLabel=new df.WebLabel(null,oDialog);oLabel.psCaption=sWaitMessage||this.getTrans("loading")+"..";oLabel.psCSSClass="WebMsgBoxProgress";oDialog.addChild(oLabel);oDialog.show();oDialog._oPrevFocus=null;}}},unlock:function(){this._bLocked=false;if(this._eLockMask){this._eLockMask.parentNode.removeChild(this._eLockMask);this._eLockMask=null;if(this._tLockCursor){clearTimeout(this._tLockCursor);this._tLockCursor=null;}}
df.events.removeDomCaptureListener("keydown",document.body,this.onBlockKey);if(this._bLockWait){this._bLockWait=false;this.OnHideProgress.fire(this,{});if(this._oLockDialog){this._oLockDialog.hide();this._oLockDialog=null;this._oLockModalBlock.bFinished=true;this.processModal();}}},onBlockKey:function(oEvent){if(this._bLocked){oEvent.stop();return false;}},handleAction:function(oAction){if(oAction.eCallMode>=df.cCallModeWait){this.lock((oAction.eCallMode>=df.cCallModeProgress),oAction.sProcessMessage);}
oAction.aViews.push(this._oCurrentWindow);if(this._oPendingCall){this._oPendingCall.aActions.push(oAction);if(this._oPendingCall.eCallMode<oAction.eCallMode){this._oPendingCall.eCallMode=oAction.eCallMode;}}else{this._oPendingCall=new df.ServerCall();this._oPendingCall.aActions.push(oAction);this._oPendingCall.sFocus=this.getFocusObjName();this._oPendingCall.eCallMode=oAction.eCallMode;}
this.processCall();},cancelAction:function(oWO,sAction){var aActions,i;if(this._oPendingCall){aActions=this._oPendingCall.aActions;for(i=0;i<aActions.length;i++){if(aActions[i].oWO===oWO&&aActions[i].sAction===sAction){aActions.splice(i,1);i--;}
if(aActions.length===0){this._oPendingCall=null;break;}}}},processCall:function(){var that=this;function process(){try{if(that._oPendingCall){if(!that._oSendingCall){that.sendCall(that._oPendingCall);that._oPendingCall=null;}}}catch(oErr){that.handleError(oErr);}}
if(this._bCallTimeout){setTimeout(process,10);}else{process();}},sendCall:function(oCall){var aViews,aActions,oAction,oData,tResponse,i,oRequest;this._oSendingCall=oCall;aViews=[];aActions=[];for(i=0;i<oCall.aActions.length;i++){oAction=oCall.aActions[i];aActions.push({sTarget:oAction.oWO.getLongName(),sAction:oAction.sAction,aParams:oAction.aParams,tData:oAction.tData});aViews=aViews.concat(oAction.aViews);}
oData={ActionRequest:{Header:this.getHeader(aViews,oCall.sFocus),aActions:aActions}};function handleCall(oEvent,bSuccess){try{tResponse=oEvent.oSource.getResponseValue();if(tResponse&&tResponse.Header){this.handleHeader(tResponse.Header);if(oCall.aActions.length===tResponse.asReturnValues.length){for(i=0;i<oCall.aActions.length;i++){oEvent.sReturnValue=tResponse.asReturnValues[i];if(oCall.aActions[i].fHandler){oCall.aActions[i].fHandler.call(oCall.aActions[i].oHandlerEnv||null,oEvent);}}}else{}}}catch(oErr){this.handleError(oErr);}finally{if(!this._oPendingCall){this.unlock();}
this._oSendingCall=null;this.processCall();}}
oRequest=new df.ajax.JSONCall("CallAction",oData,this.psWebService,this);oRequest.onFinished.addListener(function(oEvent){oEvent.bError=false;handleCall.call(this,oEvent,true);},this);oRequest.onError.addListener(function(oEvent){oEvent.bError=true;handleCall.call(this,oEvent,false);},this);oRequest.send(true);},getHeader:function(oView,sFocus){var oDone={},tHead,i;tHead={sFocus:sFocus,aDDODefs:[],aSyncProps:[]};this.getSynced(tHead.aSyncProps);function addView(oView){var oViewObj;if(typeof(oView)==="string"){oViewObj=this.findObj(oView);}else{oViewObj=oView;}
if(oViewObj instanceof df.WebView){if(!oDone[oViewObj._sName]){oDone[oViewObj._sName]=true;if(oViewObj._oInvokingView){addView(oViewObj._oInvokingView);}
oViewObj.getSynced(tHead.aSyncProps);if(oViewObj._oDDData){tHead.aDDODefs.push(oViewObj._oDDData);}else{throw new df.Error(999,"View {{0}} doesn't have DDO data yet!",this,[oViewObj._sName]);}}}else if(typeof(oView)==="string"){if(!oDone[oView]){oDone[oView]=true;this.getCachedSyncProps(oView,tHead.aSyncProps);}}}
if(oView instanceof Array){for(i=0;i<oView.length;i++){addView.call(this,oView[i]);}}else{addView.call(this,oView);}
return tHead;},handleHeader:function(oHeader){var i,tObj,x,oWO,oView,tAct;for(i=0;i<oHeader.aObjectDefs.length;i++){this.initJSON(oHeader.aObjectDefs[i]);}
for(i=0;i<oHeader.aSyncProps.length;i++){tObj=oHeader.aSyncProps[i];oWO=this.findObj(tObj.sO);if(oWO){for(x=0;x<tObj.aP.length;x++){oWO._set(tObj.aP[x].sN,tObj.aP[x].sV,true,true);}}else{this.cacheSyncProps(tObj);}}
for(i=0;i<oHeader.aDDODefs.length;i++){oView=this.findObj(oHeader.aDDODefs[i].sView);if(oView){oView._oDDData=oHeader.aDDODefs[i];}}
for(i=0;i<oHeader.aActions.length;i++){tAct=oHeader.aActions[i];oWO=this.findObj(tAct.sTarget);if(oWO){if(typeof oWO[tAct.sName]==="function"){oWO._tActionData=tAct.tData;try{oWO[tAct.sName].apply(oWO,tAct.aParams);}catch(oErr){this.handleError(oErr);}
oWO._tActionData=null;}else{throw new df.Error(999,"Action method not found '{{0}}' on object '{{1}}'",this,[tAct.sName,tAct.sTarget]);}}else{throw new df.Error(999,"Could not find object '{{0}}'",this,[tAct.sTarget]);}}},cacheSyncProps:function(tObj){var i,x,y,tCacheObj,bFound;for(i=0;i<this._aSyncPropCache.length;i++){if(this._aSyncPropCache[i].sO===tObj.sO){tCacheObj=this._aSyncPropCache[i];props:for(x=0;x<tObj.aP.length;x++){bFound=false;for(y=0;y<tCacheObj.aP.length&&!bFound;y++){if(tCacheObj.aP[y].sN===tObj.aP[x].sN){tCacheObj.aP[y].sV=tObj.aP[x].sV;bFound=true;}}
if(!bFound){tCacheObj.aP.push(tObj.aP[x]);}}
return;}}
this._aSyncPropCache.push(tObj);},getCachedSyncProps:function(sView,aSyncProps){var i,sStart,iLen;sStart=sView+'.';iLen=sStart.length;for(i=0;i<this._aSyncPropCache.length;i++){if(this._aSyncPropCache[i].sO===sView||this._aSyncPropCache[i].sO.substr(0,iLen)===sStart){aSyncProps.push(this._aSyncPropCache[i]);this._aSyncPropCache.splice(i,1);i--;}}},position:function(){},set_psTheme:function(sVal){if(this.psTheme!==sVal){if(this._eElem){df.dom.removeClass(this._eElem,this.psTheme);}else if(this._eViewPort){df.dom.removeClass(this._eViewPort,this.psTheme);}
this.psTheme=sVal;this.updateCSS(true);if(this._eElem){df.dom.addClass(this._eElem,this.psTheme);}else if(this._eViewPort){df.dom.addClass(this._eViewPort,this.psTheme);}}},updateCSS:function(bResize){var aStyles,i,eHead,that=this;if(!this._eStyleSystem||!this._eStyleTheme||!this._eStyleApplication){aStyles=df.dom.query(document,"link",true);for(i=0;i<aStyles.length;i++){if(aStyles[i].href.indexOf("DfEngine/system.css")>0){this._eStyleSystem=aStyles[i];}
if(aStyles[i].href.indexOf("CssThemes/")>0&&aStyles[i].href.indexOf("theme.css")>0){this._eStyleTheme=aStyles[i];}
if(aStyles[i].href.indexOf("CssStyle/application.css")>0){this._eStyleApplication=aStyles[i];}}
if(!this._eStyleSystem){this._eStyleSystem=df.dom.createCSSElem(this._sRootPath+"DfEngine/system.css");eHead=document.head||document.getElementsByTagName("head")[0];if(eHead.firstChild){eHead.insertBefore(this._eStyleSystem,eHead.firstChild);}else{eHead.appendChild(this._eStyleSystem);}}
if(!this._eStyleTheme){this._eStyleTheme=df.dom.createCSSElem(this._sRootPath+"CssThemes/"+this.psTheme+"/theme.css");df.dom.insertAfter(this._eStyleTheme,this._eStyleSystem);}
if(!this._eStyleApplication){this._eStyleApplication=df.dom.createCSSElem(this._sRootPath+"CssStyle/application.css");df.dom.insertAfter(this._eStyleApplication,this._eStyleTheme);}}
if(this._eStyleTheme.href.indexOf(this._sRootPath+"CssThemes/"+this.psTheme+"/theme.css")<0){this._eStyleTheme.href=this._sRootPath+"CssThemes/"+this.psTheme+"/theme.css";}
if(bResize){this.testCSS(function(){this.resize();setTimeout(function(){try{that.resize();}catch(oErr){that.handleError(oErr);}},200);});}},testCSS:function(fHandler){var eTest,that=this,iCount=0;eTest=df.dom.create('<div id="df_load_test" style="position: absolute"></div>');document.body.appendChild(eTest);function check(){if((eTest&&eTest.clientHeight>=1)||iCount>100){document.body.removeChild(eTest);fHandler.call(that);}else{setTimeout(check,20);iCount++;}}
check();},onResize:function(oEvent){var that=this;if(this._tResizeTimeout){clearTimeout(this._tResizeTimeout);this._tResizeTimeout=null;}
this._tResizeTimeout=setTimeout(function(){try{that._tResizeTimeout=null;that.resize();}catch(oErr){that.handleError(oErr);}},100);},onScroll:function(oEvent){this.notifyScroll(this);},prepareSize:function(){var iRes=df.WebApp.base.prepareSize.call(this);this._bStretch=true;return iRes;},resize:function(){var iHeight,iWidth,i;this.resizeHorizontal();this.resizeVertical();if(this._eElem){iHeight=this._iMiddleHeight-df.sys.gui.getVertBoxDiff(this._eRegionCenter,0);iWidth=this._eRegionCenter.clientWidth-df.sys.gui.getHorizBoxDiff(this._eRegionCenter,2);for(i=0;i<this._aViews.length;i++){if(this._aViews[i]._bRendered){if(this._aViews[i].piWidth>0){this._aViews[i].setOuterWidth(this._aViews[i].piWidth);}else{this._aViews[i].setOuterWidth(iWidth);}
this._aViews[i].prepareSize();if(this._aViews[i].piHeight>0){this._aViews[i].setOuterHeight(this._aViews[i].piHeight);}else if(this._aViews[i]._bStretch){this._aViews[i].setOuterHeight(iHeight);}
this._aViews[i].resize();}}}else{for(i=0;i<this._aViews.length;i++){if(this._aViews[i]._bRendered){this._aViews[i].prepareSize();this._aViews[i].resize();}}}
this.notifyPosChange(this);},showInfoBox:function(sMessage,sCaption){function showInfo(tDetails){var that=this,oDialog,oLabel,oCloseBtn,oContentPnl,oButtonPnl;oDialog=new df.WebModalDialog(null,this);oDialog.psCaption=sCaption;oDialog.piMinWidth=400;oDialog.piMinHeight=150;oDialog.OnSubmit.addListener(function(oEvent){oDialog.hide();},this);oDialog.OnHide.addListener(function(oEvent){tDetails.bFinished=true;setTimeout(function(){try{that.processModal();}catch(oErr){that.handleError(oErr);}},20);},this);oContentPnl=new df.WebPanel(null,oDialog);oContentPnl.peRegion=df.ciRegionCenter;oDialog.addChild(oContentPnl);oLabel=new df.WebLabel(null,oDialog);oLabel.psCaption=sMessage;oLabel.psCSSClass="WebMsgBoxInfo";oContentPnl.addChild(oLabel);oButtonPnl=new df.WebPanel(null,oDialog);oButtonPnl.peRegion=df.ciRegionBottom;oButtonPnl.piColumnCount=3;oDialog.addChild(oButtonPnl);oCloseBtn=new df.WebButton(null,oDialog);oCloseBtn.psCaption=this.getTrans("ok");oCloseBtn.piColumnIndex=2;oCloseBtn.pbShowLabel=false;oCloseBtn.OnClick.addListener(function(oEvent){oDialog.hide();},this);oButtonPnl.addChild(oCloseBtn);oDialog.show();this.ready(function(){oDialog.resize();oCloseBtn.focus();});}
this._aModalQueue.push({fFunc:showInfo,bFinished:false,bDisplayed:false});this.processModal();},showMessageBox:function(sReturnObj,sReturnMsg,sMessage,sCaption,sLabelCSSClass,iDefaultButton){var oReturnObj,aButtons;oReturnObj=this.findObj(sReturnObj);if(!oReturnObj){throw new df.Error(999,"Return WebObject not found '{{0}}'",this,[sReturnObj]);}
aButtons=df.sys.vt.deserialize(this._tActionData,[df.tString]);if(!aButtons){throw new df.Error(999,"No buttons specified",this);}
this.showMsgBox(sMessage,sCaption,sLabelCSSClass,aButtons,iDefaultButton,function(iBtn,oDialog){if(oReturnObj.getActionMode(sReturnMsg)<df.cCallModeWait){oReturnObj.setActionMode(sReturnMsg,df.cCallModeWait);}
oReturnObj.serverAction(sReturnMsg,[iBtn],null,function(){oDialog.hide();});});},showMsgBox:function(sMessage,sCaption,sLabelCSSClass,aButtons,iDefaultButton,fHandler){function showInfo(tDetails){var that=this,oDialog,oLabel,oBtn,oContentPnl,oButtonPnl,i,oDefaultBtn=null;oDialog=new df.WebModalDialog(null,this);oDialog.psCaption=sCaption;oDialog.piMinWidth=400;oDialog.piMinHeight=150;oDialog.pbShowClose=false;oDialog.OnHide.addListener(function(oEvent){tDetails.bFinished=true;setTimeout(function(){try{that.processModal();}catch(oErr){that.handleError(oErr);}},20);},this);oContentPnl=new df.WebPanel(null,oDialog);oContentPnl.peRegion=df.ciRegionCenter;oDialog.addChild(oContentPnl);oLabel=new df.WebLabel(null,oDialog);oLabel.psCaption=sMessage;oLabel.psCSSClass=sLabelCSSClass;oContentPnl.addChild(oLabel);oButtonPnl=new df.WebPanel(null,oDialog);oButtonPnl.peRegion=df.ciRegionBottom;oButtonPnl.piColumnCount=aButtons.length+2;oDialog.addChild(oButtonPnl);function handleBtnClick(oEvent){fHandler.call(this,oEvent.oSource._iConfirmId,oDialog);}
iDefaultButton=parseInt(iDefaultButton,10);for(i=0;i<aButtons.length;i++){oBtn=new df.WebButton(null,oDialog);oBtn.psCaption=aButtons[i];oBtn.piColumnIndex=(i+1);oBtn.pbShowLabel=false;oBtn._iConfirmId=(i+1);oBtn.OnClick.addListener(handleBtnClick);oButtonPnl.addChild(oBtn);if(oBtn._iConfirmId===iDefaultButton){oDefaultBtn=oBtn;}}
oDialog.show();this.ready(function(){oDialog.resize();if(oDefaultBtn){oDefaultBtn.focus();}});}
this._aModalQueue.push({fFunc:showInfo,bFinished:false,bDisplayed:false});this.processModal();},processModal:function(){if(this._aModalQueue.length>0){while(this._aModalQueue[0]&&this._aModalQueue[0].bFinished){this._aModalQueue.shift();}
if(this._aModalQueue.length>0&&!this._aModalQueue[0].bDisplayed){this._aModalQueue[0].bDisplayed=true;this._aModalQueue[0].fFunc.call(this,this._aModalQueue[0]);}}},queueModal:function(fFunc,oEnv){this._aModalQueue.push({fFunc:function(tDetails){fFunc.call(oEnv||null);tDetails.bFinished=true;this.processModal();},bFinished:false,bDisplayed:false});this.processModal();},log:function(sText){df.log(sText);},getTrans:function(sLbl,bOptNull){if(this._oTranslations[sLbl]){return this._oTranslations[sLbl];}
if(bOptNull){return null;}
return"{{"+sLbl+"}}";},initTranslations:function(){var aTrans;aTrans=df.sys.vt.deserialize(this._tActionData,[{sN:df.tString,sV:df.tString}]);this.initTrans(aTrans);},initTrans:function(aTrans){var i;for(i=0;i<aTrans.length;i++){this._oTranslations[aTrans[i].sN]=aTrans[i].sV;}
df.lang={monthsLong:[this.getTrans("january"),this.getTrans("february"),this.getTrans("march"),this.getTrans("april"),this.getTrans("may"),this.getTrans("june"),this.getTrans("july"),this.getTrans("august"),this.getTrans("september"),this.getTrans("october"),this.getTrans("november"),this.getTrans("december")],monthsShort:[this.getTrans("jan"),this.getTrans("feb"),this.getTrans("mar"),this.getTrans("apr"),this.getTrans("mayShort"),this.getTrans("jun"),this.getTrans("jul"),this.getTrans("aug"),this.getTrans("sep"),this.getTrans("oct"),this.getTrans("nov"),this.getTrans("dec")],daysShort:[this.getTrans("sun"),this.getTrans("mon"),this.getTrans("tue"),this.getTrans("wed"),this.getTrans("thu"),this.getTrans("fri"),this.getTrans("sat")],daysLong:[this.getTrans("sunday"),this.getTrans("monday"),this.getTrans("tuesday"),this.getTrans("wednesda"),this.getTrans("thursday"),this.getTrans("friday"),this.getTrans("saturday")]};},showError:function(iErrNum,iErrLine,sErrText,sCaption,bUserError){this.handleError(new df.Error(df.toInt(iErrNum),sErrText,this,null,null,true,df.toBool(bUserError),sCaption,null,df.toInt(iErrLine)));},handleError:function(oError){function displayError(tDetails){var that=this,oLabel,oDialog,oCloseBtn,oContentPnl,oButtonPnl,aDetails=[],oDetailsBox,sCaption;if(!oError.bServer){sCaption=oError.sCaption||this.getTrans("error_title_client",true)||"Unhandled Program Error on the client";}else{sCaption=oError.sCaption||this.getTrans("error_title_server");}
oDialog=new df.WebModalDialog(null,this);oDialog.psCaption=sCaption;oDialog.piMinWidth=500;oDialog.piMinHeight=(oError.bUserError?150:240);oDialog.OnSubmit.addListener(function(oEvent){try{oDialog.hide();}catch(oErr){that.handleError(oErr);}},this);oDialog.OnHide.addListener(function(oEvent){tDetails.bFinished=true;setTimeout(function(){that.processModal();},20);},this);oContentPnl=new df.WebPanel(null,oDialog);oContentPnl.peRegion=df.ciRegionCenter;oDialog.addChild(oContentPnl);oLabel=new df.WebLabel(null,oContentPnl);oLabel.psCaption=oError.sText;oLabel.psCSSClass=(oError.bUserError?"WebMsgBoxWarning":"WebMsgBoxError");oContentPnl.addChild(oLabel);if(!oError.bUserError){oLabel=new df.WebLabel(null,oContentPnl);aDetails.push('Error:',oError.iNumber);if(oError.bServer){if(oError.iLine){aDetails.push('\n\rLine:',oError.iLine);}}else{if(oError.oSource){if(oError.oSource instanceof df.WebObject){aDetails.push('\n\rObject:',oError.oSource.getLongName());}}}
oLabel.psCaption=aDetails.join("");oContentPnl.addChild(oLabel);if(oError.sDetailHtml){oDialog.piMinHeight=300;oDialog.piHeight=300;oDetailsBox=new df.WebHtmlBox(null,oContentPnl);oDetailsBox.pbFillHeight=true;oDetailsBox.pbShowBox=true;oDetailsBox.pbScroll=true;oDetailsBox.pbShowLabel=false;oDetailsBox.psCSSClass="WebErrorDetails";oDetailsBox.psHtml=oError.sDetailHtml;oContentPnl.addChild(oDetailsBox);}}
oButtonPnl=new df.WebPanel(null,oDialog);oButtonPnl.peRegion=df.ciRegionBottom;oButtonPnl.piColumnCount=3;oDialog.addChild(oButtonPnl);oCloseBtn=new df.WebButton(null,oDialog);oCloseBtn.psCaption=this.getTrans("ok",true)||"OK";oCloseBtn.piColumnIndex=2;oCloseBtn.pbShowLabel=false;oCloseBtn.OnClick.addListener(function(oEvent){oDialog.hide();},this);oButtonPnl.addChild(oCloseBtn);oDialog.show();this.ready(function(){oDialog.resize();oCloseBtn.focus();});}
if(oError instanceof df.Error){if(this.OnError.fire(this,{oError:oError})){if(oError.oTarget&&oError.oTarget.displayError&&oError.oTarget.pbRender&&oError.oTarget.pbVisible){oError.oTarget.displayError(oError.iNumber,oError.sText);}else{this._aModalQueue.push({fFunc:displayError,bFinished:false,bDisplayed:false});this.processModal();}}}else{throw oError;}},setCookie:function(sName,sValue,iExpires){df.sys.cookie.set(sName,sValue,df.toInt(iExpires));},navigateToPage:function(sUrl,eMode){this.queueModal(function(){var eWin;eMode=parseInt(eMode,10);if(eMode===df.ciOpenSameWindow){window.location.href=sUrl;}else{if(eMode===df.ciOpenNewWindow){eWin=window.open(sUrl,'_blank_'+df.dom.piDomCounter++,'width=700, height=500, resizable=yes');}else{eWin=window.open(sUrl,'_blank');}}},this);},navigateNewWindow:function(sUrl,iWidth,iHeight){this.queueModal(function(){window.open(sUrl,'_blank_'+df.dom.piDomCounter++,'width='+iWidth+', height='+iHeight+', resizable=yes, location=yes');});},navigateRefresh:function(){this.queueModal(function(){window.location.reload();});},get_piWindowWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;},get_piWindowHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;}});

df.WebWindow=function WebWindow(sName,oParent){df.WebWindow.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tBool,"pbResizable",true);this.prop(df.tBool,"pbShowClose",true);this.prop(df.tInt,"piMinWidth",0);this.prop(df.tInt,"piMinHeight",0);this.prop(df.tInt,"piLeft",0);this.prop(df.tInt,"piTop",0);this.pbFloating=false;this.pbModal=false;this._eLbl=null;this._aModalHiddenPlugins=null;this._aHiddenPlugins=null;this._bWrapDiv=false;this._sBaseClass="WebWindow";this._bRendered=false;this._bHasLeft=false;this._bHasTop=false;this._eRenderTo=null;this._eMask=null;this._oPrevFocus=null;};df.defineClass("df.WebWindow","df.WebBaseContainer",{create:function(){this._bHasLeft=(this.piLeft>0);this._bHasTop=(this.piTop>0);},openHtml:function(aHtml){aHtml.push('<div class="',this.genClass(),'"');if(this.psHtmlId){aHtml.push(' id="',this.psHtmlId,'"');}
aHtml.push(' data-dfobj="',this.getLongName(),'"');aHtml.push(' style=" ',(this.pbRender?'':'display: none;'),(this.pbVisible?'':'visibility: hidden;'),'"');aHtml.push('>');if(!this.pbFloating){aHtml.push('<div class="WebCon_Inner">');if(this.psCaption){aHtml.push('<label class="WebWin_title">&nbsp;</label>');}
aHtml.push('<div><div class="WebContainer">');}else{aHtml.push('<div class="WebWin_top_l">','<div class="WebWin_top_r">','<div class="WebWin_top_c">','</div>','</div>','</div>','<div class="WebWin_main_l">','<div class="WebWin_main_r">','<div class="WebWin_header">','<div class="WebWin_header">','<div class="WebWin_header_r">','<div class="WebWin_header_c">','<label class="WebWin_title">&nbsp;</label>','<div class="WebWin_controls">');if(this.pbShowClose){aHtml.push('<div class="WebWin_close" tabindex="0"></div>');}
aHtml.push('</div>','</div>','</div>','</div>','</div>','<div class="WebWin_main_c">','<div class="WebContainer">');}
df.WebWindow.base.openHtml.call(this,aHtml);},closeHtml:function(aHtml){df.WebWindow.base.closeHtml.call(this,aHtml);if(!this.pbFloating){aHtml.push('</div></div></div></div>');}else{aHtml.push('</div>','</div>','</div>','<div class="WebWin_bottom_l">','<div class="WebWin_bottom_r">','<div class="WebWin_bottom_c">','</div>','<div class="WebWin_resizer">','</div>','</div>','</div>','</div>');}},afterRender:function(){if(this.pbFloating){this._eLbl=df.dom.query(this._eElem,"label.WebWin_title");this._eHeader=df.dom.query(this._eElem,"div.WebWin_header");this._eHeaderContent=df.dom.query(this._eElem,"WebWin_header_c");this._eControlWrap=df.dom.query(this._eElem,"div.WebWin_main_c");this._eMainRight=df.dom.query(this._eElem,"div.WebWin_main_r");this._eMainLeft=df.dom.query(this._eElem,"div.WebWin_main_l");this._eTopLeft=df.dom.query(this._eElem,"div.WebWin_top_l");this._eTopRight=df.dom.query(this._eElem,"div.WebWin_top_r");this._eTopContent=df.dom.query(this._eElem,"div.WebWin_top_c");this._eBottomLeft=df.dom.query(this._eElem,"div.WebWin_bottom_l");this._eBottomRight=df.dom.query(this._eElem,"div.WebWin_bottom_r");this._eResizer=df.dom.query(this._eElem,"div.WebWin_resizer");this._eBottomContent=df.dom.query(this._eElem,"div.WebWin_bottom_c");if(this.pbShowClose){this._eCloseBtn=df.dom.query(this._eElem,"div.WebWin_close");}}else{this._eInner=df.dom.query(this._eElem,"div.WebCon_Inner");this._eLbl=df.dom.query(this._eElem,"label.WebWin_title");}
df.WebWindow.base.afterRender.call(this);this.set_psCaption(this.psCaption);if(this.pbFloating){this.set_piWidth(this.piWidth);if(this.piHeight<=0){this.prepareSize();this.piHeight=this._iWantedHeight;}
this.set_piHeight(this.piHeight);df.events.addDomListener("mousedown",this._eHeader,this.onStartDrag,this);df.events.addDomListener("mousedown",this._eMainRight,this.onStartResize,this);df.events.addDomListener("mousedown",this._eMainLeft,this.onStartResize,this);df.events.addDomListener("mousedown",this._eTopLeft,this.onStartResize,this);df.events.addDomListener("mousedown",this._eBottomLeft,this.onStartResize,this);if(this.pbShowClose){df.events.addDomListener("mousedown",this._eCloseBtn,function(oEvent){oEvent.stop();});df.events.addDomListener("click",this._eCloseBtn,this.onCloseClick,this);}
df.events.addDomListener("click",this._eElem,this.onFocusEvent,this);df.events.addDomListener("focus",this._eElem,this.onFocusEvent,this);df.events.addDomListener("scroll",this._eControlWrap,this.onFocusEvent,this);}
df.events.addDomKeyListener(this._eElem,this.onKey,this);},genClass:function(){this._sBaseClass=(this.pbFloating?"WebWindow"+(this.pbResizable?" WebWin_Resizable":""):"");return df.WebWindow.base.genClass.call(this);},_show:function(eRenderTo){var eElem,bRender=!this._eElem,eViewPort,that=this;if(bRender){eElem=this.render();df.dom.addClass(eElem,"WebWin_Hidden");}
if(this.pbFloating&&this.pbModal){eViewPort=this.getWebApp()._eViewPort||document.body;this._oPrevFocus=this.getWebApp()._oCurrentObj;if(this._eElem.parentNode){this._eElem.parentNode.removeChild(this._eElem);}
df.sys.gui.disableTabIndexes(document.body);this._aModalHiddenPlugins=df.sys.gui.hidePlugins(document.body);this._eMask=df.dom.create('<div class="WebWindow_Mask">&nbsp;</div>');eViewPort.appendChild(this._eMask);eViewPort.appendChild(this._eElem);this._eRenderTo=this._eMask;}else{if(this._eElem.parentNode!==eRenderTo){eRenderTo.appendChild(this._eElem);this._eRenderTo=eRenderTo;}}
df.dom.removeClass(this._eElem,"WebWin_Hidden");if(this._aHiddenPlugins){df.sys.gui.restorePlugins(this._aHiddenPlugins);this._aHiddenPlugins=null;}
if(bRender){this.afterRender();}
if(!this._bHasTop){this.piTop=this.getViewportHeight()/2-(this.piHeight||this._eElem.clientHeight)/2;}
if(!this._bHasLeft){this.piLeft=this.getViewportWidth()/2-(this.piWidth||this._eElem.clientWidth)/2;}
this._eElem.style.top=parseInt(this.piTop,10)+'px';this._eElem.style.left=parseInt(this.piLeft,10)+'px';this._bRendered=true;this.afterShow();if(this._bStandalone){this.resize();}
this.focus(true);setTimeout(function(){var oWebApp=that.getWebApp();if(oWebApp&&that._bRendered){df.dom.addClass(that._eElem,"WebWin_Visible");oWebApp.OnShowWindow.fire(oWebApp,{oWindow:that,eElem:that._eElem,bModal:that.pbModal});}},10);},_hide:function(){var that=this,oWebApp=this.getWebApp(),bCanceled;if(this._bRendered){if(this.pbFloating&&this.pbModal){df.sys.gui.restoreTabIndexes(document.body);if(this._aModalHiddenPlugins){df.sys.gui.restorePlugins(this._aModalHiddenPlugins);this._aModalHiddenPlugins=null;}
this._eMask.parentNode.removeChild(this._eMask);if(this._oPrevFocus){this._oPrevFocus.focus();}
this._eRenderTo=null;}
df.dom.addClass(this._eElem,"WebWin_Hidden");df.dom.removeClass(this._eElem,"WebWin_Visible");this._aHiddenPlugins=df.sys.gui.hidePlugins(this._eElem);if(oWebApp){bCanceled=!oWebApp.OnHideWindow.fire(oWebApp,{oWindow:this,eElem:this._eElem,bModal:this.pbModal});}}
this._bRendered=false;this.afterHide();if(this._bStandalone){if(bCanceled){setTimeout(function(){if(that._eElem&&that._eElem.parentNode){that._eElem.parentNode.removeChild(that._eElem);}},5000);}else{if(this._eElem&&this._eElem.parentNode){this._eElem.parentNode.removeChild(this._eElem);}}}},set_piWidth:function(iVal){var sWidth;if(this.pbFloating){iVal=(iVal>this.piMinWidth?iVal:this.piMinWidth);this.piWidth=iVal;if(this.pbFloating){sWidth=(iVal>0?parseInt(iVal,10)+'px':'');if(this._eControlWrap){this._eControlWrap.style.width=sWidth;this._eHeader.style.width=sWidth;}}else{sWidth=(iVal>0?parseInt(iVal,10)+'px':'');if(this._eElem){this._eElem.style.width=sWidth;}}}else{df.WebWindow.base.set_piWidth.call(this,iVal);}},set_piHeight:function(iVal){if(this.pbFloating){iVal=(iVal>this.piMinHeight?iVal:this.piMinHeight);this.piHeight=iVal;if(this._eElem){this.setOuterHeight(iVal);}}else{df.WebWindow.base.set_piHeight.call(this,iVal);}},set_piTop:function(iVal){this._bHasTop=true;if(this._eElem){this._eElem.style.top=parseInt(iVal,10)+'px';}},set_piLeft:function(iVal){this._bHasLeft=true;if(this._eElem){this._eElem.style.left=parseInt(iVal,10)+'px';}},set_psCaption:function(sVal){if(this._eElem){if(sVal){if(!this._eLbl){this._eLbl=df.dom.create('<label class="WebWin_title">&nbsp;</label>');if(this.pbFloating){this._eHeaderContent.insertBefore(this._eLbl,this._eHeaderContent.firstChild);}else{this._eInner.insertBefore(this._eLbl,this._eInner.firstChild);}}
df.dom.setText(this._eLbl,sVal);}else{if(this._eLbl){this._eLbl.parentNode.removeChild(this._eLbl);this._eLbl=null;}}}},set_pbResizable:function(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebWin_Resizable",bVal);}},createGhost:function(){var eGhost,eGhostContent,eGhostHeader,oSize,aHtml=[],sOrigId;sOrigId=this.psHtmlId;this.psHtmlId="";this._bWrapDiv=false;this.openHtml(aHtml);this.closeHtml(aHtml);this._bWrapDiv=true;this.psHtmlId=sOrigId;eGhost=df.dom.create(aHtml.join(''));eGhost.className=this.genClass()+" WebWin_ghost";this._eElem.parentNode.appendChild(eGhost);df.dom.disableTextSelection(eGhost);eGhostContent=df.dom.query(eGhost,".WebWin_main_c");eGhostHeader=df.dom.query(eGhost,".WebWin_header");oSize=df.sys.gui.getSize(this._eControlWrap);eGhostHeader.style.width=oSize.width+'px';eGhostContent.style.width=oSize.width+'px';eGhostContent.style.height=oSize.height+'px';eGhost.style.top=this.piTop+'px';eGhost.style.left=this.piLeft+'px';return eGhost;},onStartDrag:function(oEvent){var eMask,eGhost,oSize,iTopLim,iLeftLim,iDragOffsetTop,iDragOffsetLeft,aHiddenPlugins=null;eMask=df.gui.dragMask();eMask.style.cursor="move";iDragOffsetTop=oEvent.getMouseY()-this.piTop;iDragOffsetLeft=oEvent.getMouseX()-this.piLeft;oSize=df.sys.gui.getSize(this._eElem);if(this._eCloseBtn){if(this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth>oSize.width){oSize.width=this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth;}}
iLeftLim=this.getViewportWidth()-oSize.width-1;iTopLim=this.getViewportHeight()-oSize.height-1;function onDrag(oEvent){this.piTop=oEvent.getMouseY()-iDragOffsetTop;this.piLeft=oEvent.getMouseX()-iDragOffsetLeft;this.piTop=(this.piTop<=0?1:(this.piTop>=iTopLim?iTopLim:this.piTop));this.piLeft=(this.piLeft<=0?1:(this.piLeft>=iLeftLim?iLeftLim:this.piLeft));if(eGhost){eGhost.style.top=this.piTop+'px';eGhost.style.left=this.piLeft+'px';}else{eGhost=this.createGhost();aHiddenPlugins=df.sys.gui.hidePlugins(this._eElem);this._eElem.style.display="none";}}
function onStopDrag(oEvent){df.events.removeDomListener("mouseup",eMask,onStopDrag);df.events.removeDomListener("mouseup",window,onStopDrag);df.events.removeDomListener("mousemove",eMask,onDrag);eMask.parentNode.removeChild(eMask);if(eGhost){this._eElem.parentNode.removeChild(eGhost);}
this._eElem.style.top=this.piTop+'px';this._eElem.style.left=this.piLeft+'px';this._eElem.style.display="";this.resize();this.bringFront();if(aHiddenPlugins){df.sys.gui.restorePlugins(aHiddenPlugins);}}
df.events.addDomListener("mouseup",eMask,onStopDrag,this);df.events.addDomListener("mouseup",window,onStopDrag,this);df.events.addDomListener("mousemove",eMask,onDrag,this);},onStartResize:function(oEvent){if(this.pbResizable){var eTar=oEvent.getTarget();if(eTar===this._eMainRight){this.resizeDrag(oEvent,true,false,false,false,"e-resize");oEvent.stop();}else if(eTar===this._eMainLeft){this.resizeDrag(oEvent,true,true,false,false,"e-resize");oEvent.stop();}else if(eTar===this._eTopRight){this.resizeDrag(oEvent,true,false,true,true,"ne-resize");oEvent.stop();}else if(eTar===this._eTopLeft){this.resizeDrag(oEvent,true,true,true,true,"nw-resize");oEvent.stop();}else if(eTar===this._eTopContent){this.resizeDrag(oEvent,false,false,true,true,"n-resize");oEvent.stop();}else if(eTar===this._eBottomRight||eTar===this._eResizer){this.resizeDrag(oEvent,true,false,true,false,"nw-resize");oEvent.stop();}else if(eTar===this._eBottomLeft){this.resizeDrag(oEvent,true,true,true,false,"ne-resize");oEvent.stop();}else if(eTar===this._eBottomContent){this.resizeDrag(oEvent,false,false,true,false,"n-resize");oEvent.stop();}}},resizeDrag:function(oEvent,bWidth,bLeft,bHeight,bTop,sCursor){var eMask,eGhost,eGhostContent,eGhostHeader,oSize,iStartWidth,iStartLeft,iStartMouseX,iStartHeight,iStartMouseY,iStartTop,iMarginRight=0,aHiddenPlugins;eMask=df.gui.dragMask();eMask.style.cursor=sCursor;aHiddenPlugins=df.sys.gui.hidePlugins(this._eElem);oSize=df.sys.gui.getSize(this._eControlWrap);iStartWidth=oSize.width;iStartMouseX=oEvent.getMouseX();iStartLeft=this.piLeft;iStartHeight=oSize.height;iStartMouseY=oEvent.getMouseY();iStartTop=this.piTop;this.piHeight=(this.piHeight>0?this.piHeight:this._eControlWrap.clientHeight);if(this._eCloseBtn){if(this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth>oSize.width){iMarginRight=(this._eCloseBtn.offsetLeft+this._eCloseBtn.offsetWidth)-oSize.width;}}
function onResize(oEvent){if(!eGhost){eGhost=this.createGhost();eGhostContent=df.dom.query(eGhost,".WebWin_main_c");eGhostHeader=df.dom.query(eGhost,".WebWin_header");}
if(bWidth){if(bLeft){this.piWidth=iStartWidth-(oEvent.getMouseX()-iStartMouseX);this.piWidth=(this.piWidth>this.piMinWidth?this.piWidth:this.piMinWidth);this.piLeft=iStartLeft-(this.piWidth-iStartWidth);}else{this.piWidth=iStartWidth+(oEvent.getMouseX()-iStartMouseX);this.piWidth=(this.piWidth>this.piMinWidth?this.piWidth:this.piMinWidth);if(this.piWidth+this.piLeft>this.getViewportWidth()-iMarginRight){this.piWidth=this.getViewportWidth()-iMarginRight-this.piLeft;}}
eGhost.style.left=this.piLeft+"px";eGhostContent.style.width=this.piWidth+"px";eGhostHeader.style.width=this.piWidth+"px";}
if(bHeight){if(bTop){this.piHeight=iStartHeight-(oEvent.getMouseY()-iStartMouseY);this.piHeight=(this.piHeight>this.piMinHeight?this.piHeight:this.piMinHeight);this.piTop=iStartTop-(this.piHeight-iStartHeight);}else{this.piHeight=iStartHeight+(oEvent.getMouseY()-iStartMouseY);this.piHeight=(this.piHeight>this.piMinHeight?this.piHeight:this.piMinHeight);}
eGhost.style.top=this.piTop+"px";eGhostContent.style.height=this.piHeight+"px";}}
function onStopResize(oEvent){df.events.removeDomListener("mouseup",eMask,onStopResize);df.events.removeDomListener("mouseup",window,onStopResize);df.events.removeDomListener("mousemove",eMask,onResize);eMask.parentNode.removeChild(eMask);if(eGhost){this._eElem.parentNode.removeChild(eGhost);}
if(aHiddenPlugins){df.sys.gui.restorePlugins(aHiddenPlugins);}
this._eControlWrap.style.width=this.piWidth+"px";this._eHeader.style.width=this.piWidth+"px";this._eElem.style.left=this.piLeft+"px";this._eElem.style.top=this.piTop+"px";this._eElem.style.display="";this.setOuterHeight(this.piHeight);this.resize();this.bringFront();}
df.events.addDomListener("mousemove",eMask,onResize,this);df.events.addDomListener("mouseup",window,onStopResize,this);df.events.addDomListener("mouseup",eMask,onStopResize,this);},getViewportElem:function(){if(this.pbFloating&&this.pbModal){return document.body;}
return this._eRenderTo;},onFocusEvent:function(oEvent){this.bringFront();},bringFront:function(){if(this._bRendered){if(this._eElem.nextSibling){this._eElem.parentNode.appendChild(this._eElem);}
if(!this._bStandalone){this.getWebApp().windowFocus(this);}}},blur:function(){},doClose:function(){if(this.pbShowClose){this.hide();}},resize:function(){this.resizeHorizontal();this.resizeVertical();if(this._eControlWrap&&!this.piHeight&&!this.piWidth&&this.pbFloating){this.piHeight=this._eControlWrap.clientHeight;this.piWidth=this._eControlWrap.clientWidth;this._eControlWrap.style.width=this.piWidth+"px";this._eHeader.style.width=this.piWidth+"px";this._eControlWrap.style.height=this.piHeight+"px";}},resizeHorizontal:function(){if(!this.pbFloating){this.setOuterWidth(this.piWidth);}
df.WebWindow.base.resizeHorizontal.call(this);},setOuterHeight:function(iHeight){if(!this.pbFloating){iHeight-=this.getHeightDiff(true,false,false,false);this._eContainer.style.height=iHeight+'px';}else{if(iHeight>0){this._eControlWrap.style.height=iHeight+'px';iHeight-=this.getHeightDiff(true,false,false,false);this._eContainer.style.height=iHeight+'px';}else{this._eControlWrap.style.height='';this._eContainer.style.height='';}}},setOuterWidth:function(iWidth){if(!this.pbFloating){this._eElem.style.width=(iWidth>0?iWidth+"px":"");df.WebWindow.base.setOuterWidth.call(this,iWidth);}},getHeightDiff:function(bOut,bIn,bContentOut,bContentIn){var iHeight=df.WebWindow.base.getHeightDiff.call(this,bOut,bIn,bContentOut,bContentIn);if(!this.pbFloating&&this._eLbl){if(bOut){iHeight+=this._eLbl.clientHeight;iHeight+=df.sys.gui.getVertBoxDiff(this._eLbl,1);iHeight+=df.sys.gui.getVertBoxDiff(this._eInner,0);}}
return iHeight;},getViewportWidth:function(){if(this.pbModal){return df.sys.gui.getViewportWidth();}
return this.getViewportElem().clientWidth;},getViewportHeight:function(){if(this.pbModal){return df.sys.gui.getViewportHeight();}
return this.getViewportElem().clientHeight;},sizeChanged:function(){if(!this.pbFloating&&this._oParent&&this._oParent.resize){this._oParent.resize();}else{this.resize();}
if(this.getWebApp()){this.getWebApp().notifyLayoutChange(this);}},onCloseClick:function(oEvent){this.doClose();},onKey:function(oEvent){if(oEvent.matchKey(df.settings.formKeys.escape)&&this.pbFloating){this.doClose();}}});

df.WebView=function WebView(sName,oParent){df.WebView.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbFillHeight",false);this.prop(df.tBool,"pbClearDDOsAfterHide",false);this.prop(df.tBool,"pbDDHotKeys",true);this.event("OnSubmit",df.cCallModeWait);this.event("OnShow",df.cCallModeWait);this.event("OnHide",df.cCallModeDefault);this.setActionMode("HandleDeleteKey",df.cCallModeWait);this.setActionMode("HandleSaveKey",df.cCallModeWait);this._eForm=null;this._oDDData=null;this._sControlClass="WebView";};df.defineClass("df.WebView","df.WebWindow",{afterRender:function(){this._eForm=df.dom.query(this._eElem,"form");df.WebView.base.afterRender.call(this);},_show:function(eRenderTo){this.fire("OnShow");df.WebView.base._show.call(this,eRenderTo);},_hide:function(){if(this._bRendered){this.fire("OnHide",[],function(oEvent){if(this.pbClearDDOsAfterHide){this._oDDData={sView:this._sName,sCS:"",aDDOs:[]};}},this);}
df.WebView.base._hide.call(this);},show:function(){if(this._bStandalone){this._show();}else{this.getWebApp().showView(this._sName);}},hide:function(){if(this._bStandalone){this._hide(true);}else{this.getWebApp().hideView(this._sName);}},destroy:function(){if(this._eElem){if(this._eElem.parentNode){this._eElem.parentNode.removeChild(this._eElem);}
this._eElem=null;}},closePanel:function(){this.close();},resize:function(){if(this._bRendered){df.WebView.base.resize.call(this);}},onKey:function(oEvent){if(oEvent.matchKey(df.settings.formKeys.submit)){if(this.fire('OnSubmit')){oEvent.stop();}}else{df.WebView.base.onKey.call(this,oEvent);}},fireSubmit:function(){return this.fire('OnSubmit');},set_pbFillHeight:function(bVal){this.pbFillHeight=bVal;this.sizeChanged();}});

df.WebModalDialog=function WebModalDialog(sName,oParent){df.WebModalDialog.base.constructor.call(this,sName,oParent);this.event("OnEscape",df.cCallModeWait);this.pbFloating=true;this.pbModal=true;this._oInvokingView=null;};df.defineClass("df.WebModalDialog","df.WebView",{doClose:function(){if(!this.fire('OnEscape')){df.WebModalDialog.base.doClose.call(this);}},get_psInvokingView:function(){return(this._oInvokingView&&this._oInvokingView._sName)||"";},set_psInvokingView:function(sVal){var oWO=this.getWebApp().findObj(sVal);this._oInvokingView=(oWO instanceof df.WebView&&oWO)||null;}});

df.WebButton=function WebButton(oDef,oParent){df.WebButton.base.constructor.call(this,oDef,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tString,"psTextColor","");this.prop(df.tString,"psWaitMessage","");this.prop(df.tBool,"pbShowWaitDialog",false);this.event("OnClick",df.cCallModeWait);this.pbShowLabel=false;this._sControlClass="WebButton";};df.defineClass("df.WebButton","df.WebBaseControl",{openHtml:function(aHtml){df.WebButton.base.openHtml.call(this,aHtml);aHtml.push('<button id="',this._sControlId,'"',(!this.pbEnabled?' disabled="disabled"':''),'></button>');},afterRender:function(){this._eControl=df.dom.query(this._eElem,"button");df.WebButton.base.afterRender.call(this);df.events.addDomListener("click",this._eControl,this.onBtnClick,this);this.set_psCaption(this.psCaption);this.set_pbShowWaitDialog(this.pbShowWaitDialog);},onBtnClick:function(oEvent){if(this.pbEnabled){this.fire('OnClick',[],function(oEvent){if(!oEvent.bCancelled){if(this.psLoadViewOnClick){this.getWebApp().showView(this.psLoadViewOnClick);}}});oEvent.stop();}},set_psCaption:function(sVal){if(this._eControl){df.dom.setText(this._eControl,sVal);}},set_pbEnabled:function(bVal){df.WebButton.base.set_pbEnabled.call(this,bVal);if(this._eControl){this._eControl.disabled=!bVal;}},set_pbShowWaitDialog:function(bVal){this.setActionMode("OnClick",(bVal?df.cCallModeProgress:df.cCallModeWait),this.psWaitMessage);},set_psWaitMessage:function(sVal){this.setActionMode("OnClick",(this.pbShowWaitDialog?df.cCallModeProgress:df.cCallModeWait),sVal);}});

df.WebLabel=function WebLabel(oDef,oParent){df.WebLabel.base.constructor.call(this,oDef,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tInt,"peAlign",0);this.prop(df.tBool,"pbShowBorder",false);this.pbShowLabel=false;this._bFocusAble=false;this._sControlClass="WebLabel";};df.defineClass("df.WebLabel","df.WebBaseControl",{openHtml:function(aHtml){df.WebLabel.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebLabel_content">&nbsp;</div>');},closeHtml:function(aHtml){df.WebLabel.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div.WebLabel_content");df.WebLabel.base.afterRender.call(this);this.set_peAlign(this.peAlign);this.set_psCaption(this.psCaption);this.set_pbShowBorder(this.pbShowBorder);},set_psCaption:function(sVal){if(this._eControl){df.dom.setText(this._eControl,sVal);if(sVal!==this.psCaption){this.sizeChanged();}}},set_pbShowBorder:function(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebLabel_border",bVal);if(this.pbShowBorder!==bVal){this.sizeChanged();}}},set_peAlign:function(iVal){if(this._eControl){this._eControl.style.textAlign=(iVal===df.ciAlignLeft?"left":(iVal===df.ciAlignCenter?"center":(iVal===df.ciAlignRight?"right":"")));}}});

df.WebForm=function WebForm(oDef,oParent){df.WebForm.base.constructor.call(this,oDef,oParent);this.prop(df.tBool,"pbPromptButton",false);this.prop(df.tBool,"pbPassword",false);this.event("OnPrompt",df.cCallModeWait);this._eWrap=null;this._ePrompt=null;this._sControlClass="WebForm";};df.defineClass("df.WebForm","df.WebBaseForm",{openHtml:function(aHtml){df.WebForm.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper"><span class="WebFrm_Prompt"></span><div class="WebFrm_PromptSpacer"><input type="',(this.pbPassword?'password':'text'),'" name="',this._sName,'" value="" id="',this._sControlId,'">');},closeHtml:function(aHtml){aHtml.push('</div></div>');df.WebForm.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div.WebFrm_Wrapper input");this._ePrompt=df.dom.query(this._eElem,"div.WebFrm_Wrapper span.WebFrm_Prompt");this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");df.WebForm.base.afterRender.call(this);df.events.addDomListener("click",this._ePrompt,this.onPromptClick,this);this.set_piMaxLength(this.piMaxLength);this.set_pbPromptButton(this.pbPromptButton);},set_pbPassword:function(bVal){if(this._eControl){if(df.sys.isIE&&df.sys.iVersion<9){var eNew=this._eControl.cloneNode(false);eNew.type=(bVal?'password':'text');this._eControl.parentNode.replaceChild(eNew,this._eControl);this._eControl=eNew;}else{this._eControl.type=(bVal?'password':'text');}}},set_psBackgroundColor:function(sVal){if(this._eWrap){this._eWrap.style.backgroundColor=sVal||'';}},set_pbPromptButton:function(bVal){if(this._eWrap&&this._ePrompt){df.dom.toggleClass(this._eWrap,"WebFrm_HasPrompt",bVal);}},set_piMaxLength:function(iVal){if(this._eControl){if(this.peDataType===df.ciTypeText&&!this.psMask){this._eControl.maxLength=(iVal>0?iVal:0);}else{this._eControl.maxLength=1024;}}},onPromptClick:function(oEvent){if(this.pbEnabled){this.focus();if(this.firePrompt()){oEvent.stop();}}},setHeight:function(iHeight){if(iHeight>0){if(this.peLabelPosition===df.ciLabelTop){iHeight-=this._eLbl.offsetHeight;}
iHeight-=df.sys.gui.getVertBoxDiff(this._eInner);iHeight-=df.sys.gui.getVertBoxDiff(this._eControlWrp);iHeight-=df.sys.gui.getVertBoxDiff(this._eWrap);this._eControl.style.height=iHeight+"px";}else{this._eControl.style.height="";}},onKey:function(oEvent){df.WebForm.base.onKey.call(this,oEvent);if(oEvent.matchKey(df.settings.formKeys.prompt)){if(this.firePrompt()){oEvent.stop();}}},firePrompt:function(){if(this.pbPromptButton){return this.fire("OnPrompt");}},focus:function(bOptSelect){if(this._bFocusAble&&this.pbEnabled&&this._eControl&&this._eControl.focus){try{this._eControl.focus();if(bOptSelect){this._eControl.select();}}catch(oErr){}
return true;}
return false;},onFocus:function(oEvent){var iCarPos,iNewCarPos,iRight,iSelection,bSelectAll;iCarPos=df.dom.getCaretPosition(this._eControl);iRight=this._eControl.value.length-iCarPos;iSelection=df.dom.getSelectionLength(this._eControl);bSelectAll=iSelection>=this._eControl.value.length;df.WebForm.base.onFocus.call(this,oEvent);iNewCarPos=df.dom.getCaretPosition(this._eControl);if(iCarPos!==iNewCarPos){if(this.peDataType===df.ciTypeBCD){iCarPos=this._eControl.value.length-iRight;}
df.dom.setCaretPosition(this._eControl,iCarPos);}
if(bSelectAll){this._eControl.select();}}});

df.WebDateForm=function WebDateForm(oDef,oParent){df.WebDateForm.base.constructor.call(this,oDef,oParent);this.prop(df.tBool,"pbShowWeekNr",true);this.prop(df.tBool,"pbShowToday",true);this.prop(df.tInt,"piStartWeekAt",1);this.prop(df.tBool,"pbAutoShow",false);this.pbPromptButton=true;this._ePickerWrp=null;this._eFocus=null;this._bPickerVisible=false;this._bSkipAutoShow=false;this._bShowWait=false;this._iWidth=0;this._iHeight=0;this._sControlClass="WebForm WebDateForm";this._eParentRef=null;};df.defineClass("df.WebDateForm","df.WebForm",{afterRender:function(){df.WebDateForm.base.afterRender.call(this);this._eFocus=df.dom.create('<div class="WebDateForm_FocusHolder" tabindex="0" style="display: none; position: absolute; width: 0px; height: 0px;"></div>');this._eWrap.appendChild(this._eFocus);df.events.addDomListener("focus",this._eFocus,this.onPickFocus,this);df.events.addDomListener("blur",this._eFocus,this.onPickBlur,this);},resize:function(){if(this._bPickerVisible){this.position();}},position:function(){var iWidth,iHeight,oRect,ePicker,eTarget,iOffsetTop,iOffsetLeft;ePicker=this._ePickerWrp;eTarget=this._eWrap;if(ePicker&&eTarget){iHeight=ePicker.clientHeight+df.sys.gui.getVertBoxDiff(ePicker);iWidth=ePicker.clientWidth+df.sys.gui.getHorizBoxDiff(ePicker);oRect=eTarget.getBoundingClientRect();iOffsetTop=oRect.top+eTarget.offsetHeight;if(iOffsetTop+iHeight>df.sys.gui.getViewportHeight()){iOffsetTop-=iHeight+eTarget.offsetHeight;if(iOffsetTop<0){iOffsetTop=0;}}
iOffsetLeft=oRect.left;if(iOffsetLeft+iWidth>df.sys.gui.getViewportWidth()){iOffsetLeft=df.sys.gui.getViewportWidth()-iWidth-10;if(iOffsetLeft<0){iOffsetLeft=0;}}
ePicker.style.top=iOffsetTop+"px";ePicker.style.left=iOffsetLeft+"px";}},initDatePicker:function(){var eViewPort=this.getWebApp()._eViewPort||document.body;this._ePickerWrp=df.dom.create('<div class="WebDateForm_Picker" style="left: 0px; top: 0px;"></div>');eViewPort.appendChild(this._ePickerWrp);this._oPicker=new df.DatePicker();this._oPicker._oParent=this;this._oPicker._eFocus=this._eFocus;this._oPicker.pbShowWeekNr=this.pbShowWeekNr;this._oPicker.pbShowToday=this.pbShowToday;this._oPicker.piStartWeekAt=this.piStartWeekAt;this._ePickerWrp.appendChild(this._oPicker.render());this._oPicker.afterRender();this._oPicker.onEnter.addListener(this.onPickerEnter,this);},showDatePicker:function(){var eViewPort=this.getWebApp()._eViewPort||document.body;if(!this._ePickerWrp){this.initDatePicker();}
this._eMask=df.dom.create('<div class="WebDateForm_Mask">&nbsp;</div>');eViewPort.appendChild(this._eMask);df.events.addDomListener("click",this._eMask,this.onMaskClick,this);eViewPort.appendChild(this._ePickerWrp);this._ePickerWrp.style.bottom="";this._ePickerWrp.style.top="";this._ePickerWrp.style.left="";this.position();if(this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime){this.updateTypeVal();this._oPicker.setSelectedDate(((this._tValue&&new Date(this._tValue.getTime()))||new Date()),true,false);}
df.dom.addClass(this._ePickerWrp,"WebDF_WrapVisible");this._eFocus.style.display="";this._bPickerVisible=true;this.focus();},hideDatePicker:function(bOptNoFocus){var that=this;df.events.removeDomListener("click",this._eMask,this.onMaskClick);this._eMask.parentNode.removeChild(this._eMask);this._eMask=null;df.dom.removeClass(this._ePickerWrp,"WebDF_WrapVisible");setTimeout(function(){if(that._eParentRef&&that._ePickerWrp&&!that._bPickerVisible){that._eParentRef.removeChild(that._ePickerWrp);}},2000);this._eFocus.style.display="none";this._bPickerVisible=false;if(!bOptNoFocus){this._bSkipAutoShow=true;this.focus();}},firePrompt:function(){var that=this;if(this.pbEnabled&&!this._bShowWait){if(this._bPickerVisible){this.hideDatePicker();}else{this.showDatePicker();this._bShowWait=true;setTimeout(function(){that._bShowWait=false;},100);}
return true;}
return false;},onMaskClick:function(oEvent){var oOffset,eTarget=oEvent.getTarget();eTarget=oEvent.getTarget();oOffset=this._ePickerWrp.getBoundingClientRect();if(oEvent.getMouseY()>=oOffset.top-5&&oEvent.getMouseY()<=oOffset.bottom+5&&oEvent.getMouseX()>=oOffset.left-5&&oEvent.getMouseX()<=oOffset.right+5){this.focus();return false;}
this.hideDatePicker();},focus:function(){if(this._bPickerVisible){if(this._bFocusAble&&this.pbEnabled&&this._eFocus){this._eFocus.focus();return true;}
return false;}
return df.WebDateForm.base.focus.call(this);},onFocus:function(oEvent){var that=this;this._bLozingFocus=false;if(this._bPickerVisible){if(this.pbAutoShow&&!this._bShowWait){this.hideDatePicker(true);}}else{if(this.pbAutoShow&&!this._bSkipAutoShow){this.showDatePicker();this._bShowWait=true;setTimeout(function(){that._bShowWait=false;},100);}
this._bSkipAutoShow=false;df.WebDateForm.base.onFocus.call(this,oEvent);}},onPickFocus:function(oEvent){if(this._eElem){df.dom.addClass(this._eElem,"WebCon_Focus");}
if(this._oPicker&&this._oPicker._eElem){df.dom.addClass(this._oPicker._eElem,"WebCon_Focus");}
this._bHasFocus=true;this._bLozingFocus=false;if(this._tBlurTimeout){clearTimeout(this._tBlurTimeout);this._tBlurTimeout=null;}},onPickBlur:function(oEvent){var that=this;if(this._bPickerVisible){this._bLozingFocus=true;if(this._tBlurTimeout){clearTimeout(this._tBlurTimeout);this._tBlurTimeout=null;}
this._tBlurTimeout=setTimeout(function(){if(that._bLozingFocus){that.getWebApp().objBlur(that);if(that._eElem){df.dom.removeClass(that._eElem,"WebCon_Focus");}
if(that._oPicker&&that._oPicker._eElem){df.dom.removeClass(that._oPicker._eElem,"WebCon_Focus");}
that.hideDatePicker(true);that._bHasFocus=false;that._bLozingFocus=false;}},200);}else{df.WebDateForm.base.onBlur.call(this,oEvent);}},onPickerEnter:function(oEvent){if(this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime){this._tValue=oEvent.dValue;this.refreshDisplay(this._tValue);}
this.hideDatePicker();this.fireChange();return false;},onKey:function(oEvent){if(oEvent.matchKey(df.settings.calendarKeys.close)&&this._bPickerVisible){this.hideDatePicker();oEvent.stop();}else{df.WebDateForm.base.onKey.call(this,oEvent);}}});

df.WebCheckbox=function WebCheckbox(sName,oParent){df.WebCheckbox.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psChecked","1");this.prop(df.tString,"psUnchecked","0");this.prop(df.tString,"psCaption","");this.pbServerOnChange=false;this.psClientOnChange="";this._eCaption=null;this._sControlClass="WebCheckbox";};df.defineClass("df.WebCheckbox","df.WebBaseDEO",{openHtml:function(aHtml){df.WebCheckbox.base.openHtml.call(this,aHtml);aHtml.push('<input type="checkbox" id="',this._sControlId,'"><label class="WebCheckbox_Caption" for="',this._sControlId,'"></label><div style="clear: both"></div>');},afterRender:function(){this._eControl=df.dom.query(this._eElem,"input");this._eCaption=df.dom.query(this._eElem,"label.WebCheckbox_Caption");this.set_psCaption(this.psCaption);df.WebCheckbox.base.afterRender.call(this);df.events.addDomListener("click",this._eControl,this.onClick,this);},getControlValue:function(){if(this._eControl){if(this._eControl.checked){return this.psChecked;}
return this.psUnchecked;}
return this.psValue;},setControlValue:function(sVal){if(this._eControl){this._eControl.checked=(sVal===this.psChecked);}},set_psValue:function(sVal){df.WebCheckbox.base.set_psValue.call(this,sVal);this._sPrevChangeVal=this.get_psValue();},set_psCaption:function(sVal){if(this._eCaption){df.dom.setText(this._eCaption,sVal);if(this.psCaption!==sVal){this.sizeChanged();}}},set_psTextColor:function(sVal){if(this._eCaption){this._eCaption.style.color=sVal||'';}},tick:function(){if(this._eControl&&this.pbEnabled){this._eControl.checked=!this._eControl.checked;this.fireChange();}},onClick:function(oEvent){this.fireChange();}});

df.WebEdit=function WebEdit(oDef,oParent){df.WebEdit.base.constructor.call(this,oDef,oParent);this.prop(df.tInt,"piHeight",0);this.prop(df.tInt,"piMinHeight",0);this._eWrap=null;this._ePrompt=null;this._sControlClass="WebEdit";};df.defineClass("df.WebEdit","df.WebBaseForm",{openHtml:function(aHtml){df.WebEdit.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper"><textarea name="',this._sName,'"></textarea></div>');},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div.WebFrm_Wrapper textarea");this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");df.WebEdit.base.afterRender.call(this);},set_psBackgroundColor:function(sVal){if(this._eWrap){this._eWrap.style.backgroundColor=sVal||'';}},setHeight:function(iHeight){if(iHeight>0){if(this.peLabelPosition===df.ciLabelTop){iHeight-=this._eLbl.offsetHeight;}
iHeight-=df.sys.gui.getVertBoxDiff(this._eInner);iHeight-=df.sys.gui.getVertBoxDiff(this._eControlWrp);iHeight-=df.sys.gui.getVertBoxDiff(this._eWrap);iHeight-=df.sys.gui.getVertBoxDiff(this._eControl);if(df.sys.isChrome){iHeight--;iHeight--;}
iHeight=(iHeight<0?0:iHeight);this._eControl.style.height=iHeight+"px";}else{this._eControl.style.height="";}}});

df.tWebComboItem={sValue:df.tString,sDescription:df.tString};df.WebCombo=function WebCombo(oDef,oParent){df.WebCombo.base.constructor.call(this,oDef,oParent);this._bFilled=false;this._sControlClass="WebCombo";this._aValues=null;this._bDeferedSet=false;};df.defineClass("df.WebCombo","df.WebBaseDEO",{openHtml:function(aHtml){df.WebCombo.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper"><select name="',this._sName,'" id="',this._sControlId,'"></select></div>');},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div.WebFrm_Wrapper > select");this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");df.WebCombo.base.afterRender.call(this);df.events.addDomListener("click",this._eControl,this.onClick,this);this.updateList();},deserializeVT:df.sys.vt.generateDeserializer([df.tWebComboItem]),fill:function(){var tVT=this._tActionData,i,aData;this._aValues=this.deserializeVT(tVT);this.updateList();},updateList:function(){var eOpt,sVal,i,aValues=this._aValues,sDefValue=this.psValue;if(this._eControl&&aValues){sVal=this.get('psValue');while(this._eControl.options.length>0){this._eControl.remove(0);}
for(i=0;i<aValues.length;i++){eOpt=new Option(aValues[i].sDescription,aValues[i].sValue);this._eControl.options[this._eControl.options.length]=eOpt;if(aValues[i].sValue===sVal){eOpt.selected=true;}}
if(this._bDeferedSet){this._eControl.value=sDefValue;}
this._bFilled=true;}},getControlValue:function(){if(this._eControl&&this._bFilled){return this._eControl.value;}
return this.psValue;},setControlValue:function(sVal){if(this._eControl&&this._bFilled){this._eControl.value=sVal;this._bDeferedSet=this._eControl.value!==sVal;}else{this._bDeferedSet=true;}},fireChange:function(){this._bDeferedSet=false;df.WebCombo.base.fireChange.call(this);},set_pbCapslock:function(bVal){},set_psBackgroundColor:function(sVal){if(this._eWrap){this._eWrap.style.backgroundColor=sVal||'';}},onClick:function(oEvent){this.fireChange();},onKey:function(oEvent){var that=this;df.WebCombo.base.onKey.call(this,oEvent);setTimeout(function(){that.fireChange();},10);}});

df.tWebRow={sRowID:df.tString,sCssClassName:df.tString,aCells:[{sValue:df.tString,sTooltip:df.tString,aOptions:[df.tString]}]};df.WebList=function WebList(sName,oParent){df.WebList.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCurrentRowID","");this.prop(df.tInt,"piCurrentRowIndex",-1);this.prop(df.tInt,"piRowCount",0);this.prop(df.tBool,"pbShowSelected",true);this.prop(df.tBool,"pbDataAware",true);this.prop(df.tInt,"peDbGridType",df.gtAutomatic);this.prop(df.tBool,"pbOfflineEditing",false);this.prop(df.tBool,"pbAutoSearch",true);this.prop(df.tBool,"pbColumnSortable",true);this.prop(df.tBool,"pbReverseOrdering",true);this.prop(df.tInt,"piSortColumn",0);this.prop(df.tInt,"piMinHeight",0);this.prop(df.tInt,"piHeight",0);this.prop(df.tBool,"pbColumnsResizable",true);this._aColumns=[];this._aCache=[];this._bFirst=false;this._bLast=false;this._bLoading=false;this._bNoRender=false;this._bZebraTop=false;this._bZebraBottom=false;this._iDispOffset=0;this._iViewOffset=0;this._iRowsOffset=0;this._bClear=true;this._iRowHeight=0;this._iTableWidth=0;this._iTableHeight=0;this._iPrefViewOffset=8;this._iPrevCacheOffset=25;this._bLozingFocus=false;this._bInvalidRow=true;this._iRound=(df.sys.isIE&&df.sys.iVersion<=8?1:100);this._iColMin=1.5;this._bNoSearch=false;this._aReadyQueue=[];this.piMinHeight=200;this.pbShowLabel=false;this.addSync("piCurrentRowIndex");this.addSync("psCurrentRowID");this.addSync("piRowCount");this.setActionMode("HandleProcessDataSet",df.cCallModeWait);this.setActionMode("ChangeCurrentRow",df.cCallModeWait);this._sControlClass="WebList";};df.defineClass("df.WebList","df.WebBaseControl",{openHtml:function(aHtml){df.WebList.base.openHtml.call(this,aHtml);this.calculateColumnSizes();aHtml.push('<div class="WebList_Head">');aHtml.push('<div class="WebList_HeadWrp',(this.pbColumnsResizable?' WebList_ColResizable':''),'">');this.headerHtml(aHtml);aHtml.push('</div>');aHtml.push('</div>');aHtml.push('<div class="WebList_BodyWrp" tabindex="0">');aHtml.push('<div class="WebList_Scroll" tabindex="-1"><div class="WebList_Stretcher" style="width: 1px;"></div></div>');aHtml.push('<div class="WebList_Body',(this.pbShowSelected?' WebList_ShowSelected':''),'">');aHtml.push('<div class="WebList_TableWrp">');aHtml.push('<table>');this.resizeRowHtml(aHtml);aHtml.push('</table>');aHtml.push('</div></div><div style="clear: both"></div>');},headerHtml:function(aHtml){var iPrevCol=-1,sCssClass;aHtml.push('<table>');this.resizeRowHtml(aHtml);aHtml.push('<tr>');this.loopCols(function(oCol,iCol,bLast){sCssClass="WebList_ColHead";if(iCol===this.piSortColumn){sCssClass+=(this.pbReverseOrdering?" WebList_SortedReverse":" WebList_Sorted");}
if(this.pbColumnSortable&&oCol.pbSortable){sCssClass+=" WebList_Sortable";}
sCssClass+=" "+this.cellClass(oCol,null);aHtml.push('<th class="',sCssClass,'" data-dfcol="',iCol,'"><div>');if(iPrevCol>=0){aHtml.push('<div class="WebList_ColSep" data-dfcol="',iPrevCol,'"></div>');}
aHtml.push('<div class="WebList_ColCap">',(oCol.psCaption||'&nbsp;'),'</div>');aHtml.push('</div></th>');iPrevCol=iCol;});aHtml.push('</tr></table>');},resizeRowHtml:function(aHtml){aHtml.push('<colgroup>');this.loopCols(function(oCol){aHtml.push('<col style="width: ',oCol._iRealWidth,'%"></col>');});aHtml.push('</colgroup>');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebList.base.closeHtml.call(this,aHtml);},afterRender:function(){var fHandler;this._eTable=df.dom.query(this._eElem,"div.WebList_TableWrp > table");this._eBody=df.dom.query(this._eElem,"div.WebList_Body");this._eTableWrp=df.dom.query(this._eElem,"div.WebList_TableWrp");this._eScrollbar=df.dom.query(this._eElem,"div.WebList_Scroll");this._eScrollStretch=df.dom.query(this._eElem,"div.WebList_Scroll > div.WebList_Stretcher");this._eBodyWrp=df.dom.query(this._eElem,"div.WebList_BodyWrp");this._eHead=df.dom.query(this._eElem,"div.WebList_Head");this._eHeadWrp=df.dom.query(this._eElem,"div.WebList_HeadWrp");this._eControl=this._eFocus=this._eBodyWrp;df.WebList.base.afterRender.call(this);df.events.addDomListener("scroll",this._eScrollbar,this.onScrollbarScroll,this);df.events.addDomMouseWheelListener(this._eBody,this.onMouseWheelScroll,this);df.events.addDomListener("touchstart",this._eBody,this.onTouch,this);df.events.addDomListener("click",this._eTableWrp,this.onTableClick,this);df.events.addDomListener("dblclick",this._eTableWrp,this.onTableDblClick,this);df.events.addDomListener("click",this._eElem,this.onListClick,this);df.events.addDomListener("click",this._eHead,this.onHeadClick,this);df.events.addDomListener("mousedown",this._eHead,this.onHeadMouseDown,this);df.events.addDomListener("keydown",this._eFocus,this.onKeyDown,this);df.events.addDomListener("keypress",this._eFocus,this.onKeyPress,this);while(fHandler=this._aReadyQueue.shift()){fHandler.call(this);}
this.resize();this._bRenderChildren=true;},afterRenderChildren:function(){},updatePosition:function(bForceRedraw){var iDisplaySize,iRowsOffset,iViewSize;if(!this._bNoRender){iDisplaySize=this.getDisplaySize();iViewSize=this.getViewSize();bForceRedraw=!!bForceRedraw;iRowsOffset=Math.round(this._eScrollbar.scrollTop/(this._iRowHeight||20));if(iRowsOffset+iViewSize>this._aCache.length){iRowsOffset=(this._aCache.length-iViewSize)+1;}
if(this._iRowsOffset!==iRowsOffset||this._eTable.rows.length<iDisplaySize||bForceRedraw){this._iRowsOffset=iRowsOffset;if(this._eTable.rows.length>iDisplaySize+(this._iPrefViewOffset*3)||this._bClear){bForceRedraw=true;this._bClear=false;}
if((this._iDispOffset<=iRowsOffset&&this._iDispOffset+iDisplaySize>=iRowsOffset+iViewSize-1)&&!bForceRedraw){this._iViewOffset=iRowsOffset-this._iDispOffset;this.updateScrollPos(this._iViewOffset*(this._iRowHeight||20));this.adjustDisplay();}else{if(iRowsOffset>this._iPrefViewOffset){this._iDispOffset=iRowsOffset-this._iPrefViewOffset;this._iViewOffset=this._iPrefViewOffset;}else{this._iDispOffset=0;this._iViewOffset=iRowsOffset;}
this.refreshDisplay();}}}},adjustDisplay:function(){var iDispOffset,iDisplaySize=this.getDisplaySize();iDispOffset=this._iRowsOffset-this._iPrefViewOffset;if(iDispOffset<0){iDispOffset=0;}
if(iDispOffset+iDisplaySize>this._aCache.length){iDispOffset=this._aCache.length-iDisplaySize;}
while(this._iDispOffset>iDispOffset){this._iDispOffset--;this._iViewOffset++;this.insertRow(this._aCache[this._iDispOffset],true);}
if(!df.sys.isIE||df.sys.iVersion>8){while(this._iDispOffset<iDispOffset){this.removeTopRow();}
this.updateScrollPos(this._iViewOffset*(this._iRowHeight||20));}
while(this._eTable.rows.length<iDisplaySize){this.insertRow(this._aCache[this._iDispOffset+this._eTable.rows.length],false);}
if(!df.sys.isIE||df.sys.iVersion>8){while(this._eTable.rows.length>iDisplaySize){this.removeBottomRow();}}},removeTopRow:function(){this._iDispOffset++;this._iViewOffset--;this._bZebraTop=!this._bZebraTop;this._eTable.deleteRow(0);},removeBottomRow:function(){this._eTable.deleteRow(-1);this._bZebraBottom=!this._bZebraBottom;},updateScrollPos:function(iOffset){this._eTable.style.top="-"+iOffset+"px";},insertRow:function(tRow,bTop){var eRow,eCell,bZebra;if(bTop){bZebra=this._bZebraTop;this._bZebraTop=!this._bZebraTop;}else{bZebra=this._bZebraBottom;this._bZebraBottom=!this._bZebraBottom;}
eRow=this._eTable.insertRow(bTop?0:-1);eRow.className=this.rowClass(tRow,bZebra);this.loopCols(function(oCol,i){eCell=eRow.insertCell(-1);eCell.innerHTML=(tRow?this.cellHtml(oCol,tRow.aCells[i]):"&nbsp;");eCell.className=this.cellClass(oCol,tRow);eCell.title=(tRow&&(tRow.aCells[i].sTooltip||tRow.aCells[i].sValue))||"";});},rowHtml:function(tRow,aHtml,bZebra){var sTooltip;aHtml.push('<tr class="',this.rowClass(tRow,bZebra),'">');this.loopCols(function(oCol,i){sTooltip=(tRow&&(tRow.aCells[i].sTooltip||tRow.aCells[i].sValue))||"";sTooltip.replace('"','&quot;');aHtml.push('<td class="',this.cellClass(oCol,tRow),'" title="',sTooltip,'">',(tRow?this.cellHtml(oCol,tRow.aCells[i]):'&nbsp;'),'</td>');});aHtml.push('</tr>');},cellClass:function(oCol,tRow){var aClasses=[];aClasses.push(oCol._sCellClass);aClasses.push(oCol.pbEnabled?"Web_Enabled":"Web_Disabled");aClasses.push(oCol.peAlign===df.ciAlignLeft?"WebList_AlignLeft":(oCol.peAlign===df.ciAlignCenter?"WebList_AlignCenter":(oCol.peAlign===df.ciAlignRight?"WebList_AlignRight":"")));if(oCol.peDataType===df.ciTypeBCD){aClasses.push("dfData_BCD");}else if(oCol.peDataType===df.ciTypeDate){aClasses.push("dfData_Date");}else{aClasses.push("dfData_Text");}
if(oCol.psCSSClass){aClasses.push(oCol.psCSSClass);}
return aClasses.join(" ");},rowClass:function(tRow,bZebra){var aClasses=["WebList_Row"];if((tRow&&tRow.sRowID)===this.psCurrentRowID){aClasses.push("WebList_Selected");}
aClasses.push((bZebra?' WebList_RowOdd':' WebList_RowEven'));if(!tRow){aClasses.push("WebList_RowEmpty");}
if(tRow&&tRow.sCssClassName){aClasses.push(tRow.sCssClassName);}
return aClasses.join(" ");},cellHtml:function(oCol,tCell){var bFocus,sHtml;tCell=tCell||{sValue:"",sTooltip:"",aOptions:[]};bFocus=oCol._bHasFocus;oCol._bHasFocus=false;sHtml=oCol.cellHtml(tCell);oCol._bHasFocus=bFocus;return sHtml;},refreshDisplay:function(){var i,aHtml=[],iDisplaySize=this.getDisplaySize(true),bZebra=!this._bZebraTop;aHtml.push('<table>');this.resizeRowHtml(aHtml);for(i=this._iDispOffset;i<this._iDispOffset+iDisplaySize&&i<this._aCache.length;i++){this.rowHtml(this._aCache[i],aHtml,bZebra);bZebra=!bZebra;}
for(i;i<iDisplaySize;i++){this.rowHtml(null,aHtml,bZebra);bZebra=!bZebra;}
aHtml.push('</table>');this._eTableWrp.innerHTML=aHtml.join('');this._eTable=this._eTableWrp.firstChild;this.updateScrollPos(this._iViewOffset*(this._iRowHeight||20));this._bZebraBottom=bZebra;},onScrollbarScroll:function(){this.updatePosition();this.updateCache();},onMouseWheelScroll:function(oEvent){var iTo,iDelta=oEvent.getMouseWheelDelta();if(iDelta>0){iTo=this._eScrollbar.scrollTop-((this._iRowHeight||20)*2);this._eScrollbar.scrollTop=(iTo>0?iTo:0);}else if(iDelta<0){this._eScrollbar.scrollTop=this._eScrollbar.scrollTop+((this._iRowHeight||20)*2);}},onTouch:function(oEvent){var iY,iPrevY,bMoved=false;if(oEvent.e.targetTouches.length>1){return true;}
iPrevY=oEvent.e.targetTouches[0].pageY;function touchMove(oEvent){iY=oEvent.e.targetTouches[0].pageY;this._eScrollbar.scrollTop=this._eScrollbar.scrollTop-(iY-iPrevY);if(iPrevY!==iY){bMoved=true;}
iPrevY=iY;oEvent.stop();}
function touchEnd(oEvent){df.events.removeDomListener("touchend",this._eBody,touchEnd,this);df.events.removeDomListener("touchmove",this._eBody,touchMove,this);if(bMoved){oEvent.stop();}}
df.events.addDomListener("touchend",this._eBody,touchEnd,this);df.events.addDomListener("touchmove",this._eBody,touchMove,this);},getViewSize:function(bOptFull){var iViewSize=Math.floor(this._eTableWrp.clientHeight/(this._iRowHeight||20))+1;if(!bOptFull&&iViewSize>this._aCache.length){iViewSize=this._aCache.length;}
return iViewSize;},getDisplaySize:function(bOptFull){var iDisplaySize=this.getViewSize(bOptFull)+(this._iPrefViewOffset*2);if(!bOptFull&&iDisplaySize>this._aCache.length){iDisplaySize=this._aCache.length;}
return iDisplaySize;},updateScrollSize:function(){var iHeight=this._aCache.length*(this._iRowHeight||20)+(this._iRowHeight||20);if(this._eScrollStretch&&this._eScrollStretch.clientHeight!==iHeight){this._eScrollStretch.style.height=iHeight+"px";}},updateRowHeight:function(){var bRemove=false;if(this._eTable){if(this._eTable.rows.length<1){this._eTable.style.visibility="hidden";this.insertRow(null);bRemove=true;}
this._iRowHeight=this._eTable.rows[0].offsetHeight;if(bRemove){this._eTable.deleteRow(0);this._eTable.style.visibility="visible";}}},centerCurrentRow:function(){var iStart=this.findRowByRowId(this.psCurrentRowID);if(iStart>=0){iStart=iStart-((this.getViewSize()-2)/2);if(iStart<0){iStart=0;}
this._eScrollbar.scrollTop=(this._iRowHeight||20)*iStart;}},scrollToCurrentRow:function(){var iRow=this.findRowByRowId(this.psCurrentRowID),iViewSize=this.getViewSize()-1;if(iRow<=this._iDispOffset+this._iViewOffset){this._eScrollbar.scrollTop=(this._iRowHeight||20)*(iRow);}else{if(iRow+1>this._iDispOffset+this._iViewOffset+iViewSize){this._eScrollbar.scrollTop=(this._iRowHeight||20)*(iRow-iViewSize+1);}}},selectRow:function(sGotoRow,iRow,fOptHandler,tOptSelectRowData){var sPrevRowID=this.psCurrentRowID,bContinue=true,sTargetRowID="",iPrevRow,tSelectRowData=tOptSelectRowData||null;iPrevRow=this.findRowByRowId(sPrevRowID);this.cancelServerAction("ChangeCurrentRow");if(sGotoRow==="row"){sTargetRowID=this._aCache[iRow].sRowID;bContinue=(sTargetRowID!==this.psCurrentRowID);if(!this.pbDataAware){tSelectRowData=this._aCache[iRow];}}
function handleRowChange(oEvent){var eRow,iPrevRow,ePrevRow,iRow;if(this.pbOfflineEditing||oEvent.sReturnValue==="1"){if(sPrevRowID){iPrevRow=this.findRowByRowId(sPrevRowID);if(iPrevRow>=this._iDispOffset&&iPrevRow<this._iDispOffset+this.getDisplaySize()){ePrevRow=this._eTable.rows[iPrevRow-this._iDispOffset];df.dom.removeClass(ePrevRow,"WebList_Selected");}}
if(fOptHandler){fOptHandler.call(this,true);}
iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow>=0&&iRow-this._iDispOffset>=0&&iRow-this._iDispOffset<this._eTable.rows.length){eRow=this._eTable.rows[iRow-this._iDispOffset];df.dom.addClass(eRow,"WebList_Selected");}}else{fOptHandler.call(this,false);}}
if(bContinue){if(!this.pbOfflineEditing){this.serverAction("ChangeCurrentRow",[sGotoRow,sTargetRowID],(tSelectRowData&&this.serializeVT([tSelectRowData]))||null,handleRowChange,this);}else{if(sGotoRow==="row"){this.set('psCurrentRowID',sTargetRowID);this.updateColumnsFromCache(true);}
handleRowChange.call(this);this._bInvalidRow=false;}}else{if(fOptHandler){fOptHandler.call(this,false);}}},updateColumnsFromCache:function(bResetChange){var iRow,iCol;if(!this.pbDataAware){iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow>=0){for(iCol=0;iCol<this._aColumns.length;iCol++){this._aColumns[iCol].set('psValue',this._aCache[iRow].aCells[iCol].sValue);if(bResetChange){this._aColumns[iCol].set('pbChanged',false);}}
this._bUpdatedColumnsFromCache=true;}}},calculateColumnSizes:function(){var iTotal=0,iCol,oCol,oLast,iUsed=0,iLeft;for(iCol=0;iCol<this._aColumns.length;iCol++){oCol=this._aColumns[iCol];if(oCol.pbRender){iTotal+=oCol.piWidth;oLast=oCol;}}
for(iCol=0;iCol<this._aColumns.length;iCol++){oCol=this._aColumns[iCol];if(oCol.pbRender){oCol._iRealWidth=Math.floor((oCol.piWidth*(100/iTotal))*this._iRound)/this._iRound;iUsed=iUsed+oCol._iRealWidth;}}
iLeft=100-iUsed;if(iLeft>=1){for(iCol=0;iCol<this._aColumns.length&&iLeft>0;iCol++){oCol=this._aColumns[iCol];if(oCol.pbRender){oCol._iRealWidth++;iLeft--;}}}},resizeColumn:function(oEvent,iCol){var eMask,eGhost,iLeft=0,iPX,iStartX,iDiff=0,iMin,iMax=0;eMask=df.gui.dragMask();eMask.style.cursor="e-resize";this.loopCols(function(oCol,iCur){if(iCur<=iCol){iLeft+=oCol._iRealWidth;}else{iMax+=oCol._iRealWidth-this._iColMin;}});iStartX=oEvent.getMouseX();iMin=-this._aColumns[iCol]._iRealWidth+this._iColMin;iPX=100/this._eTableWrp.offsetWidth;eGhost=df.dom.create('<div class="WebList_ColResizer"></div>');this._eHeadWrp.appendChild(eGhost);eGhost.style.left=iLeft+"%";eGhost.style.height=(this._eHead.clientHeight+this._eBody.clientHeight)+"px";function onResize(oEvent){var iNewX=oEvent.getMouseX(),iNewLeft;iDiff=(iNewX-iStartX)*iPX;if(iDiff<iMin){iDiff=iMin;}
if(iDiff>iMax){iDiff=iMax;}
iNewLeft=this.roundColSize(iLeft+iDiff);eGhost.style.left=iNewLeft+"%";}
function onStopResize(oEvent){df.events.removeDomListener("mouseup",eMask,onStopResize);df.events.removeDomListener("mouseup",window,onStopResize);df.events.removeDomListener("mousemove",eMask,onResize);eGhost.parentNode.removeChild(eGhost);eMask.parentNode.removeChild(eMask);this.recalcColumnSizes(iCol,iDiff);this.updateHeader();this.updatePosition(true);}
df.events.addDomListener("mouseup",eMask,onStopResize,this);df.events.addDomListener("mouseup",window,onStopResize,this);df.events.addDomListener("mousemove",eMask,onResize,this);},recalcColumnSizes:function(iCol,iDiff){var i,iTotal=0,iUsed=0,iColDiff,oCol;if(this.roundColSize(iDiff)!==0){for(i=iCol+1;i<this._aColumns.length;i++){oCol=this._aColumns[i];if(oCol.pbRender){if(iDiff<0){iTotal+=oCol._iRealWidth;}else{iTotal+=oCol._iRealWidth-this._iColMin;}}}
for(i=iCol+1;i<this._aColumns.length;i++){oCol=this._aColumns[i];if(oCol.pbRender){if(iDiff<0){iColDiff=this.roundColSize((1/(iTotal/(oCol._iRealWidth)))*iDiff);}else{iColDiff=this.roundColSize((1/(iTotal/(oCol._iRealWidth-this._iColMin)))*iDiff);}
iUsed+=iColDiff;oCol._iRealWidth=this.roundColSize(oCol._iRealWidth-iColDiff);if(isNaN(oCol._iRealWidth)){alert("calculations went wrong!");}}}
this._aColumns[iCol]._iRealWidth=this.roundColSize(this._aColumns[iCol]._iRealWidth+iUsed);}},roundColSize:function(iVal){return Math.round(iVal*this._iRound)/this._iRound;},deserializeVT:df.sys.vt.generateDeserializer([df.tWebRow]),serializeVT:df.sys.vt.generateSerializer([df.tWebRow]),updateCache:function(){if(!this._bNoRender){if(!this._bLast){if((this._aCache.length-this._iDispOffset-this.getDisplaySize())<this._iPrevCacheOffset){this.loadCachePage("next",function(){this.updateCache();},this);}}
if(!this._bFirst){if(this._iDispOffset-this._iPrevCacheOffset<0){this.loadCachePage("prev",function(){this.updateCache();},this);}}}},loadCachePage:function(sType,fOptHandler,oOptEnv){var sStartRowID="";if(this._bLoading){return;}
this._bLoading=true;if(sType==="next"){sStartRowID=this._aCache[this._aCache.length-1].sRowID;}else if(sType==="prev"){sStartRowID=this._aCache[0].sRowID;}else{this._bNoRender=true;}
this.serverAction("LoadDataPage",[sType,sStartRowID],null,function(oEvent){this._bLoading=false;if(!oEvent.bError){this.ready(function(){if(fOptHandler){fOptHandler.call(oOptEnv||this);}});}});},handleDataPage:function(sType,sStartRowId,bFirst,bLast){var aRows=this.deserializeVT(this._tActionData);bFirst=(bFirst==="1");bLast=(bLast==="1");this.ready(function(){this.onBeforeCacheUpdate();if(this._iRowHeight<1){this.updateRowHeight();}
if(sType==="page"){this._aCache=aRows;this._bLast=bLast;this._bFirst=bFirst;this.sortData();this.updateScrollSize();this.centerCurrentRow();this._bNoRender=false;this.updatePosition(true);if(this._aCache.length===0){this.appendNewRow();}}
if(sType==="first"){this._aCache=aRows;this._bLast=bLast;this._bFirst=bFirst;this.sortData();this.updateScrollSize();this._eScrollbar.scrollTop=0;this._bNoRender=false;this.updatePosition();}
if(sType==="last"){aRows.reverse();this._aCache=aRows;this._bLast=bLast;this._bFirst=bFirst;this.sortData();this.updateScrollSize();this._eScrollbar.scrollTop=this._eScrollStretch.clientHeight-this._eScrollbar.clientHeight;this._bNoRender=false;this.updatePosition();}
if(sType==="next"){this._aCache=this._aCache.concat(aRows);this._bLast=bLast;this.updateScrollSize();}
if(sType==="prev"){aRows.reverse();this._aCache=aRows.concat(this._aCache);this._bFirst=bFirst;this._iDispOffset+=aRows.length;this.updateScrollSize();this._eScrollbar.scrollTop=this._eScrollbar.scrollTop+aRows.length*(this._iRowHeight||20);this.updatePosition();}
this.onAfterCacheUpdate();});},clearCache:function(){if(this._eScrollbar){this._eScrollbar.scrollTop=0;}
if(this._eTable){this._eTable.style.color="transparent";}
this._bClear=true;this._aCache=[];this._bFirst=false;this._bLast=false;this._iDispOffset=0;this._iViewOffset=0;},refreshData:function(){this.clearCache();this.showLoading();this.loadCachePage("page","",function(oEvent){this.hideLoading();});},redraw:function(){var that=this;if(this._tRedraw){clearTimeout(this._tRedraw);}
this._tRedraw=setTimeout(function(){if(that._eTableWrp){that.calculateColumnSizes();that.updateHeader();that.refreshDisplay();}
that._tRedraw=null;},10);},sortData:function(){if((!this.pbDataAware||this.peDbGridType!==df.gtAutomatic)&&this.piSortColumn>=0){if(this._bLast&&this._bFirst){var iCol,bRev,aCompare,i;this.onBeforeCacheUpdate();iCol=this.piSortColumn;bRev=this.pbReverseOrdering;aCompare=[];for(i=0;i<this._aColumns.length;i++){if(this._aColumns[i].peDataType===df.ciTypeText){aCompare[i]=this.compareText;}else if(this._aColumns[i].peDataType===df.ciTypeBCD){aCompare[i]=this.compareBCD;}else if(this._aColumns[i].peDataType===df.ciTypeDate||this._aColumns[i].peDataType===df.ciTypeDateTime){aCompare[i]=this.compareDate;}}
this._aCache.sort(function(oItem1,oItem2){var i,x;if(oItem1.aCells[iCol].sValue!==oItem2.aCells[iCol].sValue){x=aCompare[iCol](oItem1.aCells[iCol].sValue,oItem2.aCells[iCol].sValue);return(bRev?-x:x);}
for(i=0;i<oItem1.aCells.length;i++){if(oItem1.aCells[i].sValue!==oItem2.aCells[i].sValue){x=aCompare[i](oItem1.aCells[i].sValue,oItem2.aCells[i].sValue);return(bRev?-x:x);}}
return 0;});this.onAfterCacheUpdate();}else{throw new df.Error(999,"Client-side sorting is only supported with manual data loading!",[],this);}}},compareText:function(sVal1,sVal2){return sVal1.localeCompare(sVal2);},compareBCD:function(sVal1,sVal2){return parseFloat(sVal1)-parseFloat(sVal2);},compareDate:function(sVal1,sVal2){return df.sys.data.stringToDate(sVal1,"yyyy/mm/dd","-")<df.sys.data.stringToDate(sVal2,"yyyy/mm/dd","-")?-1:1;},onBeforeCacheUpdate:function(){},onAfterCacheUpdate:function(){},getColCell:function(oCol){var iCol,iCell,iRow;iRow=this.findRowByRowId(this.psCurrentRowID);iCol=this.findColNr(oCol);iCell=this.colNrToCell(iCol);if(iRow>=0&&iCol>=0&&iCell>=0){if(iRow>=this._iDispOffset&&iRow<this._iDispOffset+this.getDisplaySize()){return this._eTable.rows[iRow-this._iDispOffset].cells[iCell];}}
return null;},getColHead:function(oCol){var iCol;iCol=this.findColNr(oCol);return df.dom.query(this._eHeadWrp,"th.WebList_ColHead[data-dfcol='"+iCol+"']");},showLoading:function(){},hideLoading:function(){},findRowByRowId:function(sRowID){var i;for(i=0;i<this._aCache.length;i++){if(this._aCache[i].sRowID===sRowID){return i;}}
return-1;},ready:function(fHandler){if(this._eElem){fHandler.call(this);}else{this._aReadyQueue.push(fHandler);}},addChild:function(oChild){if(oChild._bIsColumn){this._aColumns.push(oChild);}
df.WebList.base.addChild.call(this,oChild);},loopCols:function(fHandler,bOptHidden){var i,x,iCount=0,oCol,bLast;for(i=0;i<this._aColumns.length;i++){oCol=this._aColumns[i];if(oCol.pbRender||bOptHidden){bLast=true;for(x=i+1;x<this._aColumns.length&&bLast;x++){bLast=!(this._aColumns[x].pbRender||bOptHidden);}
if(fHandler.call(this,oCol,i,bLast,iCount)===false){return false;}
iCount++;}}
return true;},colNrToCell:function(iCol){var i,iCount=0;for(i=0;i<this._aColumns.length;i++){if(this._aColumns[i].pbRender){if(iCol===i){return iCount;}
iCount++;}}
return-1;},cellToColNr:function(iCell){var i,iCount=0;for(i=0;i<this._aColumns.length;i++){if(this._aColumns[i].pbRender){if(iCell===iCount){return i;}
iCount++;}}
return-1;},findColNr:function(oCol){var iCol;for(iCol=0;iCol<this._aColumns.length;iCol++){if(this._aColumns[iCol]===oCol){return iCol;}}
return-1;},search:function(sSearch){var fComp,aData=this._aCache,iCol=this.piSortColumn,iLow=0,iHigh=aData.length-1,iMid,iRes,iRow=null,bRev=this.pbReverseOrdering;if(iCol<0){return;}
if((!this.pbDataAware||this.peDbGridType!==df.gtAutomatic)){if(this._aColumns[iCol].peDataType===df.ciTypeText){fComp=function(sVal1,sVal2){sVal1=sVal1.substr(0,sVal2.length).toLowerCase();return sVal1.localeCompare(sVal2);};sSearch=sSearch.toLowerCase();}else if(this._aColumns[iCol].peDataType===df.ciTypeBCD){fComp=this.compareBCD;}else if(this._aColumns[iCol].peDataType===df.ciTypeDate||this._aColumns[iCol].peDataType===df.ciTypeDateTime){fComp=this.compareDate;}
iCol++;while(iLow<iHigh){iMid=Math.floor((iLow+iHigh)/2);iRes=fComp(aData[iMid].aCells[iCol].sValue,sSearch);iRes=(bRev?-iRes:iRes);if(iRes<0){iLow=iMid+1;}else if(iRes>0){iHigh=iMid-1;}else{iRow=iMid;break;}}
if(iRes===0){if(iRow>0){iRes=fComp(aData[iRow-1].aCells[iCol].sValue,sSearch);iRes=(bRev?-iRes:iRes);while(iRes===0&&iRow>0){iRow--;if(iRow>0){iRes=fComp(aData[iRow-1].aCells[iCol].sValue,sSearch);}}}}else{if(iMid<iLow){iRow=iLow;}else if(iMid>iLow){iRow=iHigh;}else{iRow=iMid;}}
this.moveToRow(iRow);}else{this.serverAction("OnSearch",[sSearch]);}},showSearch:function(sOptSearch){var oDialog,oForm,iCol=this.piSortColumn;if(iCol<0){return;}
oDialog=new df.WebModalDialog(null,this);oDialog.psCaption=this.getWebApp().getTrans("search")+": "+this._aColumns[iCol].psCaption;oDialog.pbShowClose=true;oDialog.pbDDHotKeys=false;oDialog.pbResizable=false;oDialog.piWidth=320;oForm=new df.WebForm(null,oDialog);oForm.psLabel="";oForm.pbShowLabel=false;oForm.psValue=sOptSearch||"";oForm.peDataType=this._aColumns[iCol].peDataType;oForm.psMask=this._aColumns[iCol].psMask;oForm.piPrecision=this._aColumns[iCol].piPrecision;oForm.piMaxLength=this._aColumns[iCol].piMaxLength;oForm.pbCapslock=this._aColumns[iCol].pbCapslock;oDialog.addChild(oForm);oDialog.OnSubmit.addListener(function(oEvent){var sVal=oForm.get("psValue");oDialog.hide();this.getWebApp().objFocus(this);this.search(sVal);if(this._eFocus){this._eFocus.focus();}},this);oDialog.show();df.dom.setCaretPosition(oForm._eControl,oForm._eControl.value.length);},onKeyPress:function(oEvent){var sChar,iKey,iChar;if(this.pbAutoSearch&&this.piSortColumn>=0&&!this._bNoSearch){iKey=oEvent.getKeyCode();iChar=oEvent.getCharCode();if(iChar>0&&iChar!==13&&!oEvent.isSpecialKey()){sChar=String.fromCharCode(oEvent.getCharCode());if(this._aColumns[this.piSortColumn].peDataType===df.ciTypeBCD){if(("0123456789,.-").indexOf(sChar)<0){sChar="";}}else if(this._aColumns[this.piSortColumn].peDataType===df.ciTypeDate){if(("0123456789-").indexOf(sChar)<0){sChar="";}}
this.showSearch(sChar);oEvent.stop();return false;}}
return true;},onKeyDown:function(oEvent){var that=this;if(oEvent.matchKey(df.settings.listKeys.scrollUp)){this.moveUpRow();}else if(oEvent.matchKey(df.settings.listKeys.scrollDown)){this.moveDownRow();}else if(oEvent.matchKey(df.settings.listKeys.scrollPageUp)){this.movePageUp();}else if(oEvent.matchKey(df.settings.listKeys.scrollPageDown)){this.movePageDown();}else if(oEvent.matchKey(df.settings.listKeys.scrollTop)){this.moveToFirstRow();}else if(oEvent.matchKey(df.settings.listKeys.scrollBottom)){this.moveToLastRow();}else{return true;}
this._bNoSearch=true;setTimeout(function(){that._bNoSearch=false;},50);oEvent.stop();return false;},onTableClick:function(oEvent){var eElem=oEvent.getTarget(),iCol=-1,iRow;this._bHasFocus=true;while(eElem.parentNode&&eElem!==this._eBody){if(eElem.tagName==="TD"){iCol=this.cellToColNr(eElem.cellIndex);}else if(eElem.tagName==="TR"&&this._eTable.rows[eElem.rowIndex]===eElem){iRow=eElem.rowIndex+this._iDispOffset;if(iRow<this._aCache.length){this._aColumns[iCol].cellClick(oEvent,this._aCache[iRow].sRowID,this._aCache[iRow].aCells[iCol].sValue);this.selectRow("row",eElem.rowIndex+this._iDispOffset,function(){this.focus();});}
return;}
eElem=eElem.parentNode;}},onHeadClick:function(oEvent){var eElem=oEvent.getTarget(),iCol;if(this.pbColumnSortable){while(eElem.parentNode&&eElem!==this._eHead){if(eElem.tagName==="TH"&&eElem.hasAttribute("data-dfcol")){iCol=parseInt(eElem.getAttribute("data-dfcol"),10);if(this._aColumns[iCol]){this._aColumns[iCol].fire("OnHeaderClick",[],function(oEvent){if(!oEvent.bServer&&!oEvent.bClient){if(this._aColumns[iCol].pbSortable){if(this.piSortColumn===iCol){this.changeSorting(iCol,!this.pbReverseOrdering);}else{this.changeSorting(iCol,false);}}}},this);}
return;}
eElem=eElem.parentNode;}}},updateHeader:function(){var aHtml=[];if(this._eHeadWrp){this.headerHtml(aHtml);this._eHeadWrp.innerHTML=aHtml.join("");}},changeSorting:function(iCol,bReverse){var iPrevCol=this.piSortColumn,bPrevReverse=this.pbReverseOrdering;this.addSync('piSortColumn');this.addSync('pbReverseOrdering');this.piSortColumn=iCol;this.pbReverseOrdering=bReverse;if(this.pbDataAware&&this.peDbGridType===df.gtAutomatic){this.serverAction("ChangeSorting",[iCol,bReverse,iPrevCol,bPrevReverse]);}else{this.sortData();this.scrollToCurrentRow();this.refreshDisplay();}
this.updateHeader();},onHeadMouseDown:function(oEvent){var eTarget=oEvent.getTarget();if(eTarget.className==='WebList_ColSep'&&this.pbColumnsResizable){this.resizeColumn(oEvent,parseInt(eTarget.getAttribute('data-dfcol'),10));oEvent.stop();return false;}
return true;},onTableDblClick:function(oEvent){this.fireSubmit();},gridRefresh:function(bFirst,bLast){this.cancelServerAction("ChangeCurrentRow");this._bInvalidRow=false;this.clearCache();this.handleDataPage("page","",bFirst,bLast);this.ready(function(){if(this.psCurrentRowID===""){this._bInvalidRow=true;if(this._aCache.length>0){this.selectRow("row",0,function(){this.scrollToCurrentRow();});}else{this.appendNewRow();}}});},moveToFirstRow:function(){var fSelect,sRowID=this.psCurrentRowID,iRow;iRow=this.findRowByRowId(sRowID);fSelect=function(){if(this._aCache.length>0){this.selectRow("row",0,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});}else{this.appendNewRow();}};if(!this.pbDataAware||this.peDbGridType!==df.gtAutomatic){fSelect.call(this);}else{if(this.pbOfflineEditing||(iRow===0&&sRowID==="")){this.loadCachePage("first",function(){fSelect.call(this);});}else{this.selectRow("first",-1,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});}}},moveToLastRow:function(){var fSelect,sRowID=this.psCurrentRowID,iRow;iRow=this.findRowByRowId(sRowID);fSelect=function(){if(this._aCache.length>0){this.selectRow("row",this._aCache.length-1,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});}else{this.appendNewRow();}};if(!this.pbDataAware||this.peDbGridType!==df.gtAutomatic){fSelect.call(this);}else{if(this.pbOfflineEditing||(iRow===0&&sRowID==="")){this.loadCachePage("last",function(){fSelect.call(this);});}else{this.selectRow("last",-1,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});}}},moveDownRow:function(){var iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow>=0&&iRow<this._aCache.length-1){iRow++;this.selectRow("row",iRow,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});return true;}
return false;},moveUpRow:function(){var iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow>0){iRow--;this.selectRow("row",iRow,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});}},movePageDown:function(){var iRow=this.findRowByRowId(this.psCurrentRowID);iRow=iRow+this.getViewSize()-1;if(iRow>=this._aCache.length){iRow=this._aCache.length-1;}
this.selectRow("row",iRow,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});},movePageUp:function(){var iRow=this.findRowByRowId(this.psCurrentRowID);iRow=iRow-this.getViewSize()+1;if(iRow<0){iRow=0;}
this.selectRow("row",iRow,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});},moveToRow:function(iRowIndex){iRowIndex=parseInt(iRowIndex,10);if(iRowIndex>=0&&iRowIndex<this._aCache.length){this.selectRow("row",iRowIndex,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});}},moveToRowByID:function(sRowID){var iRowIndex=this.findRowByRowId(sRowID);if(iRowIndex>=0){this.moveToRow(iRowIndex);}},processDataSet:function(eOperation){var iRow=this.findRowByRowId(this.psCurrentRowID);this.serverAction("HandleProcessDataSet",[eOperation,iRow],this.serializeVT(this._aCache));},set_pbColumnSortable:function(bVal){if(this._eElem){this.pbColumnSortable=bVal;this.updateHeader();}},set_pbColumnsResizable:function(bVal){df.dom.toggleClass(this._eHeadWrp,"WebList_ColResizable",bVal);if(!bVal){this.calculateColumnSizes();if(this._eElem){this.updateHeader();this.updatePosition(true);}}},get_piCurrentRowIndex:function(){return this.findRowByRowId(this.psCurrentRowID);},get_piRowCount:function(){return this._aCache.length;},set_pbShowSelected:function(bVal){if(this._eBody){df.dom.toggleClass(this._eBody,"WebList_ShowSelected",bVal);}},set_piSortColumn:function(iVal){if(this._eTableWrp&&this.piSortColumn!==iVal){this.piSortColumn=iVal;this.updateHeader();}},set_pbReverseOrdering:function(bVal){if(this._eTableWrp&&this.pbReverseOrdering!==bVal){this.pbReverseOrdering=bVal;this.updateHeader();}},appendNewRow:function(){return false;},focus:function(){if(this._bFocusAble&&this.pbEnabled&&this._eFocus){this._eFocus.focus();return true;}
return false;},onListClick:function(oEvent){this.focus();},onFocus:function(oEvent){if(!this._bHasFocus){df.WebList.base.onFocus.call(this,oEvent);}
this._bLozingFocus=false;},onBlur:function(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){df.WebList.base.onBlur.call(that,oEvent);that._bLozingFocus=false;}},100);},setHeight:function(iHeight){if(this._eBody){if(iHeight<=80){iHeight=80;}
if(this.peLabelPosition===df.ciLabelTop){iHeight-=this._eLbl.offsetHeight;}
iHeight-=this._eHead.offsetHeight;iHeight-=df.sys.gui.getVertBoxDiff(this._eBody);iHeight-=df.sys.gui.getVertBoxDiff(this._eBodyWrp);iHeight-=df.sys.gui.getVertBoxDiff(this._eInner);iHeight-=df.sys.gui.getVertBoxDiff(this._eControlWrp);this._eBody.style.height=iHeight+"px";this._eScrollbar.style.height=iHeight+"px";}},resize:function(){var iWidth,iScrollbarWidth;iScrollbarWidth=this._eBody.clientWidth-this._eTableWrp.clientWidth;if(iScrollbarWidth>0){this._eHead.style.paddingRight=iScrollbarWidth+"px";}
iWidth=this._eBodyWrp.clientWidth;iWidth-=df.sys.gui.getHorizBoxDiff(this._eBody);this._iTableWidth=iWidth;this.updateRowHeight();this.updateScrollSize();this.updatePosition((this._iTableHeight!==this._eTableWrp.clientHeight));this.updateHeader();this._iTableHeight=this._eTableWrp.clientHeight;}});

df.WebGrid=function WebGrid(sName,oParent){df.WebGrid.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbAllowInsertRow",true);this.prop(df.tBool,"pbAllowAppendRow",true);this._tNewRow=null;this._iCurrentColumn=null;this._iNewCurrentColumn=0;this._eEditCell=null;this._bCellEdit=false;this._bFocusEdit=true;this._bNewRowAppend=false;this._bGridRefresh=false;this._aOrigRow=null;this._iNewCount=0;this.pbAutoSearch=false;this._sControlClass="WebGrid";this._bRenderChildren=true;};df.defineClass("df.WebGrid","df.WebList",{renderChildren:function(){var i;for(i=0;i<this._aColumns.length;i++){this._aColumns[i].pbShowLabel=false;this._aColumns[i].render();this._aColumns[i].afterRender();if(this._aColumns[i].pbRender&&this._iCurrentColumn===null){this._iCurrentColumn=i;}}},insertRow:function(tRow,bTop){var iRow;df.WebGrid.base.insertRow.call(this,tRow,bTop);if(tRow&&tRow.sRowID===this.psCurrentRowID){iRow=this.findRowByRowId(this.psCurrentRowID);this.editCell(iRow,this._iCurrentColumn);}},removeTopRow:function(){if(this._eEditCell&&this._eEditCell.parentNode===this._eTable.rows[0]){if(this._bCellEdit){this._eEditCell.removeChild(this._aColumns[this._iCurrentColumn]._eElem);}
this._eEditCell=null;this._eFocus.focus();}
df.WebGrid.base.removeTopRow.call(this);},removeBottomRow:function(){if(this._eEditCell&&this._eEditCell.parentNode===this._eTable.rows[this._eTable.rows.length-1]){this._eEditCell.removeChild(this._aColumns[this._iCurrentColumn]._eElem);this._eEditCell=null;this._eFocus.focus();}
df.WebGrid.base.removeBottomRow.call(this);},refreshDisplay:function(){var iRow;if(this._eEditCell){if(this._bCellEdit){this._eEditCell.removeChild(this._aColumns[this._iCurrentColumn]._eElem);}
this._eEditCell=null;}
df.WebGrid.base.refreshDisplay.call(this);iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow>=this._iDispOffset&&iRow<this._iDispOffset+this.getDisplaySize()){this.editCell(iRow,this._iCurrentColumn);}},selectRow:function(sGotoRow,iRow,fOptHandler){var i,iNewRow,iPrevRow=this.findRowByRowId(this.psCurrentRowID),sPrevRowID=this.psCurrentRowID,tSelectRowData=null;if(sGotoRow==="new"){if(this._tNewRow){return false;}
this._tNewRow={sRowID:"",sClassName:"",aCells:[]};for(i=0;i<this._aColumns.length;i++){this._tNewRow.aCells.push({sValue:(this._aColumns[i].peDataType===df.ciTypeBCD?"0":""),sTooltip:"",aOptions:[]});}
if(!this.pbDataAware){tSelectRowData=this._tNewRow;}}
if(this.pbOfflineEditing&&iPrevRow>=0){this.updateCacheFromColumns(iPrevRow);}
df.WebGrid.base.selectRow.call(this,sGotoRow,iRow,function handleRowChangeGrid(bChanged){var bRefresh=false,tRow=null;if(sGotoRow==="first"&&this._bFirst){tRow=this._aCache[0];}else if(sGotoRow==="last"&&this._bLast){tRow=this._aCache[this._aCache.length-1];}else if(sGotoRow==="row"){tRow=this._aCache[iRow];}else if(sGotoRow==="new"){tRow=this._tNewRow;this._tNewRow=null;}
this._aOrigRow=df.sys.json.parse(df.sys.json.stringify(tRow));if(bChanged||this._iNewCurrentColumn!==this._iCurrentColumn){this.unEditCell(iPrevRow,this._iCurrentColumn,!bChanged);}
if(bChanged&&sPrevRowID===""&&iPrevRow>=0){if(this._aCache[iPrevRow]&&this._aCache[iPrevRow].sRowID===""){this._aCache.splice(iPrevRow,1);this.updateScrollSize();}
bRefresh=true;}
if(bChanged&&sGotoRow==="new"){if(this.pbOfflineEditing){this.set('psCurrentRowID',"");}
if(this._bNewRowAppend){if(this._bLast){this._aCache.push(tRow);this.updateScrollSize();this.scrollToCurrentRow();bRefresh=true;}else{this.loadCachePage("last",function(){this._aCache.push(tRow);this.updateScrollSize();this.scrollToCurrentRow();this.updatePosition(true);});}}else{this._aCache.splice(iPrevRow,0,tRow);this.updateScrollSize();bRefresh=true;}
if(this.pbOfflineEditing){this.updateColumnsFromCache(true);}}
if(bRefresh){if(this._iNewCurrentColumn!==this._iCurrentColumn){this._iCurrentColumn=this._iNewCurrentColumn;}
this.updatePosition(true);}else{if(bChanged||this._iNewCurrentColumn!==this._iCurrentColumn){this._iCurrentColumn=this._iNewCurrentColumn;iNewRow=this.findRowByRowId(this.psCurrentRowID);this.editCell(iNewRow,this._iCurrentColumn);}}
if(fOptHandler){fOptHandler.call(this,bChanged);}},tSelectRowData);},onBeforeCacheUpdate:function(){if(!this.pbDataAware){this.updateCacheFromColumns(this.findRowByRowId(this.psCurrentRowID));}},onAfterCacheUpdate:function(){if(!this.pbDataAware){this.updateColumnsFromCache(this._bGridRefresh);}
this._bGridRefresh=false;},gridRefresh:function(bFirst,bLast){this._bGridRefresh=true;df.WebGrid.base.gridRefresh.call(this,bFirst,bLast);},updateCacheFromColumns:function(iRow){var iCol,bChanged=false;if(!this.pbDataAware){if(iRow>=0){for(iCol=0;iCol<this._aColumns.length;iCol++){if(this._aColumns[iCol].get('pbChanged')){this._aCache[iRow].aCells[iCol].sValue=this._aColumns[iCol].get('psValue');bChanged=true;}}
if(bChanged&&this._aCache[iRow].sRowID===""){this._aCache[iRow].sRowID="new_"+(this._iNewCount++);this.psCurrentRowID=this._aCache[iRow].sRowID;}}}},editCell:function(iRow,iCol){var eElem,eCell,oCol=this._aColumns[iCol],iCell,bEdit,eFocus;iCell=this.colNrToCell(iCol);if(iRow>=this._iDispOffset&&iRow<this._iDispOffset+this.getDisplaySize()&&oCol&&iCell>=0){this._bCellEdit=bEdit=oCol._bCellEdit;eElem=oCol._eElem;oCol._bIgnoreOnChange=true;eCell=this._eTable.rows[iRow-this._iDispOffset].cells[iCell];if(eCell!==this._eEditCell){if(bEdit){eCell.innerHTML="";eCell.appendChild(eElem);}
df.dom.addClass(eCell,"WebGrid_EditCell");}
oCol.cellEdit();if(this._bHasFocus){if(oCol.pbEnabled){if(bEdit){oCol.focus();if(oCol instanceof df.WebColumn){oCol._eControl.select();}
if(df.sys.isIE){setTimeout(function(){if(oCol instanceof df.WebColumn){oCol._eControl.select();}},10);}}else{eFocus=df.dom.getFirstFocusChild(eCell);if(eFocus){eFocus.focus();}else{this._eFocus.focus();}}}else{this._eFocus.focus();}}
oCol._bIgnoreOnChange=false;this._eEditCell=eCell;}},unEditCell:function(iRow,iCol,bUpdate){var oCol,eCell,sVal,iCell,bEdit;oCol=this._aColumns[iCol];iCell=this.colNrToCell(iCol);bEdit=oCol._bCellEdit;if(bUpdate&&bEdit){sVal=oCol.get_psValue();this._aCache[iRow].aCells[iCol].sValue=sVal;}
if(iRow>=this._iDispOffset&&iRow<this._iDispOffset+this.getDisplaySize()&&this._eTable.rows.length>iRow-this._iDispOffset&&iCell>=0){oCol.cellUnEdit();this._bFocusEdit=false;this._eFocus.focus();eCell=this._eTable.rows[iRow-this._iDispOffset].cells[iCell];if(bEdit){if(oCol._eElem.parentNode){oCol._eElem.parentNode.removeChild(oCol._eElem);}}
eCell.innerHTML=this.cellHtml(oCol,this._aCache[iRow].aCells[iCol]);this._eEditCell=null;df.dom.removeClass(eCell,"WebGrid_EditCell");if(this._bHasFocus){this._eFocus.focus();}}},updateRow:function(sRowID){var tRow,iRow,eRow,aRows=this.deserializeVT(this._tActionData);if(aRows.length>0){tRow=aRows[0];iRow=this.findRowByRowId(sRowID);if(iRow>=0){if(sRowID===""&&tRow.sRowID===""){tRow.sRowID="new_"+(this._iNewCount++);if(this.psCurrentRowID===""){this.psCurrentRowID=tRow.sRowID;}}
tRow.bZebra=this._aCache[iRow].bZebra;this._aCache[iRow]=tRow;if(this.psCurrentRowID!==sRowID){if(iRow>=this._iDispOffset&&iRow<this._iDispOffset+this.getDisplaySize()){eRow=this._eTable.rows[iRow-this._iDispOffset];this.loopCols(function(oCol,iCol,bLast,iCount){if(eRow.cells[iCount]!==this._eEditCell){eRow.cells[iCount].innerHTML=this.cellHtml(oCol,tRow.aCells[iCol]);}});}}}}},removeRow:function(sRowID){var iRow,sGotoRow="row";iRow=this.findRowByRowId(sRowID);if(iRow>=0){this._aCache.splice(iRow,1);this.updateScrollSize();this.updatePosition(true);if(sRowID===this.psCurrentRowID){this.psCurrentRowID=null;if(iRow>=this._aCache.length){iRow--;if(iRow<0){if(this.pbAllowAppendRow){sGotoRow="new";}else{return;}}}
this.selectRow(sGotoRow,iRow,function(){this.focus();});}}else{throw new df.Error(999,"Could not find row to delete!",[],this);}},clearRow:function(sRowID){var iRow,iCol;if(sRowID===this.psCurrentRowID){iRow=this.findRowByRowId(sRowID);if(iRow>=0){for(iCol=0;iCol<this._aColumns.length;iCol++){if(this._aColumns[iCol].get('pbChanged')){this._aColumns[iCol].set('psValue',(this._aOrigRow&&this._aOrigRow.aCells[iCol].sValue)||"");this._aColumns[iCol].set('pbChanged',false);}}}}},updateCurrentCell:function(oCol,sVal){var iRow,iCol,iCell;iCol=this.findColNr(oCol);if(this._tNewRow&&this.psCurrentRowID===""){this._tNewRow.aCells[iCol].sValue=sVal;}else{iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow>=0){this._aCache[iRow].aCells[iCol].sValue=sVal;if(this._eTable&&iRow>=this._iDispOffset&&iRow<this._iDispOffset+this.getDisplaySize()){iCell=this.colNrToCell(iCol);if(iCell>=0&&iCol!==this._iCurrentColumn&&this._eTable.rows.length>iRow-this._iDispOffset){this._eTable.rows[iRow-this._iDispOffset].cells[iCell].innerHTML=this.cellHtml(oCol,this._aCache[iRow].aCells[iCol]);}}}}},processDataSet:function(eOperation){var iRow=this.findRowByRowId(this.psCurrentRowID);this.updateCacheFromColumns(iRow);df.WebGrid.base.processDataSet.call(this,eOperation);},prevCol:function(){var iRow,iCol,bPrevRow=false;iCol=this._iCurrentColumn;do{iCol--;if(iCol<0){if(bPrevRow){break;}
bPrevRow=true;iCol=this._aColumns.length-1;}}while(!this._aColumns[iCol].pbEnabled||!this._aColumns[iCol].pbRender);if(bPrevRow){iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow>0){this._iNewCurrentColumn=iCol;iRow--;this.selectRow("row",iRow,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});return true;}}else{this.selectCol(iCol);this.scrollToCurrentRow();return true;}
return false;},nextCol:function(){var iRow,iCol,bNextRow;iCol=this._iCurrentColumn;if(this._aColumns[iCol].validate&&this._aColumns[iCol].validate()){do{iCol++;if(iCol>=this._aColumns.length){if(bNextRow){break;}
bNextRow=true;iCol=0;}}while(!this._aColumns[iCol].pbEnabled||!this._aColumns[iCol].pbRender);if(bNextRow){iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow<this._aCache.length-1){iRow++;this._iNewCurrentColumn=iCol;this.selectRow("row",iRow,function(bChanged){if(bChanged){this.scrollToCurrentRow();}});return true;}
if(this._bLast){this._iNewCurrentColumn=iCol;return this.appendNewRow();}}else{this.selectCol(iCol);this.scrollToCurrentRow();return true;}
return false;}},selectCol:function(iCol){var iRow=this.findRowByRowId(this.psCurrentRowID);iCol=parseInt(iCol,10);if(iCol>=0&&iCol!==this._iCurrentColumn){if(this._iCurrentColumn>=0){this.unEditCell(iRow,this._iCurrentColumn,true);}
this._iCurrentColumn=iCol;this._iNewCurrentColumn=iCol;this.editCell(iRow,iCol);}},clearCache:function(){if(this._eEditCell){this._eEditCell.removeChild(this._aColumns[this._iCurrentColumn]._eElem);this._eEditCell=null;}
df.WebGrid.base.clearCache.call(this);},moveDownRow:function(){if(!df.WebGrid.base.moveDownRow.call(this)){if(this._bLast){this.appendNewRow();}}},insertNewRow:function(){if(this.pbAllowInsertRow){this._bNewRowAppend=false;this.selectRow("new",-1);return true;}
return this.appendNewRow();},appendNewRow:function(){if(this.pbAllowAppendRow){this._bNewRowAppend=true;this.selectRow("new",-1);return true;}
return false;},onTableClick:function(oEvent){var eElem=oEvent.getTarget(),iCol=-1,iRow;this._bHasFocus=true;while(eElem.parentNode&&eElem!==this._eBody){if(eElem.tagName==="TD"){iCol=this.cellToColNr(eElem.cellIndex);}else if(eElem.tagName==="TR"&&this._eTable.rows[eElem.rowIndex]===eElem){iRow=eElem.rowIndex+this._iDispOffset;if(iRow<this._aCache.length){this._aColumns[iCol].cellClick(oEvent,this._aCache[iRow].sRowID,this._aCache[iRow].aCells[iCol].sValue);this._iNewCurrentColumn=iCol;if(iRow!==this.findRowByRowId(this.psCurrentRowID)){this.selectRow("row",iRow,function(bChanged){});}else{if(iCol!==this._iCurrentColumn){this.selectCol(iCol);}}}else{if(this._bLast){this._iNewCurrentColumn=iCol;this.appendNewRow();}}
return;}
eElem=eElem.parentNode;}
if(this._bLast){this.appendNewRow();}},onKeyDown:function(oEvent){if(oEvent.matchKey(df.settings.gridKeys.prevCol)){if(this.prevCol()){oEvent.stop();return false;}}else if(oEvent.matchKey(df.settings.gridKeys.nextCol)){if(this.nextCol()){oEvent.stop();return false;}}else if(oEvent.matchKey(df.settings.gridKeys.newRow)){if(this.insertNewRow()){oEvent.stop();return false;}}else{return df.WebGrid.base.onKeyDown.call(this,oEvent);}
return true;},attachFocusEvents:function(){df.events.addDomListener("focus",this._eFocus,this.onFocusElemFocus,this);this._eFocus.tabIndex=-1;df.WebGrid.base.attachFocusEvents.call(this);},focus:function(){var oCol,iRow;if(this._bFocusAble&&this.pbEnabled&&this._eFocus){iRow=this.findRowByRowId(this.psCurrentRowID);if(iRow>=this._iDispOffset&&iRow<this._iDispOffset+this.getDisplaySize()){oCol=this._aColumns[this._iCurrentColumn];if(oCol.focus()){return true;}}
this._bFocusEdit=false;this._eFocus.focus();return true;}
return false;},onFocusElemFocus:function(oEvent){if(this._bFocusEdit){this.focus();}
this._bFocusEdit=true;}});

df.WebColumn_mixin=function WebColumn_mixin(sName,oParent){this.getBase("df.WebColumn_mixin").constructor.call(this,sName,oParent);if(!(oParent&&oParent instanceof df.WebList)){throw new df.Error(999,"WebColumn object '{{0}}' should be placed inside a WebList object. Consider wrapping your column with a list or grid object.",this,[this.getLongName()]);}
this.prop(df.tBool,"pbSortable",false);this.prop(df.tInt,"piWidth",0);this.prop(df.tString,"psCaption","");this.event("OnHeaderClick",df.cCallModeDefault);this._sCellClass="WebCol";this._bCellEdit=true;this._bIsColumn=true;};df.defineClass("df.WebColumn_mixin",{set_psValue:function(sVal){this.getBase("df.WebColumn_mixin").set_psValue.call(this,sVal);if(this._oParent instanceof df.WebGrid){this._oParent.updateCurrentCell(this,sVal);}},set_pbRender:function(bVal){var bCS=(this.pbRender!==bVal);this.getBase("df.WebColumn_mixin").set_pbRender.call(this,bVal);if(bCS){this.pbRender=bVal;this._oParent.redraw();}},set_pbEnabled:function(bVal){var bCS=(this.pbEnabled!==bVal);this.getBase("df.WebColumn_mixin").set_pbEnabled.call(this,bVal);if(bCS){this.pbEnabled=bVal;this._oParent.redraw();}},set_psCaption:function(sVal){this.psCaption=sVal;this._oParent.updateHeader();},set_psCSSClass:function(sVal){var bCS=(this.psCSSClass!==sVal);this.getBase("df.WebColumn_mixin").set_psCSSClass.call(this,sVal);if(bCS){this.psCSSClass=sVal;this._oParent.redraw();}},onKey:function(oEvent){if(this._oParent.onKeyDown(oEvent)){this.getBase("df.WebColumn_mixin").onKey.call(this,oEvent);}else{oEvent.e.cancelBubble=true;}},cellHtml:function(tCell){var tVal,sVal;tVal=this.serverToType(tCell.sValue);sVal=this.typeToDisplay(tVal);return(sVal!==''?sVal:'&nbsp;');},cellClick:function(oEvent,sRowId,sVal){},cellEdit:function(){},cellUnEdit:function(){},getTooltipElem:function(){var eElem=this._oParent.getColCell(this);if(!eElem){eElem=this._oParent.getColHead(this);}
return eElem;},getErrorElem:function(){return this.getTooltipElem();}});

df.WebColumnBase=df.mixin("df.WebColumn_mixin","df.WebForm");df.WebColumn=function WebColumn(sName,oParent){df.WebColumn.base.constructor.call(this,sName,oParent);this._sCellClass="WebCol";};df.defineClass("df.WebColumn","df.WebColumnBase",{});

df.WebColumnComboBase=df.mixin("df.WebColumn_mixin","df.WebCombo");df.WebColumnCombo=function WebColumnCombo(sName,oParent){df.WebColumnCombo.base.constructor.call(this,sName,oParent);this._sCellClass="WebColCombo";};df.defineClass("df.WebColumnCombo","df.WebColumnComboBase",{afterRender:function(){df.WebColumnCombo.base.afterRender.call(this);df.events.addDomListener("keypress",this._eControl,this.onKeyPress,this);},cellHtml:function(tCell){var i,sVal=tCell.sValue,tVal;for(i=0;i<this._aValues.length;i++){if(this._aValues[i].sV===sVal){return this._aValues[i].sD;}}
tVal=this.serverToType(sVal);sVal=this.typeToDisplay(tVal);return(sVal!==''?sVal:'&nbsp;');},onKeyPress:function(oEvent){var that=this;if(df.sys.isMoz){if(oEvent.matchKey(df.settings.listKeys.scrollUp)||oEvent.matchKey(df.settings.listKeys.scrollDown)){this._eControl.disabled=true;setTimeout(function(){that._eControl.disabled=!that.pbEnabled;},20);}}}});

df.WebColumnCheckboxBase=df.mixin("df.WebColumn_mixin","df.WebCheckbox");df.WebColumnCheckbox=function WebColumnCheckbox(sName,oParent){df.WebColumnCheckbox.base.constructor.call(this,sName,oParent);this._bTick=false;this._sCellClass="WebColCheckbox";this._sControlClass="WebCheckbox WebCheckboxColumn";};df.defineClass("df.WebColumnCheckbox","df.WebColumnCheckboxBase",{cellClick:function(oEvent,sRowId,sVal){var that=this,eTarget=oEvent.getTarget();df.WebColumnCheckbox.base.cellEdit.call(this,oEvent,sRowId,sVal);if(eTarget.tagName==="INPUT"){this._bTick=true;setTimeout(function(){that._bTick=false;},1000);}},cellEdit:function(){df.WebColumnCheckbox.base.cellEdit.call(this);if(this._bTick){this._bIgnoreOnChange=false;this.tick();this._bIgnoreOnChange=true;this._bTick=false;}},cellHtml:function(tCell){var aHtml=[];aHtml.push('<div class="',this.genClass(),'"><div class="WebCon_Inner"><div><input type="checkbox"');if(tCell.sValue===this.psChecked){aHtml.push(' onclick="this.checked = true" checked="checked"');}else{aHtml.push(' onclick="this.checked = false"');}
if(!this.pbEnabled){aHtml.push(' disabled="disabled"');}
if(!(this._oParent instanceof df.WebGrid)){aHtml.push(' tabindex="-1""');}
aHtml.push('></div></div></div>');return aHtml.join('');}});

df.WebColumnDateBase=df.mixin("df.WebColumn_mixin","df.WebDateForm");df.WebColumnDate=function WebColumnDate(sName,oParent){df.WebColumnDate.base.constructor.call(this,sName,oParent);this._sCellClass="WebCol";};df.defineClass("df.WebColumnDate","df.WebColumnDateBase",{});

df.WebColumnButtonBase=df.mixin("df.WebColumn_mixin","df.WebBaseDEO");df.WebColumnButton=function WebColumnButton(sName,oParent){df.WebColumnButton.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbDynamic",false);this.event("OnClick",df.cCallModeDefault);this._sControlClass="";this._sCellClass="WebColBtn";this._bCellEdit=false;};df.defineClass("df.WebColumnButton","df.WebColumnButtonBase",{openHtml:function(aHtml){df.WebColumnButton.base.openHtml.call(this,aHtml);aHtml.push('<div>');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebColumnButton.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div");df.WebColumnButton.base.afterRender.call(this);},getControlValue:function(){return this.psValue;},cellClick:function(oEvent,sRowId,sVal){var eBtn=oEvent.getTarget();if(eBtn.tagName==="BUTTON"&&eBtn.hasAttribute("data-dfbtnid")){this.fire("OnClick",[eBtn.getAttribute("data-dfbtnid"),sRowId]);return true;}
return false;},cellHtml:function(tCell){var i,iBtns,aDetails,aButtons,aHtml=[];if(this.pbDynamic){aButtons=tCell.aOptions;for(i=0;i<aButtons.length;i+=3){if(aButtons[i]){aHtml.push('<button data-dfbtnid="',aButtons[i],'" class="',aButtons[i+1],'">',aButtons[i+2],'</button>');}}}else{aHtml.push('<button data-dfbtnid="DEFAULT">',this.psButtonCaption,'</button>');}
return aHtml.join('');},focus:function(){var eBtn;if(this._bFocusAble&&this.pbEnabled&&this._eControl&&this._eControl.focus){eBtn=df.dom.query(this._eControl,"button");if(eBtn){eBtn.focus();return true;}}
return false;}});

df.WebColumnImageBase=df.mixin("df.WebColumn_mixin","df.WebBaseDEO");df.WebColumnImage=function WebColumnImage(sName,oParent){df.WebColumnImage.base.constructor.call(this,sName,oParent);this.event("OnClick",df.cCallModeDefault);this.prop(df.tBool,"pbImageByCSS",false);this.prop(df.tBool,"pbDynamic",false);this.prop(df.tString,"psImageUrl","");this.prop(df.tString,"psImageCSSClass","");this.prop(df.tInt,"piImageWidth",0);this.prop(df.tInt,"piImageHeight",0);this._sControlClass="";this._sCellClass="WebColBtn";this._bCellEdit=false;};df.defineClass("df.WebColumnImage","df.WebColumnImageBase",{openHtml:function(aHtml){df.WebColumnButton.base.openHtml.call(this,aHtml);aHtml.push('<div>');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebColumnButton.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div");df.WebColumnButton.base.afterRender.call(this);},set_psImageUrl:function(sVal){this.psImageUrl=sVal;this._oParent.redraw();},getControlValue:function(){return this.psValue;},cellClick:function(oEvent,sRowId,sVal){var eImg=oEvent.getTarget();if(eImg.tagName==="IMG"&&eImg.hasAttribute("data-dfimg")){this.fire("OnClick",[eImg.getAttribute("data-dfimg"),sRowId]);return true;}
return false;},cellHtml:function(tCell){var i,aImages,aHtml=[],sStyle="";if(this.piImageWidth>0){sStyle+="width: "+this.piImageWidth+"px";}
if(this.piImageHeight>0){sStyle+="height: "+this.piImageHeight+"px";}
if(this.pbDynamic){aImages=tCell.aOptions;for(i=0;i<aImages.length;i++){if(aImages[i]){if(this.pbImageByCSS){aHtml.push('<span style="',sStyle,'" class="',aImages[i],'" data-dfimg="',aImages[i],'"></span>');}else{aHtml.push('<img style="',sStyle,'" src="',aImages[i],'" data-dfimg="',aImages[i],'">');}}}}else{if(this.pbImageByCSS){aHtml.push('<span style="',sStyle,'" class="',this.psImageCSSClass,'" data-dfimg="',this.psImageUrl,'"></span>');}else{aHtml.push('<img style="',sStyle,'" src="',this.psImageUrl,'" data-dfimg="',this.psImageUrl,'">');}}
return aHtml.join('');}});

df.WebColumnLinkBase=df.mixin("df.WebColumn_mixin","df.WebBaseDEO");df.WebColumnLink=function WebColumnLink(sName,oParent){df.WebColumnLink.base.constructor.call(this,sName,oParent);this.event("OnClick",df.cCallModeDefault);this._sControlClass="WebColLink";this._sCellClass="WebColLink";this._bCellEdit=false;};df.defineClass("df.WebColumnLink","df.WebColumnLinkBase",{openHtml:function(aHtml){df.WebColumnLink.base.openHtml.call(this,aHtml);aHtml.push('<a href="#">');},closeHtml:function(aHtml){aHtml.push('</a>');df.WebColumnLink.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"a");df.WebColumnLink.base.afterRender.call(this);},getControlValue:function(){return this.psValue;},cellClick:function(oEvent,sRowId,sVal){if(oEvent.getTarget().tagName==="A"){this.fire("OnClick",[sRowId,sVal]);return true;}
return false;},cellHtml:function(tCell){return('<a href="#">'+df.WebColumnLink.base.cellHtml.call(this,tCell)+'</a>');},onKey:function(oEvent){oEvent.e.cancelBubble=true;if(oEvent.matchKey(df.settings.formKeys.submit)){this.cellClick(oEvent,this._oParent.psCurrentRowId,this.psValue);}else{df.WebColumnLink.base.onKey.call(this,oEvent);}}});

df.WebCommandBar=function WebCommandBar(oDef,oParent){df.WebCommandBar.base.constructor.call(this,oDef,oParent);this.prop(df.tInt,"peRegion",df.ciTopRegion);this._eSizer=null;this._bWrapDiv=true;this._bRenderChildren=true;this._sControlClass="WebCommandBar";};df.defineClass("df.WebCommandBar","df.WebBaseUIObject",{openHtml:function(aHtml){df.WebCommandBar.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebCmd_Sizer">');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebCommandBar.base.closeHtml.call(this,aHtml);},renderChildren:function(eContainer){var i,eChild,oChild,eToolWrap;this._eSizer=df.dom.query(this._eElem,"div.WebCmd_Sizer");for(i=0;i<this._aChildren.length;i++){oChild=this._aChildren[i];if(oChild instanceof df.WebBaseUIObject){eChild=oChild.render();if(oChild instanceof df.WebToolBar){if(!eToolWrap){eToolWrap=df.dom.create('<div class="WebCmd_ToolWrap"></div>');this._eSizer.appendChild(eToolWrap);}
eToolWrap.appendChild(eChild);}else{eToolWrap=null;this._eSizer.appendChild(eChild);}}}},prepareSize:function(){this._bStretch=false;if(this._eSizer){this._iWantedHeight=this._eSizer.scrollHeight;}
return this._iWantedHeight;},setOuterHeight:function(iHeight){if(this._eElem){this._eElem.style.height=iHeight+"px";}}});

df.WebMenuBar=function WebMenuBar(oDef,oParent){df.WebMenuBar.base.constructor.call(this,oDef,oParent);this._eControl=null;this._bWrapDiv=true;this._bRenderChildren=true;this._sControlClass="WebMenuBar";};df.defineClass("df.WebMenuBar","df.WebBaseUIObject",{openHtml:function(aHtml){df.WebMenuBar.base.openHtml.call(this,aHtml);aHtml.push('<ul>');},closeHtml:function(aHtml){aHtml.push('</ul>');aHtml.push('<div style="clear: both"></div>');df.WebMenuBar.base.closeHtml.call(this,aHtml);},renderChildren:function(eContainer){this._eControl=df.dom.query(this._eElem,"ul");df.WebMenuBar.base.renderChildren.call(this,this._eControl);}});

df.WebToolBar=function WebToolBar(oDef,oParent){df.WebToolBar.base.constructor.call(this,oDef,oParent);this.prop(df.tBool,"pbShowCaption",false);this._eControl=null;this._bWrapDiv=true;this._bRenderChildren=true;this._sControlClass="WebToolBar";};df.defineClass("df.WebToolBar","df.WebBaseUIObject",{openHtml:function(aHtml){df.WebToolBar.base.openHtml.call(this,aHtml);aHtml.push('<ul>');},closeHtml:function(aHtml){aHtml.push('</ul>');aHtml.push('<div style="clear: both;"></div>');df.WebToolBar.base.closeHtml.call(this,aHtml);},renderChildren:function(eContainer){this._eControl=df.dom.query(this._eElem,"ul");df.WebToolBar.base.renderChildren.call(this,this._eControl);},afterRender:function(){df.WebToolBar.base.afterRender.call(this);this.set_pbShowCaption(this.pbShowCaption);},set_pbShowCaption:function(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebTlb_HideCaption",!bVal);}}});

df.WebMenuItem=function WebMenuItem(oDef,oParent){df.WebMenuItem.base.constructor.call(this,oDef,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tString,"psTextColor","");this.prop(df.tBool,"pbBeginGroup",false);this.prop(df.tString,"psImage","");this.prop(df.tString,"psToolTip","");this.event("OnClick",df.cCallModeWait);this.prop(df.tString,"psLoadViewOnClick","");this._eSubMenu=null;this._eIcon=null;this._eWrap=null;this._bChildMenu=false;this._bRenderChildren=true;this._bWrapDiv=false;this._sControlClass="WebMenuItem";this._tHideTimout=null;this._bSubShown=false;};df.defineClass("df.WebMenuItem","df.WebBaseUIObject",{openHtml:function(aHtml){df.WebMenuItem.base.openHtml.call(this,aHtml);aHtml.push('<li class="',this.genClass(),'"');aHtml.push(' style=" ',(this.pbRender?'':'display: none;'),(this.pbVisible?'':'visibility: hidden;'),'"');aHtml.push('><div><span class="WebItm_Icon">&nbsp;</span><a href="javascript: df.sys.nothing();">nbsp;</a></div>');if(this._bChildMenu){aHtml.push('<ul style="display: none">');}},closeHtml:function(aHtml){if(this._bChildMenu){aHtml.push('</ul>');}
aHtml.push('</li>');df.WebMenuItem.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"a");this._eIcon=df.dom.query(this._eElem,"div > span.WebItm_Icon");df.WebMenuItem.base.afterRender.call(this);df.events.addDomListener("click",this._eElem,this.onItemClick,this);if(this._bChildMenu){df.events.addDomListener("mouseover",this._eElem,this.onMouseOver,this);df.events.addDomListener("mouseout",this._eElem,this.onMouseOut,this);}
df.dom.disableTextSelection(this._eElem);this.set_psCaption(this.psCaption);this.set_pbBeginGroup(this.pbBeginGroup);this.set_psImage(this.psImage);this.set_psToolTip(this.psToolTip);},renderChildren:function(eContainer){this._eSubMenu=df.dom.query(this._eElem,"ul");df.WebMenuItem.base.renderChildren.call(this,this._eSubMenu);},onItemClick:function(oEvent){if(this.pbEnabled){this.fire('OnClick',[],function(oEvent){if(!oEvent.bCancelled){if(this.psLoadViewOnClick){this.getWebApp().showView(this.psLoadViewOnClick);}}
this.getWebApp().returnFocus();});this.getWebApp().returnFocus();if(this._oParent instanceof df.WebMenuItem){this._oParent.hideSub(true);}}
oEvent.stop();},onMouseOver:function(oEvent){if(this.pbEnabled){this.showSub();}},onMouseOut:function(oEvent){var that=this;this._tHideTimout=setTimeout(function(){that._tHideTimout=null;that.hideSub();},500);},hideSub:function(bParent){if(this._eSubMenu){if(this._tHideTimout){clearTimeout(this._tHideTimout);this._tHideTimout=null;}
this._bSubShown=false;df.dom.removeClass(this._eElem,"WebItm_Expanded");this._eSubMenu.style.display="none";if(bParent){if(this._oParent instanceof df.WebMenuItem){this._oParent.hideSub(true);}}}},showSub:function(){if(this._eSubMenu){if(this._tHideTimout){clearTimeout(this._tHideTimout);this._tHideTimout=null;}
if(!this._bSubShown){this.hideSiblings();}
this._bSubShown=true;df.dom.addClass(this._eElem,"WebItm_Expanded");this._eSubMenu.style.display="block";}},show:function(){var oItem=this;while(oItem&&oItem instanceof df.WebMenuItem){oItem.showSub();oItem=oItem._oParent;}},hide:function(){var oItem=this;while(oItem&&oItem instanceof df.WebMenuItem){if(!oItem._tHideTimout){oItem.hideSub();}
oItem=oItem._oParent;}},hideSiblings:function(){var i,aSiblings;if(this._oParent){aSiblings=this._oParent._aChildren||[];for(i=0;i<aSiblings.length;i++){if(aSiblings[i]instanceof df.WebMenuItem){aSiblings[i].hideSub();}}}},set_psCaption:function(sVal){if(this._eControl){sVal=sVal.replace("&","");df.dom.setText(this._eControl,sVal);}},set_psToolTip:function(sVal){if(this._eControl){this._eElem.title=sVal;}},set_pbBeginGroup:function(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebItm_BgnGroup",bVal);}},set_psImage:function(sVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebItm_HasIcon",sVal);this._eIcon.style.backgroundImage=(sVal?"url('"+sVal+"')":"");}},genClass:function(){var sClass=df.WebMenuItem.base.genClass.call(this);if(this._bChildMenu){sClass+=" WebItm_HasSub";}
return sClass;},addChild:function(oChild){if(oChild instanceof df.WebMenuItem){this._bChildMenu=true;}
df.WebMenuItem.base.addChild.call(this,oChild);}});

df.WebCardContainer=function WebCardContainer(sName,oParent){df.WebCardContainer.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbFillHeight",false);this.prop(df.tInt,"piMinHeight",0);this.prop(df.tInt,"piHeight",0);this.prop(df.tBool,"pbShowBorder",false);this.prop(df.tBool,"pbShowCaption",false);this.prop(df.tString,"psCurrentCard","");this.addSync("psCurrentCard");this.event("OnCardChange",df.cCallModeWait);this._iHeightSet=null;this._aCards=[];this._eHead=null;this._oCurrent=null;this._bRendered=false;this._bWrapDiv=true;this._bRenderChildren=true;this._sControlClass="WebCardContainer";this._sCardClass="WebCC";};df.defineClass("df.WebCardContainer","df.WebBaseControl",{openHtml:function(aHtml){var i;df.WebCardContainer.base.openHtml.call(this,aHtml);aHtml.push('<div class="',this._sCardClass,'_LabelSpacer" style="',(this.pbShowCaption?'':'display: none'),'"><label></label></div>');aHtml.push('<div class="',this._sCardClass,'_Head">');for(i=0;i<this._aCards.length;i++){this._aCards[i].tabButtonHtml(aHtml);}
aHtml.push('<div style="clear: both"></div></div>');aHtml.push('<div class="',this._sCardClass,'_Body ',(this.pbShowBorder?'WebCC_BodyBorder':'WebCC_BodyNoBorder'),(this.pbShowCaption?' WebCC_HasCaption':''),'" style="overflow: hidden">');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebCardContainer.base.closeHtml.call(this,aHtml);},afterRender:function(){var i,oTab,aButtons,oSelectTab=this._oCurrent;this._eHead=df.dom.query(this._eElem,'div.'+this._sCardClass+'_Head');this._eLabelSpacer=df.dom.query(this._eElem,'div.'+this._sCardClass+'_LabelSpacer');this._eLabel=df.dom.query(this._eElem,'div.'+this._sCardClass+'_LabelSpacer > label');aButtons=df.dom.query(this._eElem,'div.'+this._sCardClass+'_Head > div.WebTab_Btn',true);for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(!oSelectTab&&oTab.canShow()){oSelectTab=oTab;}
if(i<aButtons.length){oTab._eBtn=aButtons[i];}}
df.WebCardContainer.base.afterRender.call(this);this.showCard(oSelectTab,true);this._bRendered=true;},renderChildren:function(eRenderTo){eRenderTo=this._eControl=df.dom.query(this._eElem,'div.'+this._sCardClass+'_Body');df.WebCardContainer.base.renderChildren.call(this,eRenderTo);},addChild:function(oChild){if(oChild instanceof df.WebCard){this._aCards.push(oChild);}else if(oChild instanceof df.WebBaseUIObject){throw new df.Error(999,"WebCardContainer objects cannot have controls as direct children '{{0}}'. Consider placing them within a WebCard.",this,[(oChild.getLongName()||'oWebApp')]);}
df.WebCardContainer.base.addChild.call(this,oChild);},afterShow:function(){if(this._oCurrent){this._oCurrent.afterShow();}},afterHide:function(){if(this._oCurrent){this._oCurrent.afterHide();}},getNaturalHeight:function(){var iHeight=0,i,iTab;for(i=0;i<this._aCards.length;i++){if(this._aCards[i].pbRender){iTab=this._aCards[i].getRequiredHeight();if(iTab>iHeight){iHeight=iTab;}}}
iHeight+=this.getHeightDiff();return iHeight;},sizeHeight:function(iExtHeight){var iHeight=-1;if(this.pbFillHeight){iHeight=iExtHeight;}else{if(this.piHeight>0){iHeight=this.piHeight;}else{iHeight=this.getNaturalHeight();}}
if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;}
this.setHeight(iHeight);if(iHeight>0){return iHeight;}},setHeight:function(iHeight){if(this._eControl){if(iHeight>0){if(this.peLabelPosition===df.ciLabelTop){iHeight-=this._eLbl.offsetHeight;}
iHeight-=this.getHeightDiff();this._eControl.style.height=iHeight+"px";}}},resize:function(){var i;if(this._eElem&&this._bRendered){for(i=0;i<this._aCards.length;i++){if(this._aCards[i]._eElem){this._aCards[i].resizeHorizontal();this._aCards[i].resizeVertical();}}
if(!this.pbFillHeight){this.sizeHeight(-1);}}},getHeightDiff:function(){var iHeight=0;if(this._eHead){iHeight+=this._eHead.clientHeight;iHeight+=df.sys.gui.getVertBoxDiff(this._eHead,1);}
if(this.pbShowCaption&&this._eLabelSpacer){iHeight+=this._eLabelSpacer.clientHeight;iHeight+=df.sys.gui.getVertBoxDiff(this._eHead,1);}
if(this._eControl){iHeight+=df.sys.gui.getVertBoxDiff(this._eControl);iHeight+=df.sys.gui.getVertBoxDiff(this._eInner);iHeight+=df.sys.gui.getVertBoxDiff(this._eControlWrp);}
return iHeight;},getMinHeight:function(){var iHeight=0;this.resize();iHeight=this.getNaturalHeight();if(iHeight<this.piMinHeight){iHeight=this.piMinHeight;}
return iHeight;},attachFocusEvents:function(){if(window.addEventListener){df.events.addDomCaptureListener("focus",this._eHead,this.onFocus,this);df.events.addDomCaptureListener("blur",this._eHead,this.onBlur,this);}else{df.events.addDomListener("focusin",this._eHead,this.onFocus,this);df.events.addDomListener("focusout",this._eHead,this.onBlur,this);}},focus:function(bOptSelect){var i;for(i=0;i<this._aChildren.length;i++){if(this._aChildren[i].focus){if(this._aChildren[i].focus(bOptSelect)){return true;}}}
return false;},onFocus:function(oEvent){if(!this._bHasFocus){df.WebCardContainer.base.onFocus.call(this,oEvent);}
this._bLozingFocus=false;},onBlur:function(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){df.WebCardContainer.base.onBlur.call(that,oEvent);that._bLozingFocus=false;}},100);},showCard:function(oDisplay,bOptFirst){var i,oTab;if(this.pbEnabled||bOptFirst){if(oDisplay&&oDisplay.canShow()){if(!bOptFirst&&oDisplay!==this._oCurrent){this.fireCardChange(oDisplay._sName,(this._oCurrent&&this._oCurrent._sName)||"");}
if(this._eElem){for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(oTab===oDisplay){oTab._show(!!bOptFirst);df.dom.setText(this._eLabel,oTab.psCaption);}else{oTab._hide(!!bOptFirst);}}}
if(!bOptFirst&&this._oCurrent){this._oCurrent.afterHide();}
this._oCurrent=oDisplay;if(!bOptFirst){this._oCurrent.afterShow();}
if(this.getWebApp()){this.getWebApp().notifyLayoutChange(this);}}}},fireCardChange:function(sTo,sFrom){this.fire('OnCardChange',[sTo,sFrom]);},hideCard:function(oHide){var i,oTab,oLast=null,bFound=false;if(oHide===this._oCurrent){for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(oTab.canShow()){if(bFound){this.showCard(oTab);return;}
oLast=oTab;}
if(oTab===oHide){bFound=true;}}
this.showCard(oLast);}},nextCard:function(){var i,bFound=false,oTab;for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(!bFound){bFound=(oTab===this._oCurrent);}else{if(oTab.canShow()){this.showCard(oTab);return;}}}},previousCard:function(){var i,bFound=false,oTab;for(i=this._aCards.length-1;i>=0;i--){oTab=this._aCards[i];if(!bFound){bFound=(oTab===this._oCurrent);}else{if(oTab.canShow()){this.showCard(oTab);return;}}}},get_psCurrentCard:function(){return(this._oCurrent&&this._oCurrent.getLongName())||"";},set_pbShowBorder:function(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebCC_BodyBorder",bVal);df.dom.toggleClass(this._eControl,"WebCC_BodyNoBorder",!bVal);this.sizeChanged();}},set_pbShowCaption:function(bVal){if(this._eLabel){this._eLabelSpacer.style.display=(bVal?'':'none');df.dom.toggleClass(this._eControl,"WebCC_HasCaption",bVal);this.sizeChanged();}}});

df.WebCard=function WebCard(sName,oParent){df.WebCard.base.constructor.call(this,sName,oParent);if(!(oParent&&oParent instanceof df.WebCardContainer)){throw new df.Error(999,"WebCard object '{{0}}' should be placed inside a WebCardContainer object. Consider wrapping your card with a card container.",this,[this.getLongName()]);}
this.prop(df.tString,"psCaption","");this.event("OnShow",df.cCallModeDefault);this.event("OnHide",df.cCallModeDefault);this._eBtn=null;this._eLbl=null;this._bCurrent=false;this._sControlClass="WebCard";this._bWrapDiv=true;};df.defineClass("df.WebCard","df.WebBaseContainer",{tabButtonHtml:function(aHtml){aHtml.push('<div class="WebTab_Btn ',(this.pbEnabled?'WebTab_Enabled':'WebTab_Disabled'),'" style="',(!this.pbRender||!this.pbVisible?'display: none;':''),'" ',(!this.pbEnabled?'tabindex="-1"':'tabindex="0"'),'><span><label>&nbsp;</label></span></div>');},afterRender:function(){this._eLbl=df.dom.query(this._eBtn,'span > label');df.WebCard.base.afterRender.call(this);df.events.addDomListener("click",this._eLbl,this.onBtnClick,this);df.events.addDomListener("click",this._eBtn,this.onBtnClick,this);df.events.addDomKeyListener(this._eBtn,this.onBtnKey,this);this.set_psCaption(this.psCaption);},attachFocusEvents:function(){if(window.addEventListener){df.events.addDomCaptureListener("focus",this._eBtn,this.onBtnFocus,this);df.events.addDomCaptureListener("blur",this._eBtn,this.onBtnBlur,this);}else{df.events.addDomListener("focusin",this._eBtn,this.onBtnFocus,this);df.events.addDomListener("focusout",this._eBtn,this.onBtnBlur,this);}},prepareSize:function(){var iResult=df.WebCard.base.prepareSize.call(this);this._bStretch=true;return iResult;},onBtnClick:function(oEvent){this.show();oEvent.stop();},onBtnKey:function(oEvent){if(this.pbEnabled){if(oEvent.matchKey(df.settings.tabKeys.enter)){this.show();oEvent.stop();}}},onBtnFocus:function(oEvent){df.dom.addClass(this._eBtn,"WebTab_Focus");},onBtnBlur:function(oEvent){df.dom.removeClass(this._eBtn,"WebTab_Focus");},canShow:function(){return this.pbRender&&this.pbVisible&&this.pbEnabled;},_hide:function(bFirst){if(this._eElem){this._eElem.style.visibility="hidden";df.dom.removeClass(this._eBtn,"WebTab_Current");}
if(!bFirst&&this._bCurrent){this.fire('OnHide');}
this._bCurrent=false;},_show:function(bFirst){if(this._eElem){if(this._eElem.parentNode.firstChild&&this._eElem!==this._eElem.parentNode.firstChild){this._eElem.parentNode.insertBefore(this._eElem,this._eElem.parentNode.firstChild);}
this._eElem.style.visibility="inherit";df.dom.addClass(this._eBtn,"WebTab_Current");}
if(!bFirst&&!this._bCurrent){this.fire('OnShow');}
this._bCurrent=true;},show:function(){if(this.pbEnabled){this._oParent.showCard(this);}},set_pbEnabled:function(bVal){if(this._eBtn){df.dom.toggleClass(this._eBtn,"WebTab_Disabled",!bVal);df.dom.toggleClass(this._eBtn,"WebTab_Enabled",bVal);this._eLbl.tabIndex=(bVal?0:-1);}},set_psCaption:function(sVal){if(this._eLbl){df.dom.setText(this._eLbl,sVal);}},set_pbVisible:function(bVal){if(this._eBtn){this._eBtn.style.display=(bVal&&this.pbRender?'':'none');this.pbVisible=bVal;if(!bVal){if(this._bCurrent){this._oParent.hideCard(this);}}else{if(!this._oParent._oCurrent){this._oParent.showCard(this);}}}},set_pbRender:function(bVal){if(this._eBtn){this._eBtn.style.display=(bVal&&this.pbVisible?'':'none');if(this.pbRender!==bVal){this.pbRender=bVal;if(!bVal){if(this._bCurrent){this._oParent.hideCard(this);}}else{if(!this._oParent._oCurrent){this._oParent.showCard(this);}}}}},set_psTextColor:function(sVal){if(this._eLbl){this._eLbl.style.color=sVal||'';}
df.WebCard.base.set_psTextColor.call(this,sVal);},set_psBackgroundColor:function(sVal){if(this._eBtn){this._eBtn.style.backgroundColor=sVal||'';}
df.WebCard.base.set_psBackgroundColor.call(this,sVal);}});

df.WebTabContainer=function WebTabContainer(sName,oParent){df.WebTabContainer.base.constructor.call(this,sName,oParent);this._sControlClass="WebTabContainer";this._sCardClass="WebTbc";};df.defineClass("df.WebTabContainer","df.WebCardContainer",{openHtml:function(aHtml){this.pbShowCaption=false;this.pbShowBorder=false;df.WebTabContainer.base.openHtml.call(this,aHtml);},addChild:function(oChild){if(oChild instanceof df.WebBaseUIObject&&!(oChild instanceof df.WebCard)){throw new df.Error(999,"WebTabContainer objects cannot have controls as direct children '{{0}}'. Consider placing them within a WebTabPage.",this,[(oChild.getLongName()||'oWebApp')]);}
df.WebTabContainer.base.addChild.call(this,oChild);},set_pbShowCaption:function(bVal){},set_pbShowBorder:function(bVal){},focus:function(){var i,oTab;if(this._bFocusAble&&this.pbEnabled&&this._eElem){for(i=0;i<this._aCards.length;i++){oTab=this._aCards[i];if(oTab.canShow()&&oTab._eBtn){oTab._eBtn.focus();return true;}}}
return false;}});

df.WebTabPage=function WebTabPage(sName,oParent){if(!(oParent&&oParent instanceof df.WebCardContainer)){this._sName=sName;this._oParent=oParent;throw new df.Error(999,"WebTabPage object '{{0}}' should be placed inside a WebTabContainer object. Consider wrapping your tab page with a tab container.",this,[this.getLongName()]);}
df.WebTabPage.base.constructor.call(this,sName,oParent);this._sControlClass="WebTabPage";};df.defineClass("df.WebTabPage","df.WebCard",{});

df.WebDatePicker=function WebDatePicker(oDef,oParent){df.WebDatePicker.base.constructor.call(this,oDef,oParent);this.prop(df.tBool,"pbShowWeekNr",true);this.prop(df.tBool,"pbShowToday",true);this.prop(df.tInt,"piStartWeekAt",1);this.event("OnDateClick",df.cCallModeWait);this._oPicker=null;this._ePicker=null;this._sControlClass="WebDatePicker";};df.defineClass("df.WebDatePicker","df.WebBaseDEO",{openHtml:function(aHtml){if(!this._oPicker){this._oPicker=new df.DatePicker();this._oPicker._oParent=this;}
df.WebDatePicker.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebDatePicker_FocusHolder" tabindex="0">');this._oPicker.openHtml(aHtml);},closeHtml:function(aHtml){this._oPicker.closeHtml(aHtml);df.WebDatePicker.base.closeHtml.call(this,aHtml);aHtml.push('</div>');},afterRender:function(){this._ePicker=df.dom.query(this._eElem,"div.WebDP");this._eFocus=df.dom.query(this._eElem,"div.WebDatePicker_FocusHolder");df.WebDatePicker.base.afterRender.call(this);this.set_pbEnabled(this.pbEnabled);this._oPicker._eElem=this._ePicker;this._oPicker._eFocus=this._eFocus;this._oPicker.afterRender();this._oPicker.onChange.addListener(this.onChange,this);this._oPicker.onDateClick.addListener(this.onDateClick,this);df.events.addDomListener("focus",this._eFocus,this.onFocus,this);df.events.addDomListener("blur",this._eFocus,this.onBlur,this);},render:function(){if(!this._oPicker){this._oPicker=new df.DatePicker();this._oPicker._oParent=this;this._oPicker._eFocus=this._eFocus;}
this._oPicker.pbShowWeekNr=this.pbShowWeekNr;this._oPicker.pbShowToday=this.pbShowToday;this._oPicker.piStartWeekAt=this.piStartWeekAt;if(this.psMask){this._oPicker.psMask=this.psMask;}else{this._oPicker.psMask=this.getWebApp().psDateFormat;}
return df.WebDatePicker.base.render.call(this);},refreshDisplay:function(tVal){if(this._oPicker&&(this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime)){this._oPicker.setSelectedDate(tVal,true,false);}},updateTypeVal:function(){if(this._oPicker&&(this.peDataType===df.ciTypeDate||this.peDataType===df.ciTypeDateTime)){this._tValue=this._oPicker.getSelectedDate();}},set_pbEnabled:function(bVal){df.WebDateForm.base.set_pbEnabled.call(this,bVal);if(this._eFocus){this._eFocus.tabIndex=(bVal?0:-1);}},onDateClick:function(oEvent){this.fire("OnDateClick",[this.get('psValue')]);},focus:function(){if(this._bFocusAble&&this.pbEnabled&&this._eFocus){this._eFocus.focus();this._bLozingFocus=false;return true;}
return false;},onFocus:function(oEvent){if(this._bFocusAble&&this.pbEnabled&&this._eFocus){this.getWebApp().objFocus(this);if(this._eElem){df.dom.addClass(this._eElem,"WebCon_Focus");}
if(this._oPicker&&this._oPicker._eElem){df.dom.addClass(this._oPicker._eElem,"WebCon_Focus");}
this._bHasFocus=true;this._bLozingFocus=false;}},onBlur:function(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){df.WebDatePicker.base.onBlur.call(that,oEvent);if(that._oPicker&&that._oPicker._eElem){df.dom.removeClass(that._oPicker._eElem,"WebCon_Focus");}
that._bLozingFocus=false;}},100);}});

df.tWebTreeItem={sId:df.tString,sParentId:df.tString,sName:df.tString,sAltText:df.tString,sValue:df.tString,sCSSClass:df.tString,sIcon:df.tString,bFolder:df.tBool,bLoadChildren:df.tBool,bExpanded:df.tBool};df.WebTreeView=function WebTreeView(sName,oParent){df.WebTreeView.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbShowIcons",true);this.prop(df.tString,"psSelectedId","");this.prop(df.tString,"psSelectedValue","");this.event("OnSelect",df.cCallModeWait);this._aRootItems=[];this._aItems=[];this._iAutoNum=1000;this._tSelectedNode=null;this._bRedraw=false;this._eRootTable=null;this._sControlClass="WebTreeView";};df.defineClass("df.WebTreeView","df.WebBaseControl",{openHtml:function(aHtml){df.WebTreeView.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebTree_Body" style="height: 10px;" tabindex="0">');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebTreeView.base.closeHtml.call(this,aHtml);},afterRender:function(){var that=this;this._eControl=df.dom.query(this._eElem,'div.WebTree_Body');this._eFocus=this._eControl;df.WebTreeView.base.afterRender.call(this);this.set_pbEnabled(this.pbEnabled);df.events.addDomListener("click",this._eControl,this.onBodyClick,this);df.events.addDomListener("dblclick",this._eControl,this.onBodyDblClick,this);df.events.addDomKeyListener(this._eElem,this.onKey,this);this.redraw();setTimeout(function(){if(that._tSelectedNode){that.scrollToElement(that._tSelectedNode._eElem);}},50);},get_psSelectedId:function(){if(this._tSelectedNode){return this._tSelectedNode.sId;}
return"";},get_psSelectedValue:function(){if(this._tSelectedNode){return this._tSelectedNode.sValue;}
return"";},set_pbEnabled:function(bVal){df.WebTreeView.base.set_pbEnabled.call(this,bVal);if(this._eFocus){this._eFocus.tabIndex=(bVal?0:-1);}},set_pbShowIcons:function(bVal){this.pbShowIcons=bVal;this.redraw();},select:function(sNodeId){var tNode=this.getNodeById(sNodeId);if(tNode){this.doSelect(tNode,false);}},expand:function(sNodeId){var tNode=this.getNodeById(sNodeId);if(tNode){this.expandNode(tNode);}},collapse:function(sNodeId){var tNode=this.getNodeById(sNodeId);if(tNode){this.collapseNode(tNode);}},collapseAll:function(){var i;for(i=0;i<this._aItems.length;i++){if(this._aItems[i].bExpanded){this.collapseNode(this._aItems[i]);}}},refresh:function(sParentId){var i,tNode,aNodes=this.deserializeVT(this._tActionData),sSelectedId;sSelectedId=this._tSelectedNode&&(this._tSelectedNode.sId||"");if(!sSelectedId&&this.psSelectedId){sSelectedId=this.psSelectedId;this.psSelectedId="";}
if(sParentId){tNode=this.getNodeById(sParentId);if(tNode){while(tNode._aChildren.length>0){this.doRemove(tNode._aChildren[0],true);}}}else{this.clear();this.displayLoading();}
for(i=0;i<aNodes.length;i++){tNode=this.initNode(aNodes[i]);if(!tNode.sParentId){tNode.sParentId=sParentId||"";}
this.insert(tNode);}
if(sSelectedId){tNode=this.getNodeById(sSelectedId);if(tNode){this._tSelectedNode=tNode;}}else{this._tSelectedNode=null;}
this.redraw();this.hideLoading();},updateNode:function(){var tNewNode,tOrigNode,aNodes=this.deserializeVT(this._tActionData);if(aNodes.length>0){tNewNode=this.initNode(aNodes[0]);tOrigNode=this.getNodeById(tNewNode.sId);if(tOrigNode){tOrigNode.sName=tNewNode.sName;tOrigNode.sAltText=tNewNode.sAltText;tOrigNode.sValue=tNewNode.sValue;tOrigNode.sCSSClass=tNewNode.sCSSClass;tOrigNode.sIcon=tNewNode.sIcon;tOrigNode.bFolder=tNewNode.bFolder;tOrigNode.bLoadChildren=tNewNode.bLoadChildren;this.redraw();}}},insertNode:function(){var tNewNode,aNodes=this.deserializeVT(this._tActionData);if(aNodes.length>0){tNewNode=this.initNode(aNodes[0]);this.insert(tNewNode);this.redraw();}},removeNode:function(sNodeId){var tNode=this.getNodeById(sNodeId);if(tNode){this.doRemove(tNode);this.redraw();}},deserializeVT:df.sys.vt.generateDeserializer([df.tWebTreeItem]),loadSubNodes:function(tParentNode){var sParentId="",sParentValue="",iParentLevel=0;if(tParentNode){tParentNode._bIsLoading=true;this.displayLoading(tParentNode);sParentId=tParentNode.sId;sParentValue=tParentNode.sValue;iParentLevel=this.getLevel(tParentNode);}else{this.clear();this.displayLoading();}
this.serverAction("LoadSubNodes",[sParentId,sParentValue,iParentLevel],null,function(oEvent){if(tParentNode){tParentNode._bIsLoading=false;this.updateNodeCSS(tParentNode);}
if(!oEvent.bError){if(tParentNode){tParentNode._bIsLoaded=true;this.expandNode(tParentNode);}else{this.redraw();}}
this.hideLoading(tParentNode);},this);},addSubItems:function(sParentId){var i,tNode,aNodes=this.deserializeVT(this._tActionData);for(i=0;i<aNodes.length;i++){tNode=this.initNode(aNodes[i]);if(!tNode.sParentId){tNode.sParentId=sParentId||"";}
this.insert(tNode);}},initNode:function(tNode){tNode._aChildren=[];tNode._tParent=null;tNode._eElem=null;tNode._eSubMenuRow=null;tNode._eSubMenuTable=null;tNode._bIsLoading=false;tNode._bIsLoaded=tNode.bExpanded;if(!tNode.sId){this._iAutoNum++;tNode.sId=this._iAutoNum.toString();}
return tNode;},insert:function(tNode){var tParent;if(this.getNodeById(tNode.sId)){throw new df.Error(5151,"Node IDs must be unique (ID: '{{0}}')",this,[tNode.sId]);}
if(tNode.sParentId){tParent=this.getNodeById(tNode.sParentId);}
if(tParent){tNode._tParent=tParent;tParent._aChildren.push(tNode);}else{this._aRootItems.push(tNode);}
this._aItems.push(tNode);},clear:function(){var i;if(this._eRootTable){this._eControl.removeChild(this._eRootTable);for(i=0;i<this._aItems.length;i++){if(this._aItems[i]._eElem){this._aItems[i]._eElem.tNode=null;}
this._aItems[i]._eElem=null;this._aItems[i]._eSubMenuRow=null;this._aItems[i]._eSubMenuTable=null;}}
this._tSelectedNode=null;this._aItems=[];this._aRootItems=[];if(this._eControl){this._eRootTable=this.constructTable();this._eControl.appendChild(this._eRootTable);}},redraw:function(){var i;if(this._eControl){this._bRedraw=true;if(this._eRootTable){this._eControl.removeChild(this._eRootTable);for(i=0;i<this._aItems.length;i++){this._aItems[i]._eElem=null;this._aItems[i]._eSubMenuRow=null;this._aItems[i]._eSubMenuTable=null;}}
this._eRootTable=this.constructTable();this.constructMenu(this._aRootItems,this._eRootTable);this._eControl.appendChild(this._eRootTable);this._bRedraw=false;}},constructTable:function(){var eTable=document.createElement("table");return eTable;},constructNode:function(tNode,eTable,iPos,bIsStart,bIsLast){var bDoSub,eRow,eCell;bDoSub=tNode._aChildren.length>0||tNode.bLoadChildren;eRow=eTable.insertRow(iPos);eRow.setAttribute("data-dftree-id",tNode.sId);tNode._eElem=eRow;eCell=eRow.insertCell(0);eCell.innerHTML="<div>&nbsp;</div>";eCell=eRow.insertCell(eRow.cells.length);eCell.innerHTML='<span class="WebTree_Text" title="'+df.sys.string.encodeHtml(tNode.sAltText)+'">'+df.sys.string.encodeHtml(tNode.sName)+'</span>';this.updateNodeCSS(tNode);if(bDoSub){if(tNode.bExpanded){iPos++;this.constructSubmenu(tNode,eTable,iPos,bIsLast);}}
return iPos;},constructMenu:function(aNodes,eTable){var iNode,iPos=0;for(iNode=0;iNode<aNodes.length;iNode++){iPos=this.constructNode(aNodes[iNode],eTable,iPos,(iNode===0&&eTable===this.eRootTable),(iNode===aNodes.length-1));iPos++;}},constructSubmenu:function(tNode,eTable,iPos,bIsLast){var eRow,eCell,eNewTable;eRow=eTable.insertRow(iPos);eRow.className="WebTree_SubRow"+(!this._bRedraw?" WebTree_HiddenSubRow":"");eCell=eRow.insertCell(0);eCell.className=(bIsLast?"WebTree_ConLast":"WebTree_Con");eCell=eRow.insertCell(1);eCell.innerHTML="<table></table>";eNewTable=df.dom.query(eCell,"table");tNode._eSubMenuRow=eRow;tNode._eSubMenuTable=eNewTable;this.constructMenu(tNode._aChildren,eNewTable,false);if(!this._bRedraw){setTimeout(function(){df.dom.removeClass(tNode._eSubMenuRow,"WebTree_HiddenSubRow");},20);}},updateNodeCSS:function(tNode){var bFirst,bLast,bRoot,bSub,eCell;if(tNode._eElem){tNode._eElem.className=(tNode.bExpanded?"WebTree_Expanded":"WebTree_Collapsed")+(tNode===this._tSelectedNode?" WebTree_Selected":"")+" "+tNode.sCSSClass;bFirst=this.isFirst(tNode);bLast=this.isLast(tNode);bRoot=this.isRoot(tNode);bSub=this.hasChildren(tNode);tNode._eElem.cells[0].className="WebTree_Item WebTree_"+((bFirst&&bRoot)||bLast?(bFirst&&bRoot?"Start":"")+(bLast?"End":""):"Entry")+(bSub?"Sub":"");if(this.pbShowIcons){eCell=tNode._eElem.cells[1];eCell.className=(tNode._bIsLoading?"WebTree_IconLoading":(tNode.bFolder?"WebTree_Folder ":"WebTree_Icon "));if(tNode.sIcon&&!tNode._bIsLoading){eCell.style.backgroundImage="url('"+tNode.sIcon+"')";eCell.style.backgroundPosition="0px 1px";}else{eCell.style.backgroundImage="";}}}},toggle:function(tNode){if(tNode.bExpanded){this.collapseNode(tNode);}else{this.expandNode(tNode);}},expandNode:function(tNode){tNode.bExpanded=true;if(tNode._bIsLoading){return;}
if(!tNode._bIsLoaded&&tNode.bLoadChildren){this.loadSubNodes(tNode);}else{if(tNode._eSubMenuRow){df.dom.removeClass(tNode._eSubMenuRow,"WebTree_HiddenSubRow");}else{this.constructSubmenu(tNode,(tNode._tParent?tNode._tParent._eSubMenuTable:this._eRootTable),tNode._eElem.rowIndex+1,this.isLast(tNode));}
this.updateNodeCSS(tNode);}},collapseNode:function(tNode){tNode.bExpanded=false;if(tNode._eSubMenuRow){df.dom.addClass(tNode._eSubMenuRow,"WebTree_HiddenSubRow");}
if(this.isParent(this._tSelectedNode,tNode)){while(tNode&&!this.doSelect(tNode)){tNode=tNode._tParent;}}
this.updateNodeCSS(tNode);},moveUp:function(){var aList,iPos,tNode;if(this._tSelectedNode){tNode=this._tSelectedNode;iPos=this.getPosition(tNode);if(iPos>0){aList=(tNode._tParent?tNode._tParent._aChildren:this._aRootItems);tNode=aList[iPos-1];while(tNode.bExpanded&&tNode._aChildren.length>0){tNode=tNode._aChildren[tNode._aChildren.length-1];}
this.doSelect(tNode);}else{if(tNode._tParent){this.doSelect(tNode._tParent);}}}},moveDown:function(){var tNode,aList,iPos;if(this._tSelectedNode){tNode=this._tSelectedNode;if(tNode.bExpanded&&tNode._aChildren.length>0){this.doSelect(tNode._aChildren[0]);}else{while(tNode){aList=(tNode._tParent?tNode._tParent._aChildren:this._aRootItems);iPos=this.getPosition(tNode);if(iPos<aList.length-1){this.doSelect(aList[iPos+1]);break;}else{tNode=tNode._tParent;}}}}else if(this._aRootItems.length>0){this.doSelect(this._aRootItems[0]);}},doCollapse:function(){var tNode;if(this._tSelectedNode){tNode=this._tSelectedNode;if(tNode.bExpanded&&this.hasChildren(tNode)){this.collapseNode(tNode);}else{if(tNode._tParent){this.doSelect(tNode._tParent);}}}},doExpand:function(){var tNode;if(this._tSelectedNode){tNode=this._tSelectedNode;if(!tNode.bExpanded&&this.hasChildren(tNode)){this.expandNode(tNode);}else{if(tNode._aChildren.length>0){this.doSelect(tNode._aChildren[0]);}}}else if(this._aRootItems.length>0){this.doSelect(this._aRootItems[0]);}},moveFirst:function(){if(this._aRootItems.length>0){this.doSelect(this._aRootItems[0]);}},moveLast:function(){var tNode;if(this._aRootItems.length>0){tNode=this._aRootItems[this._aRootItems.length-1];while(tNode.bExpanded&&tNode._aChildren.length>0){tNode=tNode._aChildren[tNode._aChildren.length-1];}
this.doSelect(tNode);}},doSelect:function(tNode,bOptNoOnSelect){var tPrevSelected,oEvent;this.addSync("psSelectedId");this.addSync("psSelectedValue");tPrevSelected=this._tSelectedNode;this._tSelectedNode=tNode;this.psSelectedId=tNode.sId;if(tPrevSelected){this.updateNodeCSS(tPrevSelected);}
this.updateNodeCSS(tNode);if(tNode._eElem){this.scrollToElement(tNode._eElem);}
if(!bOptNoOnSelect){this.fire("OnSelect",[tNode.sId,tNode.sValue,this.getLevel(tNode)]);}
return true;},doRemove:function(tNode,bOptNoSelect){var i,aList,bSelect=false;function removeSub(tNode){while(tNode._aChildren.length>0){removeSub.call(this,tNode._aChildren.pop());}
tNode._eElem=null;tNode._eSubMenuRow=null;tNode._eSubMenuTable=null;if(tNode===this._tSelectedNode){this._tSelectedNode=null;bSelect=true;}
df.sys.data.removeFromArray(this._aItems,tNode);}
removeSub.call(this,tNode);aList=(tNode._tParent?tNode._tParent._aChildren:this._aRootItems);if(aList){for(i=0;i<aList.length;i++){if(aList[i]===tNode){aList.splice(i,1);break;}}}
if(bSelect&&!bOptNoSelect){if(aList&&aList.length>0){this.doSelect(aList[i]||aList[i-1]);}else{this.doSelect(tNode._tParent||this._aItems[0]);}}},getPosition:function(tNode){var aList,iPos;aList=(tNode._tParent?tNode._tParent._aChildren:this._aRootItems);for(iPos=0;iPos<aList.length;iPos++){if(aList[iPos]===tNode){return iPos;}}
return-1;},isLast:function(tNode){var aList=(tNode._tParent?tNode._tParent._aChildren:this._aRootItems);return(aList[aList.length-1]===tNode);},isFirst:function(tNode){var aList=(tNode._tParent?tNode._tParent._aChildren:this._aRootItems);return(aList[0]===tNode);},isRoot:function(tNode){return(tNode._tParent?false:true);},isParent:function(tNode,tParent){while(tNode){if(tNode===tParent){return true;}
tNode=tNode._tParent;}
return false;},getLevel:function(tNode){var iLevel=1;while(tNode._tParent){iLevel++;tNode=tNode._tParent;}
return iLevel;},getNodeById:function(sNodeId){var i;for(i=0;i<this._aItems.length;i++){if(this._aItems[i].sId===sNodeId){return this._aItems[i];}}
return null;},hasChildren:function(tNode){return(tNode.bLoadChildren&&!tNode._bIsLoaded)||tNode._aChildren.length>0;},scrollToElement:function(eElem){var iTop,oElem,oDiv;oElem=df.sys.gui.getAbsoluteOffset(eElem);oDiv=df.sys.gui.getAbsoluteOffset(this._eControl);iTop=oElem.top-oDiv.top;if(iTop<this._eControl.scrollTop){this._eControl.scrollTop=iTop;}else if(iTop+eElem.offsetHeight>this._eControl.scrollTop+this._eControl.clientHeight){this._eControl.scrollTop=iTop+eElem.offsetHeight-this._eControl.clientHeight;}},onBodyClick:function(oEvent){var sNodeId=null,bSelect=true,tNode,eElem=oEvent.getTarget();if(this.pbEnabled){while(eElem&&!sNodeId&&eElem!==this._eElem){if(eElem.className.indexOf("WebTree_Item")>=0){bSelect=false;}
sNodeId=eElem.getAttribute("data-dftree-id");eElem=eElem.parentNode;}
tNode=this.getNodeById(sNodeId);if(tNode){if(bSelect){if(this._tSelectedNode!==tNode){if(!tNode.bExpanded&&this.hasChildren(tNode)){this.expandNode(tNode);}
this.doSelect(tNode);}else{this.toggle(tNode);}}else{this.toggle(tNode);}
oEvent.stop();}
this.focus();}},onBodyDblClick:function(oEvent){var sNodeId=null,tNode,eElem=oEvent.getTarget();if(this.pbEnabled){while(eElem&&!sNodeId&&eElem!==this._eElem){sNodeId=eElem.getAttribute("data-dftree-id");eElem=eElem.parentNode;}
tNode=this.getNodeById(sNodeId);if(tNode){if(this.fireSubmit()){oEvent.stop();}}}},onKey:function(oEvent){if(this.pbEnabled){if(oEvent.matchKey(df.settings.treeKeys.moveUp)){this.moveUp();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.moveDown)){this.moveDown();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.collapse)){this.doCollapse();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.extend)){this.doExpand();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.moveFirst)){this.moveFirst();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.moveLast)){this.moveLast();oEvent.stop();}else if(oEvent.matchKey(df.settings.treeKeys.enter)){if(this.fireSubmit()){oEvent.stop();}}}},displayLoading:function(tNode){if(tNode){this.updateNodeCSS(tNode);}else{if(this._eControl){df.dom.addClass(this._eControl,"WebTree_Loading");}}},hideLoading:function(tNode){if(tNode){this.updateNodeCSS(tNode);}else{if(this._eControl){df.dom.removeClass(this._eControl,"WebTree_Loading");}}},focus:function(){if(this._bFocusAble&&this.pbEnabled&&this._eFocus){this._eFocus.focus();return true;}
return false;},onFocus:function(oEvent){df.WebList.base.onFocus.call(this,oEvent);this._bLozingFocus=false;},onBlur:function(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){df.WebTreeView.base.onBlur.call(that,oEvent);that._bLozingFocus=false;}},100);}});

df.WebIFrame=function WebIFrame(sName,oParent){df.WebIFrame.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psUrl","");this.prop(df.tInt,"piHeight",0);this.prop(df.tInt,"piMinHeight",0);this.prop(df.tBool,"pbShowBorder",true);this._eWrapper=null;this._sControlClass="WebIFrame";};df.defineClass("df.WebIFrame","df.WebBaseControl",{openHtml:function(aHtml){var sName;df.WebIFrame.base.openHtml.call(this,aHtml);sName="df_webiframe_"+df.dom.piDomCounter++;aHtml.push('<div class="WebIFrm_Wrp"><iframe name="',sName,'" scrolling="auto" frameborder="no"></iframe></div>');},afterRender:function(){this._eControl=df.dom.query(this._eElem,"iframe");this._eWrapper=df.dom.query(this._eElem,"div.WebIFrm_Wrp");df.WebIFrame.base.afterRender.call(this);this.set_pbShowBorder(this.pbShowBorder);this.set_psUrl(this.psUrl);},set_psUrl:function(sVal){if(this._eControl){this._eControl.src=sVal;}},set_pbShowBorder:function(bVal){if(this._eWrapper){df.dom.toggleClass(this._eWrapper,"WebIFrm_Box",bVal);}},setHeight:function(iHeight){if(this._eControl){if(iHeight>0){if(this.peLabelPosition===df.ciLabelTop){iHeight-=this._eLbl.offsetHeight;}
iHeight-=df.sys.gui.getVertBoxDiff(this._eInner);iHeight-=df.sys.gui.getVertBoxDiff(this._eControlWrp);iHeight-=df.sys.gui.getVertBoxDiff(this._eWrapper);this._eWrapper.style.height=iHeight+"px";}else{this._eWrapper.style.height="80px";}}}});

df.WebImage=function WebImage(oDef,oParent){df.WebImage.base.constructor.call(this,oDef,oParent);this.prop(df.tString,"psUrl","");this.prop(df.tBool,"pbScroll",false);this.prop(df.tInt,"pePosition",df.cwiActual);this.prop(df.tBool,"pbShowBorder",false);this.OnClick=df.events.JSHandler();this.pbServerOnClick=false;this.psClientOnClick="";this._sControlClass="WebImage";this._eImg=null;this._sUrl=null;};df.defineClass("df.WebImage","df.WebBaseControl",{openHtml:function(aHtml){df.WebImage.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebImg_Wrp"><img>');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebImage.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div.WebImg_Wrp");this._eImg=df.dom.query(this._eElem,"div.WebImg_Wrp > img");df.WebImage.base.afterRender.call(this);df.events.addDomListener("click",this._eControl,this.onClick,this);df.events.addDomListener("load",this._eImg,this.onImageLoaded,this);this.set_pePosition(this.pePosition);this.set_pbShowBorder(this.pbShowBorder);this.set_piHeight(this.piHeight);this.updateImage();},set_psUrl:function(sVal){this.psUrl=sVal;this._sUrl=null;this.updateImage();},set_pbScroll:function(bVal){if(this._eControl){this._eControl.style.overflowY=(bVal&&this.pePosition!==df.cwiStretch?"auto":"hidden");this._eControl.style.overflowX=(bVal&&this.pePosition!==df.cwiStretchHoriz&&this.pePosition!==df.cwiStretch?"auto":"hidden");}},set_pePosition:function(iVal){if(this._eImg){this._eImg.style.width=(iVal===df.cwiStretch||iVal===df.cwiStretchHoriz?"100%":"");this._eImg.style.height=(iVal===df.cwiStretch?"100%":"");this._eImg.style.marginLeft=(iVal===df.cwiCenter?"auto":"");this._eImg.style.marginRight=(iVal===df.cwiCenter?"auto":"");this._eImg.style.display="block";this._eImg.style.marginTop="";this.pePosition=iVal;this.set_pbScroll(this.pbScroll);this.centerImage();}},set_pbShowBorder:function(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebImg_Box",bVal);if(this.pbShowBorder!==bVal){this.sizeChanged();}}},set_psTooltip:function(sVal){if(this._eImg){this._eImg.alt=sVal;this._eImg.title=sVal;}},updateBase64:function(sType){var i,aStr=[],aData=this._aActionData;if(aData.length>0){aStr.push("data:",sType,";base64,");for(i=0;i<aData[0].aValues.length;i++){aStr.push(aData[0].aValues[i]);}
this._sUrl=aStr.join('');this.updateImage();}},updateImage:function(){if(this._eImg){if(this._sUrl){this._eImg.src=this._sUrl;}else{this._eImg.src=this.psUrl;}
this.centerImage();}},centerImage:function(){if(this._eImg&&this.pePosition===df.cwiCenter){if(this._eImg.clientHeight<this._eControl.clientHeight){this._eImg.style.marginTop=Math.floor((this._eControl.clientHeight-this._eImg.clientHeight)/2)+"px";}else{this._eImg.style.marginTop="";this._eControl.scrollTop=Math.floor((this._eControl.scrollHeight-this._eControl.clientHeight)/2);}
this._eControl.scrollLeft=Math.floor((this._eControl.scrollWidth-this._eControl.clientWidth)/2);}},resize:function(){this.centerImage();},onImageLoaded:function(oEvent){this.centerImage();},onClick:function(oEvent){if(this.fire('OnClick')){oEvent.stop();}}});

df.WebHtmlBox=function WebHtmlBox(oDef,oParent){df.WebHtmlBox.base.constructor.call(this,oDef,oParent);this.prop(df.tBool,"pbScroll",true);this.prop(df.tString,"psHtml","");this.prop(df.tInt,"piHeight",0);this.prop(df.tInt,"piMinHeight",0);this.prop(df.tBool,"pbShowBorder",false);this._sControlClass="WebHtmlBox";this._bFocusAble=false;};df.defineClass("df.WebHtmlBox","df.WebBaseControl",{openHtml:function(aHtml){df.WebHtmlBox.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebHtml_Wrp">');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebHtmlBox.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div.WebHtml_Wrp");df.WebHtmlBox.base.afterRender.call(this);this.set_piHeight(this.piHeight);this.set_pbShowBorder(this.pbShowBorder);df.events.addDomListener("click",this._eControl,this.onHtmlClick,this);this.updateHtml(this.psHtml);},updateHtml:function(sHtml){if(this._eControl){this._eControl.innerHTML=sHtml;}
this.psHtml=sHtml;},set_pbScroll:function(bVal){if(this._eControl){this._eControl.style.overflowY=(this.pbFillHeight||this.piHeight>0?(bVal?"auto":"hidden"):"visible");this._eControl.style.overflowX=(bVal?"auto":"hidden");}},set_pbShowBorder:function(bVal){if(this._eControl){df.dom.toggleClass(this._eControl,"WebHtml_Box",bVal);}},set_piHeight:function(iVal){if(this._eControl){df.WebHtmlBox.base.set_piHeight.call(this,iVal);this.piHeight=iVal;this.set_pbScroll(this.pbScroll);}},set_psHtml:function(sVal){this.updateHtml(sVal);},set_pbFillHeight:function(bVal){df.WebHtmlBox.base.set_pbFillHeight.call(this,bVal);this.pbFillHeight=bVal;this.set_pbScroll(this.pbScroll);},onHtmlClick:function(oEvent){var eElem=oEvent.getTarget();while(eElem&&eElem!==this._eControl){if(eElem.getAttribute('data-ServerOnClick')){this.fire('OnClick',[eElem.getAttribute('data-ServerOnClick'),eElem.getAttribute('data-OnClickParam')]);}
eElem=eElem.parentNode;}}});

df.WebRadio=function WebRadio(sName,oParent){df.WebRadio.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psMasterName","");this.prop(df.tString,"psGroupName","");this.prop(df.tString,"psRadioValue","");this.prop(df.tString,"psCaption","");this.event("OnSelect",df.cCallModeDefault);this._oMaster=null;this._aRadios=[];this._sPrevChangeVal=null;this._iPrevSelected=null;this._eCaption=null;this._sControlClass="WebRadio";};df.defineClass("df.WebRadio","df.WebBaseDEO",{openHtml:function(aHtml){df.WebRadio.base.openHtml.call(this,aHtml);aHtml.push('<input type="radio" name="',this.psGroupName,'" id="',this._sControlId,'"><label class="WebRadio_Caption" for="',this._sControlId,'"></label><div style="clear: both"></div>');},afterRender:function(){var oWebApp=this.getWebApp();this._eControl=df.dom.query(this._eElem,"input");this._eCaption=df.dom.query(this._eElem,"label.WebRadio_Caption");this.set_psCaption(this.psCaption);this.set_psRadioValue(this.psRadioValue);if(this.psMasterName){this._oMaster=oWebApp.findObj(this.psMasterName);this._oMaster.registerRadio(this);this.unSync('psValue');this.unSync('pbChanged');}else{this.registerRadio(this);}
df.WebRadio.base.afterRender.call(this);df.events.addDomListener("click",this._eControl,this.onClick,this);},get_pbChanged:function(){if(this._oMaster){return this._oMaster.get_pbChanged();}
return df.WebRadio.base.get_pbChanged.call(this);},set_psValue:function(sVal){var i;if(this._oMaster){this._oMaster.set_psValue(sVal);}else{df.WebRadio.base.set_psValue.call(this,sVal);for(i=0;i<this._aRadios.length;i++){if(this._aRadios[i]._eControl.checked){this._iPrevSelected=i;break;}}}},get_psValue:function(){if(this._oMaster){return this._oMaster.get_psValue();}
return df.WebRadio.base.get_psValue.call(this);},set_psRadioValue:function(sVal){if(this._eControl){this._eControl.value=sVal;}},set_psCaption:function(sVal){if(this._eCaption){df.dom.setText(this._eCaption,sVal);if(this.psCaption!==sVal){this.sizeChanged();}}},set_psTextColor:function(sVal){if(this._eCaption){this._eCaption.style.color=sVal||'';}},getControlValue:function(){var i;if(this._oMaster){return this._oMaster.getControlValue();}
for(i=0;i<this._aRadios.length;i++){if(this._aRadios[i]._eControl.checked){return this._aRadios[i].psRadioValue;}}
return this.psValue;},setControlValue:function(sVal){var i;if(this._oMaster){return this._oMaster.setControlValue(sVal);}
if(!(this._aRadios[this._iPrevSelected]&&this._aRadios[this._iPrevSelected]._eControl.checked&&this._aRadios[this._iPrevSelected].psRadioValue===sVal)){for(i=0;i<this._aRadios.length;i++){if(this._aRadios[i].psRadioValue===sVal){this._aRadios[i]._eControl.checked=true;return;}}}},registerRadio:function(oRadio){this._aRadios.push(oRadio);},fireChange:function(){var sNewVal,i;if(this._oMaster){return this._oMaster.fireChange();}
this.updateTypeVal();sNewVal=this.getServerVal();for(i=0;i<this._aRadios.length;i++){if(this._sPrevChangeVal!==sNewVal){this._aRadios[i].fire('OnChange',[sNewVal,this._sPrevChangeVal]);}
if(this._aRadios[i]._eControl.checked&&i!==this._iPrevSelected){this._aRadios[i].fire('OnSelect');this._iPrevSelected=i;}}
this._sPrevChangeVal=sNewVal;},onClick:function(oEvent){this.fireChange();}});

df.WebSlider=function WebSlider(sName,oParent){df.WebSlider.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piMinValue",1);this.prop(df.tInt,"piMaxValue",10);this.prop(df.tInt,"piSliderValue",1);this.prop(df.tInt,"piInterval",1);this.prop(df.tBool,"pbVertical",false);this.prop(df.tInt,"piHeight",0);this.prop(df.tBool,"pbShowMarkers",false);this.prop(df.tInt,"piMaxMarkers",101);this.prop(df.tBool,"pbRanged",false);this.prop(df.tInt,"piSliderStart",0);this.prop(df.tInt,"piFrom",1);this.prop(df.tInt,"piTo",3);this.prop(df.tBool,"pbShowValue",true);this.prop(df.tBool,"pbShowRange",false);this._eSlider=null;this._eSliderWrp=null;this._eSliderBar=null;this._eControl=null;this._eLabels=null;this._eValueIndicator=null;this._bSelected=false;this._bFocus=false;this._eRangedSlider=null;this._iValueInterval=0;this._aLabels=[];this._aMarkers=[];this._iPrevChangePos=1;this.unSync("psValue");this._sControlClass="WebSlider";};df.defineClass("df.WebSlider","df.WebBaseDEO",{create:function(tDef){df.WebSlider.base.create.call(this,tDef);if(this.piSliderValue<this.piMinValue){this.piSliderValue=this.piMinValue;}else if(this.piSliderValue>this.piMaxValue){this.piSliderValue=this.piMaxValue;}
this._iPrevChangePos=this.piSliderValue;this.assertions();if(this.pbRanged){this.addSync("piFrom");this.addSync("piTo");}else{this.addSync("piSliderValue");}},openHtml:function(aHtml){df.WebSlider.base.openHtml.call(this,aHtml);if(this.pbShowValue){aHtml.push('<div class="WebSlider_ValueIndicatorWrapper">1</div>');}
aHtml.push('<div class="WebSlider_Wrapper',(this.pbVertical?' WebSlider_Vertical':' WebSlider_Horizontal'),'',(this.pbRanged?' WebSlider_Range':' WebSlider_NoRange'),'">');aHtml.push('<div class="WebSlider_BarWrapper">');aHtml.push('<div class="WebSlider_Bar">');aHtml.push('<div class="WebSlider_InnerBar">');if(this.pbShowRange){aHtml.push('<div class="WebSlider_ShowRange"></div>');}
aHtml.push('</div></div>');aHtml.push('</div>');aHtml.push('<div class="WebSlider_Labels">');this.generateMarkers();this.renderLabels(aHtml);aHtml.push('</div>');aHtml.push('<div class="WebSlider_SliderWrapper">');aHtml.push('<div class="WebSlider_Slider"></div>');if(this.pbRanged){aHtml.push('<div class="WebSlider_SliderRanged WebSlider_Slider"></div>');}
aHtml.push('</div>');},closeHtml:function(aHtml){aHtml.push('</div>');},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div.WebSlider_Wrapper");this._eSlider=df.dom.query(this._eElem,"div.WebSlider_Slider");this._eSliderWrp=df.dom.query(this._eElem,"div.WebSlider_SliderWrapper");this._eSliderBar=df.dom.query(this._eElem,"div.WebSlider_Bar");this._eSliderBarWrp=df.dom.query(this._eElem,"div.WebSlider_BarWrapper");this._eSliderBarInner=df.dom.query(this._eElem,"div.WebSlider_InnerBar");this._eLabels=df.dom.query(this._eElem,"div.WebSlider_Labels");this._eValueIndicator=df.dom.query(this._eElem,"div.WebSlider_ValueIndicatorWrapper");if(this.pbRanged){this._eRangedSlider=df.dom.query(this._eElem,"div.WebSlider_SliderRanged");}
if(this.pbShowRange){this._eRangeIndicator=df.dom.query(this._eElem,"div.WebSlider_ShowRange");}
df.WebSlider.base.afterRender.call(this);this.updateDisplay();if(this.pbRanged){df.events.addDomListener("mousedown",this._eRangedSlider,this.onSlide,this);}
df.events.addDomListener("mousedown",this._eSlider,this.onSlide,this);df.events.addDomListener("click",this._eLabels,this.onLabelClick,this);df.events.addDomListener("click",this._eControl,this.onSliderClick,this);},assertions:function(){if(this.piInterval<=0){throw new df.Error(999,"The piInterval needs to be a positive number",this);}
if(this.piMaxValue===this.piMinValue){throw new df.Error(999,"Please specify a Max and a Min value",this);}else if(this.piMaxValue<this.piMinValue){throw new df.Error(999,"The max value is smaller then the min value",this);}
if((this.piMaxValue-this.piMinValue)%this.piInterval>0){throw new df.Error(999,"Your maximum, minimum and interval value do not match properly",this);}
if(this.piSliderValue<this.piMinValue||this.piSliderValue>this.piMaxValue){throw new df.Error(999,"Please specify the piSliderValue with a number between the piMinValue and piMaxValue",this);}else if((this.piSliderValue-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piSliderValue)%this.piInterval>0){throw new df.Error(999,"The piSliderValue value is unreachable with the specified interval.",this);}
if(this.pbRanged){if(this.piFrom<this.piMinValue||this.piFrom>this.piMaxValue){throw new df.Error(999,"Please specify the piFrom with a number between the piMinValue and piMaxValue",this);}else if(this.piTo<this.piMinValue||this.piTo>this.piMaxValue){throw new df.Error(999,"Please specify the piTo with a number between the piMinValue and piMaxValue",this);}else if((this.piFrom-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piFrom)%this.piInterval>0){throw new df.Error(999,"The piRangedValue value is unreachable with the specified interval.",this);}else if((this.piTo-this.piMinValue)%this.piInterval>0||(this.piMaxValue-this.piTo)%this.piInterval>0){throw new df.Error(999,"The piTo value is unreachable with the specified interval.",this);}}},setHeight:function(iHeight){if(this._eControl){if(iHeight>0){if(this.peLabelPosition===df.ciLabelTop){iHeight-=this._eLbl.offsetHeight;}
iHeight-=df.sys.gui.getVertBoxDiff(this._eInner);iHeight-=df.sys.gui.getVertBoxDiff(this._eControlWrp);iHeight-=df.sys.gui.getVertBoxDiff(this._eControl);if(this._eValueIndicator&&this.pbVertical){iHeight-=this._eValueIndicator.offsetHeight;}
if(iHeight<0){iHeight=0;}
this._eControl.style.height=iHeight+"px";}else{this._eControl.style.height="";}}},resize:function(oEvent){this.positionLabels();this.updateDisplay();},updateDisplay:function(){var nOffset,nFrom,nTo,nStep,nWidth;if(this._eElem){nStep=this.getInterval()/this.piInterval;if(this.pbRanged){nFrom=nStep*(this.piFrom-this.piMinValue);nTo=nStep*(this.piTo-this.piMinValue);if(this.pbVertical){this._eRangedSlider.style.top=nFrom+"px";this._eSlider.style.top=nTo+"px";}else{this._eRangedSlider.style.left=nFrom+"px";this._eSlider.style.left=nTo+"px";}
if(this.pbShowValue){this._eValueIndicator.innerHTML=this.piFrom+"-"+this.piTo;}
if(this.pbShowRange){if(this.pbVertical){this._eRangeIndicator.style.top=nFrom+"px";this._eRangeIndicator.style.height=(nTo-nFrom)+"px";}else{this._eRangeIndicator.style.left=nFrom+"px";nWidth=nTo-nFrom;nWidth=(nWidth<0?-nWidth:nWidth);this._eRangeIndicator.style.width=nWidth+"px";}}}else{nOffset=nStep*(this.piSliderValue-this.piMinValue);if(this.pbVertical){this._eSlider.style.top=nOffset+"px";}else{this._eSlider.style.left=nOffset+"px";}
if(this.pbShowValue){this._eValueIndicator.innerHTML=this.piSliderValue;}
if(this.pbShowRange){if(this.pbVertical){this._eRangeIndicator.style.top="0px";this._eRangeIndicator.style.height=nOffset+"px";}else{this._eRangeIndicator.style.left="0px";nOffset=nOffset<0?-nOffset:nOffset;this._eRangeIndicator.style.width=nOffset+"px";}}}}},fillLabels:function(){if(this._tActionData){this._aLabels=df.sys.vt.deserialize(this._tActionData,[{sN:df.tString,sV:df.tString}]);this.generateMarkers();this.updateLabels();}},generateMarkers:function(){var aData=this._aLabels,i,oLabel,iNumberOfIntervals,iInterval,iDevide;this._aMarkers=[];if(this.pbShowMarkers){iNumberOfIntervals=this.piMaxMarkers;iDevide=(this.piMaxValue-this.piMinValue)/(iNumberOfIntervals-1);if(iDevide<this.piInterval){iInterval=this.piInterval;}else{iInterval=this.piInterval;while(iInterval<iDevide||((this.piMaxValue-this.piMinValue)%iInterval)){iInterval+=this.piInterval;}}
iNumberOfIntervals=(this.piMaxValue-this.piMinValue)/iInterval;for(i=0;i<=iNumberOfIntervals;i++){oLabel={};oLabel.piSliderValue=iInterval*i+this.piMinValue;oLabel.psLabel="";this._aMarkers.push(oLabel);}}
if(aData){for(i=0;i<aData.length;i++){oLabel={};oLabel.piSliderValue=parseFloat(aData[i].sV,10);oLabel.psLabel=aData[i].sN;this._aMarkers.push(oLabel);if(oLabel.piSliderValue%this.piInterval>0||oLabel.piSliderValue>this.piMaxValue||oLabel.piSliderValue<this.piMinValue){throw new df.Error(999,"The position you want this label on is unreachable for the slider.",this);}}}
this._aMarkers=this._aMarkers.sort(this.sortLabels);this._aMarkers=this.removeDoubleValues(this._aMarkers);},sortLabels:function(a,b){if(a.piSliderValue<b.piSliderValue){return-1;}
if(a.piSliderValue>b.piSliderValue){return 1;}
if(a.piSliderValue===b.piSliderValue){return 0;}},removeDoubleValues:function(aLabels){var i,iDummyArray=[];for(i=0;i<aLabels.length;i++){if(i+1===aLabels.length){iDummyArray.push(aLabels[i]);}else{if(aLabels[i].piSliderValue===aLabels[i+1].piSliderValue){if(aLabels[i].psLabel.length>aLabels[i+1].psLabel.length){iDummyArray.push(aLabels[i]);}else{iDummyArray.push(aLabels[i+1]);}
i++;}else{iDummyArray.push(aLabels[i]);}}}
return iDummyArray;},renderLabels:function(aHtml){var i;aHtml.push('<div class="WebSlider_LabelMarkerWrapper"',(this._aLabels.length===0&&!this.pbShowMarkers?' style="display: none;"':''),'>');for(i=0;i<this._aMarkers.length;i++){aHtml.push('<div class="WebSlider_LabelMarker" data-labelIndex="',i,'"></div>');}
aHtml.push('</div><div class="WebSlider_LabelWrapper"',(this._aLabels.length===0?' style="display: none;"':''),'>');for(i=0;i<this._aMarkers.length;i++){if(this._aMarkers[i].psLabel!==''){aHtml.push('<div class="WebSlider_LabelText" data-labelIndex="',i,'">',this._aMarkers[i].psLabel,'</div>');}}
aHtml.push('</div>');},positionLabels:function(){var i,iNewPosition,aMarkers,iIntervalSize,aLabels,iValue,nRel,nSliderOffset;iIntervalSize=(this.getInterval()/this.piInterval);aLabels=df.dom.query(this._eLabels,"div.WebSlider_LabelText",true);aMarkers=df.dom.query(this._eLabels,"div.WebSlider_LabelMarker",true);if(this.pbVertical){nSliderOffset=this._eSlider.offsetHeight/2;}else{nSliderOffset=this._eSlider.offsetWidth/2;}
for(i=0;i<aMarkers.length;i++){iNewPosition=0;iNewPosition=nSliderOffset+iIntervalSize*(this._aMarkers[i].piSliderValue-this.piMinValue);if(this.pbVertical){aMarkers[i].style.top=iNewPosition+"px";}else{aMarkers[i].style.left=iNewPosition+"px";}}
for(i=0;i<aLabels.length;i++){iNewPosition=0;iValue=this._aMarkers[aLabels[i].getAttribute("data-labelIndex")].piSliderValue;iNewPosition=nSliderOffset+iIntervalSize*(iValue-this.piMinValue);if(this.pbVertical){iNewPosition=iNewPosition-(aLabels[i].offsetHeight/2);aLabels[i].style.top=iNewPosition+"px";}else{nRel=(iValue-this.piMinValue)/(this.piMaxValue-this.piMinValue);nRel=((nRel-0.5)*0.6)+0.5;iNewPosition=iNewPosition-(nRel*aLabels[i].offsetWidth);aLabels[i].style.left=iNewPosition+"px";}}},updateLabels:function(){var aNewLabels=[];if(this._eElem){this.renderLabels(aNewLabels);this._eLabels.innerHTML=aNewLabels.join("");this.positionLabels();}},increment:function(bUp,bSize){if(this.pbRanged){if(bSize){if(bUp){if(this.piTo<this.piMaxValue){this.piTo+=this.piInterval;}else if(this.piFrom>this.piMinValue){this.piFrom-=this.piInterval;}}else{if(this.piFrom<this.piTo){this.piTo-=this.piInterval;}}}else{if(bUp){if(this.piTo<this.piMaxValue){this.piTo+=this.piInterval;this.piFrom+=this.piInterval;}}else{if(this.piFrom>this.piMinValue){this.piTo-=this.piInterval;this.piFrom-=this.piInterval;}}}}else{if(bUp&&this.piSliderValue!==this.piMaxValue){this.piSliderValue+=this.piInterval;}else if(!bUp&&this.piSliderValue!==this.piMinValue){this.piSliderValue-=this.piInterval;}}
this.updateDisplay();this.fireChange();},getInterval:function(){var iSliderSize,iValueInterval;iSliderSize=(this.pbVertical)?this._eSliderBarInner.offsetHeight:this._eSliderBarInner.offsetWidth;iValueInterval=iSliderSize/((this.piMaxValue-this.piMinValue)/this.piInterval);return iValueInterval;},toPositive:function(iValue){iValue=Math.sqrt(Math.pow(iValue,2));return iValue;},getMaximalSliderPosition:function(){var iSliderSize;if(this.pbVertical){iSliderSize=this._eSliderBarInner.offsetHeight;}else{iSliderSize=this._eSliderBarInner.offsetWidth;}
return iSliderSize;},onLabelClick:function(oEvent){var eLabel=oEvent.getTarget();if(!this.pbEnabled){return;}
while(eLabel.getAttribute("data-labelindex")===null||eLabel===document){eLabel=eLabel.parentNode;if(eLabel===document){return;}}
this.piSliderValue=this._aMarkers[eLabel.getAttribute("data-labelIndex")].piSliderValue;this.updateDisplay();this.fireChange();this.onFocus();},onSlide:function(oEvent){var iMaxOffset,iMinOffset,iMouseStart,eMask,iStartValue,iTemp,bIsFrom,iInterval;if(!this.pbEnabled){return;}
bIsFrom=(this._eRangedSlider===oEvent.eSource&&this.pbRanged);iInterval=this.getInterval();eMask=df.gui.dragMask();eMask.style.cursor=this.pbVertical?"s-resize":"e-resize";iMouseStart=this.pbVertical?oEvent.getMouseY():oEvent.getMouseX();iMinOffset=0;iMaxOffset=this.getMaximalSliderPosition();if(this.pbRanged){if(bIsFrom){iStartValue=this.piFrom;}else{iStartValue=this.piTo;}}else{iStartValue=this.piSliderValue;}
function onDragSlide(oEvent){var iNewMouseValue,iNewValue,iDiff,iPossDiff,iNumberOfIntervals;iNewMouseValue=(this.pbVertical)?oEvent.getMouseY():oEvent.getMouseX();iDiff=iNewMouseValue-iMouseStart;iPossDiff=this.toPositive(iDiff);iNumberOfIntervals=iDiff/iInterval;iNumberOfIntervals=Math.round(this.toPositive(iNumberOfIntervals));if(iMouseStart>iNewMouseValue){iNumberOfIntervals*=-1;}
iNewValue=iNumberOfIntervals*this.piInterval+iStartValue;if(iNewValue<this.piMinValue){iNewValue=this.piMinValue;}else if(iNewValue>this.piMaxValue){iNewValue=this.piMaxValue;}
if(this.pbRanged){if(bIsFrom){this.piFrom=iNewValue;if(this.piFrom>this.piTo){bIsFrom=false;iTemp=this.piFrom;this.piFrom=this.piTo;this.piTo=iTemp;}}else{this.piTo=iNewValue;if(this.piTo<this.piFrom){bIsFrom=true;iTemp=this.piFrom;this.piFrom=this.piTo;this.piTo=iTemp;}}}else{this.piSliderValue=iNewValue;}
this.updateDisplay();}
function onStopSlide(oEvent){eMask.parentNode.removeChild(eMask);df.events.removeDomListener("mouseup",window,onStopSlide);df.events.removeDomListener("mouseup",eMask,onStopSlide);df.events.removeDomListener("mousemove",eMask,onDragSlide);this.fireChange();}
df.events.addDomListener("mouseup",window,onStopSlide,this);df.events.addDomListener("mouseup",eMask,onStopSlide,this);df.events.addDomListener("mousemove",eMask,onDragSlide,this);oEvent.stop();this.focus();},onSliderClick:function(oEvent){var oOffset,iOffset,iVal,iRawVal;if(!this.pbEnabled){return;}
oOffset=this._eSliderBarInner.getBoundingClientRect();if(!(oEvent.getMouseY()>=oOffset.top-2&&oEvent.getMouseY()<=oOffset.bottom+2&&oEvent.getMouseX()>=oOffset.left-2&&oEvent.getMouseX()<=oOffset.right+2)){return;}
if(this.pbVertical){iOffset=oEvent.getMouseY()-oOffset.top;}else{iOffset=oEvent.getMouseX()-oOffset.left;}
iRawVal=iOffset/(this.getInterval()/this.piInterval);iVal=(Math.round(iRawVal/this.piInterval)*this.piInterval)+this.piMinValue;if(iVal<this.piMinValue){iVal=this.piMinValue;}else if(iVal>this.piMaxValue){iVal=this.piMaxValue;}
if(this.pbRanged){if(iVal<this.piFrom){this.piFrom=iVal;}else if(iVal>this.iTo){this.piTo=iVal;}else if(iVal-this.piFrom<this.piTo-iVal){this.piFrom=iVal;}else{this.piTo=iVal;}}else{this.piSliderValue=iVal;}
this.updateDisplay();this.fireChange();},onKey:function(oEvent){if(oEvent.matchKey(df.settings.sliderKeys.sliderDown)){this.increment(this.pbVertical,!this.pbVertical);oEvent.stop();return;}
if(oEvent.matchKey(df.settings.sliderKeys.sliderUp)){this.increment(!this.pbVertical,!this.pbVertical);oEvent.stop();return;}
if(oEvent.matchKey(df.settings.sliderKeys.sliderLeft)){this.increment(false,this.pbVertical);oEvent.stop();return;}
if(oEvent.matchKey(df.settings.sliderKeys.sliderRight)){this.increment(true,this.pbVertical);oEvent.stop();return;}
df.WebSlider.base.onKey.call(this,oEvent);},fireChange:function(){if(this._iPrevChangePos!==this.piSliderValue){this.pbChanged=true;this.fire('OnChange',[this.piSliderValue,this._iPrevChangePos]);this._iPrevChangePos=this.piSliderValue;}},set_piMinValue:function(iVal){this.piMinValue=iVal;this.resize();this.generateMarkers();this.updateLabels();},set_piMaxValue:function(iVal){this.piMaxValue=iVal;this.updateDisplay();this.generateMarkers();this.updateLabels();},set_piInterval:function(iVal){this.piInterval=iVal;this.updateDisplay();this.generateMarkers();this.updateLabels();},set_pbShowMarkers:function(bVal){this.pbShowMarkers=bVal;this.generateMarkers();this.updateLabels();},set_piSliderValue:function(iVal){if(iVal>this.piMaxValue){this.piSliderValue=this.piMaxValue;}else if(iVal<this.piMinValue){this.piSliderValue=this.piMinValue;}else{this.piSliderValue=iVal;}
this._iPrevChangePos=this.piSliderValue;this.updateDisplay();return false;},set_piFrom:function(iVal){var that=this;if(iVal>this.piMaxValue){this.piFrom=this.piMaxValue;}else if(iVal<this.piMinValue){this.piFrom=this.piMinValue;}else{this.piFrom=iVal;}
if(this.piFrom>this.piTo){setTimeout(function(){var i;if(that.piFrom>that.piTo){i=that.piFrom;that.piFrom=that.piTo;that.piTo=i;}
that.updateDisplay();},10);}else{this.updateDisplay();}
return false;},set_piTo:function(iVal){var that=this;if(iVal>this.piMaxValue){this.piTo=this.piMaxValue;}else if(iVal<this.piMinValue){this.piTo=this.piMinValue;}else{this.piTo=iVal;}
if(this.piFrom>this.piTo){setTimeout(function(){var i;if(that.piFrom>that.piTo){i=that.piFrom;that.piFrom=that.piTo;that.piTo=i;}
that.updateDisplay();},10);}else{this.updateDisplay();}
return false;},get_pbChanged:function(){return this.pbChanged;},get_psValue:function(){return this.piSliderValue.toString();},set_psValue:function(sVal){},attachFocusEvents:function(){if(this._eControl&&this.pbEnabled&&this.pbVisible){df.events.addDomCaptureListener("focus",this._eControl,this.onFocus,this);df.events.addDomListener("blur",this._eControl,this.onBlur,this);}},focus:function(){if(this._bFocusAble&&this.pbEnabled&&this._eControl){this._eControl.focus();return true;}
return false;},onFocus:function(oEvent){df.WebSlider.base.onFocus.call(this,oEvent);this.focus();this._bLozingFocus=false;},onBlur:function(oEvent){var that=this;this._bLozingFocus=true;setTimeout(function(){if(that._bLozingFocus){that.getWebApp().objBlur(that);if(that._eElem){df.dom.removeClass(that._eElem,"WebCon_Focus");}
that._bHasFocus=false;that._bLozingFocus=false;}},100);}});

df.WebSpacer=function(sName,oParent){df.WebSpacer.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"piHeight",0);this.prop(df.tInt,"piMinHeight",0);this._sControlClass="WebSpacer";this._bFocusAble=false;};df.defineClass("df.WebSpacer","df.WebBaseControl",{openHtml:function(aHtml){df.WebSpacer.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebSpacer_Spacer">');},closeHtml:function(aHtml){aHtml.push('</div>');df.WebSpacer.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"div.WebSpacer_Spacer");df.WebSpacer.base.afterRender.call(this);}});

df.WebHorizontalLine=function(sName,oParent){df.WebHorizontalLine.base.constructor.call(this,sName,oParent);this._sControlClass="WebHorizontalLine";this._bFocusAble=false;};df.defineClass("df.WebHorizontalLine","df.WebBaseControl",{openHtml:function(aHtml){df.WebHorizontalLine.base.openHtml.call(this,aHtml);aHtml.push('<hr/>');},closeHtml:function(aHtml){df.WebHorizontalLine.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eControl=df.dom.query(this._eElem,"hr");df.WebHorizontalLine.base.afterRender.call(this);},set_psBackgroundColor:function(sVal){if(this._eControl){this._eControl.style.backgroundColor=sVal||'';this._eControl.style.color=sVal||'';}}});

df.WebTimer=function WebTimer(sName,oParent){df.WebTimer.base.constructor.call(this,sName,oParent);this.prop(df.tBool,"pbAutoStart",true);this.prop(df.tBool,"pbAutoStop",true);this.prop(df.tInt,"piInterval",2000);this.prop(df.tBool,"pbRunning",false);this.prop(df.tBool,"pbWaitForCall",true);this.event("OnTimer",df.cCallModeDefault);this._tInterval=null;this._tTimeout=null;this.addSync("pbRunning");this.init();};df.defineClass("df.WebTimer","df.WebObject",{init:function(){var oView=this.getView();if(oView){oView.OnShow.addListener(this.showView,this);oView.OnHide.addListener(this.hideView,this);}else{if(this.pbAutoStart){this.pbRunning=true;this.trigger();}}},timer:function(){if(this.pbRunning){this.fire("OnTimer",[],function(){this.trigger();});}},trigger:function(){var that=this;if(this.pbRunning){if(this.pbWaitForCall){if(this._tInterval){clearInterval(this._tInterval);this._tInterval=null;}
if(this._tTimeout){clearTimeout(this._tTimeout);}
this._tTimeout=setTimeout(function(){that.timer();},this.piInterval);}else if(!this._tInterval){this._tInterval=setInterval(function(){that.timer();},this.piInterval);}}else{if(this._tInterval){clearInterval(this._tInterval);this._tInterval=null;}
if(this._tTimeout){clearTimeout(this._tTimeout);this._tTimeout=null;}}},set_pbRunning:function(bVal){this.pbRunning=bVal;this.trigger();},set_piInterval:function(iVal){if(this.piInterval!==iVal){this.piInterval=iVal;if(this._tInterval){clearInterval(this._tInterval);this._tInterval=null;}
this.trigger();}},set_pbWaitForCall:function(bVal){this.pbWaitForCall=bVal;this.trigger();},showView:function(oEvent){if(this.pbAutoStart){this.pbRunning=true;this.trigger();}},hideView:function(oEvent){if(this.pbAutoStop){this.pbRunning=false;this.trigger();}}});

df.tWebSuggestion={sRowId:df.tString,aValues:[df.tString]};df.WebSuggestionForm=function WebSuggestionForm(sName,oParent){df.WebSuggestionForm.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peSuggestionMode",df.smFind);this.prop(df.tBool,"pbCaseSensitive",false);this.prop(df.tBool,"pbAllowForce",true);this.prop(df.tBool,"pbFullText",false);this.prop(df.tBool,"pbHighlight",true);this.prop(df.tInt,"piMaxResults",15);this.prop(df.tInt,"piStartAtChar",2);this.prop(df.tInt,"piSuggestionWidth",0);this.prop(df.tBool,"pbClientRefinement",true);this.prop(df.tInt,"piPopupTimeout",50);this.prop(df.tInt,"piTypeTimeout",20);this._eSuggestions=null;this._bForceDisplay=false;this._sSelectedId=null;};df.defineClass("df.WebSuggestionForm","df.WebForm",{openHtml:function(aHtml){df.WebSuggestionForm.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebSuggestions WebSug_Hidden"><div class="WebSug_Content"></div><div>');},afterRender:function(){this._eSuggestions=df.dom.query(this._eElem,"div.WebSuggestions");this._eSugContent=df.dom.query(this._eElem,"div.WebSug_Content");df.WebSuggestionForm.base.afterRender.call(this);df.events.addDomListener("keyup",this._eControl,this.onSuggestKey,this);df.events.addDomListener("click",this._eSuggestions,this.onSuggestClick,this);},deserializeVT:df.sys.vt.generateDeserializer([df.tWebSuggestion]),serializeVT:df.sys.vt.generateSerializer([df.tWebSuggestion]),suggestUpdate:function(){var that=this,sVal=this.getControlValue();if(sVal!==this._sSuggestPrevVal||this._bForceDisplay){this._sSuggestPrevVal=sVal;if(sVal.length>=this.piStartAtChar||this._bForceDisplay){if(this._bSuggestVisible){if(this.pbClientRefinement&&this._sSuggestBaseVal){if(sVal.substr(0,this._sSuggestBaseVal.length)===this._sSuggestBaseVal){this.suggestRefine(sVal);return;}}}else{if(!this._tSuggestDisplay){this._tSuggestDisplay=setTimeout(function(){that._tSuggestDisplay=null;that.suggestDisplay();},this.piPopupTimeout);}}
this.suggestLoad();}else if(this._bSuggestVisible){this.suggestHide();}}},suggestLoad:function(){var that=this;df.dom.addClass(this._eSuggestions,"WebSug_Loading");if(!this._tSuggestUpdate){this._tSuggestUpdate=setTimeout(function(){that._tSuggestUpdate=null;that.suggestDoLoad(that.getControlValue());},this.piTypeTimeout);}},suggestDoLoad:function(sVal){if(!this._bSuggestLoading){this._bSuggestLoading=true;this.serverAction("FindSuggestions",[sVal],null,function(){this._bSuggestLoading=false;if(this._sSuggestNextLoad){this.suggestDoLoad(this._sSuggestNextLoad);this._sSuggestNextLoad=null;}else{df.dom.removeClass(this._eSuggestions,"WebSug_Loading");}},this);}else{this._sSuggestNextLoad=sVal;}},suggestHandle:function(sVal){var aList,i,sCurVal,bFound=false,bRefine;aList=this.deserializeVT(this._tActionData);sCurVal=this.getControlValue();if(sCurVal!==sVal){if(this.pbClientRefinement&&sCurVal.substr(0,sVal)===sVal){bRefine=true;}else{return;}}
this._sSuggestBaseVal=sVal;this._aSuggestBase=this._aSuggestRows=aList;for(i=0;i<aList.length;i++){if(aList[i].sRowId===this._sSelectedId){bFound=true;}}
if(!bFound){this._sSelectedId=(aList.length>0?aList[0].sRowId:null);}
if(bRefine){this.suggestRefine(sCurVal);}else{this.suggestRender(sVal);}},suggestDisplay:function(){if(this.pbEnabled){if(!this._aSuggestRows){this._eSugContent.innerHTML="";}
this.suggestPosition();df.dom.addClass(this._eSuggestions,"WebSug_Visible");df.dom.removeClass(this._eSuggestions,"WebSug_Hidden");this._bSuggestVisible=true;}},suggestPosition:function(){var oRect=this._eSuggestions.parentNode.getBoundingClientRect();this._eSuggestions.style.top=oRect.bottom+"px";this._eSuggestions.style.left=oRect.left+"px";this._eSuggestions.style.width=(this.piSuggestionWidth>0?this.piSuggestionWidth:(oRect.right-oRect.left))+"px";if(oRect.bottom+this._eSugContent.clientHeight>window.innerHeight){this._eSuggestions.style.bottom="0px";}else{this._eSuggestions.style.bottom="";}},suggestHide:function(){if(this._eSuggestions){df.dom.addClass(this._eSuggestions,"WebSug_Hidden");df.dom.removeClass(this._eSuggestions,"WebSug_Visible");if(this._tSuggestDisplay){clearTimeout(this._tSuggestDisplay);this._tSuggestDisplay=null;}
if(this._tSuggestUpdate){clearTimeout(this._tSuggestUpdate);this._tSuggestUpdate=null;}
this._sSuggestPrevVal=this.getControlValue();this._aSuggestRows=null;this._bSuggestVisible=false;this._sSelectedId=null;this._bForceDisplay=false;}},suggestRender:function(sSearch){var aHtml=[],aList=this._aSuggestRows,i,x,sLowerSearch,iLen,sVal,oRegEx;function makeBold(sMatch){return'<b>'+sMatch+'</b>';}
if(this.pbHighlight){if(this.pbFullText){oRegEx=new RegExp(df.sys.data.escapeRegExp(sSearch),(this.pbCaseSensitive?'g':'gi'));}else{sLowerSearch=sSearch.toLowerCase();iLen=sSearch.length;}}
aHtml.push('<table>');for(i=0;i<aList.length;i++){aHtml.push('<tr data-suggestnr="',i,'" class="WebSug_Suggestion ',(aList[i].sRowId===this._sSelectedId?'WebSug_Selected':''),'">');for(x=0;x<aList[i].aValues.length;x++){sVal=aList[i].aValues[x];aHtml.push('<td>');if(this.pbHighlight&&(this.peSuggestionMode!==df.smValidationTable||x===0)){if(this.pbFullText){aHtml.push(sVal.replace(oRegEx,makeBold));}else{if(sVal.substr(0,iLen).toLowerCase()===sLowerSearch){aHtml.push('<b>',sVal.substr(0,iLen),'</b>',sVal.substr(iLen));}else{aHtml.push(sVal);}}}else{aHtml.push(sVal);}
aHtml.push('</td>');}
aHtml.push('</tr>');}
aHtml.push('</table>');this._eSugContent.innerHTML=aHtml.join("");this.suggestPosition();},suggestRefine:function(sSearch){var i,x,aList=[],aBase=this._aSuggestBase,sLowVal,iLen,bServer=true,bFound=false,oRegEx;if(this.pbFullText){oRegEx=new RegExp(df.sys.data.escapeRegExp(sSearch),(this.pbCaseSensitive?'':'i'));for(i=0;i<aBase.length;i++){for(x=0;x<(this.peSuggestionMode!==df.smValidationTable?aBase[i].aValues.length:1);x++){if(oRegEx.test(aBase[i].aValues[x])){aList.push(aBase[i]);bFound=(bFound||aBase[i].sRowId===this._sSelectedId);break;}}}
this._aSuggestRows=aList;this.suggestRender(sSearch);if(aBase.length>=this.piMaxResults&&aList.length<this.piMaxResults){this.suggestLoad();}}else{sLowVal=sSearch.toLowerCase();iLen=sSearch.length;for(i=0;i<aBase.length;i++){if((!this.pbCaseSensitive&&aBase[i].aValues[0].substr(0,iLen).toLowerCase()===sLowVal)||(this.pbCaseSensitive&&aBase[i].aValues[0].substr(0,iLen)===sSearch)){aList.push(aBase[i]);bFound=(bFound||aBase[i].sRowId===this._sSelectedId);}else if(aList.length>0){bServer=(this.peDataType===df.ciTypeBCD);}}
this._aSuggestRows=aList;if(!bFound){this._sSelectedId=(aList.length>0?aList[0].sRowId:null);}
this.suggestRender(sSearch);if(aBase.length>=this.piMaxResults&&bServer&&sSearch!==this._sSuggestBaseVal){this.suggestLoad();}}},suggestSelect:function(){var i,aList=this._aSuggestRows,tRow=null;if(this._sSelectedId){for(i=0;i<aList.length;i++){if(aList[i].sRowId===this._sSelectedId){tRow=aList[i];break;}}
if(tRow){this.serverAction("SelectSuggestion",[this.getControlValue()],this.serializeVT([tRow]),function(oEvent){this.suggestHide();});}}},suggestMove:function(iDir){var i,aList=this._aSuggestRows;if(this._sSelectedId){for(i=0;i<aList.length;i++){if(aList[i].sRowId===this._sSelectedId){break;}}
i=i+iDir;i=(i>=0?(i<aList.length?i:aList.length-1):0);this.suggestHightlight(aList[i].sRowId);}else{this.suggestHightlight(aList.length>0?aList[0].sRowId:null);}},suggestHightlight:function(sId){var eElem,iTop,iBottom;this._sSelectedId=sId;this.suggestRender(this.getControlValue());eElem=df.dom.query(this._eSugContent,"tr.WebSug_Selected");if(eElem){iTop=df.sys.gui.getAbsoluteOffset(eElem).top;iBottom=iTop+eElem.offsetHeight;if(iTop-this._eSuggestions.scrollTop<0){this._eSuggestions.scrollTop=iTop;}else if(iBottom>this._eSuggestions.clientHeight+this._eSuggestions.scrollTop){this._eSuggestions.scrollTop=iBottom-this._eSuggestions.clientHeight;}}},onSuggestClick:function(oEvent){var iRow,eElem=oEvent.getTarget();if(eElem.tagName==="TD"){eElem=eElem.parentNode;}
if(eElem.hasAttribute("data-suggestnr")){iRow=parseInt(eElem.getAttribute("data-suggestnr"),10);if(this._aSuggestRows[iRow]){this.suggestHightlight(this._aSuggestRows[iRow].sRowId);this.suggestSelect();}}},onKey:function(oEvent){var oKeys=df.settings.suggestionKeys;df.WebSuggestionForm.base.onKey.call(this,oEvent);if(!oEvent.bCanceled){if(this._bSuggestVisible){if(oEvent.matchKey(oKeys.escape)){this.suggestHide();}else if(oEvent.matchKey(oKeys.select)){this.suggestSelect();oEvent.stop();}else if(oEvent.matchKey(oKeys.moveUp)){this.suggestMove(-1);oEvent.stop();}else if(oEvent.matchKey(oKeys.moveDown)){this.suggestMove(1);oEvent.stop();}}
if(oEvent.matchKey(oKeys.forceDisplay)&&this.pbAllowForce){oEvent.stop();}}},onSuggestKey:function(oEvent){var oKeys=df.settings.suggestionKeys,iKey=oEvent.getKeyCode();if(this._bSuggestVisible){this.suggestUpdate();}else{if(oEvent.matchKey(oKeys.forceDisplay)&&this.pbAllowForce){this._bForceDisplay=true;this.suggestDisplay();this.suggestUpdate();oEvent.stop();}else if(!oEvent.isSpecialKey()&&(iKey<112||iKey>127)){this.suggestUpdate();df.log("onSuggestKey");}}},onBlur:function(oEvent){var that=this;df.WebSuggestionForm.base.onBlur.call(this,oEvent);setTimeout(function(){if(!that._bHasFocus){that.suggestHide();}},100);}});

df.WebProgressBar=function WebProgressBar(oDef,oParent){df.WebProgressBar.base.constructor.call(this,oDef,oParent);this.prop(df.tInt,"piMaxValue",100);this.prop(df.tInt,"piValue",0);this.prop(df.tBool,"pbShowPercentage",true);this.prop(df.tString,"psCaption","");this.prop(df.tInt,"piDecimals","");this._eProgressBarWrp=null;this._eProgress=null;this._ePercentage=null;this.piColumnSpan=0;this.pbShowLabel=false;};df.defineClass("df.WebProgressBar","df.WebBaseControl",{openHtml:function(aHtml){df.WebProgressBar.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebProgressBar_Wrp">');aHtml.push('<div>');aHtml.push('<div class="WebProgressBar_Progress"></div>');if(this.psCaption!==""){aHtml.push('<div class="WebProgressBar_Percentage">',this.psCaption,'</div>');}else if(this.pbShowPercentage){aHtml.push('<div class="WebProgressBar_Percentage"></div>');}},closeHtml:function(aHtml){aHtml.push('</div></div>');df.WebProgressBar.base.closeHtml.call(this,aHtml);},afterRender:function(){this._eProgressBarWrp=df.dom.query(this._eElem,".WebProgressBar_Wrp");this._eProgress=df.dom.query(this._eElem,".WebProgressBar_Progress");this._ePercentage=df.dom.query(this._eElem,".WebProgressBar_Percentage");this.set_piValue(this.piValue);df.WebProgressBar.base.afterRender.call(this);},getPercentage:function(iCustomDecimals){var fPercentage,iDecimals=this.piDecimals;if(iCustomDecimals!==undefined){iDecimals=iCustomDecimals;}
iDecimals=Math.pow(10,iDecimals);fPercentage=(this.piValue/this.piMaxValue)*100;return Math.round(fPercentage*iDecimals)/iDecimals;},set_piValue:function(iVal){iVal=(iVal>=0?(iVal<=this.piMaxValue?iVal:this.piMaxValue):0);this.piValue=iVal;this._eProgress.style.width=this.getPercentage(2)+"%";if(this.pbShowPercentage&&this.psCaption===""){this._ePercentage.innerHTML=this.getPercentage()+"%";}}});

df.WebFileUploadButton=function WebFileUploadButton(sName,oParent){df.WebFileUploadButton.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","Select file(s)");this._sControlClass="WebButton WebUploadBtn";};df.defineClass("df.WebFileUploadButton","df.WebBaseFileUpload",{openHtml:function(aHtml){df.WebFileUploadButton.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFUB_Wrp">');aHtml.push('<button tabindex="-1" id="',this._sControlId,'"',(!this.pbEnabled?' disabled="disabled"':''),'></button>');this.fileHtml(aHtml);aHtml.push('</div>');},afterRender:function(){this._eButton=df.dom.query(this._eElem,"button");df.WebFileUploadButton.base.afterRender.call(this);this.set_psCaption(this.psCaption);},set_psCaption:function(sVal){if(this._eButton){df.dom.setText(this._eButton,sVal);}},set_pbEnabled:function(bVal){df.WebButton.base.set_pbEnabled.call(this,bVal);if(this._eButton){this._eButton.disabled=!bVal;}}});

df.ciUploadStateEmpty=0;df.ciUploadStateDisplay=1;df.ciUploadStateSelected=3;df.ciUploadStateUploading=4;df.ciUploadStateFinished=2;df.WebFileUploadForm=function WebFileUploadForm(sName,oParent){df.WebFileUploadForm.base.constructor.call(this,sName,oParent);this.prop(df.tInt,"peState",df.ciUploadStateEmpty);this.prop(df.tBool,"pbShowMime",false);this.prop(df.tString,"psFileName","");this.prop(df.tInt,"piFileSize",0);this.prop(df.tString,"psFileMime","");this.addSync("peState");this._sControlClass="WebFileFrm";};df.defineClass("df.WebFileUploadForm","df.WebBaseFileUpload",{openHtml:function(aHtml){df.WebFileUploadForm.base.openHtml.call(this,aHtml);aHtml.push('<div class="WebFrm_Wrapper"><div><div class="WebFile_Btn">');this.fileHtml(aHtml);aHtml.push('</div><div class="WebFile_Content"></div></div></div>');},afterRender:function(){this._eWrap=df.dom.query(this._eElem,"div.WebFrm_Wrapper");this._eContent=df.dom.query(this._eElem,"div.WebFile_Content");df.WebFileUploadForm.base.afterRender.call(this);this.updateDetails();},initFiles:function(aFiles){var oFile;if(aFiles.length>0){oFile=aFiles[0];this.addSync("psFileName");this.addSync("piFileSize");this.addSync("psFileMime");this._eState=this.peState;if(this.peState===df.ciUploadDisplay){this._sDisplayFileName=this.psFileName;this._iDisplayFileSize=this.piFileSize;this._sDisplayFileMime=this.psFileMime;}
this.peState=df.ciUploadStateSelected;this.psFileName=oFile.name;this.piFileSize=oFile.size;this.psFileMime=oFile.type;}
this.updateDetails();df.WebFileUploadForm.base.initFiles.call(this,aFiles);},updateDetails:function(){var oFile,sDtl;if(this.psFileName){if(this.peState===df.ciUploadStateSelected){df.dom.addClass(this._eWrap,"WebFile_Pending");}else{df.dom.addClass(this._eWrap,"WebFile_HasFile");}
sDtl=this.psFileName;if(this.pbShowMime&&this.piFileSize>0&&this.psFileMime){sDtl+=" (Size: "+df.sys.data.markupDataSize(this.piFileSize)+", Mime: "+this.psFileMime+")";}else if(this.piFileSize>0){sDtl+=" ("+df.sys.data.markupDataSize(this.piFileSize)+")";}}else{df.dom.removeClass(this._eWrap,"WebFile_HasFile");df.dom.removeClass(this._eWrap,"WebFile_Pending");sDtl="No file selected";}
this._eContent.innerHTML='<div class="WebFile_Details">'+sDtl+'</div>';},displayStartWorking:function(){if(!this.pbShowDialog){this._eContent.innerHTML='<div class="WebFile_Working"></div>';}else{df.WebFileUploadForm.base.displayStartWorking.call(this);}},displayProgress:function(iFile,iFiles,iFileLoaded,iFileTotal,iTotalLoaded,iTotal){var iPercent;if(!this.pbShowDialog){iPercent=(iTotalLoaded/iTotal)*100;if(!this._eBar){this._eContent.innerHTML='<div class="WebFile_Progress"><div class="WebFile_ProgressBar" style="width: 0%;"></div><div class="WebFile_ProgressLabel">0%</div></div>';this._eBar=df.dom.query(this._eContent,"div.WebFile_ProgressBar");this._eLbl=df.dom.query(this._eContent,"div.WebFile_ProgressLabel");}
this._eBar.style.width=(Math.round(iPercent*10)/10)+"%";df.dom.setText(this._eLbl,Math.round(iPercent)+"%");}else{df.WebFileUploadForm.base.displayProgress.call(this,iFile,iFiles,iFileLoaded,iFileTotal,iTotalLoaded,iTotal);}},displayFinishWorking:function(){if(!this.pbShowDialog){if(this._eBar){this._eBar.style.width="100%";}}else{df.WebFileUploadForm.base.displayFinishWorking.call(this);}},displayFinished:function(bSuccess){this._eBar=null;this._eLbl=null;this.peState=(bSuccess?df.ciUploadStateFinished:df.ciUploadStateSelected);this.updateDetails();df.WebFileUploadForm.base.displayFinished.call(this,bSuccess);}});

df.WebGroupBase=df.mixin("df.WebBaseContainer_mixin","df.WebBaseControl");df.WebGroup=function(sName,oParent){df.WebGroup.base.constructor.call(this,sName,oParent);this.prop(df.tString,"psCaption","");this.prop(df.tBool,"pbShowBorder",true);this._eCaption=null;this._sBaseClass="WebControl";this._sControlClass="WebGroup";};df.defineClass("df.WebGroup","df.WebGroupBase",{wrpOpenHtml:function(aHtml){aHtml.push('<label class="WebGrp_Caption"></label>');aHtml.push('<div class="WebContainer">');},wrpCloseHtml:function(aHtml){aHtml.push('</div>');},afterRender:function(){this._eCaption=df.dom.query(this._eElem,"label.WebGrp_Caption");this._eControl=df.dom.query(this._eElem,"div.WebCon_Inner > div");df.WebGroup.base.afterRender.call(this);df.dom.setText(this._eCaption,this.psCaption);},genClass:function(){var sClass=df.WebGroup.base.genClass.call(this);if(this.psCaption){sClass+=" WebGrp_HasCaption";}
if(this.pbShowBorder){sClass+=" WebGrp_HasBorder";}
return sClass;},set_psCaption:function(sVal){if(this._eCaption){df.dom.toggleClass(this._eElem,"WebGrp_HasCaption",!!sVal);df.dom.setText(this._eCaption,sVal);this.sizeChanged();}},set_pbShowBorder:function(bVal){if(this._eElem){df.dom.toggleClass(this._eElem,"WebGrp_HasBorder",bVal);this.sizeChanged();}},setHeight:function(iHeight){if(this._eContainer){if(iHeight>0){iHeight-=df.sys.gui.getVertBoxDiff(this._eControl);iHeight-=df.sys.gui.getVertBoxDiff(this._eInner);iHeight-=df.sys.gui.getVertBoxDiff(this._eControlWrp);this._eContainer.style.height=iHeight+"px";}else{this._eContainer.style.height="";}}},set_psBackgroundColor:function(sVal){if(this._eInner){this._eInner.style.backgroundColor=sVal||'';}}});
